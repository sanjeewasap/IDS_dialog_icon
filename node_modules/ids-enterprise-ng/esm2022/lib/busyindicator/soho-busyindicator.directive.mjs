import { Directive, EventEmitter, Input, Output, } from '@angular/core';
import * as i0 from "@angular/core";
/**
 * Angular Wrapper for the SoHo Busy Indicator control.
 *
 * This component searches for an element, annotated with the soho-busyindicator attribute,
 * and then matches this component to it.
 * <br>
 * The characteristics of the component can be controlled using the set of inputs.
 * <br>
 * When activated, this control will display the busy indicator over the control appropriately.
 */
export class SohoBusyIndicatorDirective {
    // -------------------------------------------
    // Component Inputs
    // -------------------------------------------
    // Makes the element that Busy Indicator is invoked on unusable while it's displayed.
    set blockUI(blockUI) {
        this.options.blockUI = blockUI;
        if (this.busyindicator) {
            this.busyindicator.settings.blockUI = blockUI;
            this.updateBusyIndicator = true;
        }
    }
    // Number in milliseconds to pass before the markup is displayed.  If 0, displays immediately
    set displayDelay(displayDelay) {
        this.options.displayDelay = displayDelay;
        if (this.busyindicator) {
            this.busyindicator.settings.displayDelay = displayDelay;
            this.updateBusyIndicator = true;
        }
    }
    // Fires the 'complete' trigger at a certain timing interval.  If 0, goes indefinitely.
    set timeToComplete(timeToComplete) {
        this.options.timeToComplete = timeToComplete;
        if (this.busyindicator) {
            this.busyindicator.settings.timeToComplete = timeToComplete;
            this.updateBusyIndicator = true;
        }
    }
    /** Custom Text To Show or Will Show Localized 'Loading...' */
    set text(text) {
        this.options.text = text;
        if (this.busyindicator) {
            this.busyindicator.settings.text = text;
            this.updateBusyIndicator = true;
        }
    }
    /** Controls the activated state of the busy indicator. */
    set activated(value) {
        this.initiallyActive = value;
        if (value) {
            this.open();
        }
        else {
            this.close(true);
        }
    }
    /**
     * Display an overlay that prevents interaction,
     * but appears transparent instead of gray.
     */
    set transparentOverlay(transparentOverlay) {
        this.options.transparentOverlay = transparentOverlay;
        if (this.busyindicator) {
            this.busyindicator.settings.transparentOverlay = transparentOverlay;
            this.updateBusyIndicator = true;
        }
    }
    /**
     * To display only the overlay w/o the badge and text. Useful to stop input to a component
     * that doesn't already have another mechanism (like a disabled state).
     */
    set overlayOnly(overlayOnly) {
        this.options.overlayOnly = overlayOnly;
        if (this.busyindicator) {
            this.busyindicator.settings.overlayOnly = overlayOnly;
            this.updateBusyIndicator = true;
        }
    }
    /**
     * To display only the overlay w/o the badge and text. Useful to stop input to a component
     * that doesn't already have another mechanism (like a disabled state).
     */
    set attributes(attributes) {
        this.options.attributes = attributes;
        if (this.busyindicator) {
            this.busyindicator.settings.attributes = attributes;
            this.updateBusyIndicator = true;
        }
    }
    /**
     * To get the attributes of the busy indicator. Useful for things like getting an indicator based on an Id.
     */
    get attributes() {
        if (this.busyindicator) {
            return this.options.attributes ? this.options.attributes : [];
        }
        return [];
    }
    /**
     * Constructor.
     *
     * @param elementRef - the element matching the component's selector.
     */
    constructor(elementRef, ngZone) {
        this.elementRef = elementRef;
        this.ngZone = ngZone;
        // -------------------------------------------
        // Options Block
        // -------------------------------------------
        this.options = {};
        this.updateBusyIndicator = false;
        // -------------------------------------------
        // Component Output
        // -------------------------------------------
        // Fired after the busy indicator is displayed
        this.afterstart = new EventEmitter();
        /**
         * This event is fired when 'timeToComplete' milliseconds is reached
         * after the indicator is opened.
         *
         * @todo replace override of native attribute
         */
        // eslint-disable-next-line @angular-eslint/no-output-native
        this.complete = new EventEmitter();
    }
    // -------------------------------------------
    // Public API
    // -------------------------------------------
    /**
     * Closes the indicator, if open.
     */
    close(fromEvent) {
        if (this.busyindicator) {
            // call outside the angular zone so change detection isn't triggered by the soho component.
            this.ngZone.runOutsideAngular(() => this.busyindicator?.close(fromEvent));
        }
    }
    /**
     * Displays the busy indicator.
     */
    open() {
        if (this.busyindicator) {
            // call outside the angular zone so change detection isn't triggered by the soho component.
            this.ngZone.runOutsideAngular(() => this.busyindicator?.activate());
        }
    }
    isActive() {
        if (this.busyindicator) {
            // call outside the angular zone so change detection isn't triggered by the soho component.
            return this.ngZone.runOutsideAngular(() => this.busyindicator?.isActive());
        }
        return false;
    }
    // ------------------------------------------
    // Lifecycle Events
    // ------------------------------------------
    ngAfterViewInit() {
        this.ngZone.runOutsideAngular(() => {
            // Wrap the element in a jQuery selector.
            this.jQueryElement = jQuery(this.elementRef.nativeElement);
            // Initialise the SohoXi Control
            this.jQueryElement.busyindicator(this.options);
            // Once the control is initialised, extract the control
            // plug-in from the element.  The element name is
            // defined by the plug-in, but in this case it is 'busyindicator'.
            this.busyindicator = this.jQueryElement.data('busyindicator');
            // Initialise any event handlers.
            this.jQueryElement.on('afterstart', (e) => this.onAfterStart(e));
            this.jQueryElement.on('complete', (e) => this.onComplete(e));
            // Set initial state
            this.ngZone.run(() => this.activated = this.initiallyActive);
        });
    }
    ngAfterViewChecked() {
        if (this.busyindicator && this.updateBusyIndicator) {
            // call outside the angular zone so change detection isn't triggered by the soho component.
            this.ngZone.runOutsideAngular(() => {
                this.updateBusyIndicator = false;
                this.busyindicator?.updated();
            });
        }
    }
    /**
     * Destructor.
     */
    ngOnDestroy() {
        this.ngZone.runOutsideAngular(() => {
            if (this.jQueryElement) {
                this.jQueryElement.off();
                this.jQueryElement = undefined;
            }
            if (this.busyindicator) {
                // call outside the angular zone so change detection isn't triggered by the soho component.
                this.busyindicator?.destroy();
                this.busyindicator = null;
            }
        });
    }
    // -------------------------------------------
    // Event Handlers
    // -------------------------------------------
    /**
     * Publishes the event, after annotating the event.
     */
    onAfterStart(event) {
        this.ngZone.run(() => this.afterstart.next({
            type: 'afterstart',
            component: this,
            event
        }));
    }
    /**
     * Publishes the event, after annotating the event.
     */
    onComplete(event) {
        this.ngZone.run(() => this.complete.next({
            type: 'complete',
            component: this,
            event
        }));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoBusyIndicatorDirective, deps: [{ token: i0.ElementRef }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.1.4", type: SohoBusyIndicatorDirective, selector: "[soho-busyindicator]", inputs: { blockUI: "blockUI", displayDelay: "displayDelay", timeToComplete: "timeToComplete", text: "text", activated: "activated", transparentOverlay: "transparentOverlay", overlayOnly: "overlayOnly", attributes: "attributes" }, outputs: { afterstart: "afterstart", complete: "complete" }, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoBusyIndicatorDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[soho-busyindicator]'
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.NgZone }]; }, propDecorators: { afterstart: [{
                type: Output
            }], complete: [{
                type: Output
            }], blockUI: [{
                type: Input
            }], displayDelay: [{
                type: Input
            }], timeToComplete: [{
                type: Input
            }], text: [{
                type: Input
            }], activated: [{
                type: Input
            }], transparentOverlay: [{
                type: Input
            }], overlayOnly: [{
                type: Input
            }], attributes: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1idXN5aW5kaWNhdG9yLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2lkcy1lbnRlcnByaXNlLW5nL3NyYy9saWIvYnVzeWluZGljYXRvci9zb2hvLWJ1c3lpbmRpY2F0b3IuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFHTCxTQUFTLEVBRVQsWUFBWSxFQUNaLEtBQUssRUFFTCxNQUFNLEdBRVAsTUFBTSxlQUFlLENBQUM7O0FBRXZCOzs7Ozs7Ozs7R0FTRztBQUlILE1BQU0sT0FBTywwQkFBMEI7SUFzQ3JDLDhDQUE4QztJQUM5QyxtQkFBbUI7SUFDbkIsOENBQThDO0lBRTlDLHFGQUFxRjtJQUNyRixJQUNXLE9BQU8sQ0FBQyxPQUFnQjtRQUNqQyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDL0IsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3JCLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBZ0IsQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1lBQ3ZELElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUM7U0FDakM7SUFDSCxDQUFDO0lBRUQsNkZBQTZGO0lBQzdGLElBQ1csWUFBWSxDQUFDLFlBQW9CO1FBQzFDLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztRQUN6QyxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUU7WUFDckIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFnQixDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7WUFDakUsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQztTQUNqQztJQUNILENBQUM7SUFFRCx1RkFBdUY7SUFDdkYsSUFDVyxjQUFjLENBQUMsY0FBc0I7UUFDOUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLEdBQUcsY0FBYyxDQUFDO1FBQzdD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ZXdDaGVja2VkLFxuICBBZnRlclZpZXdJbml0LFxuICBEaXJlY3RpdmUsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE5nWm9uZSxcbiAgT3V0cHV0LFxuICBPbkRlc3Ryb3ksXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG4vKipcbiAqIEFuZ3VsYXIgV3JhcHBlciBmb3IgdGhlIFNvSG8gQnVzeSBJbmRpY2F0b3IgY29udHJvbC5cbiAqXG4gKiBUaGlzIGNvbXBvbmVudCBzZWFyY2hlcyBmb3IgYW4gZWxlbWVudCwgYW5ub3RhdGVkIHdpdGggdGhlIHNvaG8tYnVzeWluZGljYXRvciBhdHRyaWJ1dGUsXG4gKiBhbmQgdGhlbiBtYXRjaGVzIHRoaXMgY29tcG9uZW50IHRvIGl0LlxuICogPGJyPlxuICogVGhlIGNoYXJhY3RlcmlzdGljcyBvZiB0aGUgY29tcG9uZW50IGNhbiBiZSBjb250cm9sbGVkIHVzaW5nIHRoZSBzZXQgb2YgaW5wdXRzLlxuICogPGJyPlxuICogV2hlbiBhY3RpdmF0ZWQsIHRoaXMgY29udHJvbCB3aWxsIGRpc3BsYXkgdGhlIGJ1c3kgaW5kaWNhdG9yIG92ZXIgdGhlIGNvbnRyb2wgYXBwcm9wcmlhdGVseS5cbiAqL1xuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW3NvaG8tYnVzeWluZGljYXRvcl0nXG59KVxuZXhwb3J0IGNsYXNzIFNvaG9CdXN5SW5kaWNhdG9yRGlyZWN0aXZlIGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgQWZ0ZXJWaWV3Q2hlY2tlZCwgT25EZXN0cm95IHtcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIE9wdGlvbnMgQmxvY2tcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIHByaXZhdGUgb3B0aW9uczogU29ob0J1c3lJbmRpY2F0b3JPcHRpb25zID0ge1xuICB9O1xuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gUHJpdmF0ZSBNZW1iZXIgRGF0YVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLy8gUmVmZXJlbmNlIHRvIHRoZSBqUXVlcnkgY29udHJvbC5cbiAgcHJpdmF0ZSBqUXVlcnlFbGVtZW50PzogSlF1ZXJ5O1xuXG4gIHByaXZhdGUgaW5pdGlhbGx5QWN0aXZlPzogYm9vbGVhbjtcblxuICAvLyBSZWZlcmVuY2UgdG8gdGhlIFNvSG9YaSBjb250cm9sIGFwaS5cbiAgcHJpdmF0ZSBidXN5aW5kaWNhdG9yPzogU29ob0J1c3lJbmRpY2F0b3JTdGF0aWMgfCBudWxsO1xuXG4gIHByaXZhdGUgdXBkYXRlQnVzeUluZGljYXRvciA9IGZhbHNlO1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIENvbXBvbmVudCBPdXRwdXRcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8vIEZpcmVkIGFmdGVyIHRoZSBidXN5IGluZGljYXRvciBpcyBkaXNwbGF5ZWRcbiAgQE91dHB1dCgpIGFmdGVyc3RhcnQgPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9CdXN5SW5kaWNhdG9yRXZlbnQ+KCk7XG5cbiAgLyoqXG4gICAqIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiAndGltZVRvQ29tcGxldGUnIG1pbGxpc2Vjb25kcyBpcyByZWFjaGVkXG4gICAqIGFmdGVyIHRoZSBpbmRpY2F0b3IgaXMgb3BlbmVkLlxuICAgKlxuICAgKiBAdG9kbyByZXBsYWNlIG92ZXJyaWRlIG9mIG5hdGl2ZSBhdHRyaWJ1dGVcbiAgICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LW5hdGl2ZVxuICBAT3V0cHV0KCkgY29tcGxldGUgPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9CdXN5SW5kaWNhdG9yRXZlbnQ+KCk7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBDb21wb25lbnQgSW5wdXRzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvLyBNYWtlcyB0aGUgZWxlbWVudCB0aGF0IEJ1c3kgSW5kaWNhdG9yIGlzIGludm9rZWQgb24gdW51c2FibGUgd2hpbGUgaXQncyBkaXNwbGF5ZWQuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgYmxvY2tVSShibG9ja1VJOiBib29sZWFuKSB7XG4gICAgdGhpcy5vcHRpb25zLmJsb2NrVUkgPSBibG9ja1VJO1xuICAgIGlmICh0aGlzLmJ1c3lpbmRpY2F0b3IpIHtcbiAgICAgICh0aGlzLmJ1c3lpbmRpY2F0b3Iuc2V0dGluZ3MgYXMgYW55KS5ibG9ja1VJID0gYmxvY2tVSTtcbiAgICAgIHRoaXMudXBkYXRlQnVzeUluZGljYXRvciA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgLy8gTnVtYmVyIGluIG1pbGxpc2Vjb25kcyB0byBwYXNzIGJlZm9yZSB0aGUgbWFya3VwIGlzIGRpc3BsYXllZC4gIElmIDAsIGRpc3BsYXlzIGltbWVkaWF0ZWx5XG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgZGlzcGxheURlbGF5KGRpc3BsYXlEZWxheTogbnVtYmVyKSB7XG4gICAgdGhpcy5vcHRpb25zLmRpc3BsYXlEZWxheSA9IGRpc3BsYXlEZWxheTtcbiAgICBpZiAodGhpcy5idXN5aW5kaWNhdG9yKSB7XG4gICAgICAodGhpcy5idXN5aW5kaWNhdG9yLnNldHRpbmdzIGFzIGFueSkuZGlzcGxheURlbGF5ID0gZGlzcGxheURlbGF5O1xuICAgICAgdGhpcy51cGRhdGVCdXN5SW5kaWNhdG9yID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvLyBGaXJlcyB0aGUgJ2NvbXBsZXRlJyB0cmlnZ2VyIGF0IGEgY2VydGFpbiB0aW1pbmcgaW50ZXJ2YWwuICBJZiAwLCBnb2VzIGluZGVmaW5pdGVseS5cbiAgQElucHV0KClcbiAgcHVibGljIHNldCB0aW1lVG9Db21wbGV0ZSh0aW1lVG9Db21wbGV0ZTogbnVtYmVyKSB7XG4gICAgdGhpcy5vcHRpb25zLnRpbWVUb0NvbXBsZXRlID0gdGltZVRvQ29tcGxldGU7XG4gICAgaWYgKHRoaXMuYnVzeWluZGljYXRvcikge1xuICAgICAgKHRoaXMuYnVzeWluZGljYXRvci5zZXR0aW5ncyBhcyBhbnkpLnRpbWVUb0NvbXBsZXRlID0gdGltZVRvQ29tcGxldGU7XG4gICAgICB0aGlzLnVwZGF0ZUJ1c3lJbmRpY2F0b3IgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBDdXN0b20gVGV4dCBUbyBTaG93IG9yIFdpbGwgU2hvdyBMb2NhbGl6ZWQgJ0xvYWRpbmcuLi4nICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgdGV4dCh0ZXh0OiBzdHJpbmcpIHtcbiAgICB0aGlzLm9wdGlvbnMudGV4dCA9IHRleHQ7XG4gICAgaWYgKHRoaXMuYnVzeWluZGljYXRvcikge1xuICAgICAgKHRoaXMuYnVzeWluZGljYXRvci5zZXR0aW5ncyBhcyBhbnkpLnRleHQgPSB0ZXh0O1xuICAgICAgdGhpcy51cGRhdGVCdXN5SW5kaWNhdG9yID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvKiogQ29udHJvbHMgdGhlIGFjdGl2YXRlZCBzdGF0ZSBvZiB0aGUgYnVzeSBpbmRpY2F0b3IuICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgYWN0aXZhdGVkKHZhbHVlOiBib29sZWFuIHwgdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5pbml0aWFsbHlBY3RpdmUgPSB2YWx1ZTtcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHRoaXMub3BlbigpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNsb3NlKHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNwbGF5IGFuIG92ZXJsYXkgdGhhdCBwcmV2ZW50cyBpbnRlcmFjdGlvbixcbiAgICogYnV0IGFwcGVhcnMgdHJhbnNwYXJlbnQgaW5zdGVhZCBvZiBncmF5LlxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIHNldCB0cmFuc3BhcmVudE92ZXJsYXkodHJhbnNwYXJlbnRPdmVybGF5OiBib29sZWFuKSB7XG4gICAgdGhpcy5vcHRpb25zLnRyYW5zcGFyZW50T3ZlcmxheSA9IHRyYW5zcGFyZW50T3ZlcmxheTtcbiAgICBpZiAodGhpcy5idXN5aW5kaWNhdG9yKSB7XG4gICAgICAodGhpcy5idXN5aW5kaWNhdG9yLnNldHRpbmdzIGFzIGFueSkudHJhbnNwYXJlbnRPdmVybGF5ID0gdHJhbnNwYXJlbnRPdmVybGF5O1xuICAgICAgdGhpcy51cGRhdGVCdXN5SW5kaWNhdG9yID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVG8gZGlzcGxheSBvbmx5IHRoZSBvdmVybGF5IHcvbyB0aGUgYmFkZ2UgYW5kIHRleHQuIFVzZWZ1bCB0byBzdG9wIGlucHV0IHRvIGEgY29tcG9uZW50XG4gICAqIHRoYXQgZG9lc24ndCBhbHJlYWR5IGhhdmUgYW5vdGhlciBtZWNoYW5pc20gKGxpa2UgYSBkaXNhYmxlZCBzdGF0ZSkuXG4gICAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgc2V0IG92ZXJsYXlPbmx5KG92ZXJsYXlPbmx5OiBib29sZWFuKSB7XG4gICAgdGhpcy5vcHRpb25zLm92ZXJsYXlPbmx5ID0gb3ZlcmxheU9ubHk7XG4gICAgaWYgKHRoaXMuYnVzeWluZGljYXRvcikge1xuICAgICAgKHRoaXMuYnVzeWluZGljYXRvci5zZXR0aW5ncyBhcyBhbnkpLm92ZXJsYXlPbmx5ID0gb3ZlcmxheU9ubHk7XG4gICAgICB0aGlzLnVwZGF0ZUJ1c3lJbmRpY2F0b3IgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUbyBkaXNwbGF5IG9ubHkgdGhlIG92ZXJsYXkgdy9vIHRoZSBiYWRnZSBhbmQgdGV4dC4gVXNlZnVsIHRvIHN0b3AgaW5wdXQgdG8gYSBjb21wb25lbnRcbiAgICogdGhhdCBkb2Vzbid0IGFscmVhZHkgaGF2ZSBhbm90aGVyIG1lY2hhbmlzbSAobGlrZSBhIGRpc2FibGVkIHN0YXRlKS5cbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgYXR0cmlidXRlcyhhdHRyaWJ1dGVzOiBBcnJheTxPYmplY3Q+IHwgT2JqZWN0KSB7XG4gICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzO1xuICAgIGlmICh0aGlzLmJ1c3lpbmRpY2F0b3IpIHtcbiAgICAgICh0aGlzLmJ1c3lpbmRpY2F0b3Iuc2V0dGluZ3MgYXMgYW55KS5hdHRyaWJ1dGVzID0gYXR0cmlidXRlcztcbiAgICAgIHRoaXMudXBkYXRlQnVzeUluZGljYXRvciA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRvIGdldCB0aGUgYXR0cmlidXRlcyBvZiB0aGUgYnVzeSBpbmRpY2F0b3IuIFVzZWZ1bCBmb3IgdGhpbmdzIGxpa2UgZ2V0dGluZyBhbiBpbmRpY2F0b3IgYmFzZWQgb24gYW4gSWQuXG4gICAqL1xuICBwdWJsaWMgZ2V0IGF0dHJpYnV0ZXMoKTogT2JqZWN0IHwgQXJyYXk8T2JqZWN0PiB7XG4gICAgaWYgKHRoaXMuYnVzeWluZGljYXRvcikge1xuICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVzID8gdGhpcy5vcHRpb25zLmF0dHJpYnV0ZXMgOiBbXTtcbiAgICB9XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnN0cnVjdG9yLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbWVudFJlZiAtIHRoZSBlbGVtZW50IG1hdGNoaW5nIHRoZSBjb21wb25lbnQncyBzZWxlY3Rvci5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxuICApIHsgfVxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gUHVibGljIEFQSVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLyoqXG4gICAqIENsb3NlcyB0aGUgaW5kaWNhdG9yLCBpZiBvcGVuLlxuICAgKi9cbiAgcHVibGljIGNsb3NlKGZyb21FdmVudDogYm9vbGVhbikge1xuICAgIGlmICh0aGlzLmJ1c3lpbmRpY2F0b3IpIHtcbiAgICAgIC8vIGNhbGwgb3V0c2lkZSB0aGUgYW5ndWxhciB6b25lIHNvIGNoYW5nZSBkZXRlY3Rpb24gaXNuJ3QgdHJpZ2dlcmVkIGJ5IHRoZSBzb2hvIGNvbXBvbmVudC5cbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuYnVzeWluZGljYXRvcj8uY2xvc2UoZnJvbUV2ZW50KSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERpc3BsYXlzIHRoZSBidXN5IGluZGljYXRvci5cbiAgICovXG4gIHB1YmxpYyBvcGVuKCkge1xuICAgIGlmICh0aGlzLmJ1c3lpbmRpY2F0b3IpIHtcbiAgICAgIC8vIGNhbGwgb3V0c2lkZSB0aGUgYW5ndWxhciB6b25lIHNvIGNoYW5nZSBkZXRlY3Rpb24gaXNuJ3QgdHJpZ2dlcmVkIGJ5IHRoZSBzb2hvIGNvbXBvbmVudC5cbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuYnVzeWluZGljYXRvcj8uYWN0aXZhdGUoKSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGlzQWN0aXZlKCk6IGJvb2xlYW4gfCB1bmRlZmluZWQge1xuICAgIGlmICh0aGlzLmJ1c3lpbmRpY2F0b3IpIHtcbiAgICAgIC8vIGNhbGwgb3V0c2lkZSB0aGUgYW5ndWxhciB6b25lIHNvIGNoYW5nZSBkZXRlY3Rpb24gaXNuJ3QgdHJpZ2dlcmVkIGJ5IHRoZSBzb2hvIGNvbXBvbmVudC5cbiAgICAgIHJldHVybiB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLmJ1c3lpbmRpY2F0b3I/LmlzQWN0aXZlKCkpO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gTGlmZWN5Y2xlIEV2ZW50c1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgLy8gV3JhcCB0aGUgZWxlbWVudCBpbiBhIGpRdWVyeSBzZWxlY3Rvci5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudCA9IGpRdWVyeSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCk7XG5cbiAgICAgIC8vIEluaXRpYWxpc2UgdGhlIFNvaG9YaSBDb250cm9sXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQuYnVzeWluZGljYXRvcih0aGlzLm9wdGlvbnMpO1xuXG4gICAgICAvLyBPbmNlIHRoZSBjb250cm9sIGlzIGluaXRpYWxpc2VkLCBleHRyYWN0IHRoZSBjb250cm9sXG4gICAgICAvLyBwbHVnLWluIGZyb20gdGhlIGVsZW1lbnQuICBUaGUgZWxlbWVudCBuYW1lIGlzXG4gICAgICAvLyBkZWZpbmVkIGJ5IHRoZSBwbHVnLWluLCBidXQgaW4gdGhpcyBjYXNlIGl0IGlzICdidXN5aW5kaWNhdG9yJy5cbiAgICAgIHRoaXMuYnVzeWluZGljYXRvciA9IHRoaXMualF1ZXJ5RWxlbWVudC5kYXRhKCdidXN5aW5kaWNhdG9yJyk7XG5cbiAgICAgIC8vIEluaXRpYWxpc2UgYW55IGV2ZW50IGhhbmRsZXJzLlxuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50Lm9uKCdhZnRlcnN0YXJ0JywgKGU6IEpRdWVyeS5UcmlnZ2VyZWRFdmVudCkgPT4gdGhpcy5vbkFmdGVyU3RhcnQoZSkpO1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50Lm9uKCdjb21wbGV0ZScsIChlOiBKUXVlcnkuVHJpZ2dlcmVkRXZlbnQpID0+IHRoaXMub25Db21wbGV0ZShlKSk7XG5cbiAgICAgIC8vIFNldCBpbml0aWFsIHN0YXRlXG4gICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gdGhpcy5hY3RpdmF0ZWQgPSB0aGlzLmluaXRpYWxseUFjdGl2ZSk7XG4gICAgfSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0NoZWNrZWQoKSB7XG4gICAgaWYgKHRoaXMuYnVzeWluZGljYXRvciAmJiB0aGlzLnVwZGF0ZUJ1c3lJbmRpY2F0b3IpIHtcbiAgICAgIC8vIGNhbGwgb3V0c2lkZSB0aGUgYW5ndWxhciB6b25lIHNvIGNoYW5nZSBkZXRlY3Rpb24gaXNuJ3QgdHJpZ2dlcmVkIGJ5IHRoZSBzb2hvIGNvbXBvbmVudC5cbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgdGhpcy51cGRhdGVCdXN5SW5kaWNhdG9yID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYnVzeWluZGljYXRvcj8udXBkYXRlZCgpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERlc3RydWN0b3IuXG4gICAqL1xuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICBpZiAodGhpcy5qUXVlcnlFbGVtZW50KSB7XG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vZmYoKTtcbiAgICAgICAgdGhpcy5qUXVlcnlFbGVtZW50ID0gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuYnVzeWluZGljYXRvcikge1xuICAgICAgICAvLyBjYWxsIG91dHNpZGUgdGhlIGFuZ3VsYXIgem9uZSBzbyBjaGFuZ2UgZGV0ZWN0aW9uIGlzbid0IHRyaWdnZXJlZCBieSB0aGUgc29obyBjb21wb25lbnQuXG4gICAgICAgIHRoaXMuYnVzeWluZGljYXRvcj8uZGVzdHJveSgpO1xuICAgICAgICB0aGlzLmJ1c3lpbmRpY2F0b3IgPSBudWxsO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBFdmVudCBIYW5kbGVyc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLyoqXG4gICAqIFB1Ymxpc2hlcyB0aGUgZXZlbnQsIGFmdGVyIGFubm90YXRpbmcgdGhlIGV2ZW50LlxuICAgKi9cbiAgcHJpdmF0ZSBvbkFmdGVyU3RhcnQoZXZlbnQ6IEpRdWVyeS5UcmlnZ2VyZWRFdmVudCkge1xuICAgIHRoaXMubmdab25lLnJ1bigoKSA9PlxuICAgICAgdGhpcy5hZnRlcnN0YXJ0Lm5leHQoe1xuICAgICAgICB0eXBlOiAnYWZ0ZXJzdGFydCcsXG4gICAgICAgIGNvbXBvbmVudDogdGhpcyxcbiAgICAgICAgZXZlbnRcbiAgICAgIH0pKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQdWJsaXNoZXMgdGhlIGV2ZW50LCBhZnRlciBhbm5vdGF0aW5nIHRoZSBldmVudC5cbiAgICovXG4gIHByaXZhdGUgb25Db21wbGV0ZShldmVudDogSlF1ZXJ5LlRyaWdnZXJlZEV2ZW50KSB7XG4gICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+XG4gICAgICB0aGlzLmNvbXBsZXRlLm5leHQoe1xuICAgICAgICB0eXBlOiAnY29tcGxldGUnLFxuICAgICAgICBjb21wb25lbnQ6IHRoaXMsXG4gICAgICAgIGV2ZW50XG4gICAgICB9KSk7XG4gIH1cbn1cblxuLyoqXG4gKiBDdXN0b21pc2VkIGV2ZW50IG9iamVjdC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTb2hvQnVzeUluZGljYXRvckV2ZW50IHtcbiAgLyoqIEV2ZW50IFR5cGUuICovXG4gIHR5cGU6ICdhZnRlcnN0YXJ0JyB8ICdjb21wbGV0ZSc7XG5cbiAgLyoqIFNvdXJjZSBDb21wb25lbnQuICovXG4gIGNvbXBvbmVudDogU29ob0J1c3lJbmRpY2F0b3JEaXJlY3RpdmU7XG5cbiAgLyoqIEZ1bGwgSlF1ZXJ5IEV2ZW50LiAqL1xuICBldmVudDogSlF1ZXJ5LlRyaWdnZXJlZEV2ZW50O1xufVxuIl19