import { Component, Input, EventEmitter, Output, } from '@angular/core';
import * as i0 from "@angular/core";
export class SohoChartComponent {
    set chartOptions(chartOptions) {
        this._chartOptions = chartOptions;
        if (this.jQueryElement) {
            this.updateRequired = true;
        }
    }
    set selectedIndex(index) {
        this.setSelectRef(index);
        // this.setSelectDataIndex(index);
        //
        // if (this.jQueryElement) {
        //   this.updated();
        // }
    }
    set dataSet(dataset) {
        this._chartOptions.dataset = dataset;
        if (this.jQueryElement) {
            this.updateRequired = true;
        }
    }
    set type(type) {
        this._chartOptions.type = type;
    }
    set axisLabels(axisLabels) {
        this._chartOptions.axisLabels = axisLabels;
    }
    set showLegend(showLegend) {
        this._chartOptions.showLegend = showLegend;
    }
    set hideLabels(hideLabels) {
        if (this._chartOptions.labels) {
            this._chartOptions.labels.hideLabels = !hideLabels;
        }
        else {
            this._chartOptions['labels'] = { hideLabels: !hideLabels };
        }
    }
    set formatterString(formatterString) {
        this._chartOptions.formatterString = formatterString;
    }
    set legendFormatter(legendFormatter) {
        this._chartOptions.legendFormatter = legendFormatter;
    }
    set chartLabel(chartLabel) {
        this._chartOptions.chartLabel = chartLabel;
    }
    set chartredrawOnResizeLabel(redrawOnResize) {
        this._chartOptions.redrawOnResize = redrawOnResize;
    }
    set chartAnimate(animate) {
        this._chartOptions.animate = animate;
    }
    constructor(elementRef, ngZone) {
        this.elementRef = elementRef;
        this.ngZone = ngZone;
        // ------------------------------------------------------------------------
        // @Outputs
        // ------------------------------------------------------------------------
        this.selected = new EventEmitter();
        this.unselected = new EventEmitter();
        this.rendered = new EventEmitter();
        /**
         * @todo replace override of native attribute
         */
        // eslint-disable-next-line @angular-eslint/no-output-rename, @angular-eslint/no-output-native
        this.contextmenu = new EventEmitter();
        // An internal chartOptions object that gets updated by using
        // the component's Inputs()
        this._chartOptions = { animate: true };
        this.updateRequired = false;
    }
    ngAfterViewInit() {
        this.ngZone.runOutsideAngular(() => {
            // Wrap for later.
            this.jQueryElement = jQuery(this.elementRef.nativeElement);
            this.jQueryElement.chart(this._chartOptions);
            this.chart = this.jQueryElement.data('chart');
            // bind to jquery events and emit as angular events
            this.jQueryElement.on('selected', (event, ui, data) => this.ngZone.run(() => this.selected.emit({ event, ui, data })));
            this.jQueryElement.on('unselected', (event, ui, data) => this.ngZone.run(() => this.unselected.emit({ event, ui, data })));
            this.jQueryElement.on('rendered', (event, ui, data) => this.ngZone.run(() => this.rendered.emit({ event, ui, data })));
            this.jQueryElement.on('contextmenu', (event, ui, data) => this.ngZone.run(() => this.contextmenu?.emit({ event, ui, data })));
        });
    }
    ngAfterViewChecked() {
        if (this.updateRequired) {
            this.updated();
            this.updateRequired = false;
        }
    }
    ngOnDestroy() {
    }
    getChartOptions() {
        return this._chartOptions;
    }
    updated() {
        this.ngZone.runOutsideAngular(() => {
            this.jQueryElement?.chart(this._chartOptions);
            this.chart = this.jQueryElement?.data('chart');
        });
    }
    getSelected() {
        if (this.jQueryElement) {
            return this.ngZone.runOutsideAngular(() => this.chart?.getSelected());
        }
        return undefined;
    }
    setSelectRef(ref) {
        this.ngZone.runOutsideAngular(() => {
            if (this.jQueryElement) {
                let selectOptions;
                if (this._chartOptions.type?.indexOf('grouped') >= 0 || this._chartOptions.type === 'column') {
                    selectOptions = { groupName: 'ref', groupValue: ref };
                }
                else {
                    selectOptions = { fieldName: 'ref', fieldValue: ref };
                }
                this.chart?.setSelected(selectOptions);
            }
        });
    }
    setSelectDataIndex(selectIndex) {
        if (this.jQueryElement) {
            const dataArray = this._chartOptions.dataset || [];
            if (this._chartOptions.type === 'pie' || this._chartOptions.type === 'donut') {
                // eslint-disable-next-line @typescript-eslint/prefer-for-of
                for (let i = 0; i < dataArray.length; i++) {
                    const dataNode = dataArray[i];
                    for (let j = 0; j < dataNode.data.length; j++) {
                        const data = dataNode.data[j];
                        if (selectIndex === j) {
                            data.selected = true;
                        }
                        else {
                            delete data.selected;
                        }
                    }
                }
            }
            else {
                for (let i = 0; i < dataArray.length; i++) {
                    const data = dataArray[i];
                    if (selectIndex === i) {
                        data.selected = true;
                    }
                    else {
                        delete data.selected;
                    }
                }
            }
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoChartComponent, deps: [{ token: i0.ElementRef }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: SohoChartComponent, selector: "div[soho-chart]", inputs: { chartOptions: "chartOptions", selectedIndex: "selectedIndex", dataSet: "dataSet", type: "type", axisLabels: "axisLabels", showLegend: "showLegend", hideLabels: "hideLabels", formatterString: "formatterString", legendFormatter: "legendFormatter", chartLabel: "chartLabel", chartredrawOnResizeLabel: "chartredrawOnResizeLabel", chartAnimate: "chartAnimate" }, outputs: { selected: "selected", unselected: "unselected", rendered: "rendered", contextmenu: "contextmenu" }, ngImport: i0, template: ' ', isInline: true }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoChartComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'div[soho-chart]',
                    template: ' '
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.NgZone }]; }, propDecorators: { chartOptions: [{
                type: Input
            }], selectedIndex: [{
                type: Input
            }], dataSet: [{
                type: Input
            }], type: [{
                type: Input
            }], axisLabels: [{
                type: Input
            }], showLegend: [{
                type: Input
            }], hideLabels: [{
                type: Input
            }], formatterString: [{
                type: Input
            }], legendFormatter: [{
                type: Input
            }], chartLabel: [{
                type: Input
            }], chartredrawOnResizeLabel: [{
                type: Input
            }], chartAnimate: [{
                type: Input
            }], selected: [{
                type: Output
            }], unselected: [{
                type: Output
            }], rendered: [{
                type: Output
            }], contextmenu: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1jaGFydC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9pZHMtZW50ZXJwcmlzZS1uZy9zcmMvbGliL2NoYXJ0L3NvaG8tY2hhcnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCxTQUFTLEVBRVQsS0FBSyxFQUNNLFlBQVksRUFBRSxNQUFNLEdBQ2hDLE1BQU0sZUFBZSxDQUFDOztBQU92QixNQUFNLE9BQU8sa0JBQWtCO0lBRTdCLElBQWEsWUFBWSxDQUFDLFlBQThCO1FBQ3RELElBQUksQ0FBQyxhQUFhLEdBQUcsWUFBWSxDQUFDO1FBQ2xDLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUN0QixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztTQUM1QjtJQUNILENBQUM7SUFFRCxJQUFhLGFBQWEsQ0FBQyxLQUFhO1FBRXRDLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFekIsa0NBQWtDO1FBQ2xDLEVBQUU7UUFDRiw0QkFBNEI7UUFDNUIsb0JBQW9CO1FBQ3BCLElBQUk7SUFDTixDQUFDO0lBRUQsSUFBYSxPQUFPLENBQUMsT0FBb0I7UUFDdkMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBRXJDLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUN0QixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztTQUM1QjtJQUNILENBQUM7SUFFRCxJQUFhLElBQUksQ0FBQyxJQUFnQjtRQUNoQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDakMsQ0FBQztJQUVELElBQWEsVUFBVSxDQUFDLFVBQXNCO1FBQzVDLElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztJQUM3QyxDQUFDO0lBRUQsSUFBYSxVQUFVLENBQUMsVUFB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QUFJO3NCQUFoQixLQUFLO2dCQUlPLFVBQVU7c0JBQXRCLEtBQUs7Z0JBSU8sVUFBVTtzQkFBdEIsS0FBSztnQkFJTyxVQUFVO3NCQUF0QixLQUFLO2dCQVFPLGVBQWU7c0JBQTNCLEtBQUs7Z0JBSU8sZUFBZTtzQkFBM0IsS0FBSztnQkFJTyxVQUFVO3NCQUF0QixLQUFLO2dCQUlPLHdCQUF3QjtzQkFBcEMsS0FBSztnQkFJTyxZQUFZO3NCQUF4QixLQUFLO2dCQVFJLFFBQVE7c0JBQWpCLE1BQU07Z0JBRUcsVUFBVTtzQkFBbkIsTUFBTTtnQkFFRyxRQUFRO3NCQUFqQixNQUFNO2dCQU1HLFdBQVc7c0JBQXBCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIElucHV0LFxuICBPbkRlc3Ryb3ksIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBOZ1pvbmUsIEFmdGVyVmlld0NoZWNrZWQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdkaXZbc29oby1jaGFydF0nLCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIHRlbXBsYXRlOiAnICdcbn0pXG5cbmV4cG9ydCBjbGFzcyBTb2hvQ2hhcnRDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBBZnRlclZpZXdDaGVja2VkLCBPbkRlc3Ryb3kge1xuXG4gIEBJbnB1dCgpIHNldCBjaGFydE9wdGlvbnMoY2hhcnRPcHRpb25zOiBTb2hvQ2hhcnRPcHRpb25zKSB7XG4gICAgdGhpcy5fY2hhcnRPcHRpb25zID0gY2hhcnRPcHRpb25zO1xuICAgIGlmICh0aGlzLmpRdWVyeUVsZW1lbnQpIHtcbiAgICAgIHRoaXMudXBkYXRlUmVxdWlyZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBzZWxlY3RlZEluZGV4KGluZGV4OiBudW1iZXIpIHtcblxuICAgIHRoaXMuc2V0U2VsZWN0UmVmKGluZGV4KTtcblxuICAgIC8vIHRoaXMuc2V0U2VsZWN0RGF0YUluZGV4KGluZGV4KTtcbiAgICAvL1xuICAgIC8vIGlmICh0aGlzLmpRdWVyeUVsZW1lbnQpIHtcbiAgICAvLyAgIHRoaXMudXBkYXRlZCgpO1xuICAgIC8vIH1cbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBkYXRhU2V0KGRhdGFzZXQ6IFNvaG9EYXRhU2V0KSB7XG4gICAgdGhpcy5fY2hhcnRPcHRpb25zLmRhdGFzZXQgPSBkYXRhc2V0O1xuXG4gICAgaWYgKHRoaXMualF1ZXJ5RWxlbWVudCkge1xuICAgICAgdGhpcy51cGRhdGVSZXF1aXJlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IHR5cGUodHlwZTogQ2hhcnRUeXBlcykge1xuICAgIHRoaXMuX2NoYXJ0T3B0aW9ucy50eXBlID0gdHlwZTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBheGlzTGFiZWxzKGF4aXNMYWJlbHM6IEF4aXNMYWJlbHMpIHtcbiAgICB0aGlzLl9jaGFydE9wdGlvbnMuYXhpc0xhYmVscyA9IGF4aXNMYWJlbHM7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgc2hvd0xlZ2VuZChzaG93TGVnZW5kOiBib29sZWFuKSB7XG4gICAgdGhpcy5fY2hhcnRPcHRpb25zLnNob3dMZWdlbmQgPSBzaG93TGVnZW5kO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IGhpZGVMYWJlbHMoaGlkZUxhYmVsczogYm9vbGVhbikge1xuICAgIGlmICh0aGlzLl9jaGFydE9wdGlvbnMubGFiZWxzKSB7XG4gICAgICB0aGlzLl9jaGFydE9wdGlvbnMubGFiZWxzLmhpZGVMYWJlbHMgPSAhaGlkZUxhYmVscztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fY2hhcnRPcHRpb25zWydsYWJlbHMnXSA9IHsgaGlkZUxhYmVsczogIWhpZGVMYWJlbHMgfTtcbiAgICB9XG4gIH1cblxuICBASW5wdXQoKSBzZXQgZm9ybWF0dGVyU3RyaW5nKGZvcm1hdHRlclN0cmluZzogc3RyaW5nKSB7XG4gICAgdGhpcy5fY2hhcnRPcHRpb25zLmZvcm1hdHRlclN0cmluZyA9IGZvcm1hdHRlclN0cmluZztcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBsZWdlbmRGb3JtYXR0ZXIobGVnZW5kRm9ybWF0dGVyOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9jaGFydE9wdGlvbnMubGVnZW5kRm9ybWF0dGVyID0gbGVnZW5kRm9ybWF0dGVyO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IGNoYXJ0TGFiZWwoY2hhcnRMYWJlbDogQ2hhcnRMYWJlbCkge1xuICAgIHRoaXMuX2NoYXJ0T3B0aW9ucy5jaGFydExhYmVsID0gY2hhcnRMYWJlbDtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBjaGFydHJlZHJhd09uUmVzaXplTGFiZWwocmVkcmF3T25SZXNpemU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9jaGFydE9wdGlvbnMucmVkcmF3T25SZXNpemUgPSByZWRyYXdPblJlc2l6ZTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBjaGFydEFuaW1hdGUoYW5pbWF0ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2NoYXJ0T3B0aW9ucy5hbmltYXRlID0gYW5pbWF0ZTtcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBAT3V0cHV0c1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICBAT3V0cHV0KCkgc2VsZWN0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPENoYXJ0RXZlbnQ+KCk7XG5cbiAgQE91dHB1dCgpIHVuc2VsZWN0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPENoYXJ0RXZlbnQ+KCk7XG5cbiAgQE91dHB1dCgpIHJlbmRlcmVkID0gbmV3IEV2ZW50RW1pdHRlcjxDaGFydEV2ZW50PigpO1xuXG4gIC8qKlxuICAgKiBAdG9kbyByZXBsYWNlIG92ZXJyaWRlIG9mIG5hdGl2ZSBhdHRyaWJ1dGVcbiAgICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LXJlbmFtZSwgQGFuZ3VsYXItZXNsaW50L25vLW91dHB1dC1uYXRpdmVcbiAgQE91dHB1dCgpIGNvbnRleHRtZW51ID0gbmV3IEV2ZW50RW1pdHRlcjxDaGFydEV2ZW50PigpO1xuXG4gIC8vIEFuIGludGVybmFsIGNoYXJ0T3B0aW9ucyBvYmplY3QgdGhhdCBnZXRzIHVwZGF0ZWQgYnkgdXNpbmdcbiAgLy8gdGhlIGNvbXBvbmVudCdzIElucHV0cygpXG4gIHByaXZhdGUgX2NoYXJ0T3B0aW9uczogU29ob0NoYXJ0T3B0aW9ucyA9IHsgYW5pbWF0ZTogdHJ1ZSB9O1xuXG4gIC8vIFJlZmVyZW5jZSB0byB0aGUgalF1ZXJ5IGVsZW1lbnQuXG4gIHByaXZhdGUgalF1ZXJ5RWxlbWVudD86IEpRdWVyeTtcblxuICAvLyBSZWZlcmVuY2UgdG8gdGhlIHNvaG8gY2hhcnQgY29udHJvbCBhcGkuXG4gIHByaXZhdGUgY2hhcnQ/OiBTb2hvQ2hhcnRTdGF0aWM7XG5cbiAgcHJpdmF0ZSB1cGRhdGVSZXF1aXJlZCA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxuICApIHsgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAvLyBXcmFwIGZvciBsYXRlci5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudCA9IGpRdWVyeSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCk7XG5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5jaGFydCh0aGlzLl9jaGFydE9wdGlvbnMpO1xuXG4gICAgICB0aGlzLmNoYXJ0ID0gdGhpcy5qUXVlcnlFbGVtZW50LmRhdGEoJ2NoYXJ0Jyk7XG5cbiAgICAgIC8vIGJpbmQgdG8ganF1ZXJ5IGV2ZW50cyBhbmQgZW1pdCBhcyBhbmd1bGFyIGV2ZW50c1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50Lm9uKCdzZWxlY3RlZCcsIChldmVudDogSlF1ZXJ5LlRyaWdnZXJlZEV2ZW50LCB1aTogYW55LCBkYXRhOiBhbnkpID0+XG4gICAgICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLnNlbGVjdGVkLmVtaXQoeyBldmVudCwgdWksIGRhdGEgfSkpKTtcblxuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50Lm9uKCd1bnNlbGVjdGVkJywgKGV2ZW50OiBKUXVlcnkuVHJpZ2dlcmVkRXZlbnQsIHVpOiBhbnksIGRhdGE6IGFueSkgPT5cbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHRoaXMudW5zZWxlY3RlZC5lbWl0KHsgZXZlbnQsIHVpLCBkYXRhIH0pKSk7XG5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vbigncmVuZGVyZWQnLCAoZXZlbnQ6IEpRdWVyeS5UcmlnZ2VyZWRFdmVudCwgdWk6IGFueSwgZGF0YTogYW55KSA9PlxuICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gdGhpcy5yZW5kZXJlZC5lbWl0KHsgZXZlbnQsIHVpLCBkYXRhIH0pKSk7XG5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vbignY29udGV4dG1lbnUnLCAoZXZlbnQ6IEpRdWVyeS5UcmlnZ2VyZWRFdmVudCwgdWk6IGFueSwgZGF0YTogYW55KSA9PlxuICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gdGhpcy5jb250ZXh0bWVudT8uZW1pdCh7IGV2ZW50LCB1aSwgZGF0YSB9KSkpO1xuICAgIH0pO1xuICB9XG5cbiAgbmdBZnRlclZpZXdDaGVja2VkKCkge1xuICAgIGlmICh0aGlzLnVwZGF0ZVJlcXVpcmVkKSB7XG4gICAgICB0aGlzLnVwZGF0ZWQoKTtcbiAgICAgIHRoaXMudXBkYXRlUmVxdWlyZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgfVxuXG4gIHB1YmxpYyBnZXRDaGFydE9wdGlvbnMoKTogU29ob0NoYXJ0T3B0aW9ucyB7XG4gICAgcmV0dXJuIHRoaXMuX2NoYXJ0T3B0aW9ucztcbiAgfVxuXG4gIHVwZGF0ZWQoKSB7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50Py5jaGFydCh0aGlzLl9jaGFydE9wdGlvbnMpO1xuICAgICAgdGhpcy5jaGFydCA9IHRoaXMualF1ZXJ5RWxlbWVudD8uZGF0YSgnY2hhcnQnKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldFNlbGVjdGVkKCkge1xuICAgIGlmICh0aGlzLmpRdWVyeUVsZW1lbnQpIHtcbiAgICAgIHJldHVybiB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLmNoYXJ0Py5nZXRTZWxlY3RlZCgpKTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIHNldFNlbGVjdFJlZihyZWY6IGFueSk6IHZvaWQge1xuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIGlmICh0aGlzLmpRdWVyeUVsZW1lbnQpIHtcbiAgICAgICAgbGV0IHNlbGVjdE9wdGlvbnM6IENoYXJ0U2VsZWN0aW9uT3B0aW9ucztcbiAgICAgICAgaWYgKCh0aGlzLl9jaGFydE9wdGlvbnMgYXMgYW55KS50eXBlPy5pbmRleE9mKCdncm91cGVkJykgPj0gMCB8fCB0aGlzLl9jaGFydE9wdGlvbnMudHlwZSA9PT0gJ2NvbHVtbicpIHtcbiAgICAgICAgICBzZWxlY3RPcHRpb25zID0geyBncm91cE5hbWU6ICdyZWYnLCBncm91cFZhbHVlOiByZWYgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZWxlY3RPcHRpb25zID0geyBmaWVsZE5hbWU6ICdyZWYnLCBmaWVsZFZhbHVlOiByZWYgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY2hhcnQ/LnNldFNlbGVjdGVkKHNlbGVjdE9wdGlvbnMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgc2V0U2VsZWN0RGF0YUluZGV4KHNlbGVjdEluZGV4OiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5qUXVlcnlFbGVtZW50KSB7XG4gICAgICBjb25zdCBkYXRhQXJyYXkgPSB0aGlzLl9jaGFydE9wdGlvbnMuZGF0YXNldCB8fCBbXTtcbiAgICAgIGlmICh0aGlzLl9jaGFydE9wdGlvbnMudHlwZSA9PT0gJ3BpZScgfHwgdGhpcy5fY2hhcnRPcHRpb25zLnR5cGUgPT09ICdkb251dCcpIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9wcmVmZXItZm9yLW9mXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YUFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgY29uc3QgZGF0YU5vZGUgPSBkYXRhQXJyYXlbaV07XG4gICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBkYXRhTm9kZS5kYXRhLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gZGF0YU5vZGUuZGF0YVtqXTtcbiAgICAgICAgICAgIGlmIChzZWxlY3RJbmRleCA9PT0gaikge1xuICAgICAgICAgICAgICBkYXRhLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGRlbGV0ZSBkYXRhLnNlbGVjdGVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBjb25zdCBkYXRhID0gZGF0YUFycmF5W2ldO1xuICAgICAgICAgIGlmIChzZWxlY3RJbmRleCA9PT0gaSkge1xuICAgICAgICAgICAgZGF0YS5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRlbGV0ZSBkYXRhLnNlbGVjdGVkO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl19