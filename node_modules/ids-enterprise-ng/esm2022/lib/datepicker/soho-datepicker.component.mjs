import { ChangeDetectionStrategy, Component, EventEmitter, HostBinding, Input, Output } from '@angular/core';
import { BaseControlValueAccessor, provideControlValueAccessor } from '../utils/base-control-value-accessor';
import * as i0 from "@angular/core";
export class SohoDatePickerComponent extends BaseControlValueAccessor {
    /**
     * Indicates to display the timepicker; defaults to false.
     */
    set showTime(showTime) {
        this._options.showTime = showTime;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * If true current time will be used for the time portion otherwise 12:00 midnight is used.
     */
    set useCurrentTime(useCurrentTime) {
        this._options.useCurrentTime = useCurrentTime;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Indicates the pattern for the time format.
     */
    set timeFormat(timeFormat) {
        this._options.timeFormat = timeFormat;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * An integer from 1 to 60; multiples of this value are displayed as options in the minutes dropdown.
     */
    set minuteInterval(minuteInterval) {
        this._options.minuteInterval = minuteInterval;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * An integer from 1 to 60; multiples of this value are displayed as options in the seconds dropdown.
     */
    set secondInterval(secondInterval) {
        this._options.secondInterval = secondInterval;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Change the datepickers first day of the week.
     * An integer from 0 - 6 where 0 = Sunday, 1 = Monday, etc...
     */
    set firstDayOfWeek(firstDayOfWeek) {
        this._options.firstDayOfWeek = firstDayOfWeek;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * If true the field will be sized to the width of the date.
     */
    set autoSize(autoSize) {
        this._options.autoSize = autoSize;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Show the today button on the header.
     */
    set showToday(showToday) {
        this._options.showToday = showToday;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /** Add extra attributes like id's to the component **/
    set attributes(attributes) {
        this._options.attributes = attributes;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Indicates mode, either 'standard' or 'range'.
     */
    set mode(mode) {
        this._options.mode = mode;
        if (mode === 'range') {
            if (this._options.range) {
                this._options.range.useRange = true;
            }
            else {
                this._options.range = {};
                this._options.range.useRange = true;
            }
        }
        else {
            if (this._options.range) {
                this._options.range.useRange = false;
            }
        }
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Use range of two dates options.
     */
    set range(range) {
        this._options.range = range;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * If a non-matching minutes value is entered, will round the minutes value to the nearest interval on the blur event.
     */
    set roundToInterval(roundToInterval) {
        this._options.roundToInterval = roundToInterval;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Indicates the pattern for the date format or the value of 'locale'.
     */
    set dateFormat(dateFormat) {
        this._options.dateFormat = dateFormat;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Indicates a placeholder for an empty value; defaults to false.
     */
    set placeholder(placeholder) {
        this._options.placeholder = placeholder;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Indicates an object containing a date or range of dates that are enabled or disabled.
     */
    set disable(disable) {
        this._options.disable = disable;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Indicates a legend is shown to associate dates
     */
    set showLegend(showLegend) {
        this._options.showLegend = showLegend;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Indicates if the month and year will render as dropdowns.
     */
    set showMonthYearPicker(showMonthYearPicker) {
        this._options.showMonthYearPicker = showMonthYearPicker;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Indicates if the month and year will render as dropdowns.
     */
    set showWeekNumber(showWeekNumber) {
        this._options.showWeekNumber = showWeekNumber;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Indicates if the days portion of the calendar will be hidden.
     */
    set hideDays(hideDays) {
        this._options.hideDays = hideDays;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * The number of years ahead to show in the month/year picker should total 9 with yearsBack.
     */
    set yearsAhead(yearsAhead) {
        this._options.yearsAhead = yearsAhead;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * The number of years back to show in the month/year picker should total 9 with yearsAhead.
     */
    set yearsBack(yearsBack) {
        this._options.yearsBack = yearsBack;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Options for how the legend displays
     */
    set legend(legend) {
        this._options.legend = legend;
        if (this.datepicker) {
            this.datepicker.settings.legend = legend;
            this.updateLegend = true;
            this.ref.markForCheck();
        }
    }
    /**
     * The name of the locale to use for this instance. If not set, the current locale will be used.
     */
    set locale(locale) {
        this._options.locale = locale;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Calendar's name. Currently just 'gregorian' or 'islamic-umalqura'
     */
    set calendarName(calendarName) {
        this._options.calendarName = calendarName;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Indicates if the dates will use UTC format
     */
    set useUTC(useUTC) {
        this._options.useUTC = useUTC;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Set the input to tabbable
     */
    set tabbable(tabbable) {
        this._options.tabbable = tabbable;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Set the input to allow increment/decrement using keyboard
     */
    set incrementWithKeyboard(incrementWithKeyboard) {
        this._options.incrementWithKeyboard = incrementWithKeyboard;
        if (this.datepicker) {
            this.datepicker.settings.incrementWithKeyboard = incrementWithKeyboard;
            this.markForRefresh();
        }
    }
    /**
     * Set the input to allow today using keyboard
     */
    set todayWithKeyboard(todayWithKeyboard) {
        this._options.todayWithKeyboard = todayWithKeyboard;
        if (this.datepicker) {
            this.datepicker.settings.todayWithKeyboard = todayWithKeyboard;
            this.markForRefresh();
        }
    }
    /**
     * Sets the options for the date picker
     */
    set options(options) {
        this._options = options;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    set validation(validation) {
        this._validation = validation;
        if (this.datepicker) {
            this.markForRefresh();
        }
    }
    get options() {
        return this._options;
    }
    /**
     * Enables or disables the control
     */
    set disabled(value) {
        // Avoid setting the value if not required,
        // this causes issue on component initialisation
        // as enable() is called by both disabled()
        // and readonly().
        if (this.datepicker == null) {
            this.isDisabled = value;
            return;
        }
        // Set the status locally (for refreshing)
        this.isDisabled = value;
        if (value) {
            this.ngZone.runOutsideAngular(() => {
                this.datepicker?.disable();
            });
        }
        else {
            this.ngZone.runOutsideAngular(() => {
                if (this.readonly === null || this.readonly === undefined) {
                    this.datepicker?.enable();
                    this.isReadOnly = false;
                }
            });
        }
    }
    get disabled() {
        return this.isDisabled;
    }
    /**
     * Sets the control to readonly
     */
    set readonly(value) {
        // Avoid setting the value if not required,
        // this causes issue on component initialisation
        // as enable() is called by both disabled()
        // and readonly().
        if (this.datepicker == null) {
            this.isReadOnly = value;
            return;
        }
        // Set the status locally (for refreshing)
        this.isReadOnly = value;
        if (value) {
            this.ngZone.runOutsideAngular(() => this.datepicker?.readonly());
        }
        else {
            this.ngZone.runOutsideAngular(() => {
                this.datepicker?.enable();
                this.isDisabled = false;
            });
        }
    }
    get readonly() {
        return this.isReadOnly;
    }
    /**
     * Public API
     */
    setValue(value, trigger, isTime) {
        this.datepicker?.setValue(value, trigger, isTime);
    }
    getValue(asDate = false) {
        if (asDate && (typeof this.internalValue === 'string')) {
            const calendar = Soho.Locale.calendar();
            const dateFormat = this._options.dateFormat || calendar.dateFormat.short;
            const timeFormat = this._options.timeFormat || calendar.timeFormat;
            let format = dateFormat;
            if (this._options.showTime) {
                format += 'T' + timeFormat;
            }
            return Soho.Locale.parseDate(this.internalValue || '', format);
        }
        return this.internalValue || '';
    }
    focus() {
        if (this.datepicker) {
            this.datepicker.element.trigger('focus');
        }
    }
    openCalendar() {
        this.datepicker?.openCalendar();
    }
    /**
     * Bind attributes to the host input element
     */
    get isDatepicker() {
        return true;
    }
    get isTimepicker() {
        return !!this._options.showTime;
    }
    /**
     * Creates an instance of SohoDatePickerComponent.
     *
     * @param element the element this component encapsulates.
     * @param ngZone the angular zone for this component.
     * @param ref reference to the change detector
     */
    constructor(element, ngZone, ref) {
        super();
        this.element = element;
        this.ngZone = ngZone;
        this.ref = ref;
        this.isDisabled = undefined;
        this.isReadOnly = undefined;
        this._options = {};
        this.updateLegend = false;
        this._validation = null;
        /**
         * Called when the datepicker value changes
         *
         * @todo replace override of native attribute
         */
        // eslint-disable-next-line @angular-eslint/no-output-rename, @angular-eslint/no-output-native
        this.change = new EventEmitter();
        /**
         * Called when the datepicker is closed.
         */
        this.listclosed = new EventEmitter();
        /**
         * Called when the datepicker is opened.
         */
        this.listopened = new EventEmitter();
        /**
         * Called before a month will be rendered in the datepicker
         */
        this.beforemonthrendered = new EventEmitter();
        /**
         * Called after a month has been rendered in the datepicker
         */
        this.monthrendered = new EventEmitter();
    }
    ngAfterViewInit() {
        // call outside the angular zone so change detection
        // isn't triggered by the soho component.
        this.ngZone.runOutsideAngular(() => {
            // assign element to local variable
            this.jQueryElement = jQuery(this.element.nativeElement);
            // initialise the colorpicker control
            this.jQueryElement.datepicker(this._options);
            // extract the api
            this.datepicker = this.jQueryElement.data('datepicker');
            /**
             * Bind to jQueryElement's events
             */
            this.jQueryElement
                .on('change', (args) => this.onChange(args))
                .on('listclosed', () => this.onListClosed())
                .on('listopened', () => this.onListOpened())
                .on('beforemonthrendered', () => this.onBeforeMonthRendered())
                .on('monthrendered', (e, args) => this.onMonthRendered(args));
            if (this.internalValue) {
                this.datepicker?.setValue(this.internalValue, false);
            }
            this.runUpdatedOnCheck = true;
        });
    }
    ngAfterViewChecked() {
        if (this.updateLegend && this.datepicker?.isOpen()) {
            this.datepicker.loadLegend(this._options.legend);
            this.updateLegend = false;
        }
        if (this._validation) {
            // @ts-ignore
            Soho.Validation.rules[this._validation.validator.id] = this._validation.validator;
            this.datepicker?.element.attr({ 'data-validate': this._validation.validator.id });
            this.datepicker?.element.attr({ 'data-validation-events': { [this._validation.validator.id]: this._validation.validatorEvents } });
        }
        if (this.runUpdatedOnCheck) {
            // Ensure the enabled/disabled flags are set.
            if (this.isDisabled !== null && this.isDisabled !== undefined) {
                this.disabled = this.isDisabled;
            }
            if (this.isReadOnly !== null && this.isReadOnly !== undefined) {
                this.readonly = this.isReadOnly;
            }
            this.ngZone.runOutsideAngular(() => {
                // We need to update the control AFTER the model
                // has been updated (assuming there is one), so
                // execute updated after angular has generated
                // the model and the view markup.
                if (this.datepicker) {
                    this.datepicker.updated(this._options);
                }
                this.runUpdatedOnCheck = false;
            });
        }
    }
    /**
     * Handle the control being changed.
     */
    onChange(event) {
        this.internalValue = this.datepicker?.element.val();
        // Set the date on the event.
        event.data = this.internalValue;
        // When the request for data has completed, make sure we
        // update the 'dropdown' control.
        this.ngZone.run(() => {
            // Fire the event
            this.change.emit(event);
        });
    }
    /**
     * Override writeValue to allow the date picker
     * element to be updated correctly.
     *
     * @param value - the new value
     */
    writeValue(value) {
        super.writeValue(value);
        if (this.datepicker) {
            // The processing is required to ensure we use the correct format
            // in the control.
            if (typeof value === 'string' && value.length > 0 && this._options.range?.useRange) {
                const dates = value.split('-');
                const startValue = Soho.Locale.parseDate(dates[0].trim()) || Soho.Locale.parseDate(dates[0].trim(), { pattern: this._options?.dateFormat });
                const endValue = Soho.Locale.parseDate(dates[1].trim()) || Soho.Locale.parseDate(dates[1].trim(), { pattern: this._options?.dateFormat });
                this.datepicker.settings.range.start = startValue;
                this.datepicker.settings.range.end = endValue;
                this.datepicker.setValue(startValue, false);
            }
            else {
                this.datepicker.setValue(value, false);
            }
        }
    }
    /**
     * This function is called when the control status changes to or from "DISABLED".
     * Depending on the value, it will enable or disable the appropriate DOM element.
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    ngOnDestroy() {
        this.ngZone.runOutsideAngular(() => {
            if (this.jQueryElement) {
                this.jQueryElement.off();
                this.jQueryElement = undefined;
            }
            if (this.datepicker) {
                this.datepicker.destroy();
                this.datepicker = null;
            }
        });
    }
    /**
     * Marks the components as requiring a rebuild after the next update.
     */
    markForRefresh() {
        // Run updated on the next updated check.
        this.runUpdatedOnCheck = true;
        // ... make sure the change detector kicks in, otherwise if the inputs
        // were change programmatially the component may not be eligible for
        // updating.
        this.ref.markForCheck();
    }
    onListClosed() {
        this.ngZone.run(() => {
            this.listclosed.emit();
        });
    }
    onListOpened() {
        this.ngZone.run(() => {
            this.listopened.emit();
        });
    }
    onBeforeMonthRendered() {
        this.ngZone.run(() => {
            this.beforemonthrendered.emit();
        });
    }
    onMonthRendered(args) {
        this.ngZone.run(() => {
            this.monthrendered.emit(args);
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoDatePickerComponent, deps: [{ token: i0.ElementRef }, { token: i0.NgZone }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: SohoDatePickerComponent, selector: "input[soho-datepicker]", inputs: { showTime: "showTime", useCurrentTime: "useCurrentTime", timeFormat: "timeFormat", minuteInterval: "minuteInterval", secondInterval: "secondInterval", firstDayOfWeek: "firstDayOfWeek", autoSize: "autoSize", showToday: "showToday", attributes: "attributes", mode: "mode", range: "range", roundToInterval: "roundToInterval", dateFormat: "dateFormat", placeholder: "placeholder", disable: "disable", showLegend: "showLegend", showMonthYearPicker: "showMonthYearPicker", showWeekNumber: "showWeekNumber", hideDays: "hideDays", yearsAhead: "yearsAhead", yearsBack: "yearsBack", legend: "legend", locale: "locale", calendarName: "calendarName", useUTC: "useUTC", tabbable: "tabbable", incrementWithKeyboard: "incrementWithKeyboard", todayWithKeyboard: "todayWithKeyboard", options: "options", validation: "validation", disabled: "disabled", readonly: "readonly" }, outputs: { change: "change", listclosed: "listclosed", listopened: "listopened", beforemonthrendered: "beforemonthrendered", monthrendered: "monthrendered" }, host: { properties: { "class.datepicker": "this.isDatepicker", "class.timepicker": "this.isTimepicker" } }, providers: [provideControlValueAccessor(SohoDatePickerComponent)], usesInheritance: true, ngImport: i0, template: '<ng-content></ng-content>', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoDatePickerComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'input[soho-datepicker]',
                    template: '<ng-content></ng-content>',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [provideControlValueAccessor(SohoDatePickerComponent)]
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.NgZone }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { showTime: [{
                type: Input
            }], useCurrentTime: [{
                type: Input
            }], timeFormat: [{
                type: Input
            }], minuteInterval: [{
                type: Input
            }], secondInterval: [{
                type: Input
            }], firstDayOfWeek: [{
                type: Input
            }], autoSize: [{
                type: Input
            }], showToday: [{
                type: Input
            }], attributes: [{
                type: Input
            }], mode: [{
                type: Input
            }], range: [{
                type: Input
            }], roundToInterval: [{
                type: Input
            }], dateFormat: [{
                type: Input
            }], placeholder: [{
                type: Input
            }], disable: [{
                type: Input
            }], showLegend: [{
                type: Input
            }], showMonthYearPicker: [{
                type: Input
            }], showWeekNumber: [{
                type: Input
            }], hideDays: [{
                type: Input
            }], yearsAhead: [{
                type: Input
            }], yearsBack: [{
                type: Input
            }], legend: [{
                type: Input
            }], locale: [{
                type: Input
            }], calendarName: [{
                type: Input
            }], useUTC: [{
                type: Input
            }], tabbable: [{
                type: Input
            }], incrementWithKeyboard: [{
                type: Input
            }], todayWithKeyboard: [{
                type: Input
            }], options: [{
                type: Input
            }], validation: [{
                type: Input
            }], disabled: [{
                type: Input
            }], readonly: [{
                type: Input
            }], change: [{
                type: Output
            }], listclosed: [{
                type: Output
            }], listopened: [{
                type: Output
            }], beforemonthrendered: [{
                type: Output
            }], monthrendered: [{
                type: Output
            }], isDatepicker: [{
                type: HostBinding,
                args: ['class.datepicker']
            }], isTimepicker: [{
                type: HostBinding,
                args: ['class.timepicker']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1kYXRlcGlja2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2lkcy1lbnRlcnByaXNlLW5nL3NyYy9saWIvZGF0ZXBpY2tlci9zb2hvLWRhdGVwaWNrZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFHTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUVULFlBQVksRUFDWixXQUFXLEVBQ1gsS0FBSyxFQUVMLE1BQU0sRUFHUCxNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQ0wsd0JBQXdCLEVBQ3hCLDJCQUEyQixFQUM1QixNQUFNLHNDQUFzQyxDQUFDOztBQVE5QyxNQUFNLE9BQU8sdUJBQXdCLFNBQVEsd0JBQXVFO0lBd0JsSDs7T0FFRztJQUNILElBQWEsUUFBUSxDQUFDLFFBQWlCO1FBQ3JDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztRQUNsQyxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDbkIsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1NBQ3ZCO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBYSxjQUFjLENBQUMsY0FBdUI7UUFDakQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLEdBQUcsY0FBYyxDQUFDO1FBQzlDLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNuQixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDdkI7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFhLFVBQVUsQ0FBQyxVQUFrQjtRQUN4QyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7UUFDdEMsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ25CLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztTQUN2QjtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILElBQWEsY0FBYyxDQUFDLGNB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QkFBQyxrQkFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdDaGVja2VkLFxuICBBZnRlclZpZXdJbml0LFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIEhvc3RCaW5kaW5nLFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBPdXRwdXQsXG4gIE5nWm9uZSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7XG4gIEJhc2VDb250cm9sVmFsdWVBY2Nlc3NvcixcbiAgcHJvdmlkZUNvbnRyb2xWYWx1ZUFjY2Vzc29yXG59IGZyb20gJy4uL3V0aWxzL2Jhc2UtY29udHJvbC12YWx1ZS1hY2Nlc3Nvcic7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2lucHV0W3NvaG8tZGF0ZXBpY2tlcl0nLCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIHRlbXBsYXRlOiAnPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PicsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBwcm92aWRlcnM6IFtwcm92aWRlQ29udHJvbFZhbHVlQWNjZXNzb3IoU29ob0RhdGVQaWNrZXJDb21wb25lbnQpXVxufSlcbmV4cG9ydCBjbGFzcyBTb2hvRGF0ZVBpY2tlckNvbXBvbmVudCBleHRlbmRzIEJhc2VDb250cm9sVmFsdWVBY2Nlc3NvcjxzdHJpbmcgfCBudW1iZXIgfCBzdHJpbmdbXSB8IERhdGUgfCB1bmRlZmluZWQ+IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgQWZ0ZXJWaWV3Q2hlY2tlZCwgT25EZXN0cm95IHtcblxuICAvKipcbiAgICogRmxhZyB0byBmb3JjZSBhbiB1cGRhdGUgb2YgdGhlIGNvbnRyb2wgYWZ0ZXIgdGhlIHZpZXcgaXMgY3JlYXRlZC5cbiAgICovXG4gIHByaXZhdGUgcnVuVXBkYXRlZE9uQ2hlY2s/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBMb2NhbCB2YXJpYWJsZXNcbiAgICovXG4gIHByaXZhdGUgalF1ZXJ5RWxlbWVudD86IEpRdWVyeTtcblxuICBwcml2YXRlIGRhdGVwaWNrZXI/OiBTb2hvRGF0ZVBpY2tlclN0YXRpYyB8IG51bGw7XG5cbiAgcHJpdmF0ZSBpc0Rpc2FibGVkPzogYm9vbGVhbiA9IHVuZGVmaW5lZDtcblxuICBwcml2YXRlIGlzUmVhZE9ubHk/OiBib29sZWFuID0gdW5kZWZpbmVkO1xuXG4gIHByaXZhdGUgX29wdGlvbnM6IFNvaG9EYXRlUGlja2VyT3B0aW9ucyA9IHt9O1xuXG4gIHByaXZhdGUgdXBkYXRlTGVnZW5kOiBib29sZWFuID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSBfdmFsaWRhdGlvbjogU29ob0RhdGVQaWNrZXJWYWxpZGF0b3IgfCBudWxsID0gbnVsbDtcblxuICAvKipcbiAgICogSW5kaWNhdGVzIHRvIGRpc3BsYXkgdGhlIHRpbWVwaWNrZXI7IGRlZmF1bHRzIHRvIGZhbHNlLlxuICAgKi9cbiAgQElucHV0KCkgc2V0IHNob3dUaW1lKHNob3dUaW1lOiBib29sZWFuKSB7XG4gICAgdGhpcy5fb3B0aW9ucy5zaG93VGltZSA9IHNob3dUaW1lO1xuICAgIGlmICh0aGlzLmRhdGVwaWNrZXIpIHtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSWYgdHJ1ZSBjdXJyZW50IHRpbWUgd2lsbCBiZSB1c2VkIGZvciB0aGUgdGltZSBwb3J0aW9uIG90aGVyd2lzZSAxMjowMCBtaWRuaWdodCBpcyB1c2VkLlxuICAgKi9cbiAgQElucHV0KCkgc2V0IHVzZUN1cnJlbnRUaW1lKHVzZUN1cnJlbnRUaW1lOiBib29sZWFuKSB7XG4gICAgdGhpcy5fb3B0aW9ucy51c2VDdXJyZW50VGltZSA9IHVzZUN1cnJlbnRUaW1lO1xuICAgIGlmICh0aGlzLmRhdGVwaWNrZXIpIHtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5kaWNhdGVzIHRoZSBwYXR0ZXJuIGZvciB0aGUgdGltZSBmb3JtYXQuXG4gICAqL1xuICBASW5wdXQoKSBzZXQgdGltZUZvcm1hdCh0aW1lRm9ybWF0OiBzdHJpbmcpIHtcbiAgICB0aGlzLl9vcHRpb25zLnRpbWVGb3JtYXQgPSB0aW1lRm9ybWF0O1xuICAgIGlmICh0aGlzLmRhdGVwaWNrZXIpIHtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQW4gaW50ZWdlciBmcm9tIDEgdG8gNjA7IG11bHRpcGxlcyBvZiB0aGlzIHZhbHVlIGFyZSBkaXNwbGF5ZWQgYXMgb3B0aW9ucyBpbiB0aGUgbWludXRlcyBkcm9wZG93bi5cbiAgICovXG4gIEBJbnB1dCgpIHNldCBtaW51dGVJbnRlcnZhbChtaW51dGVJbnRlcnZhbDogbnVtYmVyKSB7XG4gICAgdGhpcy5fb3B0aW9ucy5taW51dGVJbnRlcnZhbCA9IG1pbnV0ZUludGVydmFsO1xuICAgIGlmICh0aGlzLmRhdGVwaWNrZXIpIHtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQW4gaW50ZWdlciBmcm9tIDEgdG8gNjA7IG11bHRpcGxlcyBvZiB0aGlzIHZhbHVlIGFyZSBkaXNwbGF5ZWQgYXMgb3B0aW9ucyBpbiB0aGUgc2Vjb25kcyBkcm9wZG93bi5cbiAgICovXG4gIEBJbnB1dCgpIHNldCBzZWNvbmRJbnRlcnZhbChzZWNvbmRJbnRlcnZhbDogbnVtYmVyKSB7XG4gICAgdGhpcy5fb3B0aW9ucy5zZWNvbmRJbnRlcnZhbCA9IHNlY29uZEludGVydmFsO1xuICAgIGlmICh0aGlzLmRhdGVwaWNrZXIpIHtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hhbmdlIHRoZSBkYXRlcGlja2VycyBmaXJzdCBkYXkgb2YgdGhlIHdlZWsuXG4gICAqIEFuIGludGVnZXIgZnJvbSAwIC0gNiB3aGVyZSAwID0gU3VuZGF5LCAxID0gTW9uZGF5LCBldGMuLi5cbiAgICovXG4gIEBJbnB1dCgpIHNldCBmaXJzdERheU9mV2VlayhmaXJzdERheU9mV2VlazogU29ob0RhdGVQaWNrZXJEYXlPZldlZWspIHtcbiAgICB0aGlzLl9vcHRpb25zLmZpcnN0RGF5T2ZXZWVrID0gZmlyc3REYXlPZldlZWs7XG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlcikge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJZiB0cnVlIHRoZSBmaWVsZCB3aWxsIGJlIHNpemVkIHRvIHRoZSB3aWR0aCBvZiB0aGUgZGF0ZS5cbiAgICovXG4gIEBJbnB1dCgpIHNldCBhdXRvU2l6ZShhdXRvU2l6ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX29wdGlvbnMuYXV0b1NpemUgPSBhdXRvU2l6ZTtcbiAgICBpZiAodGhpcy5kYXRlcGlja2VyKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNob3cgdGhlIHRvZGF5IGJ1dHRvbiBvbiB0aGUgaGVhZGVyLlxuICAgKi9cbiAgQElucHV0KCkgc2V0IHNob3dUb2RheShzaG93VG9kYXk6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9vcHRpb25zLnNob3dUb2RheSA9IHNob3dUb2RheTtcbiAgICBpZiAodGhpcy5kYXRlcGlja2VyKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqIEFkZCBleHRyYSBhdHRyaWJ1dGVzIGxpa2UgaWQncyB0byB0aGUgY29tcG9uZW50ICoqL1xuICBASW5wdXQoKSBzZXQgYXR0cmlidXRlcyhhdHRyaWJ1dGVzOiBBcnJheTxPYmplY3Q+IHwgT2JqZWN0KSB7XG4gICAgdGhpcy5fb3B0aW9ucy5hdHRyaWJ1dGVzID0gYXR0cmlidXRlcztcbiAgICBpZiAodGhpcy5kYXRlcGlja2VyKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluZGljYXRlcyBtb2RlLCBlaXRoZXIgJ3N0YW5kYXJkJyBvciAncmFuZ2UnLlxuICAgKi9cbiAgQElucHV0KCkgc2V0IG1vZGUobW9kZTogU29ob0RhdGVQaWNrZXJNb2RlKSB7XG4gICAgdGhpcy5fb3B0aW9ucy5tb2RlID0gbW9kZTtcblxuICAgIGlmIChtb2RlID09PSAncmFuZ2UnKSB7XG4gICAgICBpZiAodGhpcy5fb3B0aW9ucy5yYW5nZSkge1xuICAgICAgICB0aGlzLl9vcHRpb25zLnJhbmdlLnVzZVJhbmdlID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX29wdGlvbnMucmFuZ2UgPSB7fTtcbiAgICAgICAgdGhpcy5fb3B0aW9ucy5yYW5nZS51c2VSYW5nZSA9IHRydWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLl9vcHRpb25zLnJhbmdlKSB7XG4gICAgICAgIHRoaXMuX29wdGlvbnMucmFuZ2UudXNlUmFuZ2UgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlcikge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVc2UgcmFuZ2Ugb2YgdHdvIGRhdGVzIG9wdGlvbnMuXG4gICAqL1xuICBASW5wdXQoKSBzZXQgcmFuZ2UocmFuZ2U6IFNvaG9EYXRlUGlja2VyUmFuZ2UpIHtcbiAgICB0aGlzLl9vcHRpb25zLnJhbmdlID0gcmFuZ2U7XG5cbiAgICBpZiAodGhpcy5kYXRlcGlja2VyKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIElmIGEgbm9uLW1hdGNoaW5nIG1pbnV0ZXMgdmFsdWUgaXMgZW50ZXJlZCwgd2lsbCByb3VuZCB0aGUgbWludXRlcyB2YWx1ZSB0byB0aGUgbmVhcmVzdCBpbnRlcnZhbCBvbiB0aGUgYmx1ciBldmVudC5cbiAgICovXG4gIEBJbnB1dCgpIHNldCByb3VuZFRvSW50ZXJ2YWwocm91bmRUb0ludGVydmFsOiBib29sZWFuKSB7XG4gICAgdGhpcy5fb3B0aW9ucy5yb3VuZFRvSW50ZXJ2YWwgPSByb3VuZFRvSW50ZXJ2YWw7XG5cbiAgICBpZiAodGhpcy5kYXRlcGlja2VyKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluZGljYXRlcyB0aGUgcGF0dGVybiBmb3IgdGhlIGRhdGUgZm9ybWF0IG9yIHRoZSB2YWx1ZSBvZiAnbG9jYWxlJy5cbiAgICovXG4gIEBJbnB1dCgpIHNldCBkYXRlRm9ybWF0KGRhdGVGb3JtYXQ6IHN0cmluZykge1xuICAgIHRoaXMuX29wdGlvbnMuZGF0ZUZvcm1hdCA9IGRhdGVGb3JtYXQ7XG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlcikge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgYSBwbGFjZWhvbGRlciBmb3IgYW4gZW1wdHkgdmFsdWU7IGRlZmF1bHRzIHRvIGZhbHNlLlxuICAgKi9cbiAgQElucHV0KCkgc2V0IHBsYWNlaG9sZGVyKHBsYWNlaG9sZGVyOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9vcHRpb25zLnBsYWNlaG9sZGVyID0gcGxhY2Vob2xkZXI7XG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlcikge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgYSBkYXRlIG9yIHJhbmdlIG9mIGRhdGVzIHRoYXQgYXJlIGVuYWJsZWQgb3IgZGlzYWJsZWQuXG4gICAqL1xuICBASW5wdXQoKSBzZXQgZGlzYWJsZShkaXNhYmxlOiBhbnkpIHtcbiAgICB0aGlzLl9vcHRpb25zLmRpc2FibGUgPSBkaXNhYmxlO1xuICAgIGlmICh0aGlzLmRhdGVwaWNrZXIpIHtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5kaWNhdGVzIGEgbGVnZW5kIGlzIHNob3duIHRvIGFzc29jaWF0ZSBkYXRlc1xuICAgKi9cbiAgQElucHV0KCkgc2V0IHNob3dMZWdlbmQoc2hvd0xlZ2VuZDogYm9vbGVhbikge1xuICAgIHRoaXMuX29wdGlvbnMuc2hvd0xlZ2VuZCA9IHNob3dMZWdlbmQ7XG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlcikge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgaWYgdGhlIG1vbnRoIGFuZCB5ZWFyIHdpbGwgcmVuZGVyIGFzIGRyb3Bkb3ducy5cbiAgICovXG4gIEBJbnB1dCgpIHNldCBzaG93TW9udGhZZWFyUGlja2VyKHNob3dNb250aFllYXJQaWNrZXI6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9vcHRpb25zLnNob3dNb250aFllYXJQaWNrZXIgPSBzaG93TW9udGhZZWFyUGlja2VyO1xuICAgIGlmICh0aGlzLmRhdGVwaWNrZXIpIHtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5kaWNhdGVzIGlmIHRoZSBtb250aCBhbmQgeWVhciB3aWxsIHJlbmRlciBhcyBkcm9wZG93bnMuXG4gICAqL1xuICBASW5wdXQoKSBzZXQgc2hvd1dlZWtOdW1iZXIoc2hvd1dlZWtOdW1iZXI6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9vcHRpb25zLnNob3dXZWVrTnVtYmVyID0gc2hvd1dlZWtOdW1iZXI7XG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlcikge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgaWYgdGhlIGRheXMgcG9ydGlvbiBvZiB0aGUgY2FsZW5kYXIgd2lsbCBiZSBoaWRkZW4uXG4gICAqL1xuICBASW5wdXQoKSBzZXQgaGlkZURheXMoaGlkZURheXM6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9vcHRpb25zLmhpZGVEYXlzID0gaGlkZURheXM7XG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlcikge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgbnVtYmVyIG9mIHllYXJzIGFoZWFkIHRvIHNob3cgaW4gdGhlIG1vbnRoL3llYXIgcGlja2VyIHNob3VsZCB0b3RhbCA5IHdpdGggeWVhcnNCYWNrLlxuICAgKi9cbiAgQElucHV0KCkgc2V0IHllYXJzQWhlYWQoeWVhcnNBaGVhZDogbnVtYmVyKSB7XG4gICAgdGhpcy5fb3B0aW9ucy55ZWFyc0FoZWFkID0geWVhcnNBaGVhZDtcbiAgICBpZiAodGhpcy5kYXRlcGlja2VyKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBudW1iZXIgb2YgeWVhcnMgYmFjayB0byBzaG93IGluIHRoZSBtb250aC95ZWFyIHBpY2tlciBzaG91bGQgdG90YWwgOSB3aXRoIHllYXJzQWhlYWQuXG4gICAqL1xuICBASW5wdXQoKSBzZXQgeWVhcnNCYWNrKHllYXJzQmFjazogbnVtYmVyKSB7XG4gICAgdGhpcy5fb3B0aW9ucy55ZWFyc0JhY2sgPSB5ZWFyc0JhY2s7XG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlcikge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBPcHRpb25zIGZvciBob3cgdGhlIGxlZ2VuZCBkaXNwbGF5c1xuICAgKi9cbiAgQElucHV0KCkgc2V0IGxlZ2VuZChsZWdlbmQ6IEFycmF5PFNvaG9EYXRlUGlja2VyTGVnZW5kPikge1xuICAgIHRoaXMuX29wdGlvbnMubGVnZW5kID0gbGVnZW5kO1xuICAgIGlmICh0aGlzLmRhdGVwaWNrZXIpIHtcbiAgICAgICh0aGlzLmRhdGVwaWNrZXIgYXMgYW55KS5zZXR0aW5ncy5sZWdlbmQgPSBsZWdlbmQ7XG4gICAgICB0aGlzLnVwZGF0ZUxlZ2VuZCA9IHRydWU7XG4gICAgICB0aGlzLnJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGxvY2FsZSB0byB1c2UgZm9yIHRoaXMgaW5zdGFuY2UuIElmIG5vdCBzZXQsIHRoZSBjdXJyZW50IGxvY2FsZSB3aWxsIGJlIHVzZWQuXG4gICAqL1xuICBASW5wdXQoKSBzZXQgbG9jYWxlKGxvY2FsZTogc3RyaW5nKSB7XG4gICAgdGhpcy5fb3B0aW9ucy5sb2NhbGUgPSBsb2NhbGU7XG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlcikge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxlbmRhcidzIG5hbWUuIEN1cnJlbnRseSBqdXN0ICdncmVnb3JpYW4nIG9yICdpc2xhbWljLXVtYWxxdXJhJ1xuICAgKi9cbiAgQElucHV0KCkgc2V0IGNhbGVuZGFyTmFtZShjYWxlbmRhck5hbWU6IFNvaG9EYXRlUGlja2VyQ2FsZW5kYXJOYW1lKSB7XG4gICAgdGhpcy5fb3B0aW9ucy5jYWxlbmRhck5hbWUgPSBjYWxlbmRhck5hbWU7XG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlcikge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgaWYgdGhlIGRhdGVzIHdpbGwgdXNlIFVUQyBmb3JtYXRcbiAgICovXG4gIEBJbnB1dCgpIHNldCB1c2VVVEModXNlVVRDOiBib29sZWFuKSB7XG4gICAgdGhpcy5fb3B0aW9ucy51c2VVVEMgPSB1c2VVVEM7XG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlcikge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGlucHV0IHRvIHRhYmJhYmxlXG4gICAqL1xuICBASW5wdXQoKSBzZXQgdGFiYmFibGUodGFiYmFibGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9vcHRpb25zLnRhYmJhYmxlID0gdGFiYmFibGU7XG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlcikge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGlucHV0IHRvIGFsbG93IGluY3JlbWVudC9kZWNyZW1lbnQgdXNpbmcga2V5Ym9hcmRcbiAgICovXG4gIEBJbnB1dCgpIHNldCBpbmNyZW1lbnRXaXRoS2V5Ym9hcmQoaW5jcmVtZW50V2l0aEtleWJvYXJkOiBib29sZWFuKSB7XG4gICAgdGhpcy5fb3B0aW9ucy5pbmNyZW1lbnRXaXRoS2V5Ym9hcmQgPSBpbmNyZW1lbnRXaXRoS2V5Ym9hcmQ7XG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlcikge1xuICAgICAgKHRoaXMuZGF0ZXBpY2tlciBhcyBhbnkpLnNldHRpbmdzLmluY3JlbWVudFdpdGhLZXlib2FyZCA9IGluY3JlbWVudFdpdGhLZXlib2FyZDtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBpbnB1dCB0byBhbGxvdyB0b2RheSB1c2luZyBrZXlib2FyZFxuICAgKi9cbiAgQElucHV0KCkgc2V0IHRvZGF5V2l0aEtleWJvYXJkKHRvZGF5V2l0aEtleWJvYXJkOiBib29sZWFuKSB7XG4gICAgdGhpcy5fb3B0aW9ucy50b2RheVdpdGhLZXlib2FyZCA9IHRvZGF5V2l0aEtleWJvYXJkO1xuICAgIGlmICh0aGlzLmRhdGVwaWNrZXIpIHtcbiAgICAgICh0aGlzLmRhdGVwaWNrZXIgYXMgYW55KS5zZXR0aW5ncy50b2RheVdpdGhLZXlib2FyZCA9IHRvZGF5V2l0aEtleWJvYXJkO1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBvcHRpb25zIGZvciB0aGUgZGF0ZSBwaWNrZXJcbiAgICovXG4gIEBJbnB1dCgpIHNldCBvcHRpb25zKG9wdGlvbnM6IFNvaG9EYXRlUGlja2VyT3B0aW9ucykge1xuICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xuICAgIGlmICh0aGlzLmRhdGVwaWNrZXIpIHtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICBASW5wdXQoKSBzZXQgdmFsaWRhdGlvbih2YWxpZGF0aW9uOiBTb2hvRGF0ZVBpY2tlclZhbGlkYXRvcikge1xuICAgIHRoaXMuX3ZhbGlkYXRpb24gPSB2YWxpZGF0aW9uO1xuICAgIGlmICh0aGlzLmRhdGVwaWNrZXIpIHtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICBnZXQgb3B0aW9ucygpOiBTb2hvRGF0ZVBpY2tlck9wdGlvbnMge1xuICAgIHJldHVybiB0aGlzLl9vcHRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuYWJsZXMgb3IgZGlzYWJsZXMgdGhlIGNvbnRyb2xcbiAgICovXG4gIEBJbnB1dCgpIHNldCBkaXNhYmxlZCh2YWx1ZTogYm9vbGVhbiB8IHVuZGVmaW5lZCkge1xuICAgIC8vIEF2b2lkIHNldHRpbmcgdGhlIHZhbHVlIGlmIG5vdCByZXF1aXJlZCxcbiAgICAvLyB0aGlzIGNhdXNlcyBpc3N1ZSBvbiBjb21wb25lbnQgaW5pdGlhbGlzYXRpb25cbiAgICAvLyBhcyBlbmFibGUoKSBpcyBjYWxsZWQgYnkgYm90aCBkaXNhYmxlZCgpXG4gICAgLy8gYW5kIHJlYWRvbmx5KCkuXG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlciA9PSBudWxsKSB7XG4gICAgICB0aGlzLmlzRGlzYWJsZWQgPSB2YWx1ZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBTZXQgdGhlIHN0YXR1cyBsb2NhbGx5IChmb3IgcmVmcmVzaGluZylcbiAgICB0aGlzLmlzRGlzYWJsZWQgPSB2YWx1ZTtcblxuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICB0aGlzLmRhdGVwaWNrZXI/LmRpc2FibGUoKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnJlYWRvbmx5ID09PSBudWxsIHx8IHRoaXMucmVhZG9ubHkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHRoaXMuZGF0ZXBpY2tlcj8uZW5hYmxlKCk7XG4gICAgICAgICAgdGhpcy5pc1JlYWRPbmx5ID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGdldCBkaXNhYmxlZCgpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5pc0Rpc2FibGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGNvbnRyb2wgdG8gcmVhZG9ubHlcbiAgICovXG4gIEBJbnB1dCgpIHNldCByZWFkb25seSh2YWx1ZTogYm9vbGVhbiB8IHVuZGVmaW5lZCkge1xuICAgIC8vIEF2b2lkIHNldHRpbmcgdGhlIHZhbHVlIGlmIG5vdCByZXF1aXJlZCxcbiAgICAvLyB0aGlzIGNhdXNlcyBpc3N1ZSBvbiBjb21wb25lbnQgaW5pdGlhbGlzYXRpb25cbiAgICAvLyBhcyBlbmFibGUoKSBpcyBjYWxsZWQgYnkgYm90aCBkaXNhYmxlZCgpXG4gICAgLy8gYW5kIHJlYWRvbmx5KCkuXG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlciA9PSBudWxsKSB7XG4gICAgICB0aGlzLmlzUmVhZE9ubHkgPSB2YWx1ZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBTZXQgdGhlIHN0YXR1cyBsb2NhbGx5IChmb3IgcmVmcmVzaGluZylcbiAgICB0aGlzLmlzUmVhZE9ubHkgPSB2YWx1ZTtcblxuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4gdGhpcy5kYXRlcGlja2VyPy5yZWFkb25seSgpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICB0aGlzLmRhdGVwaWNrZXI/LmVuYWJsZSgpO1xuICAgICAgICB0aGlzLmlzRGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGdldCByZWFkb25seSgpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5pc1JlYWRPbmx5O1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGxlZCB3aGVuIHRoZSBkYXRlcGlja2VyIHZhbHVlIGNoYW5nZXNcbiAgICpcbiAgICogQHRvZG8gcmVwbGFjZSBvdmVycmlkZSBvZiBuYXRpdmUgYXR0cmlidXRlXG4gICAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L25vLW91dHB1dC1yZW5hbWUsIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtbmF0aXZlXG4gIEBPdXRwdXQoKSBjaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9EYXRlUGlja2VyRXZlbnQ+KCk7XG5cbiAgLyoqXG4gICAqIENhbGxlZCB3aGVuIHRoZSBkYXRlcGlja2VyIGlzIGNsb3NlZC5cbiAgICovXG4gIEBPdXRwdXQoKSBsaXN0Y2xvc2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIC8qKlxuICAgKiBDYWxsZWQgd2hlbiB0aGUgZGF0ZXBpY2tlciBpcyBvcGVuZWQuXG4gICAqL1xuICBAT3V0cHV0KCkgbGlzdG9wZW5lZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAvKipcbiAgICogQ2FsbGVkIGJlZm9yZSBhIG1vbnRoIHdpbGwgYmUgcmVuZGVyZWQgaW4gdGhlIGRhdGVwaWNrZXJcbiAgICovXG4gIEBPdXRwdXQoKSBiZWZvcmVtb250aHJlbmRlcmVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIC8qKlxuICAgKiBDYWxsZWQgYWZ0ZXIgYSBtb250aCBoYXMgYmVlbiByZW5kZXJlZCBpbiB0aGUgZGF0ZXBpY2tlclxuICAgKi9cbiAgQE91dHB1dCgpIG1vbnRocmVuZGVyZWQgPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9EYXRlUGlja2VyTW9udGhSZW5kZXJlZEV2ZW50PigpO1xuXG4gIC8qKlxuICAgKiBQdWJsaWMgQVBJXG4gICAqL1xuXG4gIHB1YmxpYyBzZXRWYWx1ZSh2YWx1ZTogc3RyaW5nIHwgRGF0ZSB8IG51bWJlciB8IHN0cmluZ1tdLCB0cmlnZ2VyOiBib29sZWFuLCBpc1RpbWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmRhdGVwaWNrZXI/LnNldFZhbHVlKHZhbHVlLCB0cmlnZ2VyLCBpc1RpbWUpO1xuICB9XG5cbiAgcHVibGljIGdldFZhbHVlKGFzRGF0ZTogYm9vbGVhbiA9IGZhbHNlKTogc3RyaW5nIHwgRGF0ZSB8IG51bWJlciB8IHN0cmluZ1tdIHtcbiAgICBpZiAoYXNEYXRlICYmICh0eXBlb2YgdGhpcy5pbnRlcm5hbFZhbHVlID09PSAnc3RyaW5nJykpIHtcbiAgICAgIGNvbnN0IGNhbGVuZGFyID0gU29oby5Mb2NhbGUuY2FsZW5kYXIoKTtcbiAgICAgIGNvbnN0IGRhdGVGb3JtYXQgPSB0aGlzLl9vcHRpb25zLmRhdGVGb3JtYXQgfHwgY2FsZW5kYXIuZGF0ZUZvcm1hdC5zaG9ydDtcbiAgICAgIGNvbnN0IHRpbWVGb3JtYXQgPSB0aGlzLl9vcHRpb25zLnRpbWVGb3JtYXQgfHwgY2FsZW5kYXIudGltZUZvcm1hdDtcbiAgICAgIGxldCBmb3JtYXQgPSBkYXRlRm9ybWF0O1xuICAgICAgaWYgKHRoaXMuX29wdGlvbnMuc2hvd1RpbWUpIHtcbiAgICAgICAgZm9ybWF0ICs9ICdUJyArIHRpbWVGb3JtYXQ7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBTb2hvLkxvY2FsZS5wYXJzZURhdGUodGhpcy5pbnRlcm5hbFZhbHVlIHx8ICcnLCBmb3JtYXQpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmludGVybmFsVmFsdWUgfHwgJyc7XG4gIH1cblxuICBwdWJsaWMgZm9jdXMoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlcikge1xuICAgICAgdGhpcy5kYXRlcGlja2VyLmVsZW1lbnQudHJpZ2dlcignZm9jdXMnKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgb3BlbkNhbGVuZGFyKCk6IHZvaWQge1xuICAgIHRoaXMuZGF0ZXBpY2tlcj8ub3BlbkNhbGVuZGFyKCk7XG4gIH1cblxuICAvKipcbiAgICogQmluZCBhdHRyaWJ1dGVzIHRvIHRoZSBob3N0IGlucHV0IGVsZW1lbnRcbiAgICovXG4gIEBIb3N0QmluZGluZygnY2xhc3MuZGF0ZXBpY2tlcicpIGdldCBpc0RhdGVwaWNrZXIoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy50aW1lcGlja2VyJykgZ2V0IGlzVGltZXBpY2tlcigpIHtcbiAgICByZXR1cm4gISF0aGlzLl9vcHRpb25zLnNob3dUaW1lO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgU29ob0RhdGVQaWNrZXJDb21wb25lbnQuXG4gICAqXG4gICAqIEBwYXJhbSBlbGVtZW50IHRoZSBlbGVtZW50IHRoaXMgY29tcG9uZW50IGVuY2Fwc3VsYXRlcy5cbiAgICogQHBhcmFtIG5nWm9uZSB0aGUgYW5ndWxhciB6b25lIGZvciB0aGlzIGNvbXBvbmVudC5cbiAgICogQHBhcmFtIHJlZiByZWZlcmVuY2UgdG8gdGhlIGNoYW5nZSBkZXRlY3RvclxuICAgKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50OiBFbGVtZW50UmVmLFxuICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsXG4gICAgcHVibGljIHJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuXG4gICAgLy8gY2FsbCBvdXRzaWRlIHRoZSBhbmd1bGFyIHpvbmUgc28gY2hhbmdlIGRldGVjdGlvblxuICAgIC8vIGlzbid0IHRyaWdnZXJlZCBieSB0aGUgc29obyBjb21wb25lbnQuXG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgLy8gYXNzaWduIGVsZW1lbnQgdG8gbG9jYWwgdmFyaWFibGVcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudCA9IGpRdWVyeSh0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCk7XG5cbiAgICAgIC8vIGluaXRpYWxpc2UgdGhlIGNvbG9ycGlja2VyIGNvbnRyb2xcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5kYXRlcGlja2VyKHRoaXMuX29wdGlvbnMpO1xuXG4gICAgICAvLyBleHRyYWN0IHRoZSBhcGlcbiAgICAgIHRoaXMuZGF0ZXBpY2tlciA9IHRoaXMualF1ZXJ5RWxlbWVudC5kYXRhKCdkYXRlcGlja2VyJyk7XG5cbiAgICAgIC8qKlxuICAgICAgICogQmluZCB0byBqUXVlcnlFbGVtZW50J3MgZXZlbnRzXG4gICAgICAgKi9cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudFxuICAgICAgICAub24oJ2NoYW5nZScsIChhcmdzOiBhbnkpID0+IHRoaXMub25DaGFuZ2UoYXJncykpXG4gICAgICAgIC5vbignbGlzdGNsb3NlZCcsICgpID0+IHRoaXMub25MaXN0Q2xvc2VkKCkpXG4gICAgICAgIC5vbignbGlzdG9wZW5lZCcsICgpID0+IHRoaXMub25MaXN0T3BlbmVkKCkpXG4gICAgICAgIC5vbignYmVmb3JlbW9udGhyZW5kZXJlZCcsICgpID0+IHRoaXMub25CZWZvcmVNb250aFJlbmRlcmVkKCkpXG4gICAgICAgIC5vbignbW9udGhyZW5kZXJlZCcsIChlLCBhcmdzKSA9PiB0aGlzLm9uTW9udGhSZW5kZXJlZChhcmdzKSlcblxuICAgICAgaWYgKHRoaXMuaW50ZXJuYWxWYWx1ZSkge1xuICAgICAgICB0aGlzLmRhdGVwaWNrZXI/LnNldFZhbHVlKHRoaXMuaW50ZXJuYWxWYWx1ZSwgZmFsc2UpO1xuICAgICAgfVxuICAgICAgdGhpcy5ydW5VcGRhdGVkT25DaGVjayA9IHRydWU7XG4gICAgfSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0NoZWNrZWQoKSB7XG5cbiAgICBpZiAodGhpcy51cGRhdGVMZWdlbmQgJiYgdGhpcy5kYXRlcGlja2VyPy5pc09wZW4oKSkge1xuICAgICAgdGhpcy5kYXRlcGlja2VyLmxvYWRMZWdlbmQodGhpcy5fb3B0aW9ucy5sZWdlbmQpO1xuICAgICAgdGhpcy51cGRhdGVMZWdlbmQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fdmFsaWRhdGlvbikge1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgU29oby5WYWxpZGF0aW9uLnJ1bGVzW3RoaXMuX3ZhbGlkYXRpb24udmFsaWRhdG9yLmlkXSA9IHRoaXMuX3ZhbGlkYXRpb24udmFsaWRhdG9yO1xuICAgICAgdGhpcy5kYXRlcGlja2VyPy5lbGVtZW50LmF0dHIoeydkYXRhLXZhbGlkYXRlJzogdGhpcy5fdmFsaWRhdGlvbi52YWxpZGF0b3IuaWR9KVxuICAgICAgdGhpcy5kYXRlcGlja2VyPy5lbGVtZW50LmF0dHIoeydkYXRhLXZhbGlkYXRpb24tZXZlbnRzJzoge1t0aGlzLl92YWxpZGF0aW9uLnZhbGlkYXRvci5pZF06IHRoaXMuX3ZhbGlkYXRpb24udmFsaWRhdG9yRXZlbnRzfX0pO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJ1blVwZGF0ZWRPbkNoZWNrKSB7XG4gICAgICAvLyBFbnN1cmUgdGhlIGVuYWJsZWQvZGlzYWJsZWQgZmxhZ3MgYXJlIHNldC5cbiAgICAgIGlmICh0aGlzLmlzRGlzYWJsZWQgIT09IG51bGwgJiYgdGhpcy5pc0Rpc2FibGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5kaXNhYmxlZCA9IHRoaXMuaXNEaXNhYmxlZDtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuaXNSZWFkT25seSAhPT0gbnVsbCAmJiB0aGlzLmlzUmVhZE9ubHkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLnJlYWRvbmx5ID0gdGhpcy5pc1JlYWRPbmx5O1xuICAgICAgfVxuXG4gICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gdXBkYXRlIHRoZSBjb250cm9sIEFGVEVSIHRoZSBtb2RlbFxuICAgICAgICAvLyBoYXMgYmVlbiB1cGRhdGVkIChhc3N1bWluZyB0aGVyZSBpcyBvbmUpLCBzb1xuICAgICAgICAvLyBleGVjdXRlIHVwZGF0ZWQgYWZ0ZXIgYW5ndWxhciBoYXMgZ2VuZXJhdGVkXG4gICAgICAgIC8vIHRoZSBtb2RlbCBhbmQgdGhlIHZpZXcgbWFya3VwLlxuICAgICAgICBpZiAodGhpcy5kYXRlcGlja2VyKSB7XG4gICAgICAgICAgdGhpcy5kYXRlcGlja2VyLnVwZGF0ZWQodGhpcy5fb3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ydW5VcGRhdGVkT25DaGVjayA9IGZhbHNlO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSB0aGUgY29udHJvbCBiZWluZyBjaGFuZ2VkLlxuICAgKi9cbiAgb25DaGFuZ2UoZXZlbnQ6IFNvaG9EYXRlUGlja2VyRXZlbnQpIHtcbiAgICB0aGlzLmludGVybmFsVmFsdWUgPSB0aGlzLmRhdGVwaWNrZXI/LmVsZW1lbnQudmFsKCk7XG5cbiAgICAvLyBTZXQgdGhlIGRhdGUgb24gdGhlIGV2ZW50LlxuICAgIGV2ZW50LmRhdGEgPSB0aGlzLmludGVybmFsVmFsdWU7XG5cbiAgICAvLyBXaGVuIHRoZSByZXF1ZXN0IGZvciBkYXRhIGhhcyBjb21wbGV0ZWQsIG1ha2Ugc3VyZSB3ZVxuICAgIC8vIHVwZGF0ZSB0aGUgJ2Ryb3Bkb3duJyBjb250cm9sLlxuICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICAvLyBGaXJlIHRoZSBldmVudFxuICAgICAgdGhpcy5jaGFuZ2UuZW1pdChldmVudCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogT3ZlcnJpZGUgd3JpdGVWYWx1ZSB0byBhbGxvdyB0aGUgZGF0ZSBwaWNrZXJcbiAgICogZWxlbWVudCB0byBiZSB1cGRhdGVkIGNvcnJlY3RseS5cbiAgICpcbiAgICogQHBhcmFtIHZhbHVlIC0gdGhlIG5ldyB2YWx1ZVxuICAgKi9cbiAgd3JpdGVWYWx1ZSh2YWx1ZTogRGF0ZSB8IHN0cmluZyB8IG51bWJlciB8IHN0cmluZ1tdKSB7XG4gICAgc3VwZXIud3JpdGVWYWx1ZSh2YWx1ZSk7XG4gICAgaWYgKHRoaXMuZGF0ZXBpY2tlcikge1xuICAgICAgLy8gVGhlIHByb2Nlc3NpbmcgaXMgcmVxdWlyZWQgdG8gZW5zdXJlIHdlIHVzZSB0aGUgY29ycmVjdCBmb3JtYXRcbiAgICAgIC8vIGluIHRoZSBjb250cm9sLlxuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgJiYgdmFsdWUubGVuZ3RoID4gMCAmJiB0aGlzLl9vcHRpb25zLnJhbmdlPy51c2VSYW5nZSkge1xuICAgICAgICBjb25zdCBkYXRlcyA9IHZhbHVlLnNwbGl0KCctJyk7XG4gICAgICAgIGNvbnN0IHN0YXJ0VmFsdWUgPSBTb2hvLkxvY2FsZS5wYXJzZURhdGUoZGF0ZXNbMF0udHJpbSgpKSB8fCBTb2hvLkxvY2FsZS5wYXJzZURhdGUoZGF0ZXNbMF0udHJpbSgpLCB7IHBhdHRlcm46IHRoaXMuX29wdGlvbnM/LmRhdGVGb3JtYXQgfSk7XG4gICAgICAgIGNvbnN0IGVuZFZhbHVlID0gU29oby5Mb2NhbGUucGFyc2VEYXRlKGRhdGVzWzFdLnRyaW0oKSkgfHwgU29oby5Mb2NhbGUucGFyc2VEYXRlKGRhdGVzWzFdLnRyaW0oKSwgeyBwYXR0ZXJuOiB0aGlzLl9vcHRpb25zPy5kYXRlRm9ybWF0IH0pO1xuXG4gICAgICAgICh0aGlzLmRhdGVwaWNrZXIgYXMgYW55KS5zZXR0aW5ncy5yYW5nZS5zdGFydCA9IHN0YXJ0VmFsdWU7XG4gICAgICAgICh0aGlzLmRhdGVwaWNrZXIgYXMgYW55KS5zZXR0aW5ncy5yYW5nZS5lbmQgPSBlbmRWYWx1ZTtcbiAgICAgICAgdGhpcy5kYXRlcGlja2VyLnNldFZhbHVlKHN0YXJ0VmFsdWUsIGZhbHNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZGF0ZXBpY2tlci5zZXRWYWx1ZSh2YWx1ZSwgZmFsc2UpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIHRoZSBjb250cm9sIHN0YXR1cyBjaGFuZ2VzIHRvIG9yIGZyb20gXCJESVNBQkxFRFwiLlxuICAgKiBEZXBlbmRpbmcgb24gdGhlIHZhbHVlLCBpdCB3aWxsIGVuYWJsZSBvciBkaXNhYmxlIHRoZSBhcHByb3ByaWF0ZSBET00gZWxlbWVudC5cbiAgICovXG4gIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuXG4gICAgICBpZiAodGhpcy5qUXVlcnlFbGVtZW50KSB7XG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vZmYoKTtcbiAgICAgICAgdGhpcy5qUXVlcnlFbGVtZW50ID0gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5kYXRlcGlja2VyKSB7XG4gICAgICAgIHRoaXMuZGF0ZXBpY2tlci5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMuZGF0ZXBpY2tlciA9IG51bGw7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogTWFya3MgdGhlIGNvbXBvbmVudHMgYXMgcmVxdWlyaW5nIGEgcmVidWlsZCBhZnRlciB0aGUgbmV4dCB1cGRhdGUuXG4gICAqL1xuICBtYXJrRm9yUmVmcmVzaCgpIHtcbiAgICAvLyBSdW4gdXBkYXRlZCBvbiB0aGUgbmV4dCB1cGRhdGVkIGNoZWNrLlxuICAgIHRoaXMucnVuVXBkYXRlZE9uQ2hlY2sgPSB0cnVlO1xuXG4gICAgLy8gLi4uIG1ha2Ugc3VyZSB0aGUgY2hhbmdlIGRldGVjdG9yIGtpY2tzIGluLCBvdGhlcndpc2UgaWYgdGhlIGlucHV0c1xuICAgIC8vIHdlcmUgY2hhbmdlIHByb2dyYW1tYXRpYWxseSB0aGUgY29tcG9uZW50IG1heSBub3QgYmUgZWxpZ2libGUgZm9yXG4gICAgLy8gdXBkYXRpbmcuXG4gICAgdGhpcy5yZWYubWFya0ZvckNoZWNrKCk7XG4gIH1cblxuICBwcml2YXRlIG9uTGlzdENsb3NlZCgpOiB2b2lkIHtcbiAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgdGhpcy5saXN0Y2xvc2VkLmVtaXQoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgb25MaXN0T3BlbmVkKCk6IHZvaWQge1xuICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICB0aGlzLmxpc3RvcGVuZWQuZW1pdCgpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBvbkJlZm9yZU1vbnRoUmVuZGVyZWQoKTogdm9pZCB7XG4gICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgIHRoaXMuYmVmb3JlbW9udGhyZW5kZXJlZC5lbWl0KCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIG9uTW9udGhSZW5kZXJlZChhcmdzOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgdGhpcy5tb250aHJlbmRlcmVkLmVtaXQoYXJncyk7XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==