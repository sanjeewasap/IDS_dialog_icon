import { Subject } from 'rxjs';
/**
 * Wrapper for the jQuery modal control.
 */
export class SohoMessageRef {
    /**
     * Sets the whole options block for this modal dialog.
     *
     * @param options - the options to set.
     */
    options(options) {
        this._options = options || {};
        return this;
    }
    /**
     * Sets the width for the dialog.
     *
     * @param width - the extra frame height to allow.
     */
    frameHeight(width) {
        this._options.width = width;
        return this;
    }
    /**
     * Sets the title of the message dialog.
     *
     * @param title - the title of the dialog.
     */
    title(title) {
        this._options.title = title;
        return this;
    }
    /**
     * Sets the buttons to use on the modal dialog.
     *
     * @param buttons - list of buttons to display
     */
    buttons(buttons) {
        this._options.buttons = buttons;
        return this;
    }
    /**
     * Is this an error dialog?
     *
     * @param isError - true if this dialog is to be styled an an alert.
     */
    isError(isError) {
        this._options.isError = isError;
        return this;
    }
    /**
     * Sets the 'message' that the message dialog displays.
     *
     * @param message - a selector or string representing the dialog content.
     */
    message(message) {
        this._options.message = message;
        return this;
    }
    /**
     * Sets the 'status' of the modal control.
     */
    status(status) {
        this._options.status = status;
        return this;
    }
    /**
     * Sets the 'cssClass' of the modal control.
     */
    cssClass(cssClass) {
        this._options.cssClass = cssClass;
        return this;
    }
    /**
     * If true, it will show a close icon button on the top right of the message.
     *
     * @param showCloseBtn - if true, the x button will be shown.
     */
    showCloseBtn(showCloseBtn) {
        this._options.showCloseBtn = showCloseBtn;
        return this;
    }
    /**
     * Sets the 'allowTags' of the modal control.
     */
    allowedTags(allowedTags) {
        this._options.allowedTags = allowedTags;
        return this;
    }
    /**
     * Sets the 'returnFocus' of the modal control.
     *
     * @param returnFocus -if true; the dialog will autoFocus.
     */
    returnFocus(returnFocus) {
        this._options.returnFocus = returnFocus;
        return this;
    }
    /**
     * Controls the opacity of the background overlay.
     *
     * @param overlayOpacity - The percent between 0 and 1 of opacity to use.
     */
    overlayOpacity(overlayOpacity) {
        this._options.overlayOpacity = overlayOpacity;
        return this;
    }
    /**
     * Causes this modal instance to become hidden when another modal is displayed over top.
     *
     * @param hideUnderneath - If it should be on top or bottom.
     */
    hideUnderneath(hideUnderneath) {
        this._options.hideUnderneath = hideUnderneath;
        return this;
    }
    /**
     * Causes this modal instance to become hidden when another modal is displayed over top.
     *
     * @param hideUnderneath - If it should be on top or bottom.
     */
    attributes(attributes) {
        this._options.attributes = attributes;
        return this;
    }
    /**
     * Dialog result property.
     *
     * @param dialogResult - the stored restult of the dialog.
     */
    set dialogResult(dialogResult) {
        this._dialogResult = dialogResult;
    }
    get dialogResult() {
        return this._dialogResult;
    }
    /**
     * Constructor.
     *
     * @param placeholder for the dialog; defaults to the body.
     */
    constructor() {
        /** Vetoable Event Guard */
        this.eventGuard = {};
        /** Event fired when the message is opened. */
        this.open$ = new Subject();
        // -------------------------------------------
        // Default options block
        // -------------------------------------------
        /**
         * Cached options.
         */
        this._options = {};
        this._placeholder = $('body');
    }
    /**
     * Displays the message.
     *
     * @return the dialog ref.
     */
    open() {
        // Returns the body!
        this._placeholder.message(this._options);
        // Need a better way of locating the message dialog.
        this.jQueryElement = this._placeholder.find('.modal.message');
        // Get the api.
        this._message = this.jQueryElement.data('modal');
        // Add listeners to control event (which are on the placeholder)
        this._placeholder.off('open').on('open', ((event) => {
            this.onOpen(event);
        }));
        // These are vetoable events.
        this._placeholder.off('beforeopen').on('beforeopen', ((event) => this.onBeforeOpen(event)));
        this._placeholder.off('beforeclose').on('beforeclose', ((event) => this.onBeforeClose(event)));
        return this;
    }
    /**
     * Closes the modal dialog, if open.
     *
     * @param dialogResult - optional result - held for the caller.
     */
    close(dialogResult) {
        this.dialogResult = dialogResult;
        if (this._message) {
            this._message.close();
        }
        return this;
    }
    // ------------------------------------------
    // Event Registration
    // ------------------------------------------
    /**
     * Registers a before open guard.
     *
     * @param eventFn - the function to call before openning the dialog.
     */
    beforeOpen(eventFn) {
        this.eventGuard.beforeOpen = eventFn;
        return this;
    }
    /**
     * Opened Event.
     *
     * This event is fired when the dialog is being opened.
     *
     * @param eventFn - the function to invoke when the dialog is to be opened.
     */
    opened(eventFn) {
        this.open$.subscribe((f) => {
            eventFn(f, this);
        });
        return this;
    }
    /**
     * Registers a before close guard.
     *
     * @param eventFn - the function to call before closing the dialog.
     */
    beforeClose(eventFn) {
        this.eventGuard.beforeClose = eventFn;
        return this;
    }
    // -------------------------------------------
    // Event Handlers
    // -------------------------------------------
    /**
     * Handles the 'beforeOpen' event, fired before the modal dialog
     * has been opened.
     *
     * @param event - full event object.
     *
     * @return true if the dialog can be opened; otherwise false if veoted.
     */
    onBeforeOpen(_event) {
        const fn = this.eventGuard.beforeOpen;
        return fn ? fn.call(this.eventGuard) : true;
    }
    /**
     * Handles the 'beforeCloseEvent, fired before the modal dialog
     * is closed, allowing the closure to be vetoed.
     *
     * @param event - event object.
     * @return true if the dialog can be closed; otherwise false if veoted.
     */
    onBeforeClose(_event) {
        const fn = this.eventGuard.beforeClose;
        return fn ? fn.call(this.eventGuard, this, {}, undefined) : true;
    }
    /**
     * Handles the 'open' event, fired just before
     * the focus is assigned to a message.
     *
     * @param event - full event object.
     */
    onOpen(event) {
        this.open$.next(event);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1tZXNzYWdlLnJlZi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2lkcy1lbnRlcnByaXNlLW5nL3NyYy9saWIvbWVzc2FnZS9zb2hvLW1lc3NhZ2UucmVmLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFJL0I7O0dBRUc7QUFDSCxNQUFNLE9BQU8sY0FBYztJQTRCekI7Ozs7T0FJRztJQUNILE9BQU8sQ0FBQyxPQUE0QjtRQUNsQyxJQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sSUFBSSxFQUFFLENBQUM7UUFDOUIsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILFdBQVcsQ0FBQyxLQUFhO1FBQ3ZCLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUM1QixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsS0FBSyxDQUFDLEtBQWE7UUFDakIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQzVCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxPQUFPLENBQUMsT0FBMEI7UUFDaEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ2hDLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxPQUFPLENBQUMsT0FBZ0I7UUFDdEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ2hDLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxPQUFPLENBQUMsT0FBZTtRQUNyQixJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDaEMsT0FBTyxJQUFJLENBQUM7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aUI7SUFDakIsOENBQThDO0lBRTlDOzs7Ozs7O09BT0c7SUFDSyxZQUFZLENBQUMsTUFBVztRQUM5QixNQUFNLEVBQUUsR0FBYyxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQWtCLENBQUM7UUFDekQsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDOUMsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNLLGFBQWEsQ0FBQyxNQUFXO1FBQy9CLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDO1FBQ3ZDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxFQUFHLEVBQVUsRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQzVFLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNLLE1BQU0sQ0FBQyxLQUFVO1FBQ3ZCLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pCLENBQUM7Q0FFRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgU29ob01vZGFsRGlhbG9nVmV0b2FibGVFdmVudEd1YXJkIH0gZnJvbSAnLi4vbW9kYWwtZGlhbG9nL3NvaG8tbW9kYWwtZGlhbG9nLnJlZic7XG5cbi8qKlxuICogV3JhcHBlciBmb3IgdGhlIGpRdWVyeSBtb2RhbCBjb250cm9sLlxuICovXG5leHBvcnQgY2xhc3MgU29ob01lc3NhZ2VSZWYge1xuICAvKiogVmV0b2FibGUgRXZlbnQgR3VhcmQgKi9cbiAgcHJpdmF0ZSBldmVudEd1YXJkOiBTb2hvTW9kYWxEaWFsb2dWZXRvYWJsZUV2ZW50R3VhcmQ8YW55PiA9IHt9O1xuXG4gIC8qKiBTZWxlY3RvciByZWZlcmVuY2luZyB0aGUgbW9kYWwtZGlhbG9nIGFmdGVyIGl0IGhhcyBiZWVuIG1vdmVkIHRvIHRoZSBkaWFsb2cgY29udGFpbmVyLiAqL1xuICBwcml2YXRlIGpRdWVyeUVsZW1lbnQ/OiBKUXVlcnk7XG5cbiAgLyoqIFNvaG8gQ29udHJvbCBBcGkgKi9cbiAgcHJpdmF0ZSBfbWVzc2FnZT86IFNvaG9NZXNzYWdlU3RhdGljO1xuXG4gIC8qKiBUaGUgcmVzdWx0IG9mIHRoZSBkaWFsb2cuICovXG4gIHByaXZhdGUgX2RpYWxvZ1Jlc3VsdDogYW55O1xuXG4gIC8qKiBEaWFsb2cgcGxhY2Vob2xkZXIsIGRlZmF1bHRzIHRvICQoJ2JvZHknKSovXG4gIHByaXZhdGUgX3BsYWNlaG9sZGVyOiBKUXVlcnk7XG5cbiAgLyoqIEV2ZW50IGZpcmVkIHdoZW4gdGhlIG1lc3NhZ2UgaXMgb3BlbmVkLiAqL1xuICBwcml2YXRlIG9wZW4kOiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdCgpO1xuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gRGVmYXVsdCBvcHRpb25zIGJsb2NrXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvKipcbiAgICogQ2FjaGVkIG9wdGlvbnMuXG4gICAqL1xuICBwcml2YXRlIF9vcHRpb25zOiBTb2hvTWVzc2FnZU9wdGlvbnMgPSB7fTtcblxuICAvKipcbiAgICogU2V0cyB0aGUgd2hvbGUgb3B0aW9ucyBibG9jayBmb3IgdGhpcyBtb2RhbCBkaWFsb2cuXG4gICAqXG4gICAqIEBwYXJhbSBvcHRpb25zIC0gdGhlIG9wdGlvbnMgdG8gc2V0LlxuICAgKi9cbiAgb3B0aW9ucyhvcHRpb25zPzogU29ob01lc3NhZ2VPcHRpb25zKTogU29ob01lc3NhZ2VSZWYge1xuICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIHdpZHRoIGZvciB0aGUgZGlhbG9nLlxuICAgKlxuICAgKiBAcGFyYW0gd2lkdGggLSB0aGUgZXh0cmEgZnJhbWUgaGVpZ2h0IHRvIGFsbG93LlxuICAgKi9cbiAgZnJhbWVIZWlnaHQod2lkdGg6IG51bWJlcik6IFNvaG9NZXNzYWdlUmVmIHtcbiAgICB0aGlzLl9vcHRpb25zLndpZHRoID0gd2lkdGg7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgdGl0bGUgb2YgdGhlIG1lc3NhZ2UgZGlhbG9nLlxuICAgKlxuICAgKiBAcGFyYW0gdGl0bGUgLSB0aGUgdGl0bGUgb2YgdGhlIGRpYWxvZy5cbiAgICovXG4gIHRpdGxlKHRpdGxlOiBzdHJpbmcpOiBTb2hvTWVzc2FnZVJlZiB7XG4gICAgdGhpcy5fb3B0aW9ucy50aXRsZSA9IHRpdGxlO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGJ1dHRvbnMgdG8gdXNlIG9uIHRoZSBtb2RhbCBkaWFsb2cuXG4gICAqXG4gICAqIEBwYXJhbSBidXR0b25zIC0gbGlzdCBvZiBidXR0b25zIHRvIGRpc3BsYXlcbiAgICovXG4gIGJ1dHRvbnMoYnV0dG9uczogU29ob01vZGFsQnV0dG9uW10pOiBTb2hvTWVzc2FnZVJlZiB7XG4gICAgdGhpcy5fb3B0aW9ucy5idXR0b25zID0gYnV0dG9ucztcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBJcyB0aGlzIGFuIGVycm9yIGRpYWxvZz9cbiAgICpcbiAgICogQHBhcmFtIGlzRXJyb3IgLSB0cnVlIGlmIHRoaXMgZGlhbG9nIGlzIHRvIGJlIHN0eWxlZCBhbiBhbiBhbGVydC5cbiAgICovXG4gIGlzRXJyb3IoaXNFcnJvcjogYm9vbGVhbik6IFNvaG9NZXNzYWdlUmVmIHtcbiAgICB0aGlzLl9vcHRpb25zLmlzRXJyb3IgPSBpc0Vycm9yO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlICdtZXNzYWdlJyB0aGF0IHRoZSBtZXNzYWdlIGRpYWxvZyBkaXNwbGF5cy5cbiAgICpcbiAgICogQHBhcmFtIG1lc3NhZ2UgLSBhIHNlbGVjdG9yIG9yIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIGRpYWxvZyBjb250ZW50LlxuICAgKi9cbiAgbWVzc2FnZShtZXNzYWdlOiBzdHJpbmcpOiBTb2hvTWVzc2FnZVJlZiB7XG4gICAgdGhpcy5fb3B0aW9ucy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSAnc3RhdHVzJyBvZiB0aGUgbW9kYWwgY29udHJvbC5cbiAgICovXG4gIHN0YXR1cyhzdGF0dXM6IHN0cmluZyk6IFNvaG9NZXNzYWdlUmVmIHtcbiAgICB0aGlzLl9vcHRpb25zLnN0YXR1cyA9IHN0YXR1cztcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSAnY3NzQ2xhc3MnIG9mIHRoZSBtb2RhbCBjb250cm9sLlxuICAgKi9cbiAgY3NzQ2xhc3MoY3NzQ2xhc3M6IHN0cmluZyk6IFNvaG9NZXNzYWdlUmVmIHtcbiAgICB0aGlzLl9vcHRpb25zLmNzc0NsYXNzID0gY3NzQ2xhc3M7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogSWYgdHJ1ZSwgaXQgd2lsbCBzaG93IGEgY2xvc2UgaWNvbiBidXR0b24gb24gdGhlIHRvcCByaWdodCBvZiB0aGUgbWVzc2FnZS5cbiAgICogXG4gICAqIEBwYXJhbSBzaG93Q2xvc2VCdG4gLSBpZiB0cnVlLCB0aGUgeCBidXR0b24gd2lsbCBiZSBzaG93bi5cbiAgICovXG4gIHNob3dDbG9zZUJ0bihzaG93Q2xvc2VCdG46IGJvb2xlYW4pOiBTb2hvTWVzc2FnZVJlZiB7XG4gICAgdGhpcy5fb3B0aW9ucy5zaG93Q2xvc2VCdG4gPSBzaG93Q2xvc2VCdG47XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgJ2FsbG93VGFncycgb2YgdGhlIG1vZGFsIGNvbnRyb2wuXG4gICAqL1xuICBhbGxvd2VkVGFncyhhbGxvd2VkVGFnczogc3RyaW5nKTogU29ob01lc3NhZ2VSZWYge1xuICAgIHRoaXMuX29wdGlvbnMuYWxsb3dlZFRhZ3MgPSBhbGxvd2VkVGFncztcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSAncmV0dXJuRm9jdXMnIG9mIHRoZSBtb2RhbCBjb250cm9sLlxuICAgKlxuICAgKiBAcGFyYW0gcmV0dXJuRm9jdXMgLWlmIHRydWU7IHRoZSBkaWFsb2cgd2lsbCBhdXRvRm9jdXMuXG4gICAqL1xuICByZXR1cm5Gb2N1cyhyZXR1cm5Gb2N1czogSlF1ZXJ5KTogU29ob01lc3NhZ2VSZWYge1xuICAgIHRoaXMuX29wdGlvbnMucmV0dXJuRm9jdXMgPSByZXR1cm5Gb2N1cztcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDb250cm9scyB0aGUgb3BhY2l0eSBvZiB0aGUgYmFja2dyb3VuZCBvdmVybGF5LlxuICAgKlxuICAgKiBAcGFyYW0gb3ZlcmxheU9wYWNpdHkgLSBUaGUgcGVyY2VudCBiZXR3ZWVuIDAgYW5kIDEgb2Ygb3BhY2l0eSB0byB1c2UuXG4gICAqL1xuICBvdmVybGF5T3BhY2l0eShvdmVybGF5T3BhY2l0eTogbnVtYmVyKTogU29ob01lc3NhZ2VSZWYge1xuICAgIHRoaXMuX29wdGlvbnMub3ZlcmxheU9wYWNpdHkgPSBvdmVybGF5T3BhY2l0eTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDYXVzZXMgdGhpcyBtb2RhbCBpbnN0YW5jZSB0byBiZWNvbWUgaGlkZGVuIHdoZW4gYW5vdGhlciBtb2RhbCBpcyBkaXNwbGF5ZWQgb3ZlciB0b3AuXG4gICAqXG4gICAqIEBwYXJhbSBoaWRlVW5kZXJuZWF0aCAtIElmIGl0IHNob3VsZCBiZSBvbiB0b3Agb3IgYm90dG9tLlxuICAgKi9cbiAgaGlkZVVuZGVybmVhdGgoaGlkZVVuZGVybmVhdGg6IGJvb2xlYW4pOiBTb2hvTWVzc2FnZVJlZiB7XG4gICAgdGhpcy5fb3B0aW9ucy5oaWRlVW5kZXJuZWF0aCA9IGhpZGVVbmRlcm5lYXRoO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIENhdXNlcyB0aGlzIG1vZGFsIGluc3RhbmNlIHRvIGJlY29tZSBoaWRkZW4gd2hlbiBhbm90aGVyIG1vZGFsIGlzIGRpc3BsYXllZCBvdmVyIHRvcC5cbiAgICpcbiAgICogQHBhcmFtIGhpZGVVbmRlcm5lYXRoIC0gSWYgaXQgc2hvdWxkIGJlIG9uIHRvcCBvciBib3R0b20uXG4gICAqL1xuICBhdHRyaWJ1dGVzKGF0dHJpYnV0ZXM6IEFycmF5PE9iamVjdD4gfCBPYmplY3QpOiBTb2hvTWVzc2FnZVJlZiB7XG4gICAgdGhpcy5fb3B0aW9ucy5hdHRyaWJ1dGVzID0gYXR0cmlidXRlcztcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBEaWFsb2cgcmVzdWx0IHByb3BlcnR5LlxuICAgKlxuICAgKiBAcGFyYW0gZGlhbG9nUmVzdWx0IC0gdGhlIHN0b3JlZCByZXN0dWx0IG9mIHRoZSBkaWFsb2cuXG4gICAqL1xuICBzZXQgZGlhbG9nUmVzdWx0KGRpYWxvZ1Jlc3VsdDogYW55KSB7XG4gICAgdGhpcy5fZGlhbG9nUmVzdWx0ID0gZGlhbG9nUmVzdWx0O1xuICB9XG4gIGdldCBkaWFsb2dSZXN1bHQoKTogYW55IHtcbiAgICByZXR1cm4gdGhpcy5fZGlhbG9nUmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnN0cnVjdG9yLlxuICAgKlxuICAgKiBAcGFyYW0gcGxhY2Vob2xkZXIgZm9yIHRoZSBkaWFsb2c7IGRlZmF1bHRzIHRvIHRoZSBib2R5LlxuICAgKi9cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5fcGxhY2Vob2xkZXIgPSAkKCdib2R5Jyk7XG4gIH1cblxuICAvKipcbiAgICogRGlzcGxheXMgdGhlIG1lc3NhZ2UuXG4gICAqXG4gICAqIEByZXR1cm4gdGhlIGRpYWxvZyByZWYuXG4gICAqL1xuICBvcGVuKCk6IFNvaG9NZXNzYWdlUmVmIHtcbiAgICAvLyBSZXR1cm5zIHRoZSBib2R5IVxuICAgIHRoaXMuX3BsYWNlaG9sZGVyLm1lc3NhZ2UodGhpcy5fb3B0aW9ucyk7XG5cbiAgICAvLyBOZWVkIGEgYmV0dGVyIHdheSBvZiBsb2NhdGluZyB0aGUgbWVzc2FnZSBkaWFsb2cuXG4gICAgdGhpcy5qUXVlcnlFbGVtZW50ID0gdGhpcy5fcGxhY2Vob2xkZXIuZmluZCgnLm1vZGFsLm1lc3NhZ2UnKTtcblxuICAgIC8vIEdldCB0aGUgYXBpLlxuICAgIHRoaXMuX21lc3NhZ2UgPSB0aGlzLmpRdWVyeUVsZW1lbnQuZGF0YSgnbW9kYWwnKTtcblxuICAgIC8vIEFkZCBsaXN0ZW5lcnMgdG8gY29udHJvbCBldmVudCAod2hpY2ggYXJlIG9uIHRoZSBwbGFjZWhvbGRlcilcbiAgICB0aGlzLl9wbGFjZWhvbGRlci5vZmYoJ29wZW4nKS5vbignb3BlbicsICgoZXZlbnQ6IGFueSkgPT4ge1xuICAgICAgdGhpcy5vbk9wZW4oZXZlbnQpO1xuICAgIH0pKTtcblxuICAgIC8vIFRoZXNlIGFyZSB2ZXRvYWJsZSBldmVudHMuXG4gICAgdGhpcy5fcGxhY2Vob2xkZXIub2ZmKCdiZWZvcmVvcGVuJykub24oJ2JlZm9yZW9wZW4nLCAoKGV2ZW50OiBhbnkpID0+IHRoaXMub25CZWZvcmVPcGVuKGV2ZW50KSkpO1xuICAgIHRoaXMuX3BsYWNlaG9sZGVyLm9mZignYmVmb3JlY2xvc2UnKS5vbignYmVmb3JlY2xvc2UnLCAoKGV2ZW50OiBhbnkpID0+IHRoaXMub25CZWZvcmVDbG9zZShldmVudCkpKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIENsb3NlcyB0aGUgbW9kYWwgZGlhbG9nLCBpZiBvcGVuLlxuICAgKlxuICAgKiBAcGFyYW0gZGlhbG9nUmVzdWx0IC0gb3B0aW9uYWwgcmVzdWx0IC0gaGVsZCBmb3IgdGhlIGNhbGxlci5cbiAgICovXG4gIGNsb3NlKGRpYWxvZ1Jlc3VsdD86IGFueSk6IFNvaG9NZXNzYWdlUmVmIHtcbiAgICB0aGlzLmRpYWxvZ1Jlc3VsdCA9IGRpYWxvZ1Jlc3VsdDtcbiAgICBpZiAodGhpcy5fbWVzc2FnZSkge1xuICAgICAgdGhpcy5fbWVzc2FnZS5jbG9zZSgpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBFdmVudCBSZWdpc3RyYXRpb25cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVycyBhIGJlZm9yZSBvcGVuIGd1YXJkLlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnRGbiAtIHRoZSBmdW5jdGlvbiB0byBjYWxsIGJlZm9yZSBvcGVubmluZyB0aGUgZGlhbG9nLlxuICAgKi9cbiAgYmVmb3JlT3BlbihldmVudEZuOiAoKSA9PiBib29sZWFuKTogU29ob01lc3NhZ2VSZWYge1xuICAgIHRoaXMuZXZlbnRHdWFyZC5iZWZvcmVPcGVuID0gZXZlbnRGbjtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBPcGVuZWQgRXZlbnQuXG4gICAqXG4gICAqIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiB0aGUgZGlhbG9nIGlzIGJlaW5nIG9wZW5lZC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50Rm4gLSB0aGUgZnVuY3Rpb24gdG8gaW52b2tlIHdoZW4gdGhlIGRpYWxvZyBpcyB0byBiZSBvcGVuZWQuXG4gICAqL1xuICBvcGVuZWQoZXZlbnRGbjogRnVuY3Rpb24pOiBTb2hvTWVzc2FnZVJlZiB7XG4gICAgdGhpcy5vcGVuJC5zdWJzY3JpYmUoKGY6IGFueSkgPT4ge1xuICAgICAgZXZlbnRGbihmLCB0aGlzKTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlcnMgYSBiZWZvcmUgY2xvc2UgZ3VhcmQuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudEZuIC0gdGhlIGZ1bmN0aW9uIHRvIGNhbGwgYmVmb3JlIGNsb3NpbmcgdGhlIGRpYWxvZy5cbiAgICovXG4gIGJlZm9yZUNsb3NlKGV2ZW50Rm46ICgpID0+IGJvb2xlYW4pOiBTb2hvTWVzc2FnZVJlZiB7XG4gICAgdGhpcy5ldmVudEd1YXJkLmJlZm9yZUNsb3NlID0gZXZlbnRGbjtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gRXZlbnQgSGFuZGxlcnNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8qKlxuICAgKiBIYW5kbGVzIHRoZSAnYmVmb3JlT3BlbicgZXZlbnQsIGZpcmVkIGJlZm9yZSB0aGUgbW9kYWwgZGlhbG9nXG4gICAqIGhhcyBiZWVuIG9wZW5lZC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IC0gZnVsbCBldmVudCBvYmplY3QuXG4gICAqXG4gICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgZGlhbG9nIGNhbiBiZSBvcGVuZWQ7IG90aGVyd2lzZSBmYWxzZSBpZiB2ZW90ZWQuXG4gICAqL1xuICBwcml2YXRlIG9uQmVmb3JlT3BlbihfZXZlbnQ6IGFueSk6IGJvb2xlYW4gfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IGZuOiBGdW5jdGlvbiA9ICh0aGlzLmV2ZW50R3VhcmQuYmVmb3JlT3BlbiBhcyBhbnkpO1xuICAgIHJldHVybiBmbiA/IGZuLmNhbGwodGhpcy5ldmVudEd1YXJkKSA6IHRydWU7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlcyB0aGUgJ2JlZm9yZUNsb3NlRXZlbnQsIGZpcmVkIGJlZm9yZSB0aGUgbW9kYWwgZGlhbG9nXG4gICAqIGlzIGNsb3NlZCwgYWxsb3dpbmcgdGhlIGNsb3N1cmUgdG8gYmUgdmV0b2VkLlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnQgLSBldmVudCBvYmplY3QuXG4gICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgZGlhbG9nIGNhbiBiZSBjbG9zZWQ7IG90aGVyd2lzZSBmYWxzZSBpZiB2ZW90ZWQuXG4gICAqL1xuICBwcml2YXRlIG9uQmVmb3JlQ2xvc2UoX2V2ZW50OiBhbnkpOiBib29sZWFuIHtcbiAgICBjb25zdCBmbiA9IHRoaXMuZXZlbnRHdWFyZC5iZWZvcmVDbG9zZTtcbiAgICByZXR1cm4gZm4gPyBmbi5jYWxsKHRoaXMuZXZlbnRHdWFyZCwgdGhpcywgKHt9IGFzIGFueSksIHVuZGVmaW5lZCkgOiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgdGhlICdvcGVuJyBldmVudCwgZmlyZWQganVzdCBiZWZvcmVcbiAgICogdGhlIGZvY3VzIGlzIGFzc2lnbmVkIHRvIGEgbWVzc2FnZS5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IC0gZnVsbCBldmVudCBvYmplY3QuXG4gICAqL1xuICBwcml2YXRlIG9uT3BlbihldmVudDogYW55KSB7XG4gICAgdGhpcy5vcGVuJC5uZXh0KGV2ZW50KTtcbiAgfVxuXG59XG4iXX0=