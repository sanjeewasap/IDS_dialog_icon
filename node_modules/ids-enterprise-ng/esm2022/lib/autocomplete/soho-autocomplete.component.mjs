import { ChangeDetectionStrategy, Component, EventEmitter, HostBinding, HostListener, Input, Output } from '@angular/core';
import { BaseControlValueAccessor, provideControlValueAccessor } from '../utils/base-control-value-accessor';
import * as i0 from "@angular/core";
export class SohoAutoCompleteComponent extends BaseControlValueAccessor {
    /** Defines the data to use, must be specified for this component. */
    set source(source) {
        this.options.source = source;
    }
    /** Object is passed into the source method, and augmented with parameters. */
    set sourceArguments(sourceArguments) {
        this.options.sourceArguments = sourceArguments;
    }
    /** Menu template, appropriate markup is expected. */
    set template(template) {
        this.options.template = template;
    }
    /** if true, causes filter results that don't match case to be thrown out. */
    set caseSensitive(caseSensitive) {
        this.options.caseSensitive = caseSensitive;
    }
    /** Filters based on the first character('startsWidth') of the string, or the entire string('contains') */
    set filterMode(filterMode) {
        this.options.filterMode = filterMode;
    }
    /** Delay between key strokes on the keypad before the end of typing */
    set delay(delay) {
        this.options.delay = delay;
    }
    /** Width of the open menu */
    set width(width) {
        this.options.width = width;
    }
    /** Offset, the left or top offset */
    set offset(offset) {
        this.options.offset = offset;
    }
    /** Selects first item menu */
    set autoSelectFirstItem(autoSelectFirstItem) {
        this.options.autoSelectFirstItem = autoSelectFirstItem;
    }
    set attributes(attributes) {
        this.options.attributes = attributes;
    }
    get attributes() {
        return this.options.attributes;
    }
    get isAutoComplete() {
        return true;
    }
    // -------------------------------------------
    // Component Input
    // -------------------------------------------
    set disabled(value) {
        if (value) {
            if (this.autocomplete) {
                this.autocomplete.disable();
            }
            this.isDisabled = true;
        }
        else {
            if (this.autocomplete) {
                this.autocomplete.enable();
            }
            this.isDisabled = false;
            this.isReadOnly = false;
        }
    }
    get disabled() {
        return this.isDisabled;
    }
    set readonly(value) {
        if (this.autocomplete) {
            if (value) {
                this.autocomplete.readonly();
                this.isReadOnly = true;
            }
            else {
                this.autocomplete.enable();
                this.isDisabled = false;
                this.isReadOnly = false;
            }
        }
    }
    get readonly() {
        return this.isReadOnly;
    }
    constructor(element) {
        super();
        this.element = element;
        /** Options. */
        this.options = {};
        /**
         * Available Soho Template events as Output (EventEmitters passing the event)
         * Should match the Soho event names for the component
         *
         * @todo replace override of native attribute.
         */
        // eslint-disable-next-line @angular-eslint/no-output-native
        this.change = new EventEmitter();
        this.selected = new EventEmitter();
        this.beforeopen = new EventEmitter();
    }
    onKeyUp(_event) {
        // This is required if masking is used, otherwise the
        // the form binding does not see updates.
        this.internalValue = this.jQueryElement?.val();
    }
    ngAfterViewInit() {
        this.jQueryElement = jQuery(this.element.nativeElement);
        // Bind to jQueryElement's events
        this.jQueryElement
            .on('selected', (...args) => this.selected.emit(args))
            .on('change', (_e, args) => this.onChange(args))
            .on('beforeopen', (_e, args) => this.beforeopen.emit(args));
        // Invoke the Autocomplete
        this.jQueryElement.autocomplete(this.options);
        this.autocomplete = this.jQueryElement.data('autocomplete');
        // Make sure the value of the control is set appropriately.
        if (this.internalValue) {
            this.jQueryElement.val(this.internalValue);
        }
    }
    ngAfterViewChecked() {
        this.disabled = this.isDisabled;
    }
    ngOnDestroy() {
        if (this.autocomplete) {
            this.autocomplete.destroy();
            this.autocomplete = undefined;
        }
    }
    /**
     * Handle the control being changed.
     */
    onChange(event) {
        if (!event) {
            // sometimes the event is not available
            this.internalValue = this.jQueryElement?.val();
            super.writeValue(this.internalValue);
            return;
        }
        this.change.emit(event);
    }
    /**
     * Override writeValue to allow the mask input
     * element to be updated correctly.
     *
     * @param value - the new value
     */
    writeValue(value) {
        super.writeValue(value);
        if (this.jQueryElement) {
            // The processing is required to ensure we use the correct format
            // in the control.
            this.jQueryElement.val(value);
        }
    }
    getValue() {
        return this.internalValue;
    }
    setValue(value) {
        this.writeValue(value);
    }
    /** For async methods, reinit autocomplete `source` setting. */
    updated() {
        this.autocomplete?.updated();
        return this;
    }
    /**
     * This function is called when the control status changes to or from "DISABLED".
     * Depending on the value, it will enable or disable the appropriate DOM element.
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoAutoCompleteComponent, deps: [{ token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: SohoAutoCompleteComponent, selector: "input[soho-autocomplete]", inputs: { source: "source", sourceArguments: "sourceArguments", template: "template", caseSensitive: "caseSensitive", filterMode: "filterMode", delay: "delay", width: "width", offset: "offset", autoSelectFirstItem: "autoSelectFirstItem", attributes: "attributes", disabled: "disabled", readonly: "readonly" }, outputs: { change: "change", selected: "selected", beforeopen: "beforeopen" }, host: { listeners: { "keyup": "onKeyUp($event)" }, properties: { "class.autocomplete": "this.isAutoComplete" } }, providers: [provideControlValueAccessor(SohoAutoCompleteComponent)], usesInheritance: true, ngImport: i0, template: '<ng-content></ng-content>', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoAutoCompleteComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'input[soho-autocomplete]',
                    template: '<ng-content></ng-content>',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [provideControlValueAccessor(SohoAutoCompleteComponent)]
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }]; }, propDecorators: { source: [{
                type: Input
            }], sourceArguments: [{
                type: Input
            }], template: [{
                type: Input
            }], caseSensitive: [{
                type: Input
            }], filterMode: [{
                type: Input
            }], delay: [{
                type: Input
            }], width: [{
                type: Input
            }], offset: [{
                type: Input
            }], autoSelectFirstItem: [{
                type: Input
            }], attributes: [{
                type: Input
            }], change: [{
                type: Output
            }], selected: [{
                type: Output
            }], beforeopen: [{
                type: Output
            }], isAutoComplete: [{
                type: HostBinding,
                args: ['class.autocomplete']
            }], disabled: [{
                type: Input
            }], readonly: [{
                type: Input
            }], onKeyUp: [{
                type: HostListener,
                args: ['keyup', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1hdXRvY29tcGxldGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvaWRzLWVudGVycHJpc2Utbmcvc3JjL2xpYi9hdXRvY29tcGxldGUvc29oby1hdXRvY29tcGxldGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFHTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUVULFlBQVksRUFDWixXQUFXLEVBQ1gsWUFBWSxFQUNaLEtBQUssRUFFTCxNQUFNLEVBQ1AsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUNMLHdCQUF3QixFQUN4QiwyQkFBMkIsRUFDNUIsTUFBTSxzQ0FBc0MsQ0FBQzs7QUFTOUMsTUFBTSxPQUFPLHlCQUEwQixTQUFRLHdCQUFnQztJQUk3RSxxRUFBcUU7SUFDckUsSUFBYSxNQUFNLENBQUMsTUFBOEI7UUFDaEQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQy9CLENBQUM7SUFFRCw4RUFBOEU7SUFDOUUsSUFBYSxlQUFlLENBQUMsZUFBdUI7UUFDbEQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLEdBQUcsZUFBZSxDQUFDO0lBQ2pELENBQUM7SUFFRCxxREFBcUQ7SUFDckQsSUFBYSxRQUFRLENBQUMsUUFBZ0I7UUFDcEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0lBQ25DLENBQUM7SUFFRCw2RUFBNkU7SUFDN0UsSUFBYSxhQUFhLENBQUMsYUFBc0I7UUFDL0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEdBQUcsYUFBYSxDQUFDO0lBQzdDLENBQUM7SUFFRCwwR0FBMEc7SUFDMUcsSUFBYSxVQUFVLENBQUMsVUFBc0M7UUFDNUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO0lBQ3ZDLENBQUM7SUFFRCx1RUFBdUU7SUFDdkUsSUFB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MkIsMkJBQTJCLENBQUM7aUJBQ3BFO2lHQU9jLE1BQU07c0JBQWxCLEtBQUs7Z0JBS08sZUFBZTtzQkFBM0IsS0FBSztnQkFLTyxRQUFRO3NCQUFwQixLQUFLO2dCQUtPLGFBQWE7c0JBQXpCLEtBQUs7Z0JBS08sVUFBVTtzQkFBdEIsS0FBSztnQkFLTyxLQUFLO3NCQUFqQixLQUFLO2dCQUtPLEtBQUs7c0JBQWpCLEtBQUs7Z0JBS08sTUFBTTtzQkFBbEIsS0FBSztnQkFLTyxtQkFBbUI7c0JBQS9CLEtBQUs7Z0JBS0ssVUFBVTtzQkFEcEIsS0FBSztnQkFnQkksTUFBTTtzQkFBZixNQUFNO2dCQUVHLFFBQVE7c0JBQWpCLE1BQU07Z0JBRUcsVUFBVTtzQkFBbkIsTUFBTTtnQkFFZ0MsY0FBYztzQkFBcEQsV0FBVzt1QkFBQyxvQkFBb0I7Z0JBb0JwQixRQUFRO3NCQUFwQixLQUFLO2dCQW9CTyxRQUFRO3NCQUFwQixLQUFLO2dCQXNCTixPQUFPO3NCQUROLFlBQVk7dUJBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3Q2hlY2tlZCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZyxcbiAgSG9zdExpc3RlbmVyLFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBPdXRwdXRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7XG4gIEJhc2VDb250cm9sVmFsdWVBY2Nlc3NvcixcbiAgcHJvdmlkZUNvbnRyb2xWYWx1ZUFjY2Vzc29yXG59IGZyb20gJy4uL3V0aWxzL2Jhc2UtY29udHJvbC12YWx1ZS1hY2Nlc3Nvcic7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2lucHV0W3NvaG8tYXV0b2NvbXBsZXRlXScsIC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgdGVtcGxhdGU6ICc8bmctY29udGVudD48L25nLWNvbnRlbnQ+JyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHByb3ZpZGVyczogW3Byb3ZpZGVDb250cm9sVmFsdWVBY2Nlc3NvcihTb2hvQXV0b0NvbXBsZXRlQ29tcG9uZW50KV1cbn0pXG5cbmV4cG9ydCBjbGFzcyBTb2hvQXV0b0NvbXBsZXRlQ29tcG9uZW50IGV4dGVuZHMgQmFzZUNvbnRyb2xWYWx1ZUFjY2Vzc29yPHN0cmluZz4gaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBBZnRlclZpZXdDaGVja2VkLCBPbkRlc3Ryb3kge1xuICAvKiogT3B0aW9ucy4gKi9cbiAgcHJpdmF0ZSBvcHRpb25zOiBTb2hvQXV0b0NvbXBsZXRlT3B0aW9ucyA9IHt9O1xuXG4gIC8qKiBEZWZpbmVzIHRoZSBkYXRhIHRvIHVzZSwgbXVzdCBiZSBzcGVjaWZpZWQgZm9yIHRoaXMgY29tcG9uZW50LiAqL1xuICBASW5wdXQoKSBzZXQgc291cmNlKHNvdXJjZTogU29ob0F1dG9Db21wbGV0ZVNvdXJjZSkge1xuICAgIHRoaXMub3B0aW9ucy5zb3VyY2UgPSBzb3VyY2U7XG4gIH1cblxuICAvKiogT2JqZWN0IGlzIHBhc3NlZCBpbnRvIHRoZSBzb3VyY2UgbWV0aG9kLCBhbmQgYXVnbWVudGVkIHdpdGggcGFyYW1ldGVycy4gKi9cbiAgQElucHV0KCkgc2V0IHNvdXJjZUFyZ3VtZW50cyhzb3VyY2VBcmd1bWVudHM6IHN0cmluZykge1xuICAgIHRoaXMub3B0aW9ucy5zb3VyY2VBcmd1bWVudHMgPSBzb3VyY2VBcmd1bWVudHM7XG4gIH1cblxuICAvKiogTWVudSB0ZW1wbGF0ZSwgYXBwcm9wcmlhdGUgbWFya3VwIGlzIGV4cGVjdGVkLiAqL1xuICBASW5wdXQoKSBzZXQgdGVtcGxhdGUodGVtcGxhdGU6IHN0cmluZykge1xuICAgIHRoaXMub3B0aW9ucy50ZW1wbGF0ZSA9IHRlbXBsYXRlO1xuICB9XG5cbiAgLyoqIGlmIHRydWUsIGNhdXNlcyBmaWx0ZXIgcmVzdWx0cyB0aGF0IGRvbid0IG1hdGNoIGNhc2UgdG8gYmUgdGhyb3duIG91dC4gKi9cbiAgQElucHV0KCkgc2V0IGNhc2VTZW5zaXRpdmUoY2FzZVNlbnNpdGl2ZTogYm9vbGVhbikge1xuICAgIHRoaXMub3B0aW9ucy5jYXNlU2Vuc2l0aXZlID0gY2FzZVNlbnNpdGl2ZTtcbiAgfVxuXG4gIC8qKiBGaWx0ZXJzIGJhc2VkIG9uIHRoZSBmaXJzdCBjaGFyYWN0ZXIoJ3N0YXJ0c1dpZHRoJykgb2YgdGhlIHN0cmluZywgb3IgdGhlIGVudGlyZSBzdHJpbmcoJ2NvbnRhaW5zJykgKi9cbiAgQElucHV0KCkgc2V0IGZpbHRlck1vZGUoZmlsdGVyTW9kZTogU29ob0F1dG9Db21wbGV0ZUZpbHRlck1vZGUpIHtcbiAgICB0aGlzLm9wdGlvbnMuZmlsdGVyTW9kZSA9IGZpbHRlck1vZGU7XG4gIH1cblxuICAvKiogRGVsYXkgYmV0d2VlbiBrZXkgc3Ryb2tlcyBvbiB0aGUga2V5cGFkIGJlZm9yZSB0aGUgZW5kIG9mIHR5cGluZyAqL1xuICBASW5wdXQoKSBzZXQgZGVsYXkoZGVsYXk6IG51bWJlcikge1xuICAgIHRoaXMub3B0aW9ucy5kZWxheSA9IGRlbGF5O1xuICB9XG5cbiAgLyoqIFdpZHRoIG9mIHRoZSBvcGVuIG1lbnUgKi9cbiAgQElucHV0KCkgc2V0IHdpZHRoKHdpZHRoOiBTb2hvQXV0b0NvbXBsZXRlV2lkdGgpIHtcbiAgICB0aGlzLm9wdGlvbnMud2lkdGggPSB3aWR0aDtcbiAgfVxuXG4gIC8qKiBPZmZzZXQsIHRoZSBsZWZ0IG9yIHRvcCBvZmZzZXQgKi9cbiAgQElucHV0KCkgc2V0IG9mZnNldChvZmZzZXQ6IFNvaG9BdXRvQ29tcGxldGVPZmZzZXQpIHtcbiAgICB0aGlzLm9wdGlvbnMub2Zmc2V0ID0gb2Zmc2V0O1xuICB9XG5cbiAgLyoqIFNlbGVjdHMgZmlyc3QgaXRlbSBtZW51ICovXG4gIEBJbnB1dCgpIHNldCBhdXRvU2VsZWN0Rmlyc3RJdGVtKGF1dG9TZWxlY3RGaXJzdEl0ZW06IGJvb2xlYW4pIHtcbiAgICB0aGlzLm9wdGlvbnMuYXV0b1NlbGVjdEZpcnN0SXRlbSA9IGF1dG9TZWxlY3RGaXJzdEl0ZW07XG4gIH1cblxuICBASW5wdXQoKVxuICBwdWJsaWMgc2V0IGF0dHJpYnV0ZXMoYXR0cmlidXRlczogQXJyYXk8T2JqZWN0PiB8IE9iamVjdCB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVzID0gYXR0cmlidXRlcztcbiAgfVxuXG4gIHB1YmxpYyBnZXQgYXR0cmlidXRlcygpOiBBcnJheTxPYmplY3Q+IHwgT2JqZWN0IHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLmF0dHJpYnV0ZXM7XG4gIH1cblxuICAvKipcbiAgICogQXZhaWxhYmxlIFNvaG8gVGVtcGxhdGUgZXZlbnRzIGFzIE91dHB1dCAoRXZlbnRFbWl0dGVycyBwYXNzaW5nIHRoZSBldmVudClcbiAgICogU2hvdWxkIG1hdGNoIHRoZSBTb2hvIGV2ZW50IG5hbWVzIGZvciB0aGUgY29tcG9uZW50XG4gICAqXG4gICAqIEB0b2RvIHJlcGxhY2Ugb3ZlcnJpZGUgb2YgbmF0aXZlIGF0dHJpYnV0ZS5cbiAgICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LW5hdGl2ZVxuICBAT3V0cHV0KCkgY2hhbmdlOiBFdmVudEVtaXR0ZXI8U29ob0lucHV0RXZlbnRbXT4gPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9JbnB1dEV2ZW50W10+KCk7XG5cbiAgQE91dHB1dCgpIHNlbGVjdGVkOiBFdmVudEVtaXR0ZXI8T2JqZWN0W10+ID0gbmV3IEV2ZW50RW1pdHRlcjxPYmplY3RbXT4oKTtcblxuICBAT3V0cHV0KCkgYmVmb3Jlb3BlbjogRXZlbnRFbWl0dGVyPFNvaG9BdXRvQ29tcGxldGVFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9BdXRvQ29tcGxldGVFdmVudD4oKTtcblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLmF1dG9jb21wbGV0ZScpIGdldCBpc0F1dG9Db21wbGV0ZSgpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gUHVibGljIEFQSVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLyoqXG4gICAqIExvY2FsIHZhcmlhYmxlc1xuICAgKi9cbiAgcHJpdmF0ZSBpc0Rpc2FibGVkPzogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBpc1JlYWRPbmx5PzogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBqUXVlcnlFbGVtZW50ITogSlF1ZXJ5O1xuICBwcml2YXRlIGF1dG9jb21wbGV0ZSE6IFNvaG9BdXRvQ29tcGxldGVTdGF0aWMgfCB1bmRlZmluZWQ7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBDb21wb25lbnQgSW5wdXRcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIEBJbnB1dCgpIHNldCBkaXNhYmxlZCh2YWx1ZTogYm9vbGVhbiB8IHVuZGVmaW5lZCkge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgaWYgKHRoaXMuYXV0b2NvbXBsZXRlKSB7XG4gICAgICAgIHRoaXMuYXV0b2NvbXBsZXRlLmRpc2FibGUoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLmF1dG9jb21wbGV0ZSkge1xuICAgICAgICB0aGlzLmF1dG9jb21wbGV0ZS5lbmFibGUoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5pc1JlYWRPbmx5ID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGRpc2FibGVkKCk6IGJvb2xlYW4gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmlzRGlzYWJsZWQ7XG4gIH1cblxuXG4gIEBJbnB1dCgpIHNldCByZWFkb25seSh2YWx1ZTogYm9vbGVhbiB8IHVuZGVmaW5lZCkge1xuICAgIGlmICh0aGlzLmF1dG9jb21wbGV0ZSkge1xuICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuYXV0b2NvbXBsZXRlLnJlYWRvbmx5KCk7XG4gICAgICAgIHRoaXMuaXNSZWFkT25seSA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmF1dG9jb21wbGV0ZS5lbmFibGUoKTtcbiAgICAgICAgdGhpcy5pc0Rpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNSZWFkT25seSA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGdldCByZWFkb25seSgpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5pc1JlYWRPbmx5O1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50OiBFbGVtZW50UmVmKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2tleXVwJywgWyckZXZlbnQnXSlcbiAgb25LZXlVcChfZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICAvLyBUaGlzIGlzIHJlcXVpcmVkIGlmIG1hc2tpbmcgaXMgdXNlZCwgb3RoZXJ3aXNlIHRoZVxuICAgIC8vIHRoZSBmb3JtIGJpbmRpbmcgZG9lcyBub3Qgc2VlIHVwZGF0ZXMuXG4gICAgdGhpcy5pbnRlcm5hbFZhbHVlID0gdGhpcy5qUXVlcnlFbGVtZW50Py52YWwoKSBhcyBzdHJpbmc7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5qUXVlcnlFbGVtZW50ID0galF1ZXJ5KHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50KTtcblxuICAgIC8vIEJpbmQgdG8galF1ZXJ5RWxlbWVudCdzIGV2ZW50c1xuICAgIHRoaXMualF1ZXJ5RWxlbWVudFxuICAgICAgLm9uKCdzZWxlY3RlZCcsICguLi5hcmdzKSA9PiB0aGlzLnNlbGVjdGVkLmVtaXQoYXJncykpXG4gICAgICAub24oJ2NoYW5nZScsIChfZTogYW55LCBhcmdzOiBhbnlbXSkgPT4gdGhpcy5vbkNoYW5nZShhcmdzKSlcbiAgICAgIC5vbignYmVmb3Jlb3BlbicsIChfZTogYW55LCBhcmdzOiBTb2hvQXV0b0NvbXBsZXRlRXZlbnQpID0+IHRoaXMuYmVmb3Jlb3Blbi5lbWl0KGFyZ3MpKTtcblxuICAgIC8vIEludm9rZSB0aGUgQXV0b2NvbXBsZXRlXG4gICAgdGhpcy5qUXVlcnlFbGVtZW50LmF1dG9jb21wbGV0ZSh0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMuYXV0b2NvbXBsZXRlID0gdGhpcy5qUXVlcnlFbGVtZW50LmRhdGEoJ2F1dG9jb21wbGV0ZScpO1xuXG4gICAgLy8gTWFrZSBzdXJlIHRoZSB2YWx1ZSBvZiB0aGUgY29udHJvbCBpcyBzZXQgYXBwcm9wcmlhdGVseS5cbiAgICBpZiAodGhpcy5pbnRlcm5hbFZhbHVlKSB7XG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQudmFsKHRoaXMuaW50ZXJuYWxWYWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlclZpZXdDaGVja2VkKCkge1xuICAgIHRoaXMuZGlzYWJsZWQgPSB0aGlzLmlzRGlzYWJsZWQ7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5hdXRvY29tcGxldGUpIHtcbiAgICAgIHRoaXMuYXV0b2NvbXBsZXRlLmRlc3Ryb3koKTtcbiAgICAgIHRoaXMuYXV0b2NvbXBsZXRlID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgdGhlIGNvbnRyb2wgYmVpbmcgY2hhbmdlZC5cbiAgICovXG4gIG9uQ2hhbmdlKGV2ZW50OiBhbnlbXSkge1xuICAgIGlmICghZXZlbnQpIHtcbiAgICAgIC8vIHNvbWV0aW1lcyB0aGUgZXZlbnQgaXMgbm90IGF2YWlsYWJsZVxuICAgICAgdGhpcy5pbnRlcm5hbFZhbHVlID0gdGhpcy5qUXVlcnlFbGVtZW50Py52YWwoKSBhcyBzdHJpbmc7XG4gICAgICBzdXBlci53cml0ZVZhbHVlKHRoaXMuaW50ZXJuYWxWYWx1ZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5jaGFuZ2UuZW1pdChldmVudCk7XG4gIH1cblxuICAvKipcbiAgICogT3ZlcnJpZGUgd3JpdGVWYWx1ZSB0byBhbGxvdyB0aGUgbWFzayBpbnB1dFxuICAgKiBlbGVtZW50IHRvIGJlIHVwZGF0ZWQgY29ycmVjdGx5LlxuICAgKlxuICAgKiBAcGFyYW0gdmFsdWUgLSB0aGUgbmV3IHZhbHVlXG4gICAqL1xuICB3cml0ZVZhbHVlKHZhbHVlOiBhbnkpIHtcbiAgICBzdXBlci53cml0ZVZhbHVlKHZhbHVlKTtcblxuICAgIGlmICh0aGlzLmpRdWVyeUVsZW1lbnQpIHtcbiAgICAgIC8vIFRoZSBwcm9jZXNzaW5nIGlzIHJlcXVpcmVkIHRvIGVuc3VyZSB3ZSB1c2UgdGhlIGNvcnJlY3QgZm9ybWF0XG4gICAgICAvLyBpbiB0aGUgY29udHJvbC5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC52YWwodmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIGdldFZhbHVlKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuaW50ZXJuYWxWYWx1ZTtcbiAgfVxuXG4gIHNldFZhbHVlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICB0aGlzLndyaXRlVmFsdWUodmFsdWUpO1xuICB9XG5cbiAgLyoqIEZvciBhc3luYyBtZXRob2RzLCByZWluaXQgYXV0b2NvbXBsZXRlIGBzb3VyY2VgIHNldHRpbmcuICovXG4gIHB1YmxpYyB1cGRhdGVkKCk6IFNvaG9BdXRvQ29tcGxldGVDb21wb25lbnQge1xuICAgIHRoaXMuYXV0b2NvbXBsZXRlPy51cGRhdGVkKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbiB0aGUgY29udHJvbCBzdGF0dXMgY2hhbmdlcyB0byBvciBmcm9tIFwiRElTQUJMRURcIi5cbiAgICogRGVwZW5kaW5nIG9uIHRoZSB2YWx1ZSwgaXQgd2lsbCBlbmFibGUgb3IgZGlzYWJsZSB0aGUgYXBwcm9wcmlhdGUgRE9NIGVsZW1lbnQuXG4gICAqL1xuICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLmRpc2FibGVkID0gaXNEaXNhYmxlZDtcbiAgfVxufVxuIl19