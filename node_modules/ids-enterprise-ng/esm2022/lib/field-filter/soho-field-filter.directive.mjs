import { Directive, EventEmitter, Input, Output, } from '@angular/core';
import * as i0 from "@angular/core";
export class SohoFieldFilterDirective {
    set fieldSettings(settings) {
        if (settings) {
            this._settings = settings;
            this.markForRefresh();
        }
    }
    set fieldDropdownDataSet(dataset) {
        if (dataset) {
            this._settings.dataset = dataset;
            this.markForRefresh();
        }
    }
    set dropdownOpts(options) {
        if (options) {
            this._settings.dropdownOpts = options;
            this.markForRefresh();
        }
    }
    set template(template) {
        if (template) {
            this._settings.template = template;
            this.markForRefresh();
        }
    }
    set selectedFilterType(type) {
        this.setFilterType(type);
    }
    constructor(ref, element, ngZone) {
        this.ref = ref;
        this.element = element;
        this.ngZone = ngZone;
        this.filtered = new EventEmitter();
        // default to only equals
        this._settings = {
            dataset: [
                { value: 'equals', text: 'Equals', icon: 'filter-equals' }
            ]
        };
    }
    ngAfterViewChecked() {
        if (this.runUpdatedOnCheck) {
            this.ngZone.runOutsideAngular(() => {
                // We need to update the control AFTER the model
                // has been updated (assuming there is one), so
                // execute updated after angular has generated
                // the model and the view markup.
                if (this.fieldFilter) {
                    this.fieldFilter.updated(this._settings);
                }
                this.runUpdatedOnCheck = false;
            });
        }
    }
    ngAfterViewInit() {
        // -----------------------------------------------------------------------
        // Must run outside angular so that timeouts in the soho code won't cause
        // a ViewCheck in angular. Not running outside angular results in
        // unnecessary cycles causing the app to lock up (when lots of field-filter
        // objects are used) until all the timeouts have resolved.
        // -----------------------------------------------------------------------
        this.ngZone.runOutsideAngular(() => {
            this.jQueryElement = jQuery(this.element.nativeElement);
            this.jQueryElement.fieldfilter(this._settings);
            this.fieldFilter = this.jQueryElement.data('fieldfilter');
            this.jQueryElement.on('filtered', (event, args) => this.onFiltered(event, args));
        });
    }
    /**
     * Get current filter type
     * returns {object} The current filter type
     */
    getFilterType() {
        return this.ngZone.runOutsideAngular(() => this.fieldFilter?.getFilterType());
    }
    /**
     * Set filter type to given value
     * param {number|string} value to be set, index or value.
     * returns {void}
     */
    setFilterType(value) {
        if (!value) {
            return;
        }
        // Do this if jQueryElement has been built already
        if (this.fieldFilter) {
            this.ngZone.runOutsideAngular(() => this.fieldFilter?.setFilterType(value));
            return;
        }
        // Otherwise, as long as type is SohoFieldFilterOperator, set the selected attribute
        if (typeof value !== 'number') {
            this._settings.dataset?.forEach((filterOption) => {
                filterOption.selected = (filterOption.value === value);
            });
        }
    }
    /** Destructor. */
    ngOnDestroy() {
        if (this.fieldFilter) {
            this.ngZone.runOutsideAngular(() => {
                this.jQueryElement?.off();
                this.fieldFilter?.destroy();
                this.fieldFilter = null;
            });
        }
    }
    markForRefresh() {
        // Run updated on the next updated check.
        this.runUpdatedOnCheck = true;
        // ... make sure the change detector kicks in, otherwise if the inputs
        // were change programmatically the component may not be eligible for
        // updating.
        this.ref.markForCheck();
    }
    onFiltered(event, args) {
        // ensure we are back in the angular zone
        this.ngZone.run(() => {
            event.filterOption = args.data;
            this.filtered.emit(event);
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoFieldFilterDirective, deps: [{ token: i0.ChangeDetectorRef }, { token: i0.ElementRef }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.1.4", type: SohoFieldFilterDirective, selector: "[soho-field-filter]", inputs: { fieldSettings: "fieldSettings", fieldDropdownDataSet: "fieldDropdownDataSet", dropdownOpts: "dropdownOpts", template: "template", selectedFilterType: "selectedFilterType" }, outputs: { filtered: "filtered" }, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoFieldFilterDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[soho-field-filter]' // eslint-disable-line
                }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: i0.ElementRef }, { type: i0.NgZone }]; }, propDecorators: { fieldSettings: [{
                type: Input
            }], fieldDropdownDataSet: [{
                type: Input
            }], dropdownOpts: [{
                type: Input
            }], template: [{
                type: Input
            }], selectedFilterType: [{
                type: Input
            }], filtered: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1maWVsZC1maWx0ZXIuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvaWRzLWVudGVycHJpc2Utbmcvc3JjL2xpYi9maWVsZC1maWx0ZXIvc29oby1maWVsZC1maWx0ZXIuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFHTCxTQUFTLEVBRVQsWUFBWSxFQUNaLEtBQUssRUFHTCxNQUFNLEdBQ1AsTUFBTSxlQUFlLENBQUM7O0FBS3ZCLE1BQU0sT0FBTyx3QkFBd0I7SUFFbkMsSUFBYSxhQUFhLENBQUMsUUFBaUM7UUFDMUQsSUFBSSxRQUFRLEVBQUU7WUFDWixJQUFJLENBQUMsU0FBUyxHQUFHLFFBQVEsQ0FBQztZQUMxQixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDdkI7SUFDSCxDQUFDO0lBRUQsSUFBYSxvQkFBb0IsQ0FBQyxPQUFxQztRQUNyRSxJQUFJLE9BQU8sRUFBRTtZQUNYLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztZQUNqQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDdkI7SUFDSCxDQUFDO0lBRUQsSUFBYSxZQUFZLENBQUMsT0FBNEI7UUFDcEQsSUFBSSxPQUFPLEVBQUU7WUFDWCxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksR0FBRyxPQUFPLENBQUM7WUFDdEMsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1NBQ3ZCO0lBQ0gsQ0FBQztJQUVELElBQWEsUUFBUSxDQUFDLFFBQWdCO1FBQ3BDLElBQUksUUFBUSxFQUFFO1lBQ1osSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1lBQ25DLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztTQUN2QjtJQUNILENBQUM7SUFFRCxJQUFhLGtCQUFrQixDQUFDLElBQTZCO1FBQzNELElBQUksQ0FBQyxhQUFhLENBQUMsSUFB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QyxNQUFNLENBQUMsaUJBQWlCLENBQUMsR0FBRyxFQUFFO2dCQUNqQyxJQUFJLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRSxDQUFDO2dCQUMxQixJQUFJLENBQUMsV0FBVyxFQUFFLE9BQU8sRUFBRSxDQUFDO2dCQUM1QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztZQUMxQixDQUFDLENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQztJQUVELGNBQWM7UUFDWix5Q0FBeUM7UUFDekMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQztRQUU5QixzRUFBc0U7UUFDdEUscUVBQXFFO1FBQ3JFLFlBQVk7UUFDWixJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQzFCLENBQUM7SUFFTyxVQUFVLENBQUMsS0FBNkIsRUFBRSxJQUFTO1FBQ3pELHlDQUF5QztRQUN6QyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUU7WUFDbkIsS0FBSyxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQy9CLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzVCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQzs4R0FqSlUsd0JBQXdCO2tHQUF4Qix3QkFBd0I7OzJGQUF4Qix3QkFBd0I7a0JBSHBDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLHFCQUFxQixDQUFDLHNCQUFzQjtpQkFDdkQ7c0pBR2MsYUFBYTtzQkFBekIsS0FBSztnQkFPTyxvQkFBb0I7c0JBQWhDLEtBQUs7Z0JBT08sWUFBWTtzQkFBeEIsS0FBSztnQkFPTyxRQUFRO3NCQUFwQixLQUFLO2dCQU9PLGtCQUFrQjtzQkFBOUIsS0FBSztnQkFJSSxRQUFRO3NCQUFqQixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3Q2hlY2tlZCxcbiAgQWZ0ZXJWaWV3SW5pdCwgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIERpcmVjdGl2ZSxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgTmdab25lLFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tzb2hvLWZpZWxkLWZpbHRlcl0nIC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbn0pXG5leHBvcnQgY2xhc3MgU29ob0ZpZWxkRmlsdGVyRGlyZWN0aXZlIGltcGxlbWVudHMgQWZ0ZXJWaWV3Q2hlY2tlZCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcblxuICBASW5wdXQoKSBzZXQgZmllbGRTZXR0aW5ncyhzZXR0aW5nczogU29ob0ZpZWxkRmlsdGVyU2V0dGluZ3MpIHtcbiAgICBpZiAoc2V0dGluZ3MpIHtcbiAgICAgIHRoaXMuX3NldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IGZpZWxkRHJvcGRvd25EYXRhU2V0KGRhdGFzZXQ6IEFycmF5PFNvaG9GaWVsZEZpbHRlck9wdGlvbj4pIHtcbiAgICBpZiAoZGF0YXNldCkge1xuICAgICAgdGhpcy5fc2V0dGluZ3MuZGF0YXNldCA9IGRhdGFzZXQ7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IGRyb3Bkb3duT3B0cyhvcHRpb25zOiBTb2hvRHJvcERvd25PcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMpIHtcbiAgICAgIHRoaXMuX3NldHRpbmdzLmRyb3Bkb3duT3B0cyA9IG9wdGlvbnM7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IHRlbXBsYXRlKHRlbXBsYXRlOiBzdHJpbmcpIHtcbiAgICBpZiAodGVtcGxhdGUpIHtcbiAgICAgIHRoaXMuX3NldHRpbmdzLnRlbXBsYXRlID0gdGVtcGxhdGU7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IHNlbGVjdGVkRmlsdGVyVHlwZSh0eXBlOiBTb2hvRmllbGRGaWx0ZXJPcGVyYXRvcikge1xuICAgIHRoaXMuc2V0RmlsdGVyVHlwZSh0eXBlKTtcbiAgfVxuXG4gIEBPdXRwdXQoKSBmaWx0ZXJlZDogRXZlbnRFbWl0dGVyPFNvaG9GaWVsZEZpbHRlcmVkRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxTb2hvRmllbGRGaWx0ZXJlZEV2ZW50PigpO1xuXG4gIC8vIGRlZmF1bHQgdG8gb25seSBlcXVhbHNcbiAgcHJpdmF0ZSBfc2V0dGluZ3M6IFNvaG9GaWVsZEZpbHRlclNldHRpbmdzID0ge1xuICAgIGRhdGFzZXQ6IFtcbiAgICAgIHsgdmFsdWU6ICdlcXVhbHMnLCB0ZXh0OiAnRXF1YWxzJywgaWNvbjogJ2ZpbHRlci1lcXVhbHMnIH1cbiAgICBdXG4gIH07XG5cbiAgLyoqXG4gICAqIExvY2FsIHZhcmlhYmxlc1xuICAgKi9cbiAgcHJpdmF0ZSBqUXVlcnlFbGVtZW50PzogSlF1ZXJ5O1xuICBwcml2YXRlIGZpZWxkRmlsdGVyPzogU29ob0ZpZWxkRmlsdGVyU3RhdGljIHwgbnVsbDtcbiAgcHJpdmF0ZSBydW5VcGRhdGVkT25DaGVjaz86IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWY6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgZWxlbWVudDogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxuICApIHsgfVxuXG4gIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpIHtcbiAgICBpZiAodGhpcy5ydW5VcGRhdGVkT25DaGVjaykge1xuXG4gICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gdXBkYXRlIHRoZSBjb250cm9sIEFGVEVSIHRoZSBtb2RlbFxuICAgICAgICAvLyBoYXMgYmVlbiB1cGRhdGVkIChhc3N1bWluZyB0aGVyZSBpcyBvbmUpLCBzb1xuICAgICAgICAvLyBleGVjdXRlIHVwZGF0ZWQgYWZ0ZXIgYW5ndWxhciBoYXMgZ2VuZXJhdGVkXG4gICAgICAgIC8vIHRoZSBtb2RlbCBhbmQgdGhlIHZpZXcgbWFya3VwLlxuICAgICAgICBpZiAodGhpcy5maWVsZEZpbHRlcikge1xuICAgICAgICAgIHRoaXMuZmllbGRGaWx0ZXIudXBkYXRlZCh0aGlzLl9zZXR0aW5ncyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ydW5VcGRhdGVkT25DaGVjayA9IGZhbHNlO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gTXVzdCBydW4gb3V0c2lkZSBhbmd1bGFyIHNvIHRoYXQgdGltZW91dHMgaW4gdGhlIHNvaG8gY29kZSB3b24ndCBjYXVzZVxuICAgIC8vIGEgVmlld0NoZWNrIGluIGFuZ3VsYXIuIE5vdCBydW5uaW5nIG91dHNpZGUgYW5ndWxhciByZXN1bHRzIGluXG4gICAgLy8gdW5uZWNlc3NhcnkgY3ljbGVzIGNhdXNpbmcgdGhlIGFwcCB0byBsb2NrIHVwICh3aGVuIGxvdHMgb2YgZmllbGQtZmlsdGVyXG4gICAgLy8gb2JqZWN0cyBhcmUgdXNlZCkgdW50aWwgYWxsIHRoZSB0aW1lb3V0cyBoYXZlIHJlc29sdmVkLlxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50ID0galF1ZXJ5KHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50KTtcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5maWVsZGZpbHRlcih0aGlzLl9zZXR0aW5ncyk7XG4gICAgICB0aGlzLmZpZWxkRmlsdGVyID0gdGhpcy5qUXVlcnlFbGVtZW50LmRhdGEoJ2ZpZWxkZmlsdGVyJyk7XG5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vbignZmlsdGVyZWQnLCAoZXZlbnQ6IFNvaG9GaWVsZEZpbHRlcmVkRXZlbnQsIGFyZ3M6IGFueSkgPT4gdGhpcy5vbkZpbHRlcmVkKGV2ZW50LCBhcmdzKSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgZmlsdGVyIHR5cGVcbiAgICogcmV0dXJucyB7b2JqZWN0fSBUaGUgY3VycmVudCBmaWx0ZXIgdHlwZVxuICAgKi9cbiAgcHVibGljIGdldEZpbHRlclR5cGUoKTogYW55IHtcbiAgICByZXR1cm4gdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4gdGhpcy5maWVsZEZpbHRlcj8uZ2V0RmlsdGVyVHlwZSgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgZmlsdGVyIHR5cGUgdG8gZ2l2ZW4gdmFsdWVcbiAgICogcGFyYW0ge251bWJlcnxzdHJpbmd9IHZhbHVlIHRvIGJlIHNldCwgaW5kZXggb3IgdmFsdWUuXG4gICAqIHJldHVybnMge3ZvaWR9XG4gICAqL1xuICBwdWJsaWMgc2V0RmlsdGVyVHlwZSh2YWx1ZTogU29ob0ZpZWxkRmlsdGVyT3BlcmF0b3IgfCBudW1iZXIpIHtcbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIERvIHRoaXMgaWYgalF1ZXJ5RWxlbWVudCBoYXMgYmVlbiBidWlsdCBhbHJlYWR5XG4gICAgaWYgKHRoaXMuZmllbGRGaWx0ZXIpIHtcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuZmllbGRGaWx0ZXI/LnNldEZpbHRlclR5cGUodmFsdWUpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gT3RoZXJ3aXNlLCBhcyBsb25nIGFzIHR5cGUgaXMgU29ob0ZpZWxkRmlsdGVyT3BlcmF0b3IsIHNldCB0aGUgc2VsZWN0ZWQgYXR0cmlidXRlXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ251bWJlcicpIHtcbiAgICAgIHRoaXMuX3NldHRpbmdzLmRhdGFzZXQ/LmZvckVhY2goKGZpbHRlck9wdGlvbjogU29ob0ZpZWxkRmlsdGVyT3B0aW9uKSA9PiB7XG4gICAgICAgIGZpbHRlck9wdGlvbi5zZWxlY3RlZCA9IChmaWx0ZXJPcHRpb24udmFsdWUgPT09IHZhbHVlKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBEZXN0cnVjdG9yLiAqL1xuICBuZ09uRGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5maWVsZEZpbHRlcikge1xuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICB0aGlzLmpRdWVyeUVsZW1lbnQ/Lm9mZigpO1xuICAgICAgICB0aGlzLmZpZWxkRmlsdGVyPy5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMuZmllbGRGaWx0ZXIgPSBudWxsO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgbWFya0ZvclJlZnJlc2goKSB7XG4gICAgLy8gUnVuIHVwZGF0ZWQgb24gdGhlIG5leHQgdXBkYXRlZCBjaGVjay5cbiAgICB0aGlzLnJ1blVwZGF0ZWRPbkNoZWNrID0gdHJ1ZTtcblxuICAgIC8vIC4uLiBtYWtlIHN1cmUgdGhlIGNoYW5nZSBkZXRlY3RvciBraWNrcyBpbiwgb3RoZXJ3aXNlIGlmIHRoZSBpbnB1dHNcbiAgICAvLyB3ZXJlIGNoYW5nZSBwcm9ncmFtbWF0aWNhbGx5IHRoZSBjb21wb25lbnQgbWF5IG5vdCBiZSBlbGlnaWJsZSBmb3JcbiAgICAvLyB1cGRhdGluZy5cbiAgICB0aGlzLnJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgfVxuXG4gIHByaXZhdGUgb25GaWx0ZXJlZChldmVudDogU29ob0ZpZWxkRmlsdGVyZWRFdmVudCwgYXJnczogYW55KSB7XG4gICAgLy8gZW5zdXJlIHdlIGFyZSBiYWNrIGluIHRoZSBhbmd1bGFyIHpvbmVcbiAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgZXZlbnQuZmlsdGVyT3B0aW9uID0gYXJncy5kYXRhO1xuICAgICAgdGhpcy5maWx0ZXJlZC5lbWl0KGV2ZW50KTtcbiAgICB9KTtcbiAgfVxufVxuIl19