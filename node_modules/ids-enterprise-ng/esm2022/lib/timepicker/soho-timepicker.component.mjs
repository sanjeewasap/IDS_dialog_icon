import { ChangeDetectionStrategy, Component, EventEmitter, HostBinding, Input, Output } from '@angular/core';
import { BaseControlValueAccessor, provideControlValueAccessor } from '../utils/base-control-value-accessor';
import * as i0 from "@angular/core";
export class SohoTimePickerComponent extends BaseControlValueAccessor {
    /**
     * Indicates mode, either 'standard' or 'range'; default value is 'standard'
     */
    set mode(mode) {
        this.options.mode = mode;
        if (this.timepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Indicates the pattern for the time format.
     */
    set timeFormat(timeFormat) {
        this.options.timeFormat = timeFormat;
        if (this.timepicker) {
            this.markForRefresh();
        }
    }
    /**
     * An integer from 1 to 60; multiples of this value are displayed as options in the minutes dropdown;
     * default value is 5.
     */
    set minuteInterval(minuteInterval) {
        this.options.minuteInterval = minuteInterval;
        if (this.timepicker) {
            this.markForRefresh();
        }
    }
    /**
     * If a non-matching minutes value is entered, will round the minutes value to the nearest interval on the blur event;
     * default value is false;
     */
    set roundToInterval(roundToInterval) {
        this.options.roundToInterval = roundToInterval;
        if (this.timepicker) {
            this.markForRefresh();
        }
    }
    /**
     * The name of the locale to use for this instance. If not set, the current locale will be used.
     */
    set locale(locale) {
        this.options.locale = locale;
        if (this.timepicker) {
            this.markForRefresh();
        }
    }
    /**
     * The name of the language to use for this instance. If not set, the current locale will be used or the the passed locale will be used.
     */
    set language(language) {
        this.options.language = language;
        if (this.timepicker) {
            this.markForRefresh();
        }
    }
    /**
     * An integer from 1 to 60; multiples of this value are displayed as options in the seconds dropdown;
     * default value is 5.
     */
    set secondInterval(secondInterval) {
        this.options.secondInterval = secondInterval;
        if (this.timepicker) {
            this.markForRefresh();
        }
    }
    /**
     * If defined as a JQuery-wrapped element, will be used as the target element.
     */
    set parentElement(parentElement) {
        this.options.parentElement = parentElement;
        if (this.timepicker) {
            this.markForRefresh();
        }
    }
    /**
     * If set to false, focus will not be returned to the calling element;
     * default value is true.
     */
    set returnFocus(returnFocus) {
        this.options.returnFocus = returnFocus;
        if (this.timepicker) {
            this.markForRefresh();
        }
    }
    /** Add extra attributes like id's to the component **/
    set attributes(attributes) {
        this.options.attributes = attributes;
        if (this.timepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Set the input to tabbable
     */
    set tabbable(tabbable) {
        this.options.tabbable = tabbable;
        if (this.timepicker) {
            this.markForRefresh();
        }
    }
    /**
     * Sets the control to be disabled or not.
     */
    set disabled(value) {
        // Avoid setting the value if not required,
        // this causes issue on component initialisation
        // as enable() is called by both disabled()
        // and readonly().
        if (this.timepicker == null) {
            this.isDisabled = value;
            return;
        }
        // Set the status locally (for refreshing)
        this.isDisabled = value;
        if (value) {
            this.ngZone.runOutsideAngular(() => {
                this.timepicker.disable();
            });
        }
        else {
            this.ngZone.runOutsideAngular(() => {
                this.timepicker.enable();
                this.isReadOnly = false;
            });
        }
    }
    /**
     * Public API
     */
    get disabled() {
        return this.isDisabled;
    }
    /**
     * Sets the control to readonly
     */
    set readonly(value) {
        // Avoid setting the value if not required,
        // this causes issue on component initialisation
        // as enable() is called by both disabled()
        // and readonly().
        if (this.timepicker == null) {
            this.isReadOnly = value;
            return;
        }
        // Set the status locally (for refreshing)
        this.isReadOnly = value;
        if (value) {
            this.ngZone.runOutsideAngular(() => this.timepicker.readonly());
        }
        else {
            this.ngZone.runOutsideAngular(() => {
                this.timepicker.enable();
                this.isDisabled = false;
            });
        }
    }
    get readonly() {
        return this.isReadOnly;
    }
    setValue(time) {
        // There is no API to set the value on the timepicker, so this
        // emulates what the control does internally.
        this.timepicker.element.val(time).trigger('change');
    }
    /**
     * Bind attributes to the host input element
     */
    get isTimepicker() {
        return true;
    }
    /**
     * Creates an instance of SohoTimePickerComponent.
     *
     * @param element the element this component encapsulates.
     * @param ngZone the angular zone for this component.
     * @param ref reference to the change detector
     *
     */
    constructor(element, ngZone, ref) {
        super();
        this.element = element;
        this.ngZone = ngZone;
        this.ref = ref;
        this.isDisabled = undefined;
        this.isReadOnly = undefined;
        this.options = {
            roundToInterval: false,
            returnFocus: true
        };
        /**
         * Called when the datepicker value changes
         *
         * @todo remove override of native attribute.
         */
        // eslint-disable-next-line @angular-eslint/no-output-native
        this.change = new EventEmitter();
    }
    ngAfterViewInit() {
        // call outside the angular zone so change detection
        // isn't triggered by the soho component.
        this.ngZone.runOutsideAngular(() => {
            // assign element to local variable
            this.jQueryElement = jQuery(this.element.nativeElement);
            // initialise the timepicker control
            this.jQueryElement.timepicker(this.options);
            // extract the api
            this.timepicker = this.jQueryElement.data('timepicker');
            /**
             * Bind to jQueryElement's events
             */
            this.jQueryElement
                .on('change', (args) => this.onChange(args));
            if (this.internalValue) {
                this.timepicker.element.val(this.internalValue);
            }
            this.runUpdatedOnCheck = true;
        });
    }
    ngAfterViewChecked() {
        if (this.runUpdatedOnCheck) {
            // Ensure the enabled/disabled flags are set.
            if (this.isDisabled !== null && this.isDisabled !== undefined) {
                this.disabled = this.isDisabled;
            }
            if (this.isReadOnly !== null && this.isReadOnly !== undefined) {
                this.readonly = this.isReadOnly;
            }
            this.ngZone.runOutsideAngular(() => {
                // We need to update the control AFTER the model
                // has been updated (assuming there is one), so
                // execute updated after angular has generated
                // the model and the view markup.
                if (this.timepicker) {
                    this.timepicker?.updated();
                }
                this.runUpdatedOnCheck = false;
            });
        }
    }
    ngOnDestroy() {
        this.ngZone.runOutsideAngular(() => {
            if (this.jQueryElement) {
                // remove the event listeners on this element.
                this.jQueryElement.off();
                this.jQueryElement = undefined;
            }
            if (this.timepicker) {
                // Destroy any widget resources.
                this.timepicker?.destroy();
                this.timepicker = null;
            }
        });
    }
    /**
     * Handle the control being changed.
     */
    onChange(event) {
        this.internalValue = this.timepicker?.element.val();
        // Set the date on the event.
        event.data = this.internalValue;
        // When the request for data has completed, make sure we
        // update the 'dropdown' control.
        this.ngZone.run(() => {
            // Fire the event
            this.change.emit(event);
        });
    }
    /**
     * Override writeValue to allow the time picker
     * element to be updated correctly.
     *
     * @param value - the new value
     */
    writeValue(value) {
        super.writeValue(value);
        if (this.timepicker) {
            // The processing is required to ensure we use the correct format
            // in the control.
            this.timepicker?.element.val(value);
        }
    }
    /**
     * This function is called when the control status changes to or from "DISABLED".
     * Depending on the value, it will enable or disable the appropriate DOM element.
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    /**
     * Marks the components as requiring a rebuild after the next update.
     */
    markForRefresh() {
        // Run updated on the next updated check.
        this.runUpdatedOnCheck = true;
        // ... make sure the change detector kicks in, otherwise if the inputs
        // were change programmatially the component may not be eligible for
        // updating.
        this.ref.markForCheck();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoTimePickerComponent, deps: [{ token: i0.ElementRef }, { token: i0.NgZone }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: SohoTimePickerComponent, selector: "input[soho-timepicker]", inputs: { mode: "mode", timeFormat: "timeFormat", minuteInterval: "minuteInterval", roundToInterval: "roundToInterval", locale: "locale", language: "language", secondInterval: "secondInterval", parentElement: "parentElement", returnFocus: "returnFocus", attributes: "attributes", tabbable: "tabbable", disabled: "disabled", readonly: "readonly" }, outputs: { change: "change" }, host: { properties: { "class.timepicker": "this.isTimepicker" } }, providers: [provideControlValueAccessor(SohoTimePickerComponent)], usesInheritance: true, ngImport: i0, template: '<ng-content></ng-content>', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoTimePickerComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'input[soho-timepicker]',
                    template: '<ng-content></ng-content>',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [provideControlValueAccessor(SohoTimePickerComponent)]
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.NgZone }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { mode: [{
                type: Input
            }], timeFormat: [{
                type: Input
            }], minuteInterval: [{
                type: Input
            }], roundToInterval: [{
                type: Input
            }], locale: [{
                type: Input
            }], language: [{
                type: Input
            }], secondInterval: [{
                type: Input
            }], parentElement: [{
                type: Input
            }], returnFocus: [{
                type: Input
            }], attributes: [{
                type: Input
            }], tabbable: [{
                type: Input
            }], disabled: [{
                type: Input
            }], readonly: [{
                type: Input
            }], change: [{
                type: Output
            }], isTimepicker: [{
                type: HostBinding,
                args: ['class.timepicker']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby10aW1lcGlja2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2lkcy1lbnRlcnByaXNlLW5nL3NyYy9saWIvdGltZXBpY2tlci9zb2hvLXRpbWVwaWNrZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFHTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUVULFlBQVksRUFDWixXQUFXLEVBQ1gsS0FBSyxFQUVMLE1BQU0sRUFHUCxNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQ0wsd0JBQXdCLEVBQ3hCLDJCQUEyQixFQUM1QixNQUFNLHNDQUFzQyxDQUFDOztBQVE5QyxNQUFNLE9BQU8sdUJBQXdCLFNBQVEsd0JBQTZCO0lBY3hFOztPQUVHO0lBQ0gsSUFBYSxJQUFJLENBQUMsSUFBd0I7UUFDdkMsSUFBSSxDQUFDLE9BQWUsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2xDLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNuQixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDdkI7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFhLFVBQVUsQ0FBQyxVQUFrQjtRQUN2QyxJQUFJLENBQUMsT0FBZSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7UUFDOUMsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ25CLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztTQUN2QjtJQUNILENBQUM7SUFDRDs7O09BR0c7SUFDSCxJQUFhLGNBQWMsQ0FBQyxjQUFzQjtRQUMvQyxJQUFJLENBQUMsT0FBZSxDQUFDLGNBQWMsR0FBRyxjQUFjLENBQUM7UUFDdEQsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ25CLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztTQUN2QjtJQUNILENBQUM7SUFFRDs7O09BR0c7SUFDSCxJQUFhLGVBQWUsQ0FBQyxl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dUI7a0JBTm5DLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLHdCQUF3QjtvQkFDbEMsUUFBUSxFQUFFLDJCQUEyQjtvQkFDckMsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07b0JBQy9DLFNBQVMsRUFBRSxDQUFDLDJCQUEyQix5QkFBeUIsQ0FBQztpQkFDbEU7c0pBa0JjLElBQUk7c0JBQWhCLEtBQUs7Z0JBVU8sVUFBVTtzQkFBdEIsS0FBSztnQkFVTyxjQUFjO3NCQUExQixLQUFLO2dCQVdPLGVBQWU7c0JBQTNCLEtBQUs7Z0JBVU8sTUFBTTtzQkFBbEIsS0FBSztnQkFVTyxRQUFRO3NCQUFwQixLQUFLO2dCQVdPLGNBQWM7c0JBQTFCLEtBQUs7Z0JBVU8sYUFBYTtzQkFBekIsS0FBSztnQkFXTyxXQUFXO3NCQUF2QixLQUFLO2dCQVFPLFVBQVU7c0JBQXRCLEtBQUs7Z0JBVU8sUUFBUTtzQkFBcEIsS0FBSztnQkFVTyxRQUFRO3NCQUFwQixLQUFLO2dCQW1DTyxRQUFRO3NCQUFwQixLQUFLO2dCQWlDSSxNQUFNO3NCQUFmLE1BQU07Z0JBWThCLFlBQVk7c0JBQWhELFdBQVc7dUJBQUMsa0JBQWtCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3Q2hlY2tlZCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZyxcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT3V0cHV0LFxuICBOZ1pvbmUsXG4gIENoYW5nZURldGVjdG9yUmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQge1xuICBCYXNlQ29udHJvbFZhbHVlQWNjZXNzb3IsXG4gIHByb3ZpZGVDb250cm9sVmFsdWVBY2Nlc3NvclxufSBmcm9tICcuLi91dGlscy9iYXNlLWNvbnRyb2wtdmFsdWUtYWNjZXNzb3InO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdpbnB1dFtzb2hvLXRpbWVwaWNrZXJdJywgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICB0ZW1wbGF0ZTogJzxuZy1jb250ZW50PjwvbmctY29udGVudD4nLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgcHJvdmlkZXJzOiBbcHJvdmlkZUNvbnRyb2xWYWx1ZUFjY2Vzc29yKFNvaG9UaW1lUGlja2VyQ29tcG9uZW50KV1cbn0pXG5leHBvcnQgY2xhc3MgU29ob1RpbWVQaWNrZXJDb21wb25lbnQgZXh0ZW5kcyBCYXNlQ29udHJvbFZhbHVlQWNjZXNzb3I8YW55PiBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIEFmdGVyVmlld0NoZWNrZWQsIE9uRGVzdHJveSB7XG4gIHByaXZhdGUgcnVuVXBkYXRlZE9uQ2hlY2s/OiBib29sZWFuO1xuICAvKipcbiAgICogTG9jYWwgdmFyaWFibGVzXG4gICAqL1xuICBwcml2YXRlIGpRdWVyeUVsZW1lbnQ/OiBKUXVlcnk7XG4gIHByaXZhdGUgdGltZXBpY2tlcj86IFNvaG9UaW1lUGlja2VyU3RhdGljIHwgbnVsbDtcbiAgcHJpdmF0ZSBpc0Rpc2FibGVkPzogYm9vbGVhbiA9IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBpc1JlYWRPbmx5PzogYm9vbGVhbiA9IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBvcHRpb25zPzogU29ob1RpbWVQaWNrZXJPcHRpb25zID0ge1xuICAgIHJvdW5kVG9JbnRlcnZhbDogZmFsc2UsXG4gICAgcmV0dXJuRm9jdXM6IHRydWVcbiAgfTtcblxuICAvKipcbiAgICogSW5kaWNhdGVzIG1vZGUsIGVpdGhlciAnc3RhbmRhcmQnIG9yICdyYW5nZSc7IGRlZmF1bHQgdmFsdWUgaXMgJ3N0YW5kYXJkJ1xuICAgKi9cbiAgQElucHV0KCkgc2V0IG1vZGUobW9kZTogU29ob1RpbWVQaWNrZXJNb2RlKSB7XG4gICAgKHRoaXMub3B0aW9ucyBhcyBhbnkpLm1vZGUgPSBtb2RlO1xuICAgIGlmICh0aGlzLnRpbWVwaWNrZXIpIHtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5kaWNhdGVzIHRoZSBwYXR0ZXJuIGZvciB0aGUgdGltZSBmb3JtYXQuXG4gICAqL1xuICBASW5wdXQoKSBzZXQgdGltZUZvcm1hdCh0aW1lRm9ybWF0OiBzdHJpbmcpIHtcbiAgICAodGhpcy5vcHRpb25zIGFzIGFueSkudGltZUZvcm1hdCA9IHRpbWVGb3JtYXQ7XG4gICAgaWYgKHRoaXMudGltZXBpY2tlcikge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogQW4gaW50ZWdlciBmcm9tIDEgdG8gNjA7IG11bHRpcGxlcyBvZiB0aGlzIHZhbHVlIGFyZSBkaXNwbGF5ZWQgYXMgb3B0aW9ucyBpbiB0aGUgbWludXRlcyBkcm9wZG93bjtcbiAgICogZGVmYXVsdCB2YWx1ZSBpcyA1LlxuICAgKi9cbiAgQElucHV0KCkgc2V0IG1pbnV0ZUludGVydmFsKG1pbnV0ZUludGVydmFsOiBudW1iZXIpIHtcbiAgICAodGhpcy5vcHRpb25zIGFzIGFueSkubWludXRlSW50ZXJ2YWwgPSBtaW51dGVJbnRlcnZhbDtcbiAgICBpZiAodGhpcy50aW1lcGlja2VyKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIElmIGEgbm9uLW1hdGNoaW5nIG1pbnV0ZXMgdmFsdWUgaXMgZW50ZXJlZCwgd2lsbCByb3VuZCB0aGUgbWludXRlcyB2YWx1ZSB0byB0aGUgbmVhcmVzdCBpbnRlcnZhbCBvbiB0aGUgYmx1ciBldmVudDtcbiAgICogZGVmYXVsdCB2YWx1ZSBpcyBmYWxzZTtcbiAgICovXG4gIEBJbnB1dCgpIHNldCByb3VuZFRvSW50ZXJ2YWwocm91bmRUb0ludGVydmFsOiBib29sZWFuKSB7XG4gICAgKHRoaXMub3B0aW9ucyBhcyBhbnkpLnJvdW5kVG9JbnRlcnZhbCA9IHJvdW5kVG9JbnRlcnZhbDtcbiAgICBpZiAodGhpcy50aW1lcGlja2VyKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBsb2NhbGUgdG8gdXNlIGZvciB0aGlzIGluc3RhbmNlLiBJZiBub3Qgc2V0LCB0aGUgY3VycmVudCBsb2NhbGUgd2lsbCBiZSB1c2VkLlxuICAgKi9cbiAgQElucHV0KCkgc2V0IGxvY2FsZShsb2NhbGU6IHN0cmluZykge1xuICAgICh0aGlzLm9wdGlvbnMgYXMgYW55KS5sb2NhbGUgPSBsb2NhbGU7XG4gICAgaWYgKHRoaXMudGltZXBpY2tlcikge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgbGFuZ3VhZ2UgdG8gdXNlIGZvciB0aGlzIGluc3RhbmNlLiBJZiBub3Qgc2V0LCB0aGUgY3VycmVudCBsb2NhbGUgd2lsbCBiZSB1c2VkIG9yIHRoZSB0aGUgcGFzc2VkIGxvY2FsZSB3aWxsIGJlIHVzZWQuXG4gICAqL1xuICBASW5wdXQoKSBzZXQgbGFuZ3VhZ2UobGFuZ3VhZ2U6IHN0cmluZykge1xuICAgICh0aGlzLm9wdGlvbnMgYXMgYW55KS5sYW5ndWFnZSA9IGxhbmd1YWdlO1xuICAgIGlmICh0aGlzLnRpbWVwaWNrZXIpIHtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQW4gaW50ZWdlciBmcm9tIDEgdG8gNjA7IG11bHRpcGxlcyBvZiB0aGlzIHZhbHVlIGFyZSBkaXNwbGF5ZWQgYXMgb3B0aW9ucyBpbiB0aGUgc2Vjb25kcyBkcm9wZG93bjtcbiAgICogZGVmYXVsdCB2YWx1ZSBpcyA1LlxuICAgKi9cbiAgQElucHV0KCkgc2V0IHNlY29uZEludGVydmFsKHNlY29uZEludGVydmFsOiBudW1iZXIpIHtcbiAgICAodGhpcy5vcHRpb25zIGFzIGFueSkuc2Vjb25kSW50ZXJ2YWwgPSBzZWNvbmRJbnRlcnZhbDtcbiAgICBpZiAodGhpcy50aW1lcGlja2VyKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIElmIGRlZmluZWQgYXMgYSBKUXVlcnktd3JhcHBlZCBlbGVtZW50LCB3aWxsIGJlIHVzZWQgYXMgdGhlIHRhcmdldCBlbGVtZW50LlxuICAgKi9cbiAgQElucHV0KCkgc2V0IHBhcmVudEVsZW1lbnQocGFyZW50RWxlbWVudDogSlF1ZXJ5KSB7XG4gICAgKHRoaXMub3B0aW9ucyBhcyBhbnkpLnBhcmVudEVsZW1lbnQgPSBwYXJlbnRFbGVtZW50O1xuICAgIGlmICh0aGlzLnRpbWVwaWNrZXIpIHtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSWYgc2V0IHRvIGZhbHNlLCBmb2N1cyB3aWxsIG5vdCBiZSByZXR1cm5lZCB0byB0aGUgY2FsbGluZyBlbGVtZW50O1xuICAgKiBkZWZhdWx0IHZhbHVlIGlzIHRydWUuXG4gICAqL1xuICBASW5wdXQoKSBzZXQgcmV0dXJuRm9jdXMocmV0dXJuRm9jdXM6IGJvb2xlYW4pIHtcbiAgICAodGhpcy5vcHRpb25zIGFzIGFueSkucmV0dXJuRm9jdXMgPSByZXR1cm5Gb2N1cztcbiAgICBpZiAodGhpcy50aW1lcGlja2VyKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqIEFkZCBleHRyYSBhdHRyaWJ1dGVzIGxpa2UgaWQncyB0byB0aGUgY29tcG9uZW50ICoqL1xuICBASW5wdXQoKSBzZXQgYXR0cmlidXRlcyhhdHRyaWJ1dGVzOiBBcnJheTxPYmplY3Q+IHwgT2JqZWN0KSB7XG4gICAgKHRoaXMub3B0aW9ucyBhcyBhbnkpLmF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzO1xuICAgIGlmICh0aGlzLnRpbWVwaWNrZXIpIHtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBpbnB1dCB0byB0YWJiYWJsZVxuICAgKi9cbiAgQElucHV0KCkgc2V0IHRhYmJhYmxlKHRhYmJhYmxlOiBib29sZWFuKSB7XG4gICAgKHRoaXMub3B0aW9ucyBhcyBhbnkpLnRhYmJhYmxlID0gdGFiYmFibGU7XG4gICAgaWYgKHRoaXMudGltZXBpY2tlcikge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBjb250cm9sIHRvIGJlIGRpc2FibGVkIG9yIG5vdC5cbiAgICovXG4gIEBJbnB1dCgpIHNldCBkaXNhYmxlZCh2YWx1ZTogYm9vbGVhbiB8IHVuZGVmaW5lZCkge1xuICAgIC8vIEF2b2lkIHNldHRpbmcgdGhlIHZhbHVlIGlmIG5vdCByZXF1aXJlZCxcbiAgICAvLyB0aGlzIGNhdXNlcyBpc3N1ZSBvbiBjb21wb25lbnQgaW5pdGlhbGlzYXRpb25cbiAgICAvLyBhcyBlbmFibGUoKSBpcyBjYWxsZWQgYnkgYm90aCBkaXNhYmxlZCgpXG4gICAgLy8gYW5kIHJlYWRvbmx5KCkuXG4gICAgaWYgKHRoaXMudGltZXBpY2tlciA9PSBudWxsKSB7XG4gICAgICB0aGlzLmlzRGlzYWJsZWQgPSB2YWx1ZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBTZXQgdGhlIHN0YXR1cyBsb2NhbGx5IChmb3IgcmVmcmVzaGluZylcbiAgICB0aGlzLmlzRGlzYWJsZWQgPSB2YWx1ZTtcblxuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAodGhpcy50aW1lcGlja2VyIGFzIGFueSkuZGlzYWJsZSgpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgKHRoaXMudGltZXBpY2tlciBhcyBhbnkpLmVuYWJsZSgpO1xuICAgICAgICB0aGlzLmlzUmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQdWJsaWMgQVBJXG4gICAqL1xuICBnZXQgZGlzYWJsZWQoKTogYm9vbGVhbiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuaXNEaXNhYmxlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBjb250cm9sIHRvIHJlYWRvbmx5XG4gICAqL1xuICBASW5wdXQoKSBzZXQgcmVhZG9ubHkodmFsdWU6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcbiAgICAvLyBBdm9pZCBzZXR0aW5nIHRoZSB2YWx1ZSBpZiBub3QgcmVxdWlyZWQsXG4gICAgLy8gdGhpcyBjYXVzZXMgaXNzdWUgb24gY29tcG9uZW50IGluaXRpYWxpc2F0aW9uXG4gICAgLy8gYXMgZW5hYmxlKCkgaXMgY2FsbGVkIGJ5IGJvdGggZGlzYWJsZWQoKVxuICAgIC8vIGFuZCByZWFkb25seSgpLlxuICAgIGlmICh0aGlzLnRpbWVwaWNrZXIgPT0gbnVsbCkge1xuICAgICAgdGhpcy5pc1JlYWRPbmx5ID0gdmFsdWU7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gU2V0IHRoZSBzdGF0dXMgbG9jYWxseSAoZm9yIHJlZnJlc2hpbmcpXG4gICAgdGhpcy5pc1JlYWRPbmx5ID0gdmFsdWU7XG5cbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+ICh0aGlzLnRpbWVwaWNrZXIgYXMgYW55KS5yZWFkb25seSgpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAodGhpcy50aW1lcGlja2VyIGFzIGFueSkuZW5hYmxlKCk7XG4gICAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IHJlYWRvbmx5KCk6IGJvb2xlYW4gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmlzUmVhZE9ubHk7XG4gIH1cblxuICAvKipcbiAgICogQ2FsbGVkIHdoZW4gdGhlIGRhdGVwaWNrZXIgdmFsdWUgY2hhbmdlc1xuICAgKlxuICAgKiBAdG9kbyByZW1vdmUgb3ZlcnJpZGUgb2YgbmF0aXZlIGF0dHJpYnV0ZS5cbiAgICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LW5hdGl2ZVxuICBAT3V0cHV0KCkgY2hhbmdlOiBFdmVudEVtaXR0ZXI8U29ob1RpbWVQaWNrZXJFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9UaW1lUGlja2VyRXZlbnQ+KCk7XG5cblxuICBwdWJsaWMgc2V0VmFsdWUodGltZTogc3RyaW5nIHwgdW5kZWZpbmVkKSB7XG4gICAgLy8gVGhlcmUgaXMgbm8gQVBJIHRvIHNldCB0aGUgdmFsdWUgb24gdGhlIHRpbWVwaWNrZXIsIHNvIHRoaXNcbiAgICAvLyBlbXVsYXRlcyB3aGF0IHRoZSBjb250cm9sIGRvZXMgaW50ZXJuYWxseS5cbiAgICAodGhpcy50aW1lcGlja2VyIGFzIGFueSkuZWxlbWVudC52YWwodGltZSkudHJpZ2dlcignY2hhbmdlJyk7XG4gIH1cblxuICAvKipcbiAgICogQmluZCBhdHRyaWJ1dGVzIHRvIHRoZSBob3N0IGlucHV0IGVsZW1lbnRcbiAgICovXG4gIEBIb3N0QmluZGluZygnY2xhc3MudGltZXBpY2tlcicpIGdldCBpc1RpbWVwaWNrZXIoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBTb2hvVGltZVBpY2tlckNvbXBvbmVudC5cbiAgICpcbiAgICogQHBhcmFtIGVsZW1lbnQgdGhlIGVsZW1lbnQgdGhpcyBjb21wb25lbnQgZW5jYXBzdWxhdGVzLlxuICAgKiBAcGFyYW0gbmdab25lIHRoZSBhbmd1bGFyIHpvbmUgZm9yIHRoaXMgY29tcG9uZW50LlxuICAgKiBAcGFyYW0gcmVmIHJlZmVyZW5jZSB0byB0aGUgY2hhbmdlIGRldGVjdG9yXG4gICAqXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnQ6IEVsZW1lbnRSZWYsXG4gICAgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSxcbiAgICBwdWJsaWMgcmVmOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgLy8gY2FsbCBvdXRzaWRlIHRoZSBhbmd1bGFyIHpvbmUgc28gY2hhbmdlIGRldGVjdGlvblxuICAgIC8vIGlzbid0IHRyaWdnZXJlZCBieSB0aGUgc29obyBjb21wb25lbnQuXG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgLy8gYXNzaWduIGVsZW1lbnQgdG8gbG9jYWwgdmFyaWFibGVcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudCA9IGpRdWVyeSh0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCk7XG5cbiAgICAgIC8vIGluaXRpYWxpc2UgdGhlIHRpbWVwaWNrZXIgY29udHJvbFxuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50LnRpbWVwaWNrZXIodGhpcy5vcHRpb25zKTtcblxuICAgICAgLy8gZXh0cmFjdCB0aGUgYXBpXG4gICAgICB0aGlzLnRpbWVwaWNrZXIgPSB0aGlzLmpRdWVyeUVsZW1lbnQuZGF0YSgndGltZXBpY2tlcicpO1xuXG4gICAgICAvKipcbiAgICAgICAqIEJpbmQgdG8galF1ZXJ5RWxlbWVudCdzIGV2ZW50c1xuICAgICAgICovXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnRcbiAgICAgICAgLm9uKCdjaGFuZ2UnLCAoYXJnczogU29ob1RpbWVQaWNrZXJFdmVudCkgPT4gdGhpcy5vbkNoYW5nZShhcmdzKSk7XG5cbiAgICAgIGlmICh0aGlzLmludGVybmFsVmFsdWUpIHtcbiAgICAgICAgKHRoaXMudGltZXBpY2tlciBhcyBhbnkpLmVsZW1lbnQudmFsKHRoaXMuaW50ZXJuYWxWYWx1ZSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMucnVuVXBkYXRlZE9uQ2hlY2sgPSB0cnVlO1xuICAgIH0pO1xuICB9XG5cbiAgbmdBZnRlclZpZXdDaGVja2VkKCkge1xuICAgIGlmICh0aGlzLnJ1blVwZGF0ZWRPbkNoZWNrKSB7XG4gICAgICAvLyBFbnN1cmUgdGhlIGVuYWJsZWQvZGlzYWJsZWQgZmxhZ3MgYXJlIHNldC5cbiAgICAgIGlmICh0aGlzLmlzRGlzYWJsZWQgIT09IG51bGwgJiYgdGhpcy5pc0Rpc2FibGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5kaXNhYmxlZCA9IHRoaXMuaXNEaXNhYmxlZDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmlzUmVhZE9ubHkgIT09IG51bGwgJiYgdGhpcy5pc1JlYWRPbmx5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5yZWFkb25seSA9IHRoaXMuaXNSZWFkT25seTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAvLyBXZSBuZWVkIHRvIHVwZGF0ZSB0aGUgY29udHJvbCBBRlRFUiB0aGUgbW9kZWxcbiAgICAgICAgLy8gaGFzIGJlZW4gdXBkYXRlZCAoYXNzdW1pbmcgdGhlcmUgaXMgb25lKSwgc29cbiAgICAgICAgLy8gZXhlY3V0ZSB1cGRhdGVkIGFmdGVyIGFuZ3VsYXIgaGFzIGdlbmVyYXRlZFxuICAgICAgICAvLyB0aGUgbW9kZWwgYW5kIHRoZSB2aWV3IG1hcmt1cC5cbiAgICAgICAgaWYgKHRoaXMudGltZXBpY2tlcikge1xuICAgICAgICAgIHRoaXMudGltZXBpY2tlcj8udXBkYXRlZCgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucnVuVXBkYXRlZE9uQ2hlY2sgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIGlmICh0aGlzLmpRdWVyeUVsZW1lbnQpIHtcbiAgICAgICAgLy8gcmVtb3ZlIHRoZSBldmVudCBsaXN0ZW5lcnMgb24gdGhpcyBlbGVtZW50LlxuICAgICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub2ZmKCk7XG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMudGltZXBpY2tlcikge1xuICAgICAgICAvLyBEZXN0cm95IGFueSB3aWRnZXQgcmVzb3VyY2VzLlxuICAgICAgICB0aGlzLnRpbWVwaWNrZXI/LmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy50aW1lcGlja2VyID0gbnVsbDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgdGhlIGNvbnRyb2wgYmVpbmcgY2hhbmdlZC5cbiAgICovXG4gIG9uQ2hhbmdlKGV2ZW50OiBTb2hvVGltZVBpY2tlckV2ZW50KSB7XG4gICAgdGhpcy5pbnRlcm5hbFZhbHVlID0gdGhpcy50aW1lcGlja2VyPy5lbGVtZW50LnZhbCgpO1xuXG4gICAgLy8gU2V0IHRoZSBkYXRlIG9uIHRoZSBldmVudC5cbiAgICBldmVudC5kYXRhID0gdGhpcy5pbnRlcm5hbFZhbHVlO1xuXG4gICAgLy8gV2hlbiB0aGUgcmVxdWVzdCBmb3IgZGF0YSBoYXMgY29tcGxldGVkLCBtYWtlIHN1cmUgd2VcbiAgICAvLyB1cGRhdGUgdGhlICdkcm9wZG93bicgY29udHJvbC5cbiAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgLy8gRmlyZSB0aGUgZXZlbnRcbiAgICAgIHRoaXMuY2hhbmdlLmVtaXQoZXZlbnQpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE92ZXJyaWRlIHdyaXRlVmFsdWUgdG8gYWxsb3cgdGhlIHRpbWUgcGlja2VyXG4gICAqIGVsZW1lbnQgdG8gYmUgdXBkYXRlZCBjb3JyZWN0bHkuXG4gICAqXG4gICAqIEBwYXJhbSB2YWx1ZSAtIHRoZSBuZXcgdmFsdWVcbiAgICovXG4gIHdyaXRlVmFsdWUodmFsdWU6IGFueSkge1xuICAgIHN1cGVyLndyaXRlVmFsdWUodmFsdWUpO1xuICAgIGlmICh0aGlzLnRpbWVwaWNrZXIpIHtcbiAgICAgIC8vIFRoZSBwcm9jZXNzaW5nIGlzIHJlcXVpcmVkIHRvIGVuc3VyZSB3ZSB1c2UgdGhlIGNvcnJlY3QgZm9ybWF0XG4gICAgICAvLyBpbiB0aGUgY29udHJvbC5cbiAgICAgIHRoaXMudGltZXBpY2tlcj8uZWxlbWVudC52YWwodmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIHRoZSBjb250cm9sIHN0YXR1cyBjaGFuZ2VzIHRvIG9yIGZyb20gXCJESVNBQkxFRFwiLlxuICAgKiBEZXBlbmRpbmcgb24gdGhlIHZhbHVlLCBpdCB3aWxsIGVuYWJsZSBvciBkaXNhYmxlIHRoZSBhcHByb3ByaWF0ZSBET00gZWxlbWVudC5cbiAgICovXG4gIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIE1hcmtzIHRoZSBjb21wb25lbnRzIGFzIHJlcXVpcmluZyBhIHJlYnVpbGQgYWZ0ZXIgdGhlIG5leHQgdXBkYXRlLlxuICAgKi9cbiAgbWFya0ZvclJlZnJlc2goKSB7XG4gICAgLy8gUnVuIHVwZGF0ZWQgb24gdGhlIG5leHQgdXBkYXRlZCBjaGVjay5cbiAgICB0aGlzLnJ1blVwZGF0ZWRPbkNoZWNrID0gdHJ1ZTtcblxuICAgIC8vIC4uLiBtYWtlIHN1cmUgdGhlIGNoYW5nZSBkZXRlY3RvciBraWNrcyBpbiwgb3RoZXJ3aXNlIGlmIHRoZSBpbnB1dHNcbiAgICAvLyB3ZXJlIGNoYW5nZSBwcm9ncmFtbWF0aWFsbHkgdGhlIGNvbXBvbmVudCBtYXkgbm90IGJlIGVsaWdpYmxlIGZvclxuICAgIC8vIHVwZGF0aW5nLlxuICAgIHRoaXMucmVmLm1hcmtGb3JDaGVjaygpO1xuICB9XG59XG4iXX0=