import { ChangeDetectionStrategy, Component, EventEmitter, HostBinding, Input, Output } from '@angular/core';
import { BaseControlValueAccessor, provideControlValueAccessor } from '../utils/base-control-value-accessor';
import * as i0 from "@angular/core";
export class SohoEditorComponent extends BaseControlValueAccessor {
    get isEditor() {
        return true;
    }
    // -------------------------------------------
    // Component Input
    // -------------------------------------------
    /**
     * Enables or disables the control
     */
    set disabled(value) {
        // Avoid setting the value if not required,
        // this causes issue on component initialisation
        // as enable() is called by both disabled()
        // and readonly().
        if (this.editor == null) {
            this.isDisabled = value;
            return;
        }
        // Set the status locally (for refreshing)
        this.isDisabled = value;
        if (value) {
            this.ngZone.runOutsideAngular(() => {
                this.editor?.disable();
            });
        }
        else {
            this.ngZone.runOutsideAngular(() => {
                this.editor?.enable();
                this.isReadOnly = false;
            });
        }
    }
    get disabled() {
        return this.isDisabled;
    }
    /**
     * Sets the control to readonly
     */
    set readonly(value) {
        // Avoid setting the value if not required,
        // this causes issue on component initialisation
        // as enable() is called by both disabled()
        // and readonly().
        if (this.editor == null) {
            this.isReadOnly = value;
            return;
        }
        // Set the status locally (for refreshing)
        this.isReadOnly = value;
        if (value) {
            this.ngZone.runOutsideAngular(() => this.editor?.readonly());
        }
        else {
            this.ngZone.runOutsideAngular(() => {
                this.editor?.enable();
                this.isDisabled = false;
            });
        }
    }
    get readonly() {
        return this.isReadOnly;
    }
    set delay(delay) {
        this.options.delay = delay;
    }
    set firstHeader(firstHeader) {
        this.options.firstHeader = firstHeader;
    }
    set secondHeader(secondHeader) {
        this.options.secondHeader = secondHeader;
        if (this.editor) {
            this.editor.settings.secondHeader = secondHeader;
            this.markForRefresh();
        }
    }
    set placeholder(placeholder) {
        this.options.placeholder = placeholder;
        if (this.editor) {
            this.editor.settings.placeholder = placeholder;
            this.markForRefresh();
        }
    }
    set anchor(anchor) {
        this.options.anchor = anchor;
        if (this.editor) {
            this.editor.settings.anchor = anchor;
            this.markForRefresh();
        }
    }
    set image(image) {
        this.options.image = image;
        this.markForRefresh();
        if (this.editor) {
            this.editor.settings.image = image;
        }
    }
    set buttons(buttons) {
        this.options.buttons = buttons;
        if (this.editor) {
            this.editor.settings.buttons = buttons;
            this.markForRefresh();
        }
    }
    /**
     * onLinkClick Callback for Editor clicks
     */
    set onLinkClick(value) {
        this.options.onLinkClick = value;
        if (this.editor) {
            this.editor.settings.onLinkClick = value;
            this.markForRefresh();
        }
    }
    set showHtmlView(showHtmlView) {
        this.options.showHtmlView = showHtmlView;
        if (this.editor) {
            this.editor.settings.showHtmlView = showHtmlView;
            this.markForRefresh();
        }
    }
    set preview(preview) {
        this.options.preview = preview;
        if (this.editor) {
            this.editor.settings.preview = preview;
            this.markForRefresh();
        }
    }
    set rows(rows) {
        this.options.rows = rows;
        if (this.editor) {
            this.editor.settings.rows = rows;
            this.markForRefresh();
        }
    }
    set attributes(attributes) {
        this.options.attributes = attributes;
        if (this.editor) {
            this.editor.settings.attributes = attributes;
            this.markForRefresh();
        }
    }
    /**
     * Creates an instance of SohoEditorComponent.
     *
     * @param element the element this component encapsulates.
     * @param ngZone the angualar zone for this component.
     * @param ref reference to the change detector
     */
    constructor(element, ngZone, ref) {
        super();
        this.element = element;
        this.ngZone = ngZone;
        this.ref = ref;
        // -------------------------------------------
        // Options Block
        // -------------------------------------------
        this.options = {};
        this.isDisabled = undefined;
        this.isReadOnly = undefined;
        // -------------------------------------------
        // Component Output
        // -------------------------------------------
        /**
         * Called when the editor value changes
         *
         * @todo replace override of native attribute
         */
        // eslint-disable-next-line @angular-eslint/no-output-native
        this.change = new EventEmitter();
        /**
         * Called when the editor updates in some way
         */
        this.updated = new EventEmitter();
    }
    ngAfterViewInit() {
        // call outside the angular zone so change detection
        // isn't triggered by the soho component.
        this.ngZone.runOutsideAngular(() => {
            // Wrap the element in a jQuery selector.
            this.jQueryElement = jQuery(this.element.nativeElement);
            // Initialise the SohoXi Control
            this.jQueryElement.editor(this.options);
            this.editor = this.jQueryElement.data('editor');
            // Bind to jQueryElement's events
            this.jQueryElement
                .on('change', (_e, args) => this.onChange(args))
                .on('updated', (_e, args) => this.onUpdated(args));
            if (this.internalValue) {
                this.jQueryElement.html(this.internalValue);
            }
        });
    }
    ngAfterViewChecked() {
        if (this.runUpdatedOnCheck) {
            // Ensure the enabled/disabled flags are set.
            if (this.isDisabled !== null) {
                this.disabled = this.isDisabled;
            }
            if (this.isReadOnly !== null) {
                this.readonly = this.isReadOnly;
            }
            this.ngZone.runOutsideAngular(() => {
                // We need to update the control AFTER the model
                // has been updated (assuming there is one), so
                // execute updated after angular has generated
                // the model and the view markup.
                if (this.editor) {
                    this.editor.updated();
                }
                this.runUpdatedOnCheck = false;
            });
        }
    }
    /**
     * Handle the control being changed.
     */
    onChange(_event) {
        this.internalValue = this.jQueryElement?.html();
        super.writeValue(this.internalValue);
        this.ngZone.run(() => {
            this.change.emit(this.internalValue);
        });
    }
    onUpdated(event) {
        this.ngZone.run(() => {
            this.updated.next(event);
        });
    }
    /**
     *
     * @param value Handle model updates.
     */
    writeValue(value) {
        if (this.jQueryElement && this.internalValue !== value) {
            this.jQueryElement.html(value);
        }
        super.writeValue(value);
    }
    /**
     * This function is called when the control status changes to or from "DISABLED".
     * Depending on the value, it will enable or disable the appropriate DOM element.
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    ngOnDestroy() {
        this.ngZone.runOutsideAngular(() => {
            if (this.jQueryElement) {
                // remove the event listeners on this element.
                this.jQueryElement.off();
                this.jQueryElement = undefined;
            }
            // Destroy any widget resources.
            if (this.editor) {
                this.editor.destroy();
                this.editor = null;
            }
        });
    }
    /**
     * Marks the components as requiring a rebuild after the next update.
     */
    markForRefresh() {
        // Run updated on the next updated check.
        this.runUpdatedOnCheck = true;
        // ... make sure the change detector kicks in, otherwise if the inputs
        // were change programmatially the component may not be eligible for
        // updating.
        this.ref.markForCheck();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoEditorComponent, deps: [{ token: i0.ElementRef }, { token: i0.NgZone }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: SohoEditorComponent, selector: "[soho-editor]", inputs: { disabled: "disabled", readonly: "readonly", delay: "delay", firstHeader: "firstHeader", secondHeader: "secondHeader", placeholder: "placeholder", anchor: "anchor", image: "image", buttons: "buttons", onLinkClick: "onLinkClick", showHtmlView: "showHtmlView", preview: "preview", rows: "rows", attributes: "attributes" }, outputs: { change: "change", updated: "updated" }, host: { properties: { "class.editor": "this.isEditor" } }, providers: [provideControlValueAccessor(SohoEditorComponent)], usesInheritance: true, ngImport: i0, template: '<ng-content></ng-content>', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoEditorComponent, decorators: [{
            type: Component,
            args: [{
                    selector: '[soho-editor]',
                    template: '<ng-content></ng-content>',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [provideControlValueAccessor(SohoEditorComponent)]
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.NgZone }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { isEditor: [{
                type: HostBinding,
                args: ['class.editor']
            }], disabled: [{
                type: Input
            }], readonly: [{
                type: Input
            }], delay: [{
                type: Input
            }], firstHeader: [{
                type: Input
            }], secondHeader: [{
                type: Input
            }], placeholder: [{
                type: Input
            }], anchor: [{
                type: Input
            }], image: [{
                type: Input
            }], buttons: [{
                type: Input
            }], onLinkClick: [{
                type: Input
            }], showHtmlView: [{
                type: Input
            }], preview: [{
                type: Input
            }], rows: [{
                type: Input
            }], attributes: [{
                type: Input
            }], change: [{
                type: Output
            }], updated: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1lZGl0b3IuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvaWRzLWVudGVycHJpc2Utbmcvc3JjL2xpYi9lZGl0b3Ivc29oby1lZGl0b3IuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFHTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUVULFlBQVksRUFDWixXQUFXLEVBQ1gsS0FBSyxFQUVMLE1BQU0sRUFHUCxNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQ0wsd0JBQXdCLEVBQ3hCLDJCQUEyQixFQUM1QixNQUFNLHNDQUFzQyxDQUFDOztBQVE5QyxNQUFNLE9BQU8sbUJBQW9CLFNBQVEsd0JBQTZCO0lBa0JwRSxJQUFpQyxRQUFRO1FBQ3ZDLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELDhDQUE4QztJQUM5QyxrQkFBa0I7SUFDbEIsOENBQThDO0lBRTlDOztPQUVHO0lBQ0gsSUFBYSxRQUFRLENBQUMsS0FBMEI7UUFDOUMsMkNBQTJDO1FBQzNDLGdEQUFnRDtRQUNoRCwyQ0FBMkM7UUFDM0Msa0JBQWtCO1FBQ2xCLElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLEVBQUU7WUFDdkIsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7WUFDeEIsT0FBTztTQUNSO1FBRUQsMENBQTBDO1FBQzFDLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDO1FBRXhCLElBQUksS0FBSyxFQUFFO1lBQ1QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEVBQUU7Z0JBQ2pDLElBQUksQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLENBQUM7WUFDekIsQ0FBQyxDQUFDLENBQUM7U0FDSjthQUFNO1lBQ0wsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEVBQUU7Z0JBQ2pDLElBQUksQ0FBQyxNQUFNLEVB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QUF4QixLQUFLO2dCQVFPLE9BQU87c0JBQW5CLEtBQUs7Z0JBUU8sSUFBSTtzQkFBaEIsS0FBSztnQkFTTyxVQUFVO3NCQUF0QixLQUFLO2dCQW1CSSxNQUFNO3NCQUFmLE1BQU07Z0JBS0csT0FBTztzQkFBaEIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0NoZWNrZWQsXG4gIEFmdGVyVmlld0luaXQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIElucHV0LFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbiAgTmdab25lLFxuICBDaGFuZ2VEZXRlY3RvclJlZlxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHtcbiAgQmFzZUNvbnRyb2xWYWx1ZUFjY2Vzc29yLFxuICBwcm92aWRlQ29udHJvbFZhbHVlQWNjZXNzb3Jcbn0gZnJvbSAnLi4vdXRpbHMvYmFzZS1jb250cm9sLXZhbHVlLWFjY2Vzc29yJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnW3NvaG8tZWRpdG9yXScsIC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgdGVtcGxhdGU6ICc8bmctY29udGVudD48L25nLWNvbnRlbnQ+JyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHByb3ZpZGVyczogW3Byb3ZpZGVDb250cm9sVmFsdWVBY2Nlc3NvcihTb2hvRWRpdG9yQ29tcG9uZW50KV1cbn0pXG5leHBvcnQgY2xhc3MgU29ob0VkaXRvckNvbXBvbmVudCBleHRlbmRzIEJhc2VDb250cm9sVmFsdWVBY2Nlc3Nvcjxhbnk+IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgQWZ0ZXJWaWV3Q2hlY2tlZCwgT25EZXN0cm95IHtcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIE9wdGlvbnMgQmxvY2tcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIHByaXZhdGUgb3B0aW9uczogU29ob0VkaXRvck9wdGlvbnMgPSB7fTtcblxuICAvKipcbiAgICogTG9jYWwgdmFyaWFibGVzXG4gICAqL1xuICAvKipcbiAgICogRmxhZyB0byBmb3JjZSBhbiB1cGRhdGUgb2YgdGhlIGNvbnRyb2wgYWZ0ZXIgdGhlIHZpZXcgaXMgY3JlYXRlZC5cbiAgICovXG4gIHByaXZhdGUgcnVuVXBkYXRlZE9uQ2hlY2s/OiBib29sZWFuO1xuICBwcml2YXRlIGlzRGlzYWJsZWQ/OiBib29sZWFuID0gdW5kZWZpbmVkO1xuICBwcml2YXRlIGlzUmVhZE9ubHk/OiBib29sZWFuID0gdW5kZWZpbmVkO1xuXG4gIEBIb3N0QmluZGluZygnY2xhc3MuZWRpdG9yJykgZ2V0IGlzRWRpdG9yKCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBDb21wb25lbnQgSW5wdXRcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8qKlxuICAgKiBFbmFibGVzIG9yIGRpc2FibGVzIHRoZSBjb250cm9sXG4gICAqL1xuICBASW5wdXQoKSBzZXQgZGlzYWJsZWQodmFsdWU6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcbiAgICAvLyBBdm9pZCBzZXR0aW5nIHRoZSB2YWx1ZSBpZiBub3QgcmVxdWlyZWQsXG4gICAgLy8gdGhpcyBjYXVzZXMgaXNzdWUgb24gY29tcG9uZW50IGluaXRpYWxpc2F0aW9uXG4gICAgLy8gYXMgZW5hYmxlKCkgaXMgY2FsbGVkIGJ5IGJvdGggZGlzYWJsZWQoKVxuICAgIC8vIGFuZCByZWFkb25seSgpLlxuICAgIGlmICh0aGlzLmVkaXRvciA9PSBudWxsKSB7XG4gICAgICB0aGlzLmlzRGlzYWJsZWQgPSB2YWx1ZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBTZXQgdGhlIHN0YXR1cyBsb2NhbGx5IChmb3IgcmVmcmVzaGluZylcbiAgICB0aGlzLmlzRGlzYWJsZWQgPSB2YWx1ZTtcblxuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICB0aGlzLmVkaXRvcj8uZGlzYWJsZSgpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgdGhpcy5lZGl0b3I/LmVuYWJsZSgpO1xuICAgICAgICB0aGlzLmlzUmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGdldCBkaXNhYmxlZCgpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5pc0Rpc2FibGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGNvbnRyb2wgdG8gcmVhZG9ubHlcbiAgICovXG4gIEBJbnB1dCgpIHNldCByZWFkb25seSh2YWx1ZTogYm9vbGVhbiB8IHVuZGVmaW5lZCkge1xuICAgIC8vIEF2b2lkIHNldHRpbmcgdGhlIHZhbHVlIGlmIG5vdCByZXF1aXJlZCxcbiAgICAvLyB0aGlzIGNhdXNlcyBpc3N1ZSBvbiBjb21wb25lbnQgaW5pdGlhbGlzYXRpb25cbiAgICAvLyBhcyBlbmFibGUoKSBpcyBjYWxsZWQgYnkgYm90aCBkaXNhYmxlZCgpXG4gICAgLy8gYW5kIHJlYWRvbmx5KCkuXG4gICAgaWYgKHRoaXMuZWRpdG9yID09IG51bGwpIHtcbiAgICAgIHRoaXMuaXNSZWFkT25seSA9IHZhbHVlO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFNldCB0aGUgc3RhdHVzIGxvY2FsbHkgKGZvciByZWZyZXNoaW5nKVxuICAgIHRoaXMuaXNSZWFkT25seSA9IHZhbHVlO1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4gdGhpcy5lZGl0b3I/LnJlYWRvbmx5KCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIHRoaXMuZWRpdG9yPy5lbmFibGUoKTtcbiAgICAgICAgdGhpcy5pc0Rpc2FibGVkID0gZmFsc2U7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBnZXQgcmVhZG9ubHkoKTogYm9vbGVhbiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuaXNSZWFkT25seTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBkZWxheShkZWxheTogbnVtYmVyKSB7XG4gICAgdGhpcy5vcHRpb25zLmRlbGF5ID0gZGVsYXk7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgZmlyc3RIZWFkZXIoZmlyc3RIZWFkZXI6IHN0cmluZykge1xuICAgIHRoaXMub3B0aW9ucy5maXJzdEhlYWRlciA9IGZpcnN0SGVhZGVyO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IHNlY29uZEhlYWRlcihzZWNvbmRIZWFkZXI6IHN0cmluZykge1xuICAgIHRoaXMub3B0aW9ucy5zZWNvbmRIZWFkZXIgPSBzZWNvbmRIZWFkZXI7XG4gICAgaWYgKHRoaXMuZWRpdG9yKSB7XG4gICAgICB0aGlzLmVkaXRvci5zZXR0aW5ncy5zZWNvbmRIZWFkZXIgPSBzZWNvbmRIZWFkZXI7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IHBsYWNlaG9sZGVyKHBsYWNlaG9sZGVyOiBzdHJpbmcpIHtcbiAgICB0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIgPSBwbGFjZWhvbGRlcjtcbiAgICBpZiAodGhpcy5lZGl0b3IpIHtcbiAgICAgIHRoaXMuZWRpdG9yLnNldHRpbmdzLnBsYWNlaG9sZGVyID0gcGxhY2Vob2xkZXI7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IGFuY2hvcihhbmNob3I6IFNvaG9FZGl0b3JBbmNob3IpIHtcbiAgICB0aGlzLm9wdGlvbnMuYW5jaG9yID0gYW5jaG9yO1xuICAgIGlmICh0aGlzLmVkaXRvcikge1xuICAgICAgdGhpcy5lZGl0b3Iuc2V0dGluZ3MuYW5jaG9yID0gYW5jaG9yO1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBpbWFnZShpbWFnZTogU29ob0VkaXRvck9wdGlvbnNJbWFnZSkge1xuICAgIHRoaXMub3B0aW9ucy5pbWFnZSA9IGltYWdlO1xuICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICBpZiAodGhpcy5lZGl0b3IpIHtcbiAgICAgIHRoaXMuZWRpdG9yLnNldHRpbmdzLmltYWdlID0gaW1hZ2U7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IGJ1dHRvbnMoYnV0dG9uczogU29ob0VkaXRvckJ1dHRvbnMpIHtcbiAgICB0aGlzLm9wdGlvbnMuYnV0dG9ucyA9IGJ1dHRvbnM7XG5cbiAgICBpZiAodGhpcy5lZGl0b3IpIHtcbiAgICAgIHRoaXMuZWRpdG9yLnNldHRpbmdzLmJ1dHRvbnMgPSBidXR0b25zO1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBvbkxpbmtDbGljayBDYWxsYmFjayBmb3IgRWRpdG9yIGNsaWNrc1xuICAgKi9cbiAgQElucHV0KCkgc2V0IG9uTGlua0NsaWNrKHZhbHVlOiAoZTogSlF1ZXJ5LlRyaWdnZXJlZEV2ZW50LCBlbGVtOiBhbnkpID0+IHZvaWQpIHtcbiAgICB0aGlzLm9wdGlvbnMub25MaW5rQ2xpY2sgPSB2YWx1ZTtcbiAgICBpZiAodGhpcy5lZGl0b3IpIHtcbiAgICAgIHRoaXMuZWRpdG9yLnNldHRpbmdzLm9uTGlua0NsaWNrID0gdmFsdWU7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IHNob3dIdG1sVmlldyhzaG93SHRtbFZpZXc6IGJvb2xlYW4pIHtcbiAgICB0aGlzLm9wdGlvbnMuc2hvd0h0bWxWaWV3ID0gc2hvd0h0bWxWaWV3O1xuICAgIGlmICh0aGlzLmVkaXRvcikge1xuICAgICAgdGhpcy5lZGl0b3Iuc2V0dGluZ3Muc2hvd0h0bWxWaWV3ID0gc2hvd0h0bWxWaWV3O1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBwcmV2aWV3KHByZXZpZXc6IGJvb2xlYW4pIHtcbiAgICB0aGlzLm9wdGlvbnMucHJldmlldyA9IHByZXZpZXc7XG4gICAgaWYgKHRoaXMuZWRpdG9yKSB7XG4gICAgICB0aGlzLmVkaXRvci5zZXR0aW5ncy5wcmV2aWV3ID0gcHJldmlldztcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICBASW5wdXQoKSBzZXQgcm93cyhyb3dzOiBTb2hvRWRpdG9yUm93cykge1xuICAgIHRoaXMub3B0aW9ucy5yb3dzID0gcm93cztcblxuICAgIGlmICh0aGlzLmVkaXRvcikge1xuICAgICAgdGhpcy5lZGl0b3Iuc2V0dGluZ3Mucm93cyA9IHJvd3M7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IGF0dHJpYnV0ZXMoYXR0cmlidXRlczogQXJyYXk8T2JqZWN0PiB8IE9iamVjdCkge1xuICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVzID0gYXR0cmlidXRlcztcblxuICAgIGlmICh0aGlzLmVkaXRvcikge1xuICAgICAgdGhpcy5lZGl0b3Iuc2V0dGluZ3MuYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXM7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBDb21wb25lbnQgT3V0cHV0XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvKipcbiAgICogQ2FsbGVkIHdoZW4gdGhlIGVkaXRvciB2YWx1ZSBjaGFuZ2VzXG4gICAqXG4gICAqIEB0b2RvIHJlcGxhY2Ugb3ZlcnJpZGUgb2YgbmF0aXZlIGF0dHJpYnV0ZVxuICAgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtbmF0aXZlXG4gIEBPdXRwdXQoKSBjaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9FZGl0b3JFdmVudD4oKTtcblxuICAvKipcbiAgICogQ2FsbGVkIHdoZW4gdGhlIGVkaXRvciB1cGRhdGVzIGluIHNvbWUgd2F5XG4gICAqL1xuICBAT3V0cHV0KCkgdXBkYXRlZCA9IG5ldyBFdmVudEVtaXR0ZXI8U29ob0VkaXRvckV2ZW50PigpO1xuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gUHVibGljIEFQSVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBQcml2YXRlIE1lbWJlciBEYXRhXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvLyBSZWZlcmVuY2UgdG8gdGhlIGpRdWVyeSBjb250cm9sLlxuICBwcml2YXRlIGpRdWVyeUVsZW1lbnQ/OiBKUXVlcnk7XG5cbiAgLy8gUmVmZXJlbmNlIHRvIHRoZSBTb0hvWGkgY29udHJvbCBhcGkuXG4gIHByaXZhdGUgZWRpdG9yPzogU29ob0VkaXRvclN0YXRpYyB8IG51bGw7XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgU29ob0VkaXRvckNvbXBvbmVudC5cbiAgICpcbiAgICogQHBhcmFtIGVsZW1lbnQgdGhlIGVsZW1lbnQgdGhpcyBjb21wb25lbnQgZW5jYXBzdWxhdGVzLlxuICAgKiBAcGFyYW0gbmdab25lIHRoZSBhbmd1YWxhciB6b25lIGZvciB0aGlzIGNvbXBvbmVudC5cbiAgICogQHBhcmFtIHJlZiByZWZlcmVuY2UgdG8gdGhlIGNoYW5nZSBkZXRlY3RvclxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBlbGVtZW50OiBFbGVtZW50UmVmPEhUTUxFbGVtZW50PixcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxuICAgIHByaXZhdGUgcmVmOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgLy8gY2FsbCBvdXRzaWRlIHRoZSBhbmd1bGFyIHpvbmUgc28gY2hhbmdlIGRldGVjdGlvblxuICAgIC8vIGlzbid0IHRyaWdnZXJlZCBieSB0aGUgc29obyBjb21wb25lbnQuXG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgLy8gV3JhcCB0aGUgZWxlbWVudCBpbiBhIGpRdWVyeSBzZWxlY3Rvci5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudCA9IGpRdWVyeSh0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCk7XG5cbiAgICAgIC8vIEluaXRpYWxpc2UgdGhlIFNvaG9YaSBDb250cm9sXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQuZWRpdG9yKHRoaXMub3B0aW9ucyk7XG5cbiAgICAgIHRoaXMuZWRpdG9yID0gdGhpcy5qUXVlcnlFbGVtZW50LmRhdGEoJ2VkaXRvcicpO1xuXG4gICAgICAvLyBCaW5kIHRvIGpRdWVyeUVsZW1lbnQncyBldmVudHNcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudFxuICAgICAgICAub24oJ2NoYW5nZScsIChfZTogSlF1ZXJ5LlRyaWdnZXJlZEV2ZW50LCBhcmdzOiBTb2hvRWRpdG9yRXZlbnQpID0+IHRoaXMub25DaGFuZ2UoYXJncykpXG4gICAgICAgIC5vbigndXBkYXRlZCcsIChfZTogSlF1ZXJ5LlRyaWdnZXJlZEV2ZW50LCBhcmdzOiBTb2hvRWRpdG9yRXZlbnQpID0+IHRoaXMub25VcGRhdGVkKGFyZ3MpKTtcblxuICAgICAgaWYgKHRoaXMuaW50ZXJuYWxWYWx1ZSkge1xuICAgICAgICB0aGlzLmpRdWVyeUVsZW1lbnQuaHRtbCh0aGlzLmludGVybmFsVmFsdWUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgbmdBZnRlclZpZXdDaGVja2VkKCkge1xuICAgIGlmICh0aGlzLnJ1blVwZGF0ZWRPbkNoZWNrKSB7XG4gICAgICAvLyBFbnN1cmUgdGhlIGVuYWJsZWQvZGlzYWJsZWQgZmxhZ3MgYXJlIHNldC5cbiAgICAgIGlmICh0aGlzLmlzRGlzYWJsZWQgIT09IG51bGwpIHtcbiAgICAgICAgdGhpcy5kaXNhYmxlZCA9IHRoaXMuaXNEaXNhYmxlZDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmlzUmVhZE9ubHkgIT09IG51bGwpIHtcbiAgICAgICAgdGhpcy5yZWFkb25seSA9IHRoaXMuaXNSZWFkT25seTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAvLyBXZSBuZWVkIHRvIHVwZGF0ZSB0aGUgY29udHJvbCBBRlRFUiB0aGUgbW9kZWxcbiAgICAgICAgLy8gaGFzIGJlZW4gdXBkYXRlZCAoYXNzdW1pbmcgdGhlcmUgaXMgb25lKSwgc29cbiAgICAgICAgLy8gZXhlY3V0ZSB1cGRhdGVkIGFmdGVyIGFuZ3VsYXIgaGFzIGdlbmVyYXRlZFxuICAgICAgICAvLyB0aGUgbW9kZWwgYW5kIHRoZSB2aWV3IG1hcmt1cC5cbiAgICAgICAgaWYgKHRoaXMuZWRpdG9yKSB7XG4gICAgICAgICAgdGhpcy5lZGl0b3IudXBkYXRlZCgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucnVuVXBkYXRlZE9uQ2hlY2sgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgdGhlIGNvbnRyb2wgYmVpbmcgY2hhbmdlZC5cbiAgICovXG4gIG9uQ2hhbmdlKF9ldmVudDogU29ob0VkaXRvckV2ZW50KSB7XG4gICAgdGhpcy5pbnRlcm5hbFZhbHVlID0gdGhpcy5qUXVlcnlFbGVtZW50Py5odG1sKCk7XG5cbiAgICBzdXBlci53cml0ZVZhbHVlKHRoaXMuaW50ZXJuYWxWYWx1ZSk7XG5cbiAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgdGhpcy5jaGFuZ2UuZW1pdCh0aGlzLmludGVybmFsVmFsdWUpO1xuICAgIH0pO1xuICB9XG5cbiAgb25VcGRhdGVkKGV2ZW50OiBTb2hvRWRpdG9yRXZlbnQpIHtcbiAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgdGhpcy51cGRhdGVkLm5leHQoZXZlbnQpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB2YWx1ZSBIYW5kbGUgbW9kZWwgdXBkYXRlcy5cbiAgICovXG4gIHdyaXRlVmFsdWUodmFsdWU6IGFueSkge1xuICAgIGlmICh0aGlzLmpRdWVyeUVsZW1lbnQgJiYgdGhpcy5pbnRlcm5hbFZhbHVlICE9PSB2YWx1ZSkge1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50Lmh0bWwodmFsdWUpO1xuICAgIH1cbiAgICBzdXBlci53cml0ZVZhbHVlKHZhbHVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIHRoZSBjb250cm9sIHN0YXR1cyBjaGFuZ2VzIHRvIG9yIGZyb20gXCJESVNBQkxFRFwiLlxuICAgKiBEZXBlbmRpbmcgb24gdGhlIHZhbHVlLCBpdCB3aWxsIGVuYWJsZSBvciBkaXNhYmxlIHRoZSBhcHByb3ByaWF0ZSBET00gZWxlbWVudC5cbiAgICovXG4gIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgaWYgKHRoaXMualF1ZXJ5RWxlbWVudCkge1xuICAgICAgICAvLyByZW1vdmUgdGhlIGV2ZW50IGxpc3RlbmVycyBvbiB0aGlzIGVsZW1lbnQuXG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vZmYoKTtcbiAgICAgICAgdGhpcy5qUXVlcnlFbGVtZW50ID0gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgICAvLyBEZXN0cm95IGFueSB3aWRnZXQgcmVzb3VyY2VzLlxuICAgICAgaWYgKHRoaXMuZWRpdG9yKSB7XG4gICAgICAgIHRoaXMuZWRpdG9yLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5lZGl0b3IgPSBudWxsO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE1hcmtzIHRoZSBjb21wb25lbnRzIGFzIHJlcXVpcmluZyBhIHJlYnVpbGQgYWZ0ZXIgdGhlIG5leHQgdXBkYXRlLlxuICAgKi9cbiAgbWFya0ZvclJlZnJlc2goKSB7XG4gICAgLy8gUnVuIHVwZGF0ZWQgb24gdGhlIG5leHQgdXBkYXRlZCBjaGVjay5cbiAgICB0aGlzLnJ1blVwZGF0ZWRPbkNoZWNrID0gdHJ1ZTtcblxuICAgIC8vIC4uLiBtYWtlIHN1cmUgdGhlIGNoYW5nZSBkZXRlY3RvciBraWNrcyBpbiwgb3RoZXJ3aXNlIGlmIHRoZSBpbnB1dHNcbiAgICAvLyB3ZXJlIGNoYW5nZSBwcm9ncmFtbWF0aWFsbHkgdGhlIGNvbXBvbmVudCBtYXkgbm90IGJlIGVsaWdpYmxlIGZvclxuICAgIC8vIHVwZGF0aW5nLlxuICAgIHRoaXMucmVmLm1hcmtGb3JDaGVjaygpO1xuICB9XG59XG4iXX0=