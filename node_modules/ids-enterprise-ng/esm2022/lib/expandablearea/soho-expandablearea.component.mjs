// tslint:disable-next-line:no-unused-variable
import { ChangeDetectionStrategy, Component, ContentChild, ContentChildren, EventEmitter, forwardRef, HostBinding, Input, Output, } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
/**
 * Helper Component for the ExpandableAreaComponent
 */
export class ExpandableHeaderComponent {
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: ExpandableHeaderComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: ExpandableHeaderComponent, selector: "soho-expandable-header", ngImport: i0, template: `
    <span class="title">
      <ng-content></ng-content>
    </span>
  `, isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: ExpandableHeaderComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'soho-expandable-header',
                    template: `
    <span class="title">
      <ng-content></ng-content>
    </span>
  `,
                    changeDetection: ChangeDetectionStrategy.OnPush
                }]
        }] });
/**
 * Helper Component for the ExpandableAreaComponent
 */
export class ExpandablePaneComponent {
    constructor() {
        this.fixed = false;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: ExpandablePaneComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: ExpandablePaneComponent, selector: "soho-expandable-pane", inputs: { fixed: "fixed" }, host: { properties: { "attr.fixed": "this.fixed" } }, ngImport: i0, template: `
    <ng-content></ng-content>
  `, isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: ExpandablePaneComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'soho-expandable-pane',
                    template: `
    <ng-content></ng-content>
  `,
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], propDecorators: { fixed: [{
                type: HostBinding,
                args: ['attr.fixed']
            }, {
                type: Input
            }] } });
/**
 * Helper Component for the ExpandableAreaComponent
 */
export class ExpandableFooterComponent {
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: ExpandableFooterComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: ExpandableFooterComponent, selector: "soho-expandable-footer", ngImport: i0, template: `
    <ng-content></ng-content>
  `, isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: ExpandableFooterComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'soho-expandable-footer',
                    template: `
    <ng-content></ng-content>
  `,
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }] });
export class ExpandableAreaComponent {
    set disabled(value) {
        this._disabled = value;
        if (this.jQueryElement) {
            if (value) {
                this.disable();
            }
            else {
                this.enable();
            }
        }
    }
    /**
     * Boolean value of the disabled state of the component
     */
    get disabled() {
        return this._disabled;
    }
    set closed(value) {
        this._closed = value;
        if (value && this.jQueryElement) {
            this.close();
        }
    }
    /**
     * Boolean value of the closed state of the component
     */
    get closed() {
        return this._closed;
    }
    constructor(element, changeDetectorRef, ngZone) {
        this.element = element;
        this.changeDetectorRef = changeDetectorRef;
        this.ngZone = ngZone;
        // Get the header DOM element
        this.header = undefined;
        // @ContentChild(forwardRef(() => ExpandablePaneComponent))
        // private _pane: ExpandablePaneComponent = null;
        // Get the pane DOM element
        this.footer = undefined;
        // Add Events for Angular elements to listen to (can only have exposed events)
        this.beforeexpand = new EventEmitter();
        this.beforecollapse = new EventEmitter();
        this.expand = new EventEmitter();
        this.collapse = new EventEmitter();
        this.afterexpand = new EventEmitter();
        this.aftercollapse = new EventEmitter();
        this.hasFixedPane = true;
    }
    ngAfterViewInit() {
        this.ngZone.runOutsideAngular(() => {
            // Assign element to local variable
            this.jQueryElement = jQuery(this.element.nativeElement.children[0]);
            // Attach handler for Open and Close listener
            if (this.toggle) {
                this.toggle.subscribe(value => this.toggleOpen(value));
            }
            // Add listeners to emit events
            this.jQueryElement.on('beforeexpand', (event) => this.onBeforeExpand(event));
            this.jQueryElement.on('beforecollapse', (event) => this.onBeforeCollapse(event));
            this.jQueryElement.on('expand', (event) => this.onExpand(event));
            this.jQueryElement.on('collapse', (event) => this.onCollapse(event));
            this.jQueryElement.on('afterexpand', (event) => this.onAfterExpand(event));
            this.jQueryElement.on('aftercollapse', (event) => this.onAfterCollapse(event));
            // Add listeners to emit events
            // Instantiate the element via jQuery
            this.jQueryElement.expandablearea({
                id: this.id,
                disabled: this.disabled,
                expanded: !this.closed,
            });
            this.expandablearea = this.jQueryElement.data('expandablearea');
            // Check initial values (since constructor doesn't handle it)
            if (this.disabled) {
                this.disable();
            }
            // Be specific so that undefined is not counted
            if (this.closed) {
                this.toggleOpen(false);
            }
            else if (typeof this.closed !== 'undefined') {
                this.toggleOpen(true);
            }
            this.ngZone.run(() => {
                // Ensure we are back in a zone so that the timeout will trigger change detection.
                // This is necessary because hasFixedPane is part of the angular template and
                // hence angular needs to know about it.
                setTimeout(() => {
                    // todo @theo what do you think about this timeout?
                    this.hasFixedPane = this.panes?.filter(pane => pane.fixed).length !== 0;
                    this.changeDetectorRef.markForCheck();
                });
            });
        });
    }
    ngOnDestroy() {
        // call outside the angular zone so change detection isn't triggered by the soho component.
        this.ngZone.runOutsideAngular(() => {
            if (this.jQueryElement) {
                this.jQueryElement.off();
                this.jQueryElement = undefined;
            }
            if (this.expandablearea) {
                this.expandablearea.destroy();
                this.expandablearea = null;
            }
        });
    }
    /**
     * Calls the expandablearea disable function
     */
    disable() {
        // call outside the angular zone so change detection isn't triggered by the soho component.
        this.ngZone.runOutsideAngular(() => this.expandablearea?.disable());
    }
    /**
     * Calls the expandablearea enable function
     */
    enable() {
        // call outside the angular zone so change detection isn't triggered by the soho component.
        this.ngZone.runOutsideAngular(() => this.expandablearea?.enable());
    }
    /**
     * Toggles the state of the expandablearea (open or closed) based on the passed
     * parameter.
     */
    toggleOpen(open) {
        // call outside the angular zone so change detection isn't triggered by the soho component.
        this.ngZone.runOutsideAngular(() => {
            this._closed = !open;
            if (open) {
                this.expandablearea?.open();
            }
            else {
                this.expandablearea?.close();
            }
        });
    }
    close() {
        // call outside the angular zone so change detection isn't triggered by the soho component.
        this.ngZone.runOutsideAngular(() => this.expandablearea?.close());
    }
    open() {
        // call outside the angular zone so change detection isn't triggered by the soho component.
        this.ngZone.runOutsideAngular(() => this.expandablearea?.open());
    }
    /**
     * The class setter for the expandable area div element
     */
    get expandableAreaClasses() {
        return 'expandable-area';
    }
    /**
     * The class setter for the header element
     */
    get headerClasses() {
        return 'expandable-header';
    }
    /**
     * The class setter for the pane element
     */
    get paneClasses() {
        return 'expandable-pane';
    }
    /**
     * The class setter for the pane element
     */
    get footerClasses() {
        return 'expandable-footer';
    }
    /**
     * The class setter for the visible pane element
     */
    get visiblePaneClasses() {
        return 'expandable-visible-pane';
    }
    onBeforeExpand(event) {
        // ensure we are back in the angular zone
        this.ngZone.run(() => this.beforeexpand.emit(event));
    }
    onBeforeCollapse(event) {
        // ensure we are back in the angular zone
        this.ngZone.run(() => this.beforecollapse.emit(event));
    }
    onExpand(event) {
        // ensure we are back in the angular zone
        this.ngZone.run(() => this.expand.emit(event));
    }
    onCollapse(event) {
        // ensure we are back in the angular zone
        this.ngZone.run(() => this.collapse.emit(event));
    }
    onAfterExpand(event) {
        // ensure we are back in the angular zone
        this.ngZone.run(() => this.afterexpand.emit(event));
    }
    onAfterCollapse(event) {
        // ensure we are back in the angular zone
        this.ngZone.run(() => this.aftercollapse.emit(event));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: ExpandableAreaComponent, deps: [{ token: i0.ElementRef }, { token: i0.ChangeDetectorRef }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: ExpandableAreaComponent, selector: "soho-expandable-area", inputs: { id: ["soho-expandable-area", "id"], disabled: "disabled", closed: "closed", toggle: "toggle" }, outputs: { beforeexpand: "beforeexpand", beforecollapse: "beforecollapse", expand: "expand", collapse: "collapse", afterexpand: "afterexpand", aftercollapse: "aftercollapse" }, queries: [{ propertyName: "header", first: true, predicate: i0.forwardRef(function () { return ExpandableHeaderComponent; }), descendants: true, static: true }, { propertyName: "footer", first: true, predicate: i0.forwardRef(function () { return ExpandableFooterComponent; }), descendants: true, static: true }, { propertyName: "panes", predicate: i0.forwardRef(function () { return ExpandablePaneComponent; }) }], ngImport: i0, template: "<div [ngClass]=\"expandableAreaClasses\">\n\n  <div *ngIf=\"header\" [ngClass]=\"headerClasses\">\n    <ng-content select=\"soho-expandable-header\"></ng-content>\n  </div>\n\n  <div *ngIf=\"hasFixedPane\" [ngClass]=\"visiblePaneClasses\">\n    <div class=\"content\">\n      <ng-content select=\"soho-expandable-pane[fixed=true]\"></ng-content>\n    </div>\n  </div>\n\n  <div [ngClass]=\"paneClasses\">\n    <div class=\"content\">\n      <ng-content select=\"soho-expandable-pane\"></ng-content>\n    </div>\n  </div>\n\n  <div *ngIf=\"footer\" [ngClass]=\"footerClasses\">\n    <ng-content select=\"soho-expandable-footer\"></ng-content>\n  </div>\n</div>\n", styles: [""], dependencies: [{ kind: "directive", type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: ExpandableAreaComponent, decorators: [{
            type: Component,
            args: [{ selector: 'soho-expandable-area', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div [ngClass]=\"expandableAreaClasses\">\n\n  <div *ngIf=\"header\" [ngClass]=\"headerClasses\">\n    <ng-content select=\"soho-expandable-header\"></ng-content>\n  </div>\n\n  <div *ngIf=\"hasFixedPane\" [ngClass]=\"visiblePaneClasses\">\n    <div class=\"content\">\n      <ng-content select=\"soho-expandable-pane[fixed=true]\"></ng-content>\n    </div>\n  </div>\n\n  <div [ngClass]=\"paneClasses\">\n    <div class=\"content\">\n      <ng-content select=\"soho-expandable-pane\"></ng-content>\n    </div>\n  </div>\n\n  <div *ngIf=\"footer\" [ngClass]=\"footerClasses\">\n    <ng-content select=\"soho-expandable-footer\"></ng-content>\n  </div>\n</div>\n" }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.ChangeDetectorRef }, { type: i0.NgZone }]; }, propDecorators: { id: [{
                type: Input,
                args: ['soho-expandable-area']
            }], disabled: [{
                type: Input
            }], closed: [{
                type: Input
            }], toggle: [{
                type: Input
            }], header: [{
                type: ContentChild,
                args: [forwardRef(() => ExpandableHeaderComponent), { static: true }]
            }], panes: [{
                type: ContentChildren,
                args: [forwardRef(() => ExpandablePaneComponent)]
            }], footer: [{
                type: ContentChild,
                args: [forwardRef(() => ExpandableFooterComponent), { static: true }]
            }], beforeexpand: [{
                type: Output
            }], beforecollapse: [{
                type: Output
            }], expand: [{
                type: Output
            }], collapse: [{
                type: Output
            }], afterexpand: [{
                type: Output
            }], aftercollapse: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1leHBhbmRhYmxlYXJlYS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9pZHMtZW50ZXJwcmlzZS1uZy9zcmMvbGliL2V4cGFuZGFibGVhcmVhL3NvaG8tZXhwYW5kYWJsZWFyZWEuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvaWRzLWVudGVycHJpc2Utbmcvc3JjL2xpYi9leHBhbmRhYmxlYXJlYS9zb2hvLWV4cGFuZGFibGVhcmVhLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDhDQUE4QztBQUM5QyxPQUFPLEVBRUwsdUJBQXVCLEVBRXZCLFNBQVMsRUFDVCxZQUFZLEVBQ1osZUFBZSxFQUVmLFlBQVksRUFDWixVQUFVLEVBQ1YsV0FBVyxFQUNYLEtBQUssRUFFTCxNQUFNLEdBRVAsTUFBTSxlQUFlLENBQUM7OztBQUt2Qjs7R0FFRztBQVVILE1BQU0sT0FBTyx5QkFBeUI7OEdBQXpCLHlCQUF5QjtrR0FBekIseUJBQXlCLDhEQVAxQjs7OztHQUlUOzsyRkFHVSx5QkFBeUI7a0JBVHJDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLHdCQUF3QjtvQkFDbEMsUUFBUSxFQUFFOzs7O0dBSVQ7b0JBQ0QsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07aUJBQ2hEOztBQUdEOztHQUVHO0FBUUgsTUFBTSxPQUFPLHVCQUF1QjtJQVBwQztRQVNXLFVBQUssR0FBRyxLQUFLLENBQUM7S0FDeEI7OEdBSFksdUJBQXVCO2tHQUF2Qix1QkFBdUIsOElBTHhCOztHQUVUOzsyRkFHVSx1QkFBdUI7a0JBUG5DLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLHNCQUFzQjtvQkFDaEMsUUFBUSxFQUFFOztHQUVUO29CQUNELGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO2lCQUNoRDs4QkFHVSxLQUFLO3NCQURiLFdBQVc7dUJBQUMs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Q0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ3hELENBQUM7OEdBeFBVLHVCQUF1QjtrR0FBdkIsdUJBQXVCLDhaQXNDSCx5QkFBeUIsOEhBYXpCLHlCQUF5QixnSEFQdEIsdUJBQXVCLGlDQ2hIM0QsdXBCQXNCQTs7MkZEOENhLHVCQUF1QjtrQkFObkMsU0FBUzsrQkFDRSxzQkFBc0IsbUJBR2YsdUJBQXVCLENBQUMsTUFBTTtzSkFHaEIsRUFBRTtzQkFBaEMsS0FBSzt1QkFBQyxzQkFBc0I7Z0JBQ2hCLFFBQVE7c0JBQXBCLEtBQUs7Z0JBa0JPLE1BQU07c0JBQWxCLEtBQUs7Z0JBZUcsTUFBTTtzQkFBZCxLQUFLO2dCQU1DLE1BQU07c0JBSFosWUFBWTt1QkFBQyxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMseUJBQXlCLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0JBT3BFLEtBQUs7c0JBRFgsZUFBZTt1QkFBQyxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsdUJBQXVCLENBQUM7Z0JBVW5ELE1BQU07c0JBSFosWUFBWTt1QkFBQyxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMseUJBQXlCLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0JBTWpFLFlBQVk7c0JBQXJCLE1BQU07Z0JBQ0csY0FBYztzQkFBdkIsTUFBTTtnQkFDRyxNQUFNO3NCQUFmLE1BQU07Z0JBQ0csUUFBUTtzQkFBakIsTUFBTTtnQkFDRyxXQUFXO3NCQUFwQixNQUFNO2dCQUNHLGFBQWE7c0JBQXRCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tdW51c2VkLXZhcmlhYmxlXG5pbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkLFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgZm9yd2FyZFJlZixcbiAgSG9zdEJpbmRpbmcsXG4gIElucHV0LCBOZ1pvbmUsXG4gIE9uRGVzdHJveSxcbiAgT3V0cHV0LFxuICBRdWVyeUxpc3QsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tdW51c2VkLXZhcmlhYmxlXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5cbi8qKlxuICogSGVscGVyIENvbXBvbmVudCBmb3IgdGhlIEV4cGFuZGFibGVBcmVhQ29tcG9uZW50XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3NvaG8tZXhwYW5kYWJsZS1oZWFkZXInLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxzcGFuIGNsYXNzPVwidGl0bGVcIj5cbiAgICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cbiAgICA8L3NwYW4+XG4gIGAsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIEV4cGFuZGFibGVIZWFkZXJDb21wb25lbnQgeyB9XG5cbi8qKlxuICogSGVscGVyIENvbXBvbmVudCBmb3IgdGhlIEV4cGFuZGFibGVBcmVhQ29tcG9uZW50XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3NvaG8tZXhwYW5kYWJsZS1wYW5lJyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gIGAsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBFeHBhbmRhYmxlUGFuZUNvbXBvbmVudCB7XG4gIEBIb3N0QmluZGluZygnYXR0ci5maXhlZCcpXG4gIEBJbnB1dCgpIGZpeGVkID0gZmFsc2U7XG59XG5cbi8qKlxuICogSGVscGVyIENvbXBvbmVudCBmb3IgdGhlIEV4cGFuZGFibGVBcmVhQ29tcG9uZW50XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3NvaG8tZXhwYW5kYWJsZS1mb290ZXInLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cbiAgYCxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIEV4cGFuZGFibGVGb290ZXJDb21wb25lbnQgeyB9XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3NvaG8tZXhwYW5kYWJsZS1hcmVhJyxcbiAgdGVtcGxhdGVVcmw6ICdzb2hvLWV4cGFuZGFibGVhcmVhLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVzOiBbYGBdLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgRXhwYW5kYWJsZUFyZWFDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICBASW5wdXQoJ3NvaG8tZXhwYW5kYWJsZS1hcmVhJykgaWQ6IHN0cmluZyB8IHVuZGVmaW5lZDsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICBASW5wdXQoKSBzZXQgZGlzYWJsZWQodmFsdWU6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLl9kaXNhYmxlZCA9IHZhbHVlO1xuICAgIGlmICh0aGlzLmpRdWVyeUVsZW1lbnQpIHtcbiAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICB0aGlzLmRpc2FibGUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZW5hYmxlKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEJvb2xlYW4gdmFsdWUgb2YgdGhlIGRpc2FibGVkIHN0YXRlIG9mIHRoZSBjb21wb25lbnRcbiAgICovXG4gIGdldCBkaXNhYmxlZCgpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5fZGlzYWJsZWQ7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgY2xvc2VkKHZhbHVlOiBib29sZWFuIHwgdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5fY2xvc2VkID0gdmFsdWU7XG4gICAgaWYgKHZhbHVlICYmIHRoaXMualF1ZXJ5RWxlbWVudCkge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBCb29sZWFuIHZhbHVlIG9mIHRoZSBjbG9zZWQgc3RhdGUgb2YgdGhlIGNvbXBvbmVudFxuICAgKi9cbiAgZ2V0IGNsb3NlZCgpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5fY2xvc2VkO1xuICB9XG5cbiAgLy8gRXhwb3NlIE1ldGhvZHMgaW4gY2FzZSBBbmd1bGFyIG5lZWRzIHRvIGNvbnRyb2wgdGhlIERPTSwgdXNpbmcgT2JzZXJ2YWJsZXNcbiAgQElucHV0KCkgdG9nZ2xlPzogT2JzZXJ2YWJsZTxib29sZWFuPjtcblxuICAvLyBHZXQgdGhlIGhlYWRlciBET00gZWxlbWVudFxuICBAQ29udGVudENoaWxkKGZvcndhcmRSZWYoKCkgPT4gRXhwYW5kYWJsZUhlYWRlckNvbXBvbmVudCksIHsgc3RhdGljOiB0cnVlIH0pIC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIHB1YmxpYyBoZWFkZXI6IEV4cGFuZGFibGVIZWFkZXJDb21wb25lbnQgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG5cbiAgLy8gR2V0IHRoZSBwYW5lIERPTSBlbGVtZW50c1xuICBAQ29udGVudENoaWxkcmVuKGZvcndhcmRSZWYoKCkgPT4gRXhwYW5kYWJsZVBhbmVDb21wb25lbnQpKSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIHB1YmxpYyBwYW5lczogUXVlcnlMaXN0PEV4cGFuZGFibGVQYW5lQ29tcG9uZW50PiB8IHVuZGVmaW5lZDtcblxuICAvLyBAQ29udGVudENoaWxkKGZvcndhcmRSZWYoKCkgPT4gRXhwYW5kYWJsZVBhbmVDb21wb25lbnQpKVxuICAvLyBwcml2YXRlIF9wYW5lOiBFeHBhbmRhYmxlUGFuZUNvbXBvbmVudCA9IG51bGw7XG5cbiAgLy8gR2V0IHRoZSBwYW5lIERPTSBlbGVtZW50XG4gIEBDb250ZW50Q2hpbGQoZm9yd2FyZFJlZigoKSA9PiBFeHBhbmRhYmxlRm9vdGVyQ29tcG9uZW50KSwgeyBzdGF0aWM6IHRydWUgfSkgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgcHVibGljIGZvb3Rlcj86IEV4cGFuZGFibGVQYW5lQ29tcG9uZW50ID0gdW5kZWZpbmVkO1xuXG4gIC8vIEFkZCBFdmVudHMgZm9yIEFuZ3VsYXIgZWxlbWVudHMgdG8gbGlzdGVuIHRvIChjYW4gb25seSBoYXZlIGV4cG9zZWQgZXZlbnRzKVxuICBAT3V0cHV0KCkgYmVmb3JlZXhwYW5kOiBFdmVudEVtaXR0ZXI8T2JqZWN0PiA9IG5ldyBFdmVudEVtaXR0ZXI8T2JqZWN0PigpO1xuICBAT3V0cHV0KCkgYmVmb3JlY29sbGFwc2U6IEV2ZW50RW1pdHRlcjxPYmplY3Q+ID0gbmV3IEV2ZW50RW1pdHRlcjxPYmplY3Q+KCk7XG4gIEBPdXRwdXQoKSBleHBhbmQ6IEV2ZW50RW1pdHRlcjxPYmplY3Q+ID0gbmV3IEV2ZW50RW1pdHRlcjxPYmplY3Q+KCk7XG4gIEBPdXRwdXQoKSBjb2xsYXBzZTogRXZlbnRFbWl0dGVyPE9iamVjdD4gPSBuZXcgRXZlbnRFbWl0dGVyPE9iamVjdD4oKTtcbiAgQE91dHB1dCgpIGFmdGVyZXhwYW5kOiBFdmVudEVtaXR0ZXI8T2JqZWN0PiA9IG5ldyBFdmVudEVtaXR0ZXI8T2JqZWN0PigpO1xuICBAT3V0cHV0KCkgYWZ0ZXJjb2xsYXBzZTogRXZlbnRFbWl0dGVyPE9iamVjdD4gPSBuZXcgRXZlbnRFbWl0dGVyPE9iamVjdD4oKTtcblxuICAvLyBWYXJpb3VzIGxvY2FsIHZhcmlhYmxlcyB1c2VkIGZvciBsb2dpY1xuICBwcml2YXRlIGpRdWVyeUVsZW1lbnQ/OiBKUXVlcnk7XG4gIHByaXZhdGUgZXhwYW5kYWJsZWFyZWE/OiBTb2hvRXhwYW5kYWJsZUFyZWFTdGF0aWMgfCBudWxsO1xuICBwcml2YXRlIF9kaXNhYmxlZD86IGJvb2xlYW47XG4gIHByaXZhdGUgX2Nsb3NlZD86IGJvb2xlYW47XG4gIHB1YmxpYyBoYXNGaXhlZFBhbmUgPSB0cnVlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZWxlbWVudDogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxuICApIHtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAvLyBBc3NpZ24gZWxlbWVudCB0byBsb2NhbCB2YXJpYWJsZVxuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50ID0galF1ZXJ5KHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdKTtcblxuICAgICAgLy8gQXR0YWNoIGhhbmRsZXIgZm9yIE9wZW4gYW5kIENsb3NlIGxpc3RlbmVyXG4gICAgICBpZiAodGhpcy50b2dnbGUpIHtcbiAgICAgICAgdGhpcy50b2dnbGUuc3Vic2NyaWJlKHZhbHVlID0+IHRoaXMudG9nZ2xlT3Blbih2YWx1ZSkpO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGQgbGlzdGVuZXJzIHRvIGVtaXQgZXZlbnRzXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub24oJ2JlZm9yZWV4cGFuZCcsIChldmVudDogU29ob0V4cGFuZGFibGVBcmVhRXZlbnQpID0+IHRoaXMub25CZWZvcmVFeHBhbmQoZXZlbnQpKTtcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vbignYmVmb3JlY29sbGFwc2UnLCAoZXZlbnQ6IFNvaG9FeHBhbmRhYmxlQXJlYUV2ZW50KSA9PiB0aGlzLm9uQmVmb3JlQ29sbGFwc2UoZXZlbnQpKTtcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vbignZXhwYW5kJywgKGV2ZW50OiBTb2hvRXhwYW5kYWJsZUFyZWFFdmVudCkgPT4gdGhpcy5vbkV4cGFuZChldmVudCkpO1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50Lm9uKCdjb2xsYXBzZScsIChldmVudDogU29ob0V4cGFuZGFibGVBcmVhRXZlbnQpID0+IHRoaXMub25Db2xsYXBzZShldmVudCkpO1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50Lm9uKCdhZnRlcmV4cGFuZCcsIChldmVudDogU29ob0V4cGFuZGFibGVBcmVhRXZlbnQpID0+IHRoaXMub25BZnRlckV4cGFuZChldmVudCkpO1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50Lm9uKCdhZnRlcmNvbGxhcHNlJywgKGV2ZW50OiBTb2hvRXhwYW5kYWJsZUFyZWFFdmVudCkgPT4gdGhpcy5vbkFmdGVyQ29sbGFwc2UoZXZlbnQpKTtcblxuICAgICAgLy8gQWRkIGxpc3RlbmVycyB0byBlbWl0IGV2ZW50c1xuICAgICAgLy8gSW5zdGFudGlhdGUgdGhlIGVsZW1lbnQgdmlhIGpRdWVyeVxuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50LmV4cGFuZGFibGVhcmVhKHtcbiAgICAgICAgaWQ6IHRoaXMuaWQsXG4gICAgICAgIGRpc2FibGVkOiB0aGlzLmRpc2FibGVkLFxuICAgICAgICBleHBhbmRlZDogIXRoaXMuY2xvc2VkLFxuICAgICAgfSk7XG4gICAgICB0aGlzLmV4cGFuZGFibGVhcmVhID0gdGhpcy5qUXVlcnlFbGVtZW50LmRhdGEoJ2V4cGFuZGFibGVhcmVhJyk7XG5cbiAgICAgIC8vIENoZWNrIGluaXRpYWwgdmFsdWVzIChzaW5jZSBjb25zdHJ1Y3RvciBkb2Vzbid0IGhhbmRsZSBpdClcbiAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XG4gICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgfVxuICAgICAgLy8gQmUgc3BlY2lmaWMgc28gdGhhdCB1bmRlZmluZWQgaXMgbm90IGNvdW50ZWRcbiAgICAgIGlmICh0aGlzLmNsb3NlZCkge1xuICAgICAgICB0aGlzLnRvZ2dsZU9wZW4oZmFsc2UpO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGhpcy5jbG9zZWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHRoaXMudG9nZ2xlT3Blbih0cnVlKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgICAgLy8gRW5zdXJlIHdlIGFyZSBiYWNrIGluIGEgem9uZSBzbyB0aGF0IHRoZSB0aW1lb3V0IHdpbGwgdHJpZ2dlciBjaGFuZ2UgZGV0ZWN0aW9uLlxuICAgICAgICAvLyBUaGlzIGlzIG5lY2Vzc2FyeSBiZWNhdXNlIGhhc0ZpeGVkUGFuZSBpcyBwYXJ0IG9mIHRoZSBhbmd1bGFyIHRlbXBsYXRlIGFuZFxuICAgICAgICAvLyBoZW5jZSBhbmd1bGFyIG5lZWRzIHRvIGtub3cgYWJvdXQgaXQuXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIC8vIHRvZG8gQHRoZW8gd2hhdCBkbyB5b3UgdGhpbmsgYWJvdXQgdGhpcyB0aW1lb3V0P1xuICAgICAgICAgIHRoaXMuaGFzRml4ZWRQYW5lID0gdGhpcy5wYW5lcz8uZmlsdGVyKHBhbmUgPT4gcGFuZS5maXhlZCkubGVuZ3RoICE9PSAwO1xuICAgICAgICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICAvLyBjYWxsIG91dHNpZGUgdGhlIGFuZ3VsYXIgem9uZSBzbyBjaGFuZ2UgZGV0ZWN0aW9uIGlzbid0IHRyaWdnZXJlZCBieSB0aGUgc29obyBjb21wb25lbnQuXG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgaWYgKHRoaXMualF1ZXJ5RWxlbWVudCkge1xuICAgICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub2ZmKCk7XG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmV4cGFuZGFibGVhcmVhKSB7XG4gICAgICAgIHRoaXMuZXhwYW5kYWJsZWFyZWEuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLmV4cGFuZGFibGVhcmVhID0gbnVsbDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxscyB0aGUgZXhwYW5kYWJsZWFyZWEgZGlzYWJsZSBmdW5jdGlvblxuICAgKi9cbiAgZGlzYWJsZSgpIHtcbiAgICAvLyBjYWxsIG91dHNpZGUgdGhlIGFuZ3VsYXIgem9uZSBzbyBjaGFuZ2UgZGV0ZWN0aW9uIGlzbid0IHRyaWdnZXJlZCBieSB0aGUgc29obyBjb21wb25lbnQuXG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4gdGhpcy5leHBhbmRhYmxlYXJlYT8uZGlzYWJsZSgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxscyB0aGUgZXhwYW5kYWJsZWFyZWEgZW5hYmxlIGZ1bmN0aW9uXG4gICAqL1xuICBlbmFibGUoKSB7XG4gICAgLy8gY2FsbCBvdXRzaWRlIHRoZSBhbmd1bGFyIHpvbmUgc28gY2hhbmdlIGRldGVjdGlvbiBpc24ndCB0cmlnZ2VyZWQgYnkgdGhlIHNvaG8gY29tcG9uZW50LlxuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuZXhwYW5kYWJsZWFyZWE/LmVuYWJsZSgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUb2dnbGVzIHRoZSBzdGF0ZSBvZiB0aGUgZXhwYW5kYWJsZWFyZWEgKG9wZW4gb3IgY2xvc2VkKSBiYXNlZCBvbiB0aGUgcGFzc2VkXG4gICAqIHBhcmFtZXRlci5cbiAgICovXG4gIHRvZ2dsZU9wZW4ob3BlbjogYm9vbGVhbikge1xuICAgIC8vIGNhbGwgb3V0c2lkZSB0aGUgYW5ndWxhciB6b25lIHNvIGNoYW5nZSBkZXRlY3Rpb24gaXNuJ3QgdHJpZ2dlcmVkIGJ5IHRoZSBzb2hvIGNvbXBvbmVudC5cbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICB0aGlzLl9jbG9zZWQgPSAhb3BlbjtcbiAgICAgIGlmIChvcGVuKSB7XG4gICAgICAgIHRoaXMuZXhwYW5kYWJsZWFyZWE/Lm9wZW4oKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZXhwYW5kYWJsZWFyZWE/LmNsb3NlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBjbG9zZSgpIHtcbiAgICAvLyBjYWxsIG91dHNpZGUgdGhlIGFuZ3VsYXIgem9uZSBzbyBjaGFuZ2UgZGV0ZWN0aW9uIGlzbid0IHRyaWdnZXJlZCBieSB0aGUgc29obyBjb21wb25lbnQuXG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4gdGhpcy5leHBhbmRhYmxlYXJlYT8uY2xvc2UoKSk7XG4gIH1cblxuICBvcGVuKCkge1xuICAgIC8vIGNhbGwgb3V0c2lkZSB0aGUgYW5ndWxhciB6b25lIHNvIGNoYW5nZSBkZXRlY3Rpb24gaXNuJ3QgdHJpZ2dlcmVkIGJ5IHRoZSBzb2hvIGNvbXBvbmVudC5cbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLmV4cGFuZGFibGVhcmVhPy5vcGVuKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBjbGFzcyBzZXR0ZXIgZm9yIHRoZSBleHBhbmRhYmxlIGFyZWEgZGl2IGVsZW1lbnRcbiAgICovXG4gIGdldCBleHBhbmRhYmxlQXJlYUNsYXNzZXMoKSB7XG4gICAgcmV0dXJuICdleHBhbmRhYmxlLWFyZWEnO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBjbGFzcyBzZXR0ZXIgZm9yIHRoZSBoZWFkZXIgZWxlbWVudFxuICAgKi9cbiAgZ2V0IGhlYWRlckNsYXNzZXMoKSB7XG4gICAgcmV0dXJuICdleHBhbmRhYmxlLWhlYWRlcic7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGNsYXNzIHNldHRlciBmb3IgdGhlIHBhbmUgZWxlbWVudFxuICAgKi9cbiAgZ2V0IHBhbmVDbGFzc2VzKCkge1xuICAgIHJldHVybiAnZXhwYW5kYWJsZS1wYW5lJztcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgY2xhc3Mgc2V0dGVyIGZvciB0aGUgcGFuZSBlbGVtZW50XG4gICAqL1xuICBnZXQgZm9vdGVyQ2xhc3NlcygpIHtcbiAgICByZXR1cm4gJ2V4cGFuZGFibGUtZm9vdGVyJztcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgY2xhc3Mgc2V0dGVyIGZvciB0aGUgdmlzaWJsZSBwYW5lIGVsZW1lbnRcbiAgICovXG4gIGdldCB2aXNpYmxlUGFuZUNsYXNzZXMoKSB7XG4gICAgcmV0dXJuICdleHBhbmRhYmxlLXZpc2libGUtcGFuZSc7XG4gIH1cblxuICBwcml2YXRlIG9uQmVmb3JlRXhwYW5kKGV2ZW50OiBTb2hvRXhwYW5kYWJsZUFyZWFFdmVudCkge1xuICAgIC8vIGVuc3VyZSB3ZSBhcmUgYmFjayBpbiB0aGUgYW5ndWxhciB6b25lXG4gICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHRoaXMuYmVmb3JlZXhwYW5kLmVtaXQoZXZlbnQpKTtcbiAgfVxuXG4gIHByaXZhdGUgb25CZWZvcmVDb2xsYXBzZShldmVudDogU29ob0V4cGFuZGFibGVBcmVhRXZlbnQpIHtcbiAgICAvLyBlbnN1cmUgd2UgYXJlIGJhY2sgaW4gdGhlIGFuZ3VsYXIgem9uZVxuICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLmJlZm9yZWNvbGxhcHNlLmVtaXQoZXZlbnQpKTtcbiAgfVxuXG4gIHByaXZhdGUgb25FeHBhbmQoZXZlbnQ6IFNvaG9FeHBhbmRhYmxlQXJlYUV2ZW50KSB7XG4gICAgLy8gZW5zdXJlIHdlIGFyZSBiYWNrIGluIHRoZSBhbmd1bGFyIHpvbmVcbiAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gdGhpcy5leHBhbmQuZW1pdChldmVudCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBvbkNvbGxhcHNlKGV2ZW50OiBTb2hvRXhwYW5kYWJsZUFyZWFFdmVudCkge1xuICAgIC8vIGVuc3VyZSB3ZSBhcmUgYmFjayBpbiB0aGUgYW5ndWxhciB6b25lXG4gICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHRoaXMuY29sbGFwc2UuZW1pdChldmVudCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBvbkFmdGVyRXhwYW5kKGV2ZW50OiBTb2hvRXhwYW5kYWJsZUFyZWFFdmVudCkge1xuICAgIC8vIGVuc3VyZSB3ZSBhcmUgYmFjayBpbiB0aGUgYW5ndWxhciB6b25lXG4gICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHRoaXMuYWZ0ZXJleHBhbmQuZW1pdChldmVudCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBvbkFmdGVyQ29sbGFwc2UoZXZlbnQ6IFNvaG9FeHBhbmRhYmxlQXJlYUV2ZW50KSB7XG4gICAgLy8gZW5zdXJlIHdlIGFyZSBiYWNrIGluIHRoZSBhbmd1bGFyIHpvbmVcbiAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gdGhpcy5hZnRlcmNvbGxhcHNlLmVtaXQoZXZlbnQpKTtcbiAgfVxufVxuIiwiPGRpdiBbbmdDbGFzc109XCJleHBhbmRhYmxlQXJlYUNsYXNzZXNcIj5cblxuICA8ZGl2ICpuZ0lmPVwiaGVhZGVyXCIgW25nQ2xhc3NdPVwiaGVhZGVyQ2xhc3Nlc1wiPlxuICAgIDxuZy1jb250ZW50IHNlbGVjdD1cInNvaG8tZXhwYW5kYWJsZS1oZWFkZXJcIj48L25nLWNvbnRlbnQ+XG4gIDwvZGl2PlxuXG4gIDxkaXYgKm5nSWY9XCJoYXNGaXhlZFBhbmVcIiBbbmdDbGFzc109XCJ2aXNpYmxlUGFuZUNsYXNzZXNcIj5cbiAgICA8ZGl2IGNsYXNzPVwiY29udGVudFwiPlxuICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwic29oby1leHBhbmRhYmxlLXBhbmVbZml4ZWQ9dHJ1ZV1cIj48L25nLWNvbnRlbnQ+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuXG4gIDxkaXYgW25nQ2xhc3NdPVwicGFuZUNsYXNzZXNcIj5cbiAgICA8ZGl2IGNsYXNzPVwiY29udGVudFwiPlxuICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwic29oby1leHBhbmRhYmxlLXBhbmVcIj48L25nLWNvbnRlbnQ+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuXG4gIDxkaXYgKm5nSWY9XCJmb290ZXJcIiBbbmdDbGFzc109XCJmb290ZXJDbGFzc2VzXCI+XG4gICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwic29oby1leHBhbmRhYmxlLWZvb3RlclwiPjwvbmctY29udGVudD5cbiAgPC9kaXY+XG48L2Rpdj5cbiJdfQ==