import { Attribute, Directive, EventEmitter, HostBinding, Input, Output } from '@angular/core';
import * as i0 from "@angular/core";
/**
 * Angular Wrapper for the SoHo Input Validate Directive.
 *
 * This component searches for an element with the attribute
 * 'data-validate' or 'data-validate-on="submit"'.
 */
export class SohoInputValidateDirective {
    constructor(el, dataValidateAttr, // eslint-disable-line
    ngZone) {
        this.el = el;
        this.ngZone = ngZone;
        /**
         * @todo replace override of native attribute
         */
        // eslint-disable-next-line @angular-eslint/no-output-native, @angular-eslint/no-output-rename
        this.error = new EventEmitter();
        this.alert = new EventEmitter();
        /**
         * @todo replace override of native attribute
         */
        // eslint-disable-next-line @angular-eslint/no-output-native, @angular-eslint/no-output-rename
        this.success = new EventEmitter();
        this.icon = new EventEmitter();
        this.info = new EventEmitter();
        this.valid = new EventEmitter();
        this.dataValidate = dataValidateAttr;
    }
    /**
     * After the control has been initialised and the view is ready,
     * get the SoHoXi controls to activate any validations.
     */
    ngAfterViewInit() {
        this.ngZone.runOutsideAngular(() => {
            this.jQueryElement = jQuery(this.el.nativeElement);
            this.jQueryElement.validate();
            // Initialise any event handlers.
            this.jQueryElement.on('error', (event, validation) => this.ngZone.run(() => {
                event.validation = { field: validation.field[0], message: validation.message };
                this.error.emit(event);
            }));
            this.jQueryElement.on('alert', (event, validation) => this.ngZone.run(() => {
                event.validation = { field: validation.field[0], message: validation.message };
                this.alert.emit(event);
            }));
            this.jQueryElement.on('success', (event, validation) => this.ngZone.run(() => {
                event.validation = { field: validation.field[0], message: validation.message };
                this.success.emit(event);
            }));
            this.jQueryElement.on('icon', (event, validation) => this.ngZone.run(() => {
                event.validation = { field: validation.field[0], message: validation.message };
                this.icon.emit(event);
            }));
            this.jQueryElement.on('info', (event, validation) => this.ngZone.run(() => {
                event.validation = { field: validation.field[0], message: validation.message };
                this.info.emit(event);
            }));
            this.jQueryElement.on('valid', (event, validation) => this.ngZone.run(() => {
                event.validation = { field: validation.field[0], message: validation.message };
                this.valid.emit(event);
            }));
            this.validator = this.jQueryElement.data('validate');
        });
    }
    ngOnDestroy() {
        // Necessary clean up step (add additional here)
        this.ngZone.runOutsideAngular(() => {
            if (this.jQueryElement) {
                // clean up attached events.
                this.jQueryElement.off();
                this.jQueryElement = undefined;
            }
            this.validator.destroy();
            this.validator = undefined;
            this.el.nativeElement = undefined;
        });
    }
    /**
     * Remove the message from the field if there is one and mark the field valid
     */
    removeMessage(type) {
        this.ngZone.runOutsideAngular(() => {
            this.validator?.removeMessage(this.jQueryElement, type);
        });
    }
    /**
     * Trigger validation of the field
     */
    validate(event) {
        this.ngZone.runOutsideAngular(() => {
            this.validator?.validate(this.jQueryElement, false, event);
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoInputValidateDirective, deps: [{ token: i0.ElementRef }, { token: 'data-validate', attribute: true }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.1.4", type: SohoInputValidateDirective, selector: "form[soho-input-validate], input[soho-input-validate], input[data-validate], input[data-validate-on=\"submit\"], textarea[data-validate], select[data-validate]", inputs: { dataValidate: ["data-validate", "dataValidate"] }, outputs: { error: "error", alert: "alert", success: "success", icon: "icon", info: "info", valid: "valid" }, host: { properties: { "attr.data-validate": "this.dataValidate" } }, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoInputValidateDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'form[soho-input-validate], input[soho-input-validate], input[data-validate], input[data-validate-on="submit"], textarea[data-validate], select[data-validate]' // eslint-disable-line
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: undefined, decorators: [{
                    type: Attribute,
                    args: ['data-validate']
                }] }, { type: i0.NgZone }]; }, propDecorators: { dataValidate: [{
                type: HostBinding,
                args: ['attr.data-validate']
            }, {
                type: Input,
                args: ['data-validate']
            }], error: [{
                type: Output
            }], alert: [{
                type: Output
            }], success: [{
                type: Output
            }], icon: [{
                type: Output
            }], info: [{
                type: Output
            }], valid: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1pbnB1dC12YWxpZGF0ZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9pZHMtZW50ZXJwcmlzZS1uZy9zcmMvbGliL2lucHV0LXZhbGlkYXRlL3NvaG8taW5wdXQtdmFsaWRhdGUuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDVSxTQUFTLEVBQUUsU0FBUyxFQUNuQyxZQUFZLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQ2pELE1BQU0sZUFBZSxDQUFDOztBQUV2Qjs7Ozs7R0FLRztBQUlILE1BQU0sT0FBTywwQkFBMEI7SUEyQnJDLFlBQ1UsRUFBYyxFQUNNLGdCQUFxQixFQUFFLHNCQUFzQjtJQUNqRSxNQUFjO1FBRmQsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUVkLFdBQU0sR0FBTixNQUFNLENBQVE7UUFuQnhCOztXQUVHO1FBQ0gsOEZBQThGO1FBQ3BGLFVBQUssR0FBRyxJQUFJLFlBQVksRUFBMEIsQ0FBQztRQUNuRCxVQUFLLEdBQUcsSUFBSSxZQUFZLEVBQTBCLENBQUM7UUFFN0Q7O1dBRUc7UUFDSCw4RkFBOEY7UUFDcEYsWUFBTyxHQUFHLElBQUksWUFBWSxFQUEwQixDQUFDO1FBQ3JELFNBQUksR0FBRyxJQUFJLFlBQVksRUFBMEIsQ0FBQztRQUNsRCxTQUFJLEdBQUcsSUFBSSxZQUFZLEVBQTBCLENBQUM7UUFDbEQsVUFBSyxHQUFHLElBQUksWUFBWSxFQUEwQixDQUFDO1FBTzNELElBQUksQ0FBQyxZQUFZLEdBQUcsZ0JBQWdCLENBQUM7SUFDdkMsQ0FBQztJQUVEOzs7T0FHRztJQUNILGVBQWU7UUFDYixJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRTtZQUNqQyxJQUFJLENBQUMsYUFBYSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lB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QUFLLENBQUMsQ0FBQztRQUM3RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7OEdBOUdVLDBCQUEwQiw0Q0E2QnhCLGVBQWU7a0dBN0JqQiwwQkFBMEI7OzJGQUExQiwwQkFBMEI7a0JBSHRDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLCtKQUErSixDQUFDLHNCQUFzQjtpQkFDak07OzBCQThCSSxTQUFTOzJCQUFDLGVBQWU7aUVBcEIrQixZQUFZO3NCQUF0RSxXQUFXO3VCQUFDLG9CQUFvQjs7c0JBQUcsS0FBSzt1QkFBQyxlQUFlO2dCQU0vQyxLQUFLO3NCQUFkLE1BQU07Z0JBQ0csS0FBSztzQkFBZCxNQUFNO2dCQU1HLE9BQU87c0JBQWhCLE1BQU07Z0JBQ0csSUFBSTtzQkFBYixNQUFNO2dCQUNHLElBQUk7c0JBQWIsTUFBTTtnQkFDRyxLQUFLO3NCQUFkLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdJbml0LCBBdHRyaWJ1dGUsIERpcmVjdGl2ZSwgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLCBIb3N0QmluZGluZywgSW5wdXQsIE5nWm9uZSwgT3V0cHV0LCBPbkRlc3Ryb3lcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbi8qKlxuICogQW5ndWxhciBXcmFwcGVyIGZvciB0aGUgU29IbyBJbnB1dCBWYWxpZGF0ZSBEaXJlY3RpdmUuXG4gKlxuICogVGhpcyBjb21wb25lbnQgc2VhcmNoZXMgZm9yIGFuIGVsZW1lbnQgd2l0aCB0aGUgYXR0cmlidXRlXG4gKiAnZGF0YS12YWxpZGF0ZScgb3IgJ2RhdGEtdmFsaWRhdGUtb249XCJzdWJtaXRcIicuXG4gKi9cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ2Zvcm1bc29oby1pbnB1dC12YWxpZGF0ZV0sIGlucHV0W3NvaG8taW5wdXQtdmFsaWRhdGVdLCBpbnB1dFtkYXRhLXZhbGlkYXRlXSwgaW5wdXRbZGF0YS12YWxpZGF0ZS1vbj1cInN1Ym1pdFwiXSwgdGV4dGFyZWFbZGF0YS12YWxpZGF0ZV0sIHNlbGVjdFtkYXRhLXZhbGlkYXRlXScgLy8gZXNsaW50LWRpc2FibGUtbGluZVxufSlcbmV4cG9ydCBjbGFzcyBTb2hvSW5wdXRWYWxpZGF0ZURpcmVjdGl2ZSBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG5cbiAgLyoqXG4gICAqIExvY2FsIHZhcmlhYmxlc1xuICAgKi9cbiAgcHJpdmF0ZSBqUXVlcnlFbGVtZW50PzogSlF1ZXJ5O1xuXG4gIHByaXZhdGUgdmFsaWRhdG9yPzogU29ob0lucHV0VmFsaWRhdGVTdGF0aWM7XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLmRhdGEtdmFsaWRhdGUnKSBASW5wdXQoJ2RhdGEtdmFsaWRhdGUnKSBkYXRhVmFsaWRhdGU6IHN0cmluZzsgICAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG5cbiAgLyoqXG4gICAqIEB0b2RvIHJlcGxhY2Ugb3ZlcnJpZGUgb2YgbmF0aXZlIGF0dHJpYnV0ZVxuICAgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtbmF0aXZlLCBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LXJlbmFtZVxuICBAT3V0cHV0KCkgZXJyb3IgPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9JbnB1dFZhbGlkYXRlRXZlbnQ+KCk7XG4gIEBPdXRwdXQoKSBhbGVydCA9IG5ldyBFdmVudEVtaXR0ZXI8U29ob0lucHV0VmFsaWRhdGVFdmVudD4oKTtcblxuICAvKipcbiAgICogQHRvZG8gcmVwbGFjZSBvdmVycmlkZSBvZiBuYXRpdmUgYXR0cmlidXRlXG4gICAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L25vLW91dHB1dC1uYXRpdmUsIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtcmVuYW1lXG4gIEBPdXRwdXQoKSBzdWNjZXNzID0gbmV3IEV2ZW50RW1pdHRlcjxTb2hvSW5wdXRWYWxpZGF0ZUV2ZW50PigpO1xuICBAT3V0cHV0KCkgaWNvbiA9IG5ldyBFdmVudEVtaXR0ZXI8U29ob0lucHV0VmFsaWRhdGVFdmVudD4oKTtcbiAgQE91dHB1dCgpIGluZm8gPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9JbnB1dFZhbGlkYXRlRXZlbnQ+KCk7XG4gIEBPdXRwdXQoKSB2YWxpZCA9IG5ldyBFdmVudEVtaXR0ZXI8U29ob0lucHV0VmFsaWRhdGVFdmVudD4oKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmLFxuICAgIEBBdHRyaWJ1dGUoJ2RhdGEtdmFsaWRhdGUnKSBkYXRhVmFsaWRhdGVBdHRyOiBhbnksIC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxuICApIHtcbiAgICB0aGlzLmRhdGFWYWxpZGF0ZSA9IGRhdGFWYWxpZGF0ZUF0dHI7XG4gIH1cblxuICAvKipcbiAgICogQWZ0ZXIgdGhlIGNvbnRyb2wgaGFzIGJlZW4gaW5pdGlhbGlzZWQgYW5kIHRoZSB2aWV3IGlzIHJlYWR5LFxuICAgKiBnZXQgdGhlIFNvSG9YaSBjb250cm9scyB0byBhY3RpdmF0ZSBhbnkgdmFsaWRhdGlvbnMuXG4gICAqL1xuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50ID0galF1ZXJ5KHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XG5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC52YWxpZGF0ZSgpO1xuXG4gICAgICAvLyBJbml0aWFsaXNlIGFueSBldmVudCBoYW5kbGVycy5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vbignZXJyb3InLCAoZXZlbnQ6IFNvaG9JbnB1dFZhbGlkYXRlRXZlbnQsIHZhbGlkYXRpb24pID0+IHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICAgIGV2ZW50LnZhbGlkYXRpb24gPSB7IGZpZWxkOiB2YWxpZGF0aW9uLmZpZWxkWzBdLCBtZXNzYWdlOiB2YWxpZGF0aW9uLm1lc3NhZ2UgfTtcbiAgICAgICAgdGhpcy5lcnJvci5lbWl0KGV2ZW50KTtcbiAgICAgIH0pKTtcblxuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50Lm9uKCdhbGVydCcsIChldmVudDogU29ob0lucHV0VmFsaWRhdGVFdmVudCwgdmFsaWRhdGlvbikgPT4gdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgICAgZXZlbnQudmFsaWRhdGlvbiA9IHsgZmllbGQ6IHZhbGlkYXRpb24uZmllbGRbMF0sIG1lc3NhZ2U6IHZhbGlkYXRpb24ubWVzc2FnZSB9O1xuICAgICAgICB0aGlzLmFsZXJ0LmVtaXQoZXZlbnQpO1xuICAgICAgfSkpO1xuXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub24oJ3N1Y2Nlc3MnLCAoZXZlbnQ6IFNvaG9JbnB1dFZhbGlkYXRlRXZlbnQsIHZhbGlkYXRpb24pID0+IHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICAgIGV2ZW50LnZhbGlkYXRpb24gPSB7IGZpZWxkOiB2YWxpZGF0aW9uLmZpZWxkWzBdLCBtZXNzYWdlOiB2YWxpZGF0aW9uLm1lc3NhZ2UgfTtcbiAgICAgICAgdGhpcy5zdWNjZXNzLmVtaXQoZXZlbnQpO1xuICAgICAgfSkpO1xuXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub24oJ2ljb24nLCAoZXZlbnQ6IFNvaG9JbnB1dFZhbGlkYXRlRXZlbnQsIHZhbGlkYXRpb24pID0+IHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICAgIGV2ZW50LnZhbGlkYXRpb24gPSB7IGZpZWxkOiB2YWxpZGF0aW9uLmZpZWxkWzBdLCBtZXNzYWdlOiB2YWxpZGF0aW9uLm1lc3NhZ2UgfTtcbiAgICAgICAgdGhpcy5pY29uLmVtaXQoZXZlbnQpO1xuICAgICAgfSkpO1xuXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub24oJ2luZm8nLCAoZXZlbnQ6IFNvaG9JbnB1dFZhbGlkYXRlRXZlbnQsIHZhbGlkYXRpb24pID0+IHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICAgIGV2ZW50LnZhbGlkYXRpb24gPSB7IGZpZWxkOiB2YWxpZGF0aW9uLmZpZWxkWzBdLCBtZXNzYWdlOiB2YWxpZGF0aW9uLm1lc3NhZ2UgfTtcbiAgICAgICAgdGhpcy5pbmZvLmVtaXQoZXZlbnQpO1xuICAgICAgfSkpO1xuXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub24oJ3ZhbGlkJywgKGV2ZW50OiBTb2hvSW5wdXRWYWxpZGF0ZUV2ZW50LCB2YWxpZGF0aW9uKSA9PiB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgICBldmVudC52YWxpZGF0aW9uID0geyBmaWVsZDogdmFsaWRhdGlvbi5maWVsZFswXSwgbWVzc2FnZTogdmFsaWRhdGlvbi5tZXNzYWdlIH07XG4gICAgICAgIHRoaXMudmFsaWQuZW1pdChldmVudCk7XG4gICAgICB9KSk7XG5cbiAgICAgIHRoaXMudmFsaWRhdG9yID0gdGhpcy5qUXVlcnlFbGVtZW50LmRhdGEoJ3ZhbGlkYXRlJyk7XG4gICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICAvLyBOZWNlc3NhcnkgY2xlYW4gdXAgc3RlcCAoYWRkIGFkZGl0aW9uYWwgaGVyZSlcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICBpZiAodGhpcy5qUXVlcnlFbGVtZW50KSB7XG4gICAgICAgIC8vIGNsZWFuIHVwIGF0dGFjaGVkIGV2ZW50cy5cbiAgICAgICAgdGhpcy5qUXVlcnlFbGVtZW50Lm9mZigpO1xuICAgICAgICB0aGlzLmpRdWVyeUVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICB0aGlzLnZhbGlkYXRvciEuZGVzdHJveSgpO1xuICAgICAgdGhpcy52YWxpZGF0b3IgPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIHRoZSBtZXNzYWdlIGZyb20gdGhlIGZpZWxkIGlmIHRoZXJlIGlzIG9uZSBhbmQgbWFyayB0aGUgZmllbGQgdmFsaWRcbiAgICovXG4gIHB1YmxpYyByZW1vdmVNZXNzYWdlKHR5cGU6IGFueSkge1xuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIHRoaXMudmFsaWRhdG9yPy5yZW1vdmVNZXNzYWdlKHRoaXMualF1ZXJ5RWxlbWVudCwgdHlwZSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogVHJpZ2dlciB2YWxpZGF0aW9uIG9mIHRoZSBmaWVsZFxuICAgKi9cbiAgcHVibGljIHZhbGlkYXRlKGV2ZW50OiBhbnkpIHtcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICB0aGlzLnZhbGlkYXRvcj8udmFsaWRhdGUodGhpcy5qUXVlcnlFbGVtZW50LCBmYWxzZSwgZXZlbnQpO1xuICAgIH0pO1xuICB9XG59XG4iXX0=