import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { NavigationEnd } from '@angular/router';
/**
 * Wrapper for the jQuery modal control.
 *
 */
export class SohoModalDialogRef {
    /**
     * The component displayed inside the modal frame, if specified.  This may
     * be null if the dialog is built from an HTML fragment or a jQuery selector.
     *
     * @returns the contained component dialog.
     */
    get componentDialog() {
        if (this.componentRef) {
            return this.componentRef.instance;
        }
        return undefined;
    }
    /**
     * The buttonset API for the modal dialog.
     *
     * @returns the buttonset API for the modal dialog, if initialised.
     */
    get buttonsetAPI() {
        return this.modal ? this.modal.buttonsetAPI : undefined;
    }
    /**
     * Sets the whole options block for this modal dialog.
     *
     * @param options - the options to set.
     */
    options(options) {
        this._options = Object.assign({}, this._options, options);
        // @todo update the dialog if required.
        if (this.modal) {
            this.modal.settings = this._options;
            // @todo - need an api on modal to update settings.
        }
        return this;
    }
    /**
     * Sets the frame height for the dialog.
     *
     * @param frameHeight - the extra frame height to allow.
     */
    frameHeight(frameHeight) {
        this._options.frameHeight = frameHeight;
        if (this.modal) {
            this.modal.settings.frameHeight = frameHeight;
        }
        return this;
    }
    /**
     * Sets the frame width for the dialog.
     *
     * @param frameWidth - the extra frame width to allow.
     */
    frameWidth(frameWidth) {
        this._options.frameWidth = frameWidth;
        if (this.modal) {
            this.modal.settings.frameWidth = frameWidth;
        }
        return this;
    }
    /**
     * A call back function that can be used to return data for the modal. This is the callback form of the before show event.
     *
     * @param beforeShow - The callback function
     */
    beforeShow(beforeShow) {
        this._options.beforeShow = beforeShow;
        if (this.modal) {
            this.modal.settings.beforeShow = beforeShow;
        }
        return this;
    }
    /**
     * If true, show a close icon button on the top right of the modal.
     *
     * @param showCloseBtn - if true the x will be shown.
     */
    showCloseBtn(showCloseBtn) {
        this._options.showCloseBtn = showCloseBtn;
        if (this.modal) {
            this.modal.settings.showCloseBtn = showCloseBtn;
        }
        return this;
    }
    /**
     * Optional max width to add in pixels.
     *
     * @param maxWidth - The width in pixels
     */
    maxWidth(maxWidth) {
        this.modal.settings.maxWidth = maxWidth;
        if (this.modal) {
            this.modal.settings.maxWidth = maxWidth;
        }
        return this;
    }
    /**
     * Sets the title of the modal dialog.
     *
     * @param title - the title of the dialog.
     */
    title(title) {
        this._options.title = title;
        if (this.modal) {
            this.modal.settings.title = title;
            // @todo - need an api on modal to update settings.
        }
        return this;
    }
    /**
     * Sets the buttons to use on the modal dialog.
     *
     * @param buttons - list of buttons to display
     */
    buttons(buttons) {
        this._options.buttons = buttons;
        if (this.modal) {
            this.modal.settings.buttons = buttons;
            // @todo - need an api on modal to update settings.
        }
        return this;
    }
    /**
     * Sets the 'id' that the modal control uses.
     *
     * @param id - the id.
     */
    id(id) {
        this._options.id = id;
        if (this.modal) {
            this.modal.settings.id = id;
            // @todo - need an api on modal to update settings.
        }
        return this;
    }
    /**
     * Sets the 'trigger' that the modal control uses.
     *
     * @param trigger - when to open the dialog.
     */
    trigger(trigger) {
        this._options.trigger = trigger;
        if (this.modal) {
            this.modal.settings.trigger = trigger;
            // @todo - need an api on modal to update settings.
        }
        return this;
    }
    /**
     * Sets the 'isAlert' that the modal control uses.
     *
     * @param isAlert - true if this dialog is to be styled an an alert.
     */
    isAlert(isAlert) {
        this._options.isAlert = isAlert;
        if (this.modal) {
            this.modal.settings.isAlert = isAlert;
            // @todo - need an api on modal to update settings.
        }
        return this;
    }
    /**
     * Sets the fullsize configuration that the modal control uses.
     *
     * @param fullsize - The full size configuration to use.
     */
    fullsize(fullsize) {
        this._options.fullsize = fullsize;
        if (this.modal) {
            this.modal.settings.fullsize = fullsize;
        }
        return this;
    }
    /**
     * Sets the breakpoint configuration that the modal control uses in full size mode(s).
     *
     * @param breakpoint - The full size configuration to use.
     */
    breakpoint(breakpoint) {
        this._options.breakpoint = breakpoint;
        if (this.modal) {
            this.modal.settings.breakpoint = breakpoint;
        }
        return this;
    }
    /**
     * Controls the opacity of the background overlay.
     *
     * @param overlayOpacity - The percent between 0 and 1 of opacity to use.
     */
    overlayOpacity(overlayOpacity) {
        this._options.overlayOpacity = overlayOpacity;
        if (this.modal) {
            this.modal.settings.overlayOpacity = overlayOpacity;
        }
        return this;
    }
    /**
     * Causes this modal instance to become hidden when another modal is displayed over top.
     *
     * @param hideUnderneath - If it should be on top or bottom.
     */
    hideUnderneath(hideUnderneath) {
        this._options.hideUnderneath = hideUnderneath;
        if (this.modal) {
            this.modal.settings.hideUnderneath = hideUnderneath;
        }
        return this;
    }
    /**
     * if true, causes the modal to not exit when the enter key is pressed.
     *
     * @param suppressEnterKey - If it supress enter
     */
    suppressEnterKey(suppressEnterKey) {
        this._options.suppressEnterKey = suppressEnterKey;
        if (this.modal) {
            this.modal.settings.suppressEnterKey = suppressEnterKey;
        }
        return this;
    }
    /**
     * If true, causes the modal's trigger element not to become focused once the modal is closed.
     *
     * @param noRefocus - If true, refocus
     */
    noRefocus(noRefocus) {
        this._options.noRefocus = noRefocus;
        if (this.modal) {
            this.modal.settings.noRefocus = noRefocus;
        }
        return this;
    }
    /**
     * The modal's trigger element to keep refocused once the modal is closed. This can be html or jquery object or query selector as string.
     *
     * @param triggerButton - The element (for example a button) to refocus on close.
     */
    triggerButton(triggerButton) {
        this._options.triggerButton = triggerButton;
        if (this.modal) {
            this.modal.settings.triggerButton = triggerButton;
        }
        return this;
    }
    /**
     * Add extra attributes like id's to the component
     */
    attributes(attributes) {
        this._options.attributes = attributes;
        if (this.modal) {
            this.modal.settings.attributes = attributes;
        }
        return this;
    }
    /**
     * Sets the 'content' that the modal control uses.
     *
     * @param content - a selector or string representing the dialog content.
     */
    content(content) {
        this._options.content = content;
        if (this.modal) {
            this.modal.settings.content = content;
            // @todo - need an api on modal to update content.
        }
        return this;
    }
    /**
     * Sets the 'cssClass' of the modal control.
     */
    cssClass(cssClass) {
        this._options.cssClass = cssClass;
        if (this.modal) {
            this.modal.settings.cssClass = cssClass;
            // @todo - need an api on modal to update settings.
        }
        return this;
    }
    /**
     * Sets the 'autoFocus' of the modal control.
     *
     * @param autoFocus -if true; the dialog will autoFocus.
     */
    autoFocus(autoFocus) {
        this._options.autoFocus = autoFocus;
        if (this.modal) {
            this.modal.settings.autoFocus = autoFocus;
            // @todo - need an api on modal to update settings.
        }
        return this;
    }
    /**
     * Applies a function to the instantiated component,
     * allowing the component to be modified, or initialised.
     *
     * The function is provided with a typed value for the
     * instance.
     *
     * @param component - the instantated instance.
     * @return the dialog ref for onward assignment.
     */
    apply(fn) {
        if (fn && this.componentRef?.instance) {
            fn(this.componentRef.instance);
        }
        return this;
    }
    /**
     * When set to true, this dialog is closed when navigation is detected.
     *
     * @param closeOnNavigation controls the close behaviour when navigating.
     * @return the dialog ref for support a fluent api.
     */
    closeOnNavigation(closeOnNavigation) {
        this._closeOnNavigation = closeOnNavigation;
        return this;
    }
    /**
     * Dialog result property.
     *
     * @param dialogResult - the stored restult of the dialog.
     */
    set dialogResult(dialogResult) {
        this._dialogResult = dialogResult;
    }
    get dialogResult() {
        return this._dialogResult;
    }
    /**
     * Constructor.
     *
     * @paran appRef - application reference used to insert the component.
     */
    constructor(router, appRef, componentFactoryResolver, injector, ngZone, settings, modalComponent) {
        this.appRef = appRef;
        this.injector = injector;
        this.ngZone = ngZone;
        /** Vetoable Event Guard */
        this.eventGuard = {};
        /**
         * Closes the modal dialogs if router navigation is detected, this prevents diaslogs from being
         * left open when navigating.
         */
        this._closeOnNavigation = true;
        /** Event fired when the modal is opened. */
        this.open$ = new Subject();
        /** Event fired when the modal is closed. */
        this.close$ = new Subject();
        /** Event fired after closing the modal. */
        this.afterClose$ = new Subject();
        /** Event fired after openning the modal dialog. */
        this.afterOpen$ = new Subject();
        /** Handle resource tidy up of this class. */
        this.destroyed$ = new Subject();
        // -------------------------------------------
        // Default options block
        // -------------------------------------------
        /**
         * Cached options.
         */
        this._options = {};
        this.options(settings);
        if (modalComponent) {
            // Create component
            this.componentRef = componentFactoryResolver
                .resolveComponentFactory(modalComponent)
                .create(this.injector);
            appRef.attachView(this.componentRef.hostView);
            // Handle angular closing the component by closing the corresponding dialog.
            this.componentRef.onDestroy(() => {
                // Disable the beforeClose veto capability when navigating.
                this.eventGuard.beforeClose = null;
                this.close();
            });
            // Initialise the event guart
            this.eventGuard = this.componentRef.instance || null;
            this._options.content = jQuery(this.componentRef.location.nativeElement);
        }
        // Add a subscription to the router to remove
        // the dialog when the user navigates.
        if (router) {
            router.events
                .pipe(takeUntil(this.destroyed$))
                .subscribe(e => {
                if (this._closeOnNavigation && e instanceof NavigationEnd) {
                    // Disable the beforeClose veto capability when navigating.
                    this.eventGuard.beforeClose = null;
                    if (this.modal) {
                        this.modal.close(true);
                    }
                    if (this.componentRef) {
                        this.componentRef.destroy();
                    }
                }
            });
        }
    }
    /**
     * Opens the dialog.
     *
     * @return the dialog ref.
     */
    open() {
        if (this.modal) {
            this.modal.open();
            return this;
        }
        if (!this.componentRef && !this._options.content) {
            throw Error('componentRef or content must be initialised.');
        }
        this.jQueryElement = this.ngZone.runOutsideAngular(() => {
            const element = jQuery('body');
            element.modal(this._options);
            this.modal = element.data('modal');
            return this.modal?.element;
        });
        // Add listeners to control events
        this.jQueryElement?.off('close').on('close', ((event, isCancelled) => this.ngZone.run(() => this.onClose(event, isCancelled))));
        this.jQueryElement?.off('afterclose').on('afterclose', ((event) => this.ngZone.run(() => this.onAfterClose(event))));
        this.jQueryElement?.off('open').on('open', ((event) => this.ngZone.run(() => this.onOpen(event))));
        this.jQueryElement?.off('afteropen').on('afteropen', ((event) => this.ngZone.run(() => this.onAfterOpen(event))));
        // These are vetoable events.
        this.jQueryElement?.off('beforeopen').on('beforeopen', ((event) => this.ngZone.run(() => this.onBeforeOpen(event))));
        this.jQueryElement?.off('beforeclose').on('beforeclose', ((event) => this.ngZone.run(() => this.onBeforeClose(event))));
        this.jQueryElement?.off('beforedestroy').on('beforedestroy', ((event) => this.ngZone.run(() => this.onBeforeDestroy(event))));
        return this;
    }
    /**
     * Closes the modal dialog, if open.  The dialog is not closed
     * fully until the 'afterClosed' event is fired.
     *
     * @param dialogResult - optional result - passed back to the caller.
     */
    close(dialogResult) {
        this.dialogResult = dialogResult;
        if (this.modal) {
            this.ngZone.runOutsideAngular(() => this.modal?.close(false, false, true));
        }
        return this;
    }
    /**
     * Destroys the modal dialog.
     */
    destroy() {
        this.modal?.destroy();
        return this;
    }
    // ------------------------------------------
    // Events
    // ------------------------------------------
    /**
     * Registers a before open guard.
     *
     * SOHO-4892 - Returning false from beforeOpen or beforeDestroy breaks dialogs
     *
     * @param eventFn - the function to call before openning the dialog.
     */
    beforeOpen(eventFn) {
        this.eventGuard.beforeOpen = eventFn;
        return this;
    }
    /**
     * Opened Event.
     *
     * This event is fired when the dialog is being opened.
     *
     * @param eventFn - the function to invoke when the dialog is to be opened.
     */
    opened(eventFn) {
        this.open$.pipe(takeUntil(this.destroyed$)).subscribe((f) => {
            eventFn(f, this);
        });
        return this;
    }
    /**
     * Opened Event.
     *
     * This event is fired after the dialog has been opened.
     *
     * @param eventFn - the function to invoke when the dialog is to be opened.
     */
    afterOpen(eventFn) {
        this.afterOpen$.pipe(takeUntil(this.destroyed$)).subscribe((f) => {
            eventFn(f, this);
        });
        return this;
    }
    /**
     * Registers a before close guard.
     *
     * @param eventFn - the function to call before closing the dialog.
     */
    beforeClose(eventFn) {
        this.eventGuard.beforeClose = eventFn;
        return this;
    }
    /**
     * Closed Event.
     *
     * This event is fired when the dialog is being closed.
     *
     * @param eventFn - the function to invoke when the dialog is to be closed.
     */
    closed(eventFn) {
        this.close$.pipe(takeUntil(this.destroyed$)).subscribe((f) => {
            eventFn(f, this, this.componentDialog);
        });
        return this;
    }
    /**
     * After Closed Event.
     *
     * This event is fired, with the result of the dialog, when the dialog has been
     * closed and destroyed.
     *
     * @param eventFn - the function to invoke after the dialog has been closed.
     */
    afterClose(eventFn) {
        this.afterClose$.pipe(takeUntil(this.destroyed$)).subscribe((result) => {
            eventFn(result, this, this.componentDialog);
        });
        return this;
    }
    /**
     * Registers a before destroy guard.
     *
     * SOHO-4892 - Returning false from beforeOpen or beforeDestroy breaks dialogs
     *
     * @param eventFn - the function to call before destroying the dialog.
     */
    beforeDestroy(eventFn) {
        this.eventGuard.beforeDestroy = eventFn;
        return this;
    }
    // -------------------------------------------
    // Event Handlers
    // -------------------------------------------
    /**
     * Handles the 'afterOpen' event, fired after the modal dialog
     * has been opened.
     *
     * @param event - full event object.
     */
    onAfterOpen(event) {
        this.afterOpen$.next(event);
    }
    /**
     * Handles the 'beforeOpen' event, fired before the modal dialog
     * has been opened.
     *
     * @param event - full event object.
     *
     * @return true if the dialog can be opened; otherwise false if veoted.
     */
    onBeforeOpen(_event) {
        const fn = this.eventGuard?.beforeOpen;
        return fn ? fn.call(this.eventGuard, this) : true;
    }
    /**
     * Handles the 'beforeClose' event, fired before the modal dialog
     * has been destroyed.
     *
     * @param event - event object.
     * @return true if the dialog can be closed; otherwise false if veoted.
     */
    onBeforeClose(_event) {
        const fn = this.eventGuard.beforeClose;
        this.eventGuard.isCancelled = this.modal?.isCancelled;
        return fn ? fn.call(this.eventGuard, this) : true;
    }
    /**
     * Handles the 'beforeDestroy' event, fired before the modal dialog
     * has been destroyed.
     *
     * @param event - event object.
     * @return true if the dialog can be destroyed; otherwise false if veoted.
     */
    onBeforeDestroy(_) {
        const fn = this.eventGuard?.beforeDestroy;
        const allow = fn ? fn.call(this.eventGuard) : true;
        if (allow) {
            // Remove all events.
            if (this.jQueryElement) {
                this.jQueryElement.off();
                this.jQueryElement = undefined;
            }
            this.ngZone.run(() => {
                if (this.componentRef) {
                    this.appRef.detachView(this.componentRef.hostView);
                    this.componentRef.destroy();
                    this.componentRef = null;
                }
                // Tidy up all subscriptions.
                this.destroyed$.next(_);
                this.destroyed$.complete();
                // Clean up references
                this.eventGuard = null;
            });
        }
        return allow;
    }
    /**
     * Handles the 'open' event, fired just before
     * the focus is assigned to a modal.
     *
     * @param event - full event object.
     */
    onOpen(event) {
        this.open$.next(event);
    }
    /**
     * Handles the close event.
     *
     * @param event - full event object.
     * @param isCancelled - is true if the cancel button was pressed; otherwise false.
     */
    onClose(_event, isCancelled) {
        this.close$.next(isCancelled);
    }
    /**
     * Handles the 'afterClose' event, fired when the dialog
     * has been closed and tidy up is required.
     *
     * @param event - full event object.
     */
    onAfterClose(_event) {
        // Pass the dialog result back.
        this.afterClose$.next(this.dialogResult);
        this.afterClose$.complete();
        this.ngZone.runOutsideAngular(() => {
            // must destroy before turning off jquery events. modal.destroy relies on
            // the onBeforeDestroy event.
            this.modal?.destroy();
            this.modal = null;
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1tb2RhbC1kaWFsb2cucmVmLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvaWRzLWVudGVycHJpc2Utbmcvc3JjL2xpYi9tb2RhbC1kaWFsb2cvc29oby1tb2RhbC1kaWFsb2cucmVmLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDLE9BQU8sRUFBVSxhQUFhLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUV4RDs7O0dBR0c7QUFDSCxNQUFNLE9BQU8sa0JBQWtCO0lBcUM3Qjs7Ozs7T0FLRztJQUNILElBQVcsZUFBZTtRQUN4QixJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDckIsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQztTQUNuQztRQUNELE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsSUFBVyxZQUFZO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztJQUMxRCxDQUFDO0lBV0Q7Ozs7T0FJRztJQUNILE9BQU8sQ0FBQyxPQUF5QjtRQUMvQixJQUFJLENBQUMsUUFBUSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFFMUQsdUNBQXVDO1FBQ3ZDLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNkLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7WUFDcEMsbURBQW1EO1NBQ3BEO1FBRUQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQ7Ozs7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RUFBRSxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUMsS0FBVSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFILElBQUksQ0FBQyxhQUFhLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLEtBQVUsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4RyxJQUFJLENBQUMsYUFBYSxFQUFFLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxLQUFVLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFdkgsNkJBQTZCO1FBQzdCLElBQUksQ0FBQyxhQUFhLEVBQUUsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDLEtBQVUsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxSCxJQUFJLENBQUMsYUFBYSxFQUFFLEdBQUcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUMsQ0FBQyxLQUFVLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FB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O0lBQ2hDLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNLLFlBQVksQ0FBQyxNQUFXO1FBQzlCLCtCQUErQjtRQUMvQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUU1QixJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRTtZQUNqQyx5RUFBeUU7WUFDekUsNkJBQTZCO1lBQzdCLElBQUksQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDcEIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnRSZWYsIE5nWm9uZSwgQXBwbGljYXRpb25SZWYsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IENvbXBvbmVudFR5cGUgfSBmcm9tICcuJztcbmltcG9ydCB7IFJvdXRlciwgTmF2aWdhdGlvbkVuZCB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5cbi8qKlxuICogV3JhcHBlciBmb3IgdGhlIGpRdWVyeSBtb2RhbCBjb250cm9sLlxuICpcbiAqL1xuZXhwb3J0IGNsYXNzIFNvaG9Nb2RhbERpYWxvZ1JlZjxUPiB7XG4gIC8qKiBDb21wb25lbnQgLSBpZiB0aGUgY29udGVudCBpcyBkZXJpdmVkIGZyb20gYW4gZXhpc3RpbmcgY29tcG9uZW50LiAqL1xuICBwcml2YXRlIGNvbXBvbmVudFJlZj86IENvbXBvbmVudFJlZjxUPiB8IG51bGw7XG5cbiAgLyoqIFZldG9hYmxlIEV2ZW50IEd1YXJkICovXG4gIHByaXZhdGUgZXZlbnRHdWFyZDogU29ob01vZGFsRGlhbG9nVmV0b2FibGVFdmVudEd1YXJkPFQ+IHwgbnVsbCB8IHVuZGVmaW5lZCA9IHt9O1xuXG4gIC8qKlxuICAgKiBDbG9zZXMgdGhlIG1vZGFsIGRpYWxvZ3MgaWYgcm91dGVyIG5hdmlnYXRpb24gaXMgZGV0ZWN0ZWQsIHRoaXMgcHJldmVudHMgZGlhc2xvZ3MgZnJvbSBiZWluZ1xuICAgKiBsZWZ0IG9wZW4gd2hlbiBuYXZpZ2F0aW5nLlxuICAgKi9cbiAgcHJpdmF0ZSBfY2xvc2VPbk5hdmlnYXRpb24gPSB0cnVlO1xuXG4gIC8qKiBTZWxlY3RvciByZWZlcmVuY2luZyB0aGUgbW9kYWwtZGlhbG9nIGFmdGVyIGl0IGhhcyBiZWVuIG1vdmVkIHRvIHRoZSBkaWFsb2cgY29udGFpbmVyLiAqL1xuICBwcml2YXRlIGpRdWVyeUVsZW1lbnQ/OiBKUXVlcnk7XG5cbiAgLyoqIFNvaG8gQ29udHJvbCBBcGkgKi9cbiAgcHJpdmF0ZSBtb2RhbD86IFNvaG9Nb2RhbFN0YXRpYyB8IG51bGw7XG5cbiAgLyoqIFRoZSByZXN1bHQgb2YgdGhlIGRpYWxvZy4gKi9cbiAgcHJpdmF0ZSBfZGlhbG9nUmVzdWx0OiBhbnk7XG5cbiAgLyoqIEV2ZW50IGZpcmVkIHdoZW4gdGhlIG1vZGFsIGlzIG9wZW5lZC4gKi9cbiAgcHJpdmF0ZSBvcGVuJDogU3ViamVjdDxhbnk+ID0gbmV3IFN1YmplY3QoKTtcblxuICAvKiogRXZlbnQgZmlyZWQgd2hlbiB0aGUgbW9kYWwgaXMgY2xvc2VkLiAqL1xuICBwcml2YXRlIGNsb3NlJDogU3ViamVjdDxhbnk+ID0gbmV3IFN1YmplY3QoKTtcblxuICAvKiogRXZlbnQgZmlyZWQgYWZ0ZXIgY2xvc2luZyB0aGUgbW9kYWwuICovXG4gIHByaXZhdGUgYWZ0ZXJDbG9zZSQ6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgLyoqIEV2ZW50IGZpcmVkIGFmdGVyIG9wZW5uaW5nIHRoZSBtb2RhbCBkaWFsb2cuICovXG4gIHByaXZhdGUgYWZ0ZXJPcGVuJDogU3ViamVjdDxhbnk+ID0gbmV3IFN1YmplY3QoKTtcblxuICAvKiogSGFuZGxlIHJlc291cmNlIHRpZHkgdXAgb2YgdGhpcyBjbGFzcy4gKi9cbiAgcHJpdmF0ZSBkZXN0cm95ZWQkID0gbmV3IFN1YmplY3QoKTtcblxuICAvKipcbiAgICogVGhlIGNvbXBvbmVudCBkaXNwbGF5ZWQgaW5zaWRlIHRoZSBtb2RhbCBmcmFtZSwgaWYgc3BlY2lmaWVkLiAgVGhpcyBtYXlcbiAgICogYmUgbnVsbCBpZiB0aGUgZGlhbG9nIGlzIGJ1aWx0IGZyb20gYW4gSFRNTCBmcmFnbWVudCBvciBhIGpRdWVyeSBzZWxlY3Rvci5cbiAgICpcbiAgICogQHJldHVybnMgdGhlIGNvbnRhaW5lZCBjb21wb25lbnQgZGlhbG9nLlxuICAgKi9cbiAgcHVibGljIGdldCBjb21wb25lbnREaWFsb2coKTogVCB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKHRoaXMuY29tcG9uZW50UmVmKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2U7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICogVGhlIGJ1dHRvbnNldCBBUEkgZm9yIHRoZSBtb2RhbCBkaWFsb2cuXG4gICAqXG4gICAqIEByZXR1cm5zIHRoZSBidXR0b25zZXQgQVBJIGZvciB0aGUgbW9kYWwgZGlhbG9nLCBpZiBpbml0aWFsaXNlZC5cbiAgICovXG4gIHB1YmxpYyBnZXQgYnV0dG9uc2V0QVBJKCk6IFNvaG9CdXR0b25zZXRTdGF0aWMgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLm1vZGFsID8gdGhpcy5tb2RhbC5idXR0b25zZXRBUEkgOiB1bmRlZmluZWQ7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIERlZmF1bHQgb3B0aW9ucyBibG9ja1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLyoqXG4gICAqIENhY2hlZCBvcHRpb25zLlxuICAgKi9cbiAgcHJpdmF0ZSBfb3B0aW9uczogU29ob01vZGFsT3B0aW9ucyA9IHt9O1xuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSB3aG9sZSBvcHRpb25zIGJsb2NrIGZvciB0aGlzIG1vZGFsIGRpYWxvZy5cbiAgICpcbiAgICogQHBhcmFtIG9wdGlvbnMgLSB0aGUgb3B0aW9ucyB0byBzZXQuXG4gICAqL1xuICBvcHRpb25zKG9wdGlvbnM6IFNvaG9Nb2RhbE9wdGlvbnMpOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4ge1xuICAgIHRoaXMuX29wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLl9vcHRpb25zLCBvcHRpb25zKTtcblxuICAgIC8vIEB0b2RvIHVwZGF0ZSB0aGUgZGlhbG9nIGlmIHJlcXVpcmVkLlxuICAgIGlmICh0aGlzLm1vZGFsKSB7XG4gICAgICB0aGlzLm1vZGFsLnNldHRpbmdzID0gdGhpcy5fb3B0aW9ucztcbiAgICAgIC8vIEB0b2RvIC0gbmVlZCBhbiBhcGkgb24gbW9kYWwgdG8gdXBkYXRlIHNldHRpbmdzLlxuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGZyYW1lIGhlaWdodCBmb3IgdGhlIGRpYWxvZy5cbiAgICpcbiAgICogQHBhcmFtIGZyYW1lSGVpZ2h0IC0gdGhlIGV4dHJhIGZyYW1lIGhlaWdodCB0byBhbGxvdy5cbiAgICovXG4gIGZyYW1lSGVpZ2h0KGZyYW1lSGVpZ2h0OiBudW1iZXIpOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4ge1xuICAgIHRoaXMuX29wdGlvbnMuZnJhbWVIZWlnaHQgPSBmcmFtZUhlaWdodDtcbiAgICBpZiAodGhpcy5tb2RhbCkge1xuICAgICAgdGhpcy5tb2RhbC5zZXR0aW5ncy5mcmFtZUhlaWdodCA9IGZyYW1lSGVpZ2h0O1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBmcmFtZSB3aWR0aCBmb3IgdGhlIGRpYWxvZy5cbiAgICpcbiAgICogQHBhcmFtIGZyYW1lV2lkdGggLSB0aGUgZXh0cmEgZnJhbWUgd2lkdGggdG8gYWxsb3cuXG4gICAqL1xuICBmcmFtZVdpZHRoKGZyYW1lV2lkdGg6IG51bWJlcik6IFNvaG9Nb2RhbERpYWxvZ1JlZjxUPiB7XG4gICAgdGhpcy5fb3B0aW9ucy5mcmFtZVdpZHRoID0gZnJhbWVXaWR0aDtcbiAgICBpZiAodGhpcy5tb2RhbCkge1xuICAgICAgdGhpcy5tb2RhbC5zZXR0aW5ncy5mcmFtZVdpZHRoID0gZnJhbWVXaWR0aDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogQSBjYWxsIGJhY2sgZnVuY3Rpb24gdGhhdCBjYW4gYmUgdXNlZCB0byByZXR1cm4gZGF0YSBmb3IgdGhlIG1vZGFsLiBUaGlzIGlzIHRoZSBjYWxsYmFjayBmb3JtIG9mIHRoZSBiZWZvcmUgc2hvdyBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIGJlZm9yZVNob3cgLSBUaGUgY2FsbGJhY2sgZnVuY3Rpb25cbiAgICovXG4gIGJlZm9yZVNob3coYmVmb3JlU2hvdzogYW55KTogU29ob01vZGFsRGlhbG9nUmVmPFQ+IHtcbiAgICB0aGlzLl9vcHRpb25zLmJlZm9yZVNob3cgPSBiZWZvcmVTaG93O1xuICAgIGlmICh0aGlzLm1vZGFsKSB7XG4gICAgICB0aGlzLm1vZGFsLnNldHRpbmdzLmJlZm9yZVNob3cgPSBiZWZvcmVTaG93O1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBJZiB0cnVlLCBzaG93IGEgY2xvc2UgaWNvbiBidXR0b24gb24gdGhlIHRvcCByaWdodCBvZiB0aGUgbW9kYWwuXG4gICAqXG4gICAqIEBwYXJhbSBzaG93Q2xvc2VCdG4gLSBpZiB0cnVlIHRoZSB4IHdpbGwgYmUgc2hvd24uXG4gICAqL1xuICBzaG93Q2xvc2VCdG4oc2hvd0Nsb3NlQnRuOiBib29sZWFuKTogU29ob01vZGFsRGlhbG9nUmVmPFQ+IHtcbiAgICB0aGlzLl9vcHRpb25zLnNob3dDbG9zZUJ0biA9IHNob3dDbG9zZUJ0bjtcbiAgICBpZiAodGhpcy5tb2RhbCkge1xuICAgICAgdGhpcy5tb2RhbC5zZXR0aW5ncy5zaG93Q2xvc2VCdG4gPSBzaG93Q2xvc2VCdG47XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIE9wdGlvbmFsIG1heCB3aWR0aCB0byBhZGQgaW4gcGl4ZWxzLlxuICAgKlxuICAgKiBAcGFyYW0gbWF4V2lkdGggLSBUaGUgd2lkdGggaW4gcGl4ZWxzXG4gICAqL1xuICBtYXhXaWR0aChtYXhXaWR0aDogbnVtYmVyKTogU29ob01vZGFsRGlhbG9nUmVmPFQ+IHtcbiAgICAodGhpcy5tb2RhbCBhcyBhbnkpLnNldHRpbmdzLm1heFdpZHRoID0gbWF4V2lkdGg7XG4gICAgaWYgKHRoaXMubW9kYWwpIHtcbiAgICAgIHRoaXMubW9kYWwuc2V0dGluZ3MubWF4V2lkdGggPSBtYXhXaWR0aDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgdGl0bGUgb2YgdGhlIG1vZGFsIGRpYWxvZy5cbiAgICpcbiAgICogQHBhcmFtIHRpdGxlIC0gdGhlIHRpdGxlIG9mIHRoZSBkaWFsb2cuXG4gICAqL1xuICB0aXRsZSh0aXRsZTogc3RyaW5nKTogU29ob01vZGFsRGlhbG9nUmVmPFQ+IHtcbiAgICB0aGlzLl9vcHRpb25zLnRpdGxlID0gdGl0bGU7XG4gICAgaWYgKHRoaXMubW9kYWwpIHtcbiAgICAgIHRoaXMubW9kYWwuc2V0dGluZ3MudGl0bGUgPSB0aXRsZTtcbiAgICAgIC8vIEB0b2RvIC0gbmVlZCBhbiBhcGkgb24gbW9kYWwgdG8gdXBkYXRlIHNldHRpbmdzLlxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBidXR0b25zIHRvIHVzZSBvbiB0aGUgbW9kYWwgZGlhbG9nLlxuICAgKlxuICAgKiBAcGFyYW0gYnV0dG9ucyAtIGxpc3Qgb2YgYnV0dG9ucyB0byBkaXNwbGF5XG4gICAqL1xuICBidXR0b25zKGJ1dHRvbnM6IFNvaG9Nb2RhbEJ1dHRvbltdKTogU29ob01vZGFsRGlhbG9nUmVmPFQ+IHtcbiAgICB0aGlzLl9vcHRpb25zLmJ1dHRvbnMgPSBidXR0b25zO1xuICAgIGlmICh0aGlzLm1vZGFsKSB7XG4gICAgICB0aGlzLm1vZGFsLnNldHRpbmdzLmJ1dHRvbnMgPSBidXR0b25zO1xuICAgICAgLy8gQHRvZG8gLSBuZWVkIGFuIGFwaSBvbiBtb2RhbCB0byB1cGRhdGUgc2V0dGluZ3MuXG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlICdpZCcgdGhhdCB0aGUgbW9kYWwgY29udHJvbCB1c2VzLlxuICAgKlxuICAgKiBAcGFyYW0gaWQgLSB0aGUgaWQuXG4gICAqL1xuICBpZChpZDogc3RyaW5nKTogU29ob01vZGFsRGlhbG9nUmVmPFQ+IHtcbiAgICB0aGlzLl9vcHRpb25zLmlkID0gaWQ7XG4gICAgaWYgKHRoaXMubW9kYWwpIHtcbiAgICAgIHRoaXMubW9kYWwuc2V0dGluZ3MuaWQgPSBpZDtcbiAgICAgIC8vIEB0b2RvIC0gbmVlZCBhbiBhcGkgb24gbW9kYWwgdG8gdXBkYXRlIHNldHRpbmdzLlxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSAndHJpZ2dlcicgdGhhdCB0aGUgbW9kYWwgY29udHJvbCB1c2VzLlxuICAgKlxuICAgKiBAcGFyYW0gdHJpZ2dlciAtIHdoZW4gdG8gb3BlbiB0aGUgZGlhbG9nLlxuICAgKi9cbiAgdHJpZ2dlcih0cmlnZ2VyOiBTb2hvTW9kYWxUcmlnZ2VyVHlwZSk6IFNvaG9Nb2RhbERpYWxvZ1JlZjxUPiB7XG4gICAgdGhpcy5fb3B0aW9ucy50cmlnZ2VyID0gdHJpZ2dlcjtcbiAgICBpZiAodGhpcy5tb2RhbCkge1xuICAgICAgdGhpcy5tb2RhbC5zZXR0aW5ncy50cmlnZ2VyID0gdHJpZ2dlcjtcbiAgICAgIC8vIEB0b2RvIC0gbmVlZCBhbiBhcGkgb24gbW9kYWwgdG8gdXBkYXRlIHNldHRpbmdzLlxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSAnaXNBbGVydCcgdGhhdCB0aGUgbW9kYWwgY29udHJvbCB1c2VzLlxuICAgKlxuICAgKiBAcGFyYW0gaXNBbGVydCAtIHRydWUgaWYgdGhpcyBkaWFsb2cgaXMgdG8gYmUgc3R5bGVkIGFuIGFuIGFsZXJ0LlxuICAgKi9cbiAgaXNBbGVydChpc0FsZXJ0OiBib29sZWFuKTogU29ob01vZGFsRGlhbG9nUmVmPFQ+IHtcbiAgICB0aGlzLl9vcHRpb25zLmlzQWxlcnQgPSBpc0FsZXJ0O1xuICAgIGlmICh0aGlzLm1vZGFsKSB7XG4gICAgICB0aGlzLm1vZGFsLnNldHRpbmdzLmlzQWxlcnQgPSBpc0FsZXJ0O1xuICAgICAgLy8gQHRvZG8gLSBuZWVkIGFuIGFwaSBvbiBtb2RhbCB0byB1cGRhdGUgc2V0dGluZ3MuXG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGZ1bGxzaXplIGNvbmZpZ3VyYXRpb24gdGhhdCB0aGUgbW9kYWwgY29udHJvbCB1c2VzLlxuICAgKlxuICAgKiBAcGFyYW0gZnVsbHNpemUgLSBUaGUgZnVsbCBzaXplIGNvbmZpZ3VyYXRpb24gdG8gdXNlLlxuICAgKi9cbiAgZnVsbHNpemUoZnVsbHNpemU6IFNvaG9Nb2RhbEZ1bGxTaXplKTogU29ob01vZGFsRGlhbG9nUmVmPFQ+IHtcbiAgICB0aGlzLl9vcHRpb25zLmZ1bGxzaXplID0gZnVsbHNpemU7XG4gICAgaWYgKHRoaXMubW9kYWwpIHtcbiAgICAgIHRoaXMubW9kYWwuc2V0dGluZ3MuZnVsbHNpemUgPSBmdWxsc2l6ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgYnJlYWtwb2ludCBjb25maWd1cmF0aW9uIHRoYXQgdGhlIG1vZGFsIGNvbnRyb2wgdXNlcyBpbiBmdWxsIHNpemUgbW9kZShzKS5cbiAgICpcbiAgICogQHBhcmFtIGJyZWFrcG9pbnQgLSBUaGUgZnVsbCBzaXplIGNvbmZpZ3VyYXRpb24gdG8gdXNlLlxuICAgKi9cbiAgYnJlYWtwb2ludChicmVha3BvaW50OiBTb2hvTW9kYWxCcmVha1BvaW50KTogU29ob01vZGFsRGlhbG9nUmVmPFQ+IHtcbiAgICB0aGlzLl9vcHRpb25zLmJyZWFrcG9pbnQgPSBicmVha3BvaW50O1xuICAgIGlmICh0aGlzLm1vZGFsKSB7XG4gICAgICB0aGlzLm1vZGFsLnNldHRpbmdzLmJyZWFrcG9pbnQgPSBicmVha3BvaW50O1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDb250cm9scyB0aGUgb3BhY2l0eSBvZiB0aGUgYmFja2dyb3VuZCBvdmVybGF5LlxuICAgKlxuICAgKiBAcGFyYW0gb3ZlcmxheU9wYWNpdHkgLSBUaGUgcGVyY2VudCBiZXR3ZWVuIDAgYW5kIDEgb2Ygb3BhY2l0eSB0byB1c2UuXG4gICAqL1xuICBvdmVybGF5T3BhY2l0eShvdmVybGF5T3BhY2l0eTogbnVtYmVyKTogU29ob01vZGFsRGlhbG9nUmVmPFQ+IHtcbiAgICB0aGlzLl9vcHRpb25zLm92ZXJsYXlPcGFjaXR5ID0gb3ZlcmxheU9wYWNpdHk7XG4gICAgaWYgKHRoaXMubW9kYWwpIHtcbiAgICAgIHRoaXMubW9kYWwuc2V0dGluZ3Mub3ZlcmxheU9wYWNpdHkgPSBvdmVybGF5T3BhY2l0eTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogQ2F1c2VzIHRoaXMgbW9kYWwgaW5zdGFuY2UgdG8gYmVjb21lIGhpZGRlbiB3aGVuIGFub3RoZXIgbW9kYWwgaXMgZGlzcGxheWVkIG92ZXIgdG9wLlxuICAgKlxuICAgKiBAcGFyYW0gaGlkZVVuZGVybmVhdGggLSBJZiBpdCBzaG91bGQgYmUgb24gdG9wIG9yIGJvdHRvbS5cbiAgICovXG4gIGhpZGVVbmRlcm5lYXRoKGhpZGVVbmRlcm5lYXRoOiBib29sZWFuKTogU29ob01vZGFsRGlhbG9nUmVmPFQ+IHtcbiAgICB0aGlzLl9vcHRpb25zLmhpZGVVbmRlcm5lYXRoID0gaGlkZVVuZGVybmVhdGg7XG4gICAgaWYgKHRoaXMubW9kYWwpIHtcbiAgICAgIHRoaXMubW9kYWwuc2V0dGluZ3MuaGlkZVVuZGVybmVhdGggPSBoaWRlVW5kZXJuZWF0aDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogaWYgdHJ1ZSwgY2F1c2VzIHRoZSBtb2RhbCB0byBub3QgZXhpdCB3aGVuIHRoZSBlbnRlciBrZXkgaXMgcHJlc3NlZC5cbiAgICpcbiAgICogQHBhcmFtIHN1cHByZXNzRW50ZXJLZXkgLSBJZiBpdCBzdXByZXNzIGVudGVyXG4gICAqL1xuICBzdXBwcmVzc0VudGVyS2V5KHN1cHByZXNzRW50ZXJLZXk6IGJvb2xlYW4pOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4ge1xuICAgIHRoaXMuX29wdGlvbnMuc3VwcHJlc3NFbnRlcktleSA9IHN1cHByZXNzRW50ZXJLZXk7XG4gICAgaWYgKHRoaXMubW9kYWwpIHtcbiAgICAgIHRoaXMubW9kYWwuc2V0dGluZ3Muc3VwcHJlc3NFbnRlcktleSA9IHN1cHByZXNzRW50ZXJLZXk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIElmIHRydWUsIGNhdXNlcyB0aGUgbW9kYWwncyB0cmlnZ2VyIGVsZW1lbnQgbm90IHRvIGJlY29tZSBmb2N1c2VkIG9uY2UgdGhlIG1vZGFsIGlzIGNsb3NlZC5cbiAgICpcbiAgICogQHBhcmFtIG5vUmVmb2N1cyAtIElmIHRydWUsIHJlZm9jdXNcbiAgICovXG4gIG5vUmVmb2N1cyhub1JlZm9jdXM6IGJvb2xlYW4pOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4ge1xuICAgIHRoaXMuX29wdGlvbnMubm9SZWZvY3VzID0gbm9SZWZvY3VzO1xuICAgIGlmICh0aGlzLm1vZGFsKSB7XG4gICAgICB0aGlzLm1vZGFsLnNldHRpbmdzLm5vUmVmb2N1cyA9IG5vUmVmb2N1cztcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogVGhlIG1vZGFsJ3MgdHJpZ2dlciBlbGVtZW50IHRvIGtlZXAgcmVmb2N1c2VkIG9uY2UgdGhlIG1vZGFsIGlzIGNsb3NlZC4gVGhpcyBjYW4gYmUgaHRtbCBvciBqcXVlcnkgb2JqZWN0IG9yIHF1ZXJ5IHNlbGVjdG9yIGFzIHN0cmluZy5cbiAgICpcbiAgICogQHBhcmFtIHRyaWdnZXJCdXR0b24gLSBUaGUgZWxlbWVudCAoZm9yIGV4YW1wbGUgYSBidXR0b24pIHRvIHJlZm9jdXMgb24gY2xvc2UuXG4gICAqL1xuICB0cmlnZ2VyQnV0dG9uKHRyaWdnZXJCdXR0b246IGJvb2xlYW4pOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4ge1xuICAgIHRoaXMuX29wdGlvbnMudHJpZ2dlckJ1dHRvbiA9IHRyaWdnZXJCdXR0b247XG4gICAgaWYgKHRoaXMubW9kYWwpIHtcbiAgICAgIHRoaXMubW9kYWwuc2V0dGluZ3MudHJpZ2dlckJ1dHRvbiA9IHRyaWdnZXJCdXR0b247XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBleHRyYSBhdHRyaWJ1dGVzIGxpa2UgaWQncyB0byB0aGUgY29tcG9uZW50XG4gICAqL1xuICBhdHRyaWJ1dGVzKGF0dHJpYnV0ZXM6IGJvb2xlYW4pOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4ge1xuICAgIHRoaXMuX29wdGlvbnMuYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXM7XG4gICAgaWYgKHRoaXMubW9kYWwpIHtcbiAgICAgIHRoaXMubW9kYWwuc2V0dGluZ3MuYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXM7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlICdjb250ZW50JyB0aGF0IHRoZSBtb2RhbCBjb250cm9sIHVzZXMuXG4gICAqXG4gICAqIEBwYXJhbSBjb250ZW50IC0gYSBzZWxlY3RvciBvciBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBkaWFsb2cgY29udGVudC5cbiAgICovXG4gIGNvbnRlbnQoY29udGVudDogSlF1ZXJ5IHwgc3RyaW5nKTogU29ob01vZGFsRGlhbG9nUmVmPFQ+IHtcbiAgICB0aGlzLl9vcHRpb25zLmNvbnRlbnQgPSBjb250ZW50O1xuICAgIGlmICh0aGlzLm1vZGFsKSB7XG4gICAgICB0aGlzLm1vZGFsLnNldHRpbmdzLmNvbnRlbnQgPSBjb250ZW50O1xuICAgICAgLy8gQHRvZG8gLSBuZWVkIGFuIGFwaSBvbiBtb2RhbCB0byB1cGRhdGUgY29udGVudC5cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgJ2Nzc0NsYXNzJyBvZiB0aGUgbW9kYWwgY29udHJvbC5cbiAgICovXG4gIGNzc0NsYXNzKGNzc0NsYXNzOiBzdHJpbmcpOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4ge1xuICAgIHRoaXMuX29wdGlvbnMuY3NzQ2xhc3MgPSBjc3NDbGFzcztcbiAgICBpZiAodGhpcy5tb2RhbCkge1xuICAgICAgdGhpcy5tb2RhbC5zZXR0aW5ncy5jc3NDbGFzcyA9IGNzc0NsYXNzO1xuICAgICAgLy8gQHRvZG8gLSBuZWVkIGFuIGFwaSBvbiBtb2RhbCB0byB1cGRhdGUgc2V0dGluZ3MuXG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlICdhdXRvRm9jdXMnIG9mIHRoZSBtb2RhbCBjb250cm9sLlxuICAgKlxuICAgKiBAcGFyYW0gYXV0b0ZvY3VzIC1pZiB0cnVlOyB0aGUgZGlhbG9nIHdpbGwgYXV0b0ZvY3VzLlxuICAgKi9cbiAgYXV0b0ZvY3VzKGF1dG9Gb2N1czogYm9vbGVhbik6IFNvaG9Nb2RhbERpYWxvZ1JlZjxUPiB7XG4gICAgdGhpcy5fb3B0aW9ucy5hdXRvRm9jdXMgPSBhdXRvRm9jdXM7XG4gICAgaWYgKHRoaXMubW9kYWwpIHtcbiAgICAgIHRoaXMubW9kYWwuc2V0dGluZ3MuYXV0b0ZvY3VzID0gYXV0b0ZvY3VzO1xuICAgICAgLy8gQHRvZG8gLSBuZWVkIGFuIGFwaSBvbiBtb2RhbCB0byB1cGRhdGUgc2V0dGluZ3MuXG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIEFwcGxpZXMgYSBmdW5jdGlvbiB0byB0aGUgaW5zdGFudGlhdGVkIGNvbXBvbmVudCxcbiAgICogYWxsb3dpbmcgdGhlIGNvbXBvbmVudCB0byBiZSBtb2RpZmllZCwgb3IgaW5pdGlhbGlzZWQuXG4gICAqXG4gICAqIFRoZSBmdW5jdGlvbiBpcyBwcm92aWRlZCB3aXRoIGEgdHlwZWQgdmFsdWUgZm9yIHRoZVxuICAgKiBpbnN0YW5jZS5cbiAgICpcbiAgICogQHBhcmFtIGNvbXBvbmVudCAtIHRoZSBpbnN0YW50YXRlZCBpbnN0YW5jZS5cbiAgICogQHJldHVybiB0aGUgZGlhbG9nIHJlZiBmb3Igb253YXJkIGFzc2lnbm1lbnQuXG4gICAqL1xuICBhcHBseShmbjogKGNvbXBvbmVudDogVCkgPT4gdm9pZCk6IFNvaG9Nb2RhbERpYWxvZ1JlZjxUPiB7XG4gICAgaWYgKGZuICYmIHRoaXMuY29tcG9uZW50UmVmPy5pbnN0YW5jZSkge1xuICAgICAgZm4odGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2UpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGVuIHNldCB0byB0cnVlLCB0aGlzIGRpYWxvZyBpcyBjbG9zZWQgd2hlbiBuYXZpZ2F0aW9uIGlzIGRldGVjdGVkLlxuICAgKlxuICAgKiBAcGFyYW0gY2xvc2VPbk5hdmlnYXRpb24gY29udHJvbHMgdGhlIGNsb3NlIGJlaGF2aW91ciB3aGVuIG5hdmlnYXRpbmcuXG4gICAqIEByZXR1cm4gdGhlIGRpYWxvZyByZWYgZm9yIHN1cHBvcnQgYSBmbHVlbnQgYXBpLlxuICAgKi9cbiAgY2xvc2VPbk5hdmlnYXRpb24oY2xvc2VPbk5hdmlnYXRpb246IGJvb2xlYW4pOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4ge1xuICAgIHRoaXMuX2Nsb3NlT25OYXZpZ2F0aW9uID0gY2xvc2VPbk5hdmlnYXRpb247XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogRGlhbG9nIHJlc3VsdCBwcm9wZXJ0eS5cbiAgICpcbiAgICogQHBhcmFtIGRpYWxvZ1Jlc3VsdCAtIHRoZSBzdG9yZWQgcmVzdHVsdCBvZiB0aGUgZGlhbG9nLlxuICAgKi9cbiAgc2V0IGRpYWxvZ1Jlc3VsdChkaWFsb2dSZXN1bHQ6IGFueSkge1xuICAgIHRoaXMuX2RpYWxvZ1Jlc3VsdCA9IGRpYWxvZ1Jlc3VsdDtcbiAgfVxuICBnZXQgZGlhbG9nUmVzdWx0KCk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuX2RpYWxvZ1Jlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3Rvci5cbiAgICpcbiAgICogQHBhcmFuIGFwcFJlZiAtIGFwcGxpY2F0aW9uIHJlZmVyZW5jZSB1c2VkIHRvIGluc2VydCB0aGUgY29tcG9uZW50LlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgcm91dGVyOiBSb3V0ZXIsXG4gICAgcHJpdmF0ZSBhcHBSZWY6IEFwcGxpY2F0aW9uUmVmLFxuICAgIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsXG4gICAgc2V0dGluZ3M6IFNvaG9Nb2RhbE9wdGlvbnMsXG4gICAgbW9kYWxDb21wb25lbnQ/OiBDb21wb25lbnRUeXBlPFQ+KSB7XG4gICAgdGhpcy5vcHRpb25zKHNldHRpbmdzKTtcblxuICAgIGlmIChtb2RhbENvbXBvbmVudCkge1xuXG4gICAgICAvLyBDcmVhdGUgY29tcG9uZW50XG4gICAgICB0aGlzLmNvbXBvbmVudFJlZiA9IGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlclxuICAgICAgICAucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkobW9kYWxDb21wb25lbnQpXG4gICAgICAgIC5jcmVhdGUodGhpcy5pbmplY3Rvcik7XG5cbiAgICAgIGFwcFJlZi5hdHRhY2hWaWV3KHRoaXMuY29tcG9uZW50UmVmLmhvc3RWaWV3KTtcblxuICAgICAgLy8gSGFuZGxlIGFuZ3VsYXIgY2xvc2luZyB0aGUgY29tcG9uZW50IGJ5IGNsb3NpbmcgdGhlIGNvcnJlc3BvbmRpbmcgZGlhbG9nLlxuICAgICAgdGhpcy5jb21wb25lbnRSZWYub25EZXN0cm95KCgpID0+IHtcbiAgICAgICAgLy8gRGlzYWJsZSB0aGUgYmVmb3JlQ2xvc2UgdmV0byBjYXBhYmlsaXR5IHdoZW4gbmF2aWdhdGluZy5cbiAgICAgICAgKHRoaXMuZXZlbnRHdWFyZCBhcyBhbnkpLmJlZm9yZUNsb3NlID0gbnVsbDtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEluaXRpYWxpc2UgdGhlIGV2ZW50IGd1YXJ0XG4gICAgICB0aGlzLmV2ZW50R3VhcmQgPSB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZSB8fCBudWxsO1xuXG4gICAgICB0aGlzLl9vcHRpb25zLmNvbnRlbnQgPSBqUXVlcnkodGhpcy5jb21wb25lbnRSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudCk7XG4gICAgfVxuXG4gICAgLy8gQWRkIGEgc3Vic2NyaXB0aW9uIHRvIHRoZSByb3V0ZXIgdG8gcmVtb3ZlXG4gICAgLy8gdGhlIGRpYWxvZyB3aGVuIHRoZSB1c2VyIG5hdmlnYXRlcy5cbiAgICBpZiAocm91dGVyKSB7XG4gICAgICByb3V0ZXIuZXZlbnRzXG4gICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3llZCQpKVxuICAgICAgICAuc3Vic2NyaWJlKGUgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLl9jbG9zZU9uTmF2aWdhdGlvbiAmJiBlIGluc3RhbmNlb2YgTmF2aWdhdGlvbkVuZCkge1xuICAgICAgICAgICAgLy8gRGlzYWJsZSB0aGUgYmVmb3JlQ2xvc2UgdmV0byBjYXBhYmlsaXR5IHdoZW4gbmF2aWdhdGluZy5cbiAgICAgICAgICAgICh0aGlzLmV2ZW50R3VhcmQgYXMgYW55KS5iZWZvcmVDbG9zZSA9IG51bGw7XG4gICAgICAgICAgICBpZiAodGhpcy5tb2RhbCkge1xuICAgICAgICAgICAgICB0aGlzLm1vZGFsLmNsb3NlKHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50UmVmKSB7XG4gICAgICAgICAgICAgIHRoaXMuY29tcG9uZW50UmVmLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBPcGVucyB0aGUgZGlhbG9nLlxuICAgKlxuICAgKiBAcmV0dXJuIHRoZSBkaWFsb2cgcmVmLlxuICAgKi9cbiAgb3BlbigpOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4ge1xuICAgIGlmICh0aGlzLm1vZGFsKSB7XG4gICAgICB0aGlzLm1vZGFsLm9wZW4oKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5jb21wb25lbnRSZWYgJiYgIXRoaXMuX29wdGlvbnMuY29udGVudCkge1xuICAgICAgdGhyb3cgRXJyb3IoJ2NvbXBvbmVudFJlZiBvciBjb250ZW50IG11c3QgYmUgaW5pdGlhbGlzZWQuJyk7XG4gICAgfVxuXG4gICAgdGhpcy5qUXVlcnlFbGVtZW50ID0gdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgY29uc3QgZWxlbWVudCA9IGpRdWVyeSgnYm9keScpO1xuICAgICAgZWxlbWVudC5tb2RhbCh0aGlzLl9vcHRpb25zKTtcblxuICAgICAgdGhpcy5tb2RhbCA9IGVsZW1lbnQuZGF0YSgnbW9kYWwnKTtcbiAgICAgIHJldHVybiB0aGlzLm1vZGFsPy5lbGVtZW50O1xuICAgIH0pO1xuXG4gICAgLy8gQWRkIGxpc3RlbmVycyB0byBjb250cm9sIGV2ZW50c1xuICAgIHRoaXMualF1ZXJ5RWxlbWVudD8ub2ZmKCdjbG9zZScpLm9uKCdjbG9zZScsICgoZXZlbnQ6IGFueSwgaXNDYW5jZWxsZWQ6IGJvb2xlYW4pID0+IHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLm9uQ2xvc2UoZXZlbnQsIGlzQ2FuY2VsbGVkKSkpKTtcbiAgICB0aGlzLmpRdWVyeUVsZW1lbnQ/Lm9mZignYWZ0ZXJjbG9zZScpLm9uKCdhZnRlcmNsb3NlJywgKChldmVudDogYW55KSA9PiB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gdGhpcy5vbkFmdGVyQ2xvc2UoZXZlbnQpKSkpO1xuICAgIHRoaXMualF1ZXJ5RWxlbWVudD8ub2ZmKCdvcGVuJykub24oJ29wZW4nLCAoKGV2ZW50OiBhbnkpID0+IHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLm9uT3BlbihldmVudCkpKSk7XG4gICAgdGhpcy5qUXVlcnlFbGVtZW50Py5vZmYoJ2FmdGVyb3BlbicpLm9uKCdhZnRlcm9wZW4nLCAoKGV2ZW50OiBhbnkpID0+IHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLm9uQWZ0ZXJPcGVuKGV2ZW50KSkpKTtcblxuICAgIC8vIFRoZXNlIGFyZSB2ZXRvYWJsZSBldmVudHMuXG4gICAgdGhpcy5qUXVlcnlFbGVtZW50Py5vZmYoJ2JlZm9yZW9wZW4nKS5vbignYmVmb3Jlb3BlbicsICgoZXZlbnQ6IGFueSkgPT4gdGhpcy5uZ1pvbmUucnVuKCgpID0+IHRoaXMub25CZWZvcmVPcGVuKGV2ZW50KSkpKTtcbiAgICB0aGlzLmpRdWVyeUVsZW1lbnQ/Lm9mZignYmVmb3JlY2xvc2UnKS5vbignYmVmb3JlY2xvc2UnLCAoKGV2ZW50OiBhbnkpID0+IHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLm9uQmVmb3JlQ2xvc2UoZXZlbnQpKSkpO1xuICAgIHRoaXMualF1ZXJ5RWxlbWVudD8ub2ZmKCdiZWZvcmVkZXN0cm95Jykub24oJ2JlZm9yZWRlc3Ryb3knLCAoKGV2ZW50OiBhbnkpID0+IHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLm9uQmVmb3JlRGVzdHJveShldmVudCkpKSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDbG9zZXMgdGhlIG1vZGFsIGRpYWxvZywgaWYgb3Blbi4gIFRoZSBkaWFsb2cgaXMgbm90IGNsb3NlZFxuICAgKiBmdWxseSB1bnRpbCB0aGUgJ2FmdGVyQ2xvc2VkJyBldmVudCBpcyBmaXJlZC5cbiAgICpcbiAgICogQHBhcmFtIGRpYWxvZ1Jlc3VsdCAtIG9wdGlvbmFsIHJlc3VsdCAtIHBhc3NlZCBiYWNrIHRvIHRoZSBjYWxsZXIuXG4gICAqL1xuICBjbG9zZShkaWFsb2dSZXN1bHQ/OiBhbnkpOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4ge1xuICAgIHRoaXMuZGlhbG9nUmVzdWx0ID0gZGlhbG9nUmVzdWx0O1xuICAgIGlmICh0aGlzLm1vZGFsKSB7XG4gICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLm1vZGFsPy5jbG9zZShmYWxzZSwgZmFsc2UsIHRydWUpKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogRGVzdHJveXMgdGhlIG1vZGFsIGRpYWxvZy5cbiAgICovXG4gIGRlc3Ryb3koKTogU29ob01vZGFsRGlhbG9nUmVmPFQ+IHtcbiAgICB0aGlzLm1vZGFsPy5kZXN0cm95KCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gRXZlbnRzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlcnMgYSBiZWZvcmUgb3BlbiBndWFyZC5cbiAgICpcbiAgICogU09ITy00ODkyIC0gUmV0dXJuaW5nIGZhbHNlIGZyb20gYmVmb3JlT3BlbiBvciBiZWZvcmVEZXN0cm95IGJyZWFrcyBkaWFsb2dzXG4gICAqXG4gICAqIEBwYXJhbSBldmVudEZuIC0gdGhlIGZ1bmN0aW9uIHRvIGNhbGwgYmVmb3JlIG9wZW5uaW5nIHRoZSBkaWFsb2cuXG4gICAqL1xuICBiZWZvcmVPcGVuKGV2ZW50Rm46IChkaWFsb2dSZWY/OiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4pID0+IGJvb2xlYW4pOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4ge1xuICAgICh0aGlzLmV2ZW50R3VhcmQgYXMgYW55KS5iZWZvcmVPcGVuID0gZXZlbnRGbjtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBPcGVuZWQgRXZlbnQuXG4gICAqXG4gICAqIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiB0aGUgZGlhbG9nIGlzIGJlaW5nIG9wZW5lZC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50Rm4gLSB0aGUgZnVuY3Rpb24gdG8gaW52b2tlIHdoZW4gdGhlIGRpYWxvZyBpcyB0byBiZSBvcGVuZWQuXG4gICAqL1xuICBvcGVuZWQoZXZlbnRGbjogRnVuY3Rpb24pOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4ge1xuICAgIHRoaXMub3BlbiQucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95ZWQkKSkuc3Vic2NyaWJlKChmOiBhbnkpID0+IHtcbiAgICAgIGV2ZW50Rm4oZiwgdGhpcyk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogT3BlbmVkIEV2ZW50LlxuICAgKlxuICAgKiBUaGlzIGV2ZW50IGlzIGZpcmVkIGFmdGVyIHRoZSBkaWFsb2cgaGFzIGJlZW4gb3BlbmVkLlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnRGbiAtIHRoZSBmdW5jdGlvbiB0byBpbnZva2Ugd2hlbiB0aGUgZGlhbG9nIGlzIHRvIGJlIG9wZW5lZC5cbiAgICovXG4gIGFmdGVyT3BlbihldmVudEZuOiBGdW5jdGlvbik6IFNvaG9Nb2RhbERpYWxvZ1JlZjxUPiB7XG4gICAgdGhpcy5hZnRlck9wZW4kLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveWVkJCkpLnN1YnNjcmliZSgoZjogYW55KSA9PiB7XG4gICAgICBldmVudEZuKGYsIHRoaXMpO1xuICAgIH0pO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVycyBhIGJlZm9yZSBjbG9zZSBndWFyZC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50Rm4gLSB0aGUgZnVuY3Rpb24gdG8gY2FsbCBiZWZvcmUgY2xvc2luZyB0aGUgZGlhbG9nLlxuICAgKi9cbiAgYmVmb3JlQ2xvc2UoZXZlbnRGbjogU29ob01vZGFsRGlhbG9nRXZlbnRWZXRvRnVuY3Rpb248VD4pOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4ge1xuICAgICh0aGlzLmV2ZW50R3VhcmQgYXMgYW55KS5iZWZvcmVDbG9zZSA9IGV2ZW50Rm47XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogQ2xvc2VkIEV2ZW50LlxuICAgKlxuICAgKiBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gdGhlIGRpYWxvZyBpcyBiZWluZyBjbG9zZWQuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudEZuIC0gdGhlIGZ1bmN0aW9uIHRvIGludm9rZSB3aGVuIHRoZSBkaWFsb2cgaXMgdG8gYmUgY2xvc2VkLlxuICAgKi9cbiAgY2xvc2VkKGV2ZW50Rm46IFNvaG9Nb2RhbERpYWxvZ0V2ZW50RnVuY3Rpb248VD4pOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4ge1xuICAgIHRoaXMuY2xvc2UkLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveWVkJCkpLnN1YnNjcmliZSgoZjogYW55KSA9PiB7XG4gICAgICBldmVudEZuKGYsIHRoaXMsICh0aGlzLmNvbXBvbmVudERpYWxvZyBhcyBhbnkpKTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBBZnRlciBDbG9zZWQgRXZlbnQuXG4gICAqXG4gICAqIFRoaXMgZXZlbnQgaXMgZmlyZWQsIHdpdGggdGhlIHJlc3VsdCBvZiB0aGUgZGlhbG9nLCB3aGVuIHRoZSBkaWFsb2cgaGFzIGJlZW5cbiAgICogY2xvc2VkIGFuZCBkZXN0cm95ZWQuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudEZuIC0gdGhlIGZ1bmN0aW9uIHRvIGludm9rZSBhZnRlciB0aGUgZGlhbG9nIGhhcyBiZWVuIGNsb3NlZC5cbiAgICovXG4gIGFmdGVyQ2xvc2UoZXZlbnRGbjogU29ob01vZGFsRGlhbG9nRXZlbnRGdW5jdGlvbjxUPik6IFNvaG9Nb2RhbERpYWxvZ1JlZjxUPiB7XG4gICAgdGhpcy5hZnRlckNsb3NlJC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3llZCQpKS5zdWJzY3JpYmUoKHJlc3VsdDogYW55KSA9PiB7XG4gICAgICBldmVudEZuKHJlc3VsdCwgdGhpcywgKHRoaXMuY29tcG9uZW50RGlhbG9nIGFzIGFueSkpO1xuICAgIH0pO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVycyBhIGJlZm9yZSBkZXN0cm95IGd1YXJkLlxuICAgKlxuICAgKiBTT0hPLTQ4OTIgLSBSZXR1cm5pbmcgZmFsc2UgZnJvbSBiZWZvcmVPcGVuIG9yIGJlZm9yZURlc3Ryb3kgYnJlYWtzIGRpYWxvZ3NcbiAgICpcbiAgICogQHBhcmFtIGV2ZW50Rm4gLSB0aGUgZnVuY3Rpb24gdG8gY2FsbCBiZWZvcmUgZGVzdHJveWluZyB0aGUgZGlhbG9nLlxuICAgKi9cbiAgYmVmb3JlRGVzdHJveShldmVudEZuOiAoKSA9PiBib29sZWFuKTogU29ob01vZGFsRGlhbG9nUmVmPFQ+IHtcbiAgICAodGhpcy5ldmVudEd1YXJkIGFzIGFueSkuYmVmb3JlRGVzdHJveSA9IGV2ZW50Rm47XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEV2ZW50IEhhbmRsZXJzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvKipcbiAgICogSGFuZGxlcyB0aGUgJ2FmdGVyT3BlbicgZXZlbnQsIGZpcmVkIGFmdGVyIHRoZSBtb2RhbCBkaWFsb2dcbiAgICogaGFzIGJlZW4gb3BlbmVkLlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnQgLSBmdWxsIGV2ZW50IG9iamVjdC5cbiAgICovXG4gIHByaXZhdGUgb25BZnRlck9wZW4oZXZlbnQ6IGFueSkge1xuICAgIHRoaXMuYWZ0ZXJPcGVuJC5uZXh0KGV2ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGVzIHRoZSAnYmVmb3JlT3BlbicgZXZlbnQsIGZpcmVkIGJlZm9yZSB0aGUgbW9kYWwgZGlhbG9nXG4gICAqIGhhcyBiZWVuIG9wZW5lZC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IC0gZnVsbCBldmVudCBvYmplY3QuXG4gICAqXG4gICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgZGlhbG9nIGNhbiBiZSBvcGVuZWQ7IG90aGVyd2lzZSBmYWxzZSBpZiB2ZW90ZWQuXG4gICAqL1xuICBwcml2YXRlIG9uQmVmb3JlT3BlbihfZXZlbnQ6IGFueSk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGZuOiBGdW5jdGlvbiA9ICh0aGlzLmV2ZW50R3VhcmQ/LmJlZm9yZU9wZW4gYXMgYW55KTtcbiAgICByZXR1cm4gZm4gPyBmbi5jYWxsKHRoaXMuZXZlbnRHdWFyZCwgdGhpcykgOiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgdGhlICdiZWZvcmVDbG9zZScgZXZlbnQsIGZpcmVkIGJlZm9yZSB0aGUgbW9kYWwgZGlhbG9nXG4gICAqIGhhcyBiZWVuIGRlc3Ryb3llZC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IC0gZXZlbnQgb2JqZWN0LlxuICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGRpYWxvZyBjYW4gYmUgY2xvc2VkOyBvdGhlcndpc2UgZmFsc2UgaWYgdmVvdGVkLlxuICAgKi9cbiAgcHJpdmF0ZSBvbkJlZm9yZUNsb3NlKF9ldmVudDogYW55KTogYm9vbGVhbiB7XG4gICAgY29uc3QgZm46IEZ1bmN0aW9uID0gKCh0aGlzLmV2ZW50R3VhcmQgYXMgYW55KS5iZWZvcmVDbG9zZSBhcyBhbnkpO1xuICAgICh0aGlzLmV2ZW50R3VhcmQgYXMgYW55KS5pc0NhbmNlbGxlZCA9IHRoaXMubW9kYWw/LmlzQ2FuY2VsbGVkO1xuXG4gICAgcmV0dXJuIGZuID8gZm4uY2FsbCh0aGlzLmV2ZW50R3VhcmQsIHRoaXMpIDogdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGVzIHRoZSAnYmVmb3JlRGVzdHJveScgZXZlbnQsIGZpcmVkIGJlZm9yZSB0aGUgbW9kYWwgZGlhbG9nXG4gICAqIGhhcyBiZWVuIGRlc3Ryb3llZC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IC0gZXZlbnQgb2JqZWN0LlxuICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGRpYWxvZyBjYW4gYmUgZGVzdHJveWVkOyBvdGhlcndpc2UgZmFsc2UgaWYgdmVvdGVkLlxuICAgKi9cbiAgcHJpdmF0ZSBvbkJlZm9yZURlc3Ryb3koXzogYW55KTogYm9vbGVhbiB7XG4gICAgY29uc3QgZm46IEZ1bmN0aW9uID0gKHRoaXMuZXZlbnRHdWFyZD8uYmVmb3JlRGVzdHJveSBhcyBhbnkpO1xuICAgIGNvbnN0IGFsbG93ID0gZm4gPyBmbi5jYWxsKHRoaXMuZXZlbnRHdWFyZCkgOiB0cnVlO1xuXG4gICAgaWYgKGFsbG93KSB7XG4gICAgICAvLyBSZW1vdmUgYWxsIGV2ZW50cy5cbiAgICAgIGlmICh0aGlzLmpRdWVyeUVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5qUXVlcnlFbGVtZW50Lm9mZigpO1xuICAgICAgICB0aGlzLmpRdWVyeUVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmNvbXBvbmVudFJlZikge1xuICAgICAgICAgIHRoaXMuYXBwUmVmLmRldGFjaFZpZXcodGhpcy5jb21wb25lbnRSZWYuaG9zdFZpZXcpO1xuICAgICAgICAgIHRoaXMuY29tcG9uZW50UmVmLmRlc3Ryb3koKTtcbiAgICAgICAgICB0aGlzLmNvbXBvbmVudFJlZiA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUaWR5IHVwIGFsbCBzdWJzY3JpcHRpb25zLlxuICAgICAgICB0aGlzLmRlc3Ryb3llZCQubmV4dChfKTtcbiAgICAgICAgdGhpcy5kZXN0cm95ZWQkLmNvbXBsZXRlKCk7XG5cbiAgICAgICAgLy8gQ2xlYW4gdXAgcmVmZXJlbmNlc1xuICAgICAgICB0aGlzLmV2ZW50R3VhcmQgPSBudWxsO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBhbGxvdztcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGVzIHRoZSAnb3BlbicgZXZlbnQsIGZpcmVkIGp1c3QgYmVmb3JlXG4gICAqIHRoZSBmb2N1cyBpcyBhc3NpZ25lZCB0byBhIG1vZGFsLlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnQgLSBmdWxsIGV2ZW50IG9iamVjdC5cbiAgICovXG4gIHByaXZhdGUgb25PcGVuKGV2ZW50OiBhbnkpIHtcbiAgICB0aGlzLm9wZW4kLm5leHQoZXZlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgdGhlIGNsb3NlIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnQgLSBmdWxsIGV2ZW50IG9iamVjdC5cbiAgICogQHBhcmFtIGlzQ2FuY2VsbGVkIC0gaXMgdHJ1ZSBpZiB0aGUgY2FuY2VsIGJ1dHRvbiB3YXMgcHJlc3NlZDsgb3RoZXJ3aXNlIGZhbHNlLlxuICAgKi9cbiAgcHJpdmF0ZSBvbkNsb3NlKF9ldmVudDogYW55LCBpc0NhbmNlbGxlZDogYm9vbGVhbikge1xuICAgIHRoaXMuY2xvc2UkLm5leHQoaXNDYW5jZWxsZWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgdGhlICdhZnRlckNsb3NlJyBldmVudCwgZmlyZWQgd2hlbiB0aGUgZGlhbG9nXG4gICAqIGhhcyBiZWVuIGNsb3NlZCBhbmQgdGlkeSB1cCBpcyByZXF1aXJlZC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IC0gZnVsbCBldmVudCBvYmplY3QuXG4gICAqL1xuICBwcml2YXRlIG9uQWZ0ZXJDbG9zZShfZXZlbnQ6IGFueSkge1xuICAgIC8vIFBhc3MgdGhlIGRpYWxvZyByZXN1bHQgYmFjay5cbiAgICB0aGlzLmFmdGVyQ2xvc2UkLm5leHQodGhpcy5kaWFsb2dSZXN1bHQpO1xuICAgIHRoaXMuYWZ0ZXJDbG9zZSQuY29tcGxldGUoKTtcblxuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIC8vIG11c3QgZGVzdHJveSBiZWZvcmUgdHVybmluZyBvZmYganF1ZXJ5IGV2ZW50cy4gbW9kYWwuZGVzdHJveSByZWxpZXMgb25cbiAgICAgIC8vIHRoZSBvbkJlZm9yZURlc3Ryb3kgZXZlbnQuXG4gICAgICB0aGlzLm1vZGFsPy5kZXN0cm95KCk7XG4gICAgICB0aGlzLm1vZGFsID0gbnVsbDtcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIENsb3NlL0FmdGVyQ2xvc2UgZXZlbnQgaGFuZGxlci5cbiAqXG4gKiBAcGFyYW0gcmVzdWx0IC0gdGhlIGRpYWxvZyByZXN1bHQgKGlmIHNldCk7IG1heSBiZSB1bmRlZmluZWQuXG4gKiBAcGFyYW0gZGlhbG9nUmVmIC0gdGhlIGRpYWxvZyByZWZlcmVuY2UgKG9yIHdyYXBwZXIpOyBuZXZlciBudWxsLlxuICogQHBhcmFtIGRpYWxvZ0NvbXBvbmVudCAtIHRoZSBjb21wb25lbnQgaG9zdGVkIGluIHRoZSBtb2RhbDsgbWF5IGJlIHVuZGVmaW5lZC5cbiAqL1xuZXhwb3J0IHR5cGUgU29ob01vZGFsRGlhbG9nRXZlbnRGdW5jdGlvbjxUPiA9IChyZXN1bHQ6IGFueSwgZGlhbG9nUmVmOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4sIGRpYWxvZ0NvbXBvbmVudDogVCkgPT4gdm9pZDtcblxuLyoqXG4gKiBCZWZvcmVDbG9zZSBldmVudCBoYW5kbGVyLlxuICpcbiAqIEBwYXJhbSBkaWFsb2dSZWYgLSB0aGUgZGlhbG9nIHJlZmVyZW5jZTsgbmV2ZXIgbnVsbC5cbiAqL1xuZXhwb3J0IHR5cGUgU29ob01vZGFsRGlhbG9nRXZlbnRWZXRvRnVuY3Rpb248VD4gPSAoZGlhbG9nUmVmOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4pID0+IGJvb2xlYW47XG5cbi8qKlxuICogQ29udHJhY3QgZm9yIGFsbCBTb2hvTW9kYWxEaWFsb2dDb21wb25lbnRzLlxuICovXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWVtcHR5LWludGVyZmFjZVxuZXhwb3J0IGludGVyZmFjZSBTb2hvTW9kYWxDb21wb25lbnQ8VD4ge1xufVxuXG4vKipcbiAqIFZldG9hYmxlIEV2ZW50IEhhbmRsZXJzLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNvaG9Nb2RhbERpYWxvZ1ZldG9hYmxlRXZlbnRHdWFyZDxUPiB7XG5cbiAgLyoqXG4gICAqICBUcmFjayBpZiBjYW5jZWxsZWRcbiAgICovXG4gIGlzQ2FuY2VsbGVkPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogSW52b2tlZCBiZWZvcmUgYSBtb2RhbCBpcyBvcGVuZWQuXG4gICAqXG4gICAqIEByZXR1cm4gZmFsc2UgdG8gdmV0byB0aGUgb3BlbiBhY3Rpb247IG90aGVyd2lzZSB0cnVlLlxuICAgKi9cbiAgYmVmb3JlT3Blbj8oZGlhbG9nUmVmOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4pOiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBJbnZva2VkIGJlZm9yZSBhIG1vZGFsIGlzIGNsb3NlZCwgYWxsb3dpbmcgdGhlIGNsb3NlIHRvIGJlIHZldG9lZC5cbiAgICpcbiAgICogQHBhcmFtIHJlc3VsdCAtIHRoZSB2YWx1ZSBvZiB0aGUgZGlhbG9nIHJlc3VsdCwgcGFzc2VkIHRvIGNsb3NlIG9yIHNldC5cbiAgICogQHBhcmFtIGRpYWxvZ1JlZiAtIGEgcmVmZXJlbmNlIHRvIHRoZSBtb2RhbCBkaWFsb2cgd3JhcHBlci5cbiAgICogQHBhcmFtIGRpYWxvZ0NvbXBvbmVudCAtIHRoZSB1bmRlcmx5aW5nIGRpYWxvZyBjb21wb25lbnQgZGlzcGxheWVkIGluIHRoZSBkaWFsb2cuXG4gICAqIEByZXR1cm4gZmFsc2UgdG8gdmV0byB0aGUgY2xvc2UgYWN0aW9uOyBvdGhlcndpc2UgdHJ1ZS5cbiAgICovXG4gIGJlZm9yZUNsb3NlPyhyZXN1bHQ6IGFueSwgZGlhbG9nUmVmOiBTb2hvTW9kYWxEaWFsb2dSZWY8VD4sIGRpYWxvZ0NvbXBvbmVudDogVCk6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEludm9rZWQgYmVmb3JlIGEgbW9kYWwgaXMgb3BlbmVkLlxuICAgKlxuICAgKiBAcmV0dXJuIGZhbHNlIHRvIHZldG8gdGhlIGRlc3Ryb3kgYWN0aW9uOyBvdGhlcndpc2UgdHJ1ZS5cbiAgICovXG4gIGJlZm9yZURlc3Ryb3k/KCk6IGJvb2xlYW47XG59XG4iXX0=