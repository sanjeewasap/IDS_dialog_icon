import { ChangeDetectionStrategy, Component, EventEmitter, HostBinding, Input, Output, HostListener } from '@angular/core';
import { BaseControlValueAccessor, provideControlValueAccessor } from '../utils/base-control-value-accessor';
import * as i0 from "@angular/core";
export class SohoTextAreaComponent extends BaseControlValueAccessor {
    // -------------------------------------------
    // Component Input
    // -------------------------------------------
    set disabled(value) {
        this.isDisabled = value;
        if (this.textarea) {
            if (value) {
                this.textarea.disable();
                this.isDisabled = true;
            }
            else {
                this.textarea.enable();
                this.isDisabled = false;
                this.isReadOnly = false;
            }
            this.markForRefresh();
        }
    }
    get disabled() {
        return this.isDisabled;
    }
    set readonly(value) {
        this.isReadOnly = value;
        if (this.textarea) {
            if (value) {
                this.textarea.readonly();
                this.isReadOnly = true;
            }
            else {
                this.textarea.enable();
                this.isDisabled = false;
                this.isReadOnly = false;
            }
            this.markForRefresh();
        }
    }
    get readonly() {
        return this.isReadOnly;
    }
    set maxLength(maxLength) {
        this.options.maxLength = maxLength;
        if (this.textStatic) {
            this.textStatic.settings.maxLength = maxLength;
        }
        if (this.textarea) {
            this.markForRefresh();
        }
    }
    get maxLength() {
        return this.options.maxLength;
    }
    set autoGrow(autoGrow) {
        this.options.autoGrow = autoGrow;
        if (this.textStatic) {
            this.textStatic.settings.autoGrow = autoGrow;
        }
        if (this.textarea) {
            this.markForRefresh();
        }
    }
    get autoGrow() {
        return this.options.autoGrow;
    }
    set autoGrowMaxHeight(autoGrowMaxHeight) {
        this.options.autoGrowMaxHeight = autoGrowMaxHeight;
        if (this.textStatic) {
            this.textStatic.settings.autoGrowMaxHeight = autoGrowMaxHeight;
        }
        if (this.textarea) {
            this.markForRefresh();
        }
    }
    get autoGrowMaxHeight() {
        return this.options.autoGrowMaxHeight;
    }
    set attributes(attributes) {
        this.options.attributes = attributes;
        if (this.textStatic) {
            this.textStatic.settings.attributes = attributes;
        }
        if (this.textarea) {
            this.markForRefresh();
        }
    }
    get attributes() {
        return this.options.attributes;
    }
    set characterCounter(characterCounter) {
        this.options.characterCounter = characterCounter;
        if (this.textarea) {
            this.markForRefresh();
        }
    }
    set printable(printable) {
        this.options.printable = printable;
        if (this.textarea) {
            this.markForRefresh();
        }
    }
    set charRemainingText(charRemainingText) {
        this.options.charRemainingText = charRemainingText;
        if (this.textarea) {
            this.markForRefresh();
        }
    }
    set charMaxText(charMaxText) {
        this.options.charMaxText = charMaxText;
        if (this.textarea) {
            this.markForRefresh();
        }
    }
    /**
     * Specific host listener for textarea.
     *
     * @param textarea the HTML element
     */
    oninput(event, textarea) {
        this.internalValue = textarea.value;
        super.writeValue(this.internalValue);
        this.change.emit([event]);
    }
    constructor(element, ref, ngZone) {
        super();
        this.element = element;
        this.ref = ref;
        this.ngZone = ngZone;
        this.options = {};
        this.resizable = undefined;
        // -------------------------------------------
        // Component Output
        // -------------------------------------------
        /**
         * Called when the textarea updates in some way
         */
        this.updated = new EventEmitter();
        /**
         * @todo Change to 'changed'.
         */
        // eslint-disable-next-line @angular-eslint/no-output-native
        this.change = new EventEmitter();
    }
    ngAfterViewInit() {
        // Wrap the element in a jQuery selector.
        this.jQueryElement = jQuery(this.element.nativeElement);
        // Initialise the SohoXi Control
        this.jQueryElement.val(this.internalValue);
        this.jQueryElement.textarea(this.options);
        this.textarea = this.jQueryElement.data('textarea');
        if (this.isReadOnly) {
            this.textarea?.readonly();
        }
        if (this.isDisabled) {
            this.textarea?.disable();
        }
        if (this.internalValue) {
            this.jQueryElement.val(this.internalValue);
        }
        /**
         * Bind to jQueryElement's events
         */
        this.jQueryElement
            .on('change', (_e, args) => this.onChange(args))
            .on('updated', (_e, args) => this.updated.next(args));
        this.runUpdatedOnCheck = true;
    }
    ngAfterViewChecked() {
        if (this.runUpdatedOnCheck) {
            this.ngZone.runOutsideAngular(() => {
                if (this.textarea) {
                    this.textarea?.updated(this.options);
                }
                this.runUpdatedOnCheck = false;
            });
        }
    }
    /**
     * Handle the control being changed.
     */
    onChange(event) {
        if (!event) {
            // sometimes the event is not available
            this.internalValue = this.jQueryElement?.val();
            super.writeValue(this.internalValue);
            return;
        }
        this.change.emit(event);
    }
    /**
     * Override writeValue to allow the input to count correctly
     *
     * @param value - the new value
     */
    writeValue(value) {
        super.writeValue(value);
        if (this.jQueryElement) {
            this.jQueryElement.val(value);
            if (this.textarea) {
                this.textarea.updateCounter();
                this.textarea.autoGrow();
            }
        }
    }
    /**
     * This function is called when the control status changes to or from "DISABLED".
     * Depending on the value, it will enable or disable the appropriate DOM element.
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    /**
     * Marks the components as requiring a rebuild after the next update.
     */
    markForRefresh() {
        this.runUpdatedOnCheck = true;
        this.ref.markForCheck();
    }
    ngOnDestroy() {
        if (this.textarea) {
            this.textarea.destroy();
            this.textarea = null;
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoTextAreaComponent, deps: [{ token: i0.ElementRef }, { token: i0.ChangeDetectorRef }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: SohoTextAreaComponent, selector: "textarea[soho-textarea]", inputs: { disabled: "disabled", readonly: "readonly", resizable: "resizable", maxLength: "maxLength", autoGrow: "autoGrow", autoGrowMaxHeight: "autoGrowMaxHeight", attributes: "attributes", characterCounter: "characterCounter", printable: "printable", charRemainingText: "charRemainingText", charMaxText: "charMaxText" }, outputs: { updated: "updated", change: "change" }, host: { listeners: { "input": "oninput($event,$event.target)" }, properties: { "class.resizable": "this.resizable" } }, providers: [provideControlValueAccessor(SohoTextAreaComponent)], usesInheritance: true, ngImport: i0, template: '<ng-content></ng-content>', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoTextAreaComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'textarea[soho-textarea]',
                    template: '<ng-content></ng-content>',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [provideControlValueAccessor(SohoTextAreaComponent)]
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.ChangeDetectorRef }, { type: i0.NgZone }]; }, propDecorators: { disabled: [{
                type: Input
            }], readonly: [{
                type: Input
            }], resizable: [{
                type: HostBinding,
                args: ['class.resizable']
            }, {
                type: Input
            }], maxLength: [{
                type: Input
            }], autoGrow: [{
                type: Input
            }], autoGrowMaxHeight: [{
                type: Input
            }], attributes: [{
                type: Input
            }], characterCounter: [{
                type: Input
            }], printable: [{
                type: Input
            }], charRemainingText: [{
                type: Input
            }], charMaxText: [{
                type: Input
            }], updated: [{
                type: Output
            }], change: [{
                type: Output
            }], oninput: [{
                type: HostListener,
                args: ['input', ['$event', '$event.target']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby10ZXh0YXJlYS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9pZHMtZW50ZXJwcmlzZS1uZy9zcmMvbGliL3RleHRhcmVhL3NvaG8tdGV4dGFyZWEuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUVULFlBQVksRUFDWixXQUFXLEVBQ1gsS0FBSyxFQUVMLE1BQU0sRUFDTixZQUFZLEVBSWIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUNMLHdCQUF3QixFQUN4QiwyQkFBMkIsRUFDNUIsTUFBTSxzQ0FBc0MsQ0FBQzs7QUFROUMsTUFBTSxPQUFPLHFCQUFzQixTQUFRLHdCQUFnQztJQWdCekUsOENBQThDO0lBQzlDLGtCQUFrQjtJQUNsQiw4Q0FBOEM7SUFFOUMsSUFBYSxRQUFRLENBQUMsS0FBMEI7UUFDOUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7UUFFeEIsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2pCLElBQUksS0FBSyxFQUFFO2dCQUNULElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ3hCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO2FBQ3hCO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUM7Z0JBQ3ZCLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDO2dCQUN4QixJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQzthQUN6QjtZQUVELElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztTQUN2QjtJQUNILENBQUM7SUFFRCxJQUFJLFFBQVE7UUFDVixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDekIsQ0FBQztJQUVELElBQWEsUUFBUSxDQUFDLEtBQTBCO1FBQzlDLElBQUksQ0FBQyxVQUFV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dUJBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxFQUFFLGVBQWUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIElucHV0LFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbiAgSG9zdExpc3RlbmVyLFxuICBBZnRlclZpZXdDaGVja2VkLFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgTmdab25lXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgQmFzZUNvbnRyb2xWYWx1ZUFjY2Vzc29yLFxuICBwcm92aWRlQ29udHJvbFZhbHVlQWNjZXNzb3Jcbn0gZnJvbSAnLi4vdXRpbHMvYmFzZS1jb250cm9sLXZhbHVlLWFjY2Vzc29yJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGV4dGFyZWFbc29oby10ZXh0YXJlYV0nLCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIHRlbXBsYXRlOiAnPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PicsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBwcm92aWRlcnM6IFtwcm92aWRlQ29udHJvbFZhbHVlQWNjZXNzb3IoU29ob1RleHRBcmVhQ29tcG9uZW50KV1cbn0pXG5leHBvcnQgY2xhc3MgU29ob1RleHRBcmVhQ29tcG9uZW50IGV4dGVuZHMgQmFzZUNvbnRyb2xWYWx1ZUFjY2Vzc29yPHN0cmluZz4gaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBBZnRlclZpZXdDaGVja2VkLCBPbkRlc3Ryb3kge1xuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gT3B0aW9ucyBCbG9ja1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgcHJpdmF0ZSB0ZXh0U3RhdGljPzogU29ob1RleHRBcmVhU3RhdGljO1xuICBwcml2YXRlIG9wdGlvbnM6IFNvaG9UZXh0QXJlYU9wdGlvbnMgPSB7fTtcblxuICAvKipcbiAgICogTG9jYWwgdmFyaWFibGVzXG4gICAqL1xuICBwcml2YXRlIGlzRGlzYWJsZWQ/OiBib29sZWFuO1xuICBwcml2YXRlIGlzUmVhZE9ubHk/OiBib29sZWFuO1xuICBwcml2YXRlIHJ1blVwZGF0ZWRPbkNoZWNrPzogYm9vbGVhbjtcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIENvbXBvbmVudCBJbnB1dFxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgQElucHV0KCkgc2V0IGRpc2FibGVkKHZhbHVlOiBib29sZWFuIHwgdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5pc0Rpc2FibGVkID0gdmFsdWU7XG5cbiAgICBpZiAodGhpcy50ZXh0YXJlYSkge1xuICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgIHRoaXMudGV4dGFyZWEuZGlzYWJsZSgpO1xuICAgICAgICB0aGlzLmlzRGlzYWJsZWQgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5lbmFibGUoKTtcbiAgICAgICAgdGhpcy5pc0Rpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNSZWFkT25seSA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGRpc2FibGVkKCk6IGJvb2xlYW4gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmlzRGlzYWJsZWQ7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgcmVhZG9ubHkodmFsdWU6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLmlzUmVhZE9ubHkgPSB2YWx1ZTtcblxuICAgIGlmICh0aGlzLnRleHRhcmVhKSB7XG4gICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5yZWFkb25seSgpO1xuICAgICAgICB0aGlzLmlzUmVhZE9ubHkgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5lbmFibGUoKTtcbiAgICAgICAgdGhpcy5pc0Rpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaXNSZWFkT25seSA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IHJlYWRvbmx5KCk6IGJvb2xlYW4gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmlzUmVhZE9ubHk7XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLnJlc2l6YWJsZScpXG4gIEBJbnB1dCgpIHJlc2l6YWJsZT86IGJvb2xlYW4gPSB1bmRlZmluZWQ7XG5cbiAgQElucHV0KCkgc2V0IG1heExlbmd0aChtYXhMZW5ndGg6IG51bWJlciB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMub3B0aW9ucy5tYXhMZW5ndGggPSBtYXhMZW5ndGg7XG4gICAgaWYgKHRoaXMudGV4dFN0YXRpYykge1xuICAgICAgdGhpcy50ZXh0U3RhdGljLnNldHRpbmdzLm1heExlbmd0aCA9IG1heExlbmd0aDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy50ZXh0YXJlYSkge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIGdldCBtYXhMZW5ndGgoKTogbnVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLm1heExlbmd0aDtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBhdXRvR3JvdyhhdXRvR3JvdzogYm9vbGVhbiB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMub3B0aW9ucy5hdXRvR3JvdyA9IGF1dG9Hcm93O1xuICAgIGlmICh0aGlzLnRleHRTdGF0aWMpIHtcbiAgICAgIHRoaXMudGV4dFN0YXRpYy5zZXR0aW5ncy5hdXRvR3JvdyA9IGF1dG9Hcm93O1xuICAgIH1cblxuICAgIGlmICh0aGlzLnRleHRhcmVhKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGF1dG9Hcm93KCk6IGJvb2xlYW4gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnMuYXV0b0dyb3c7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgYXV0b0dyb3dNYXhIZWlnaHQoYXV0b0dyb3dNYXhIZWlnaHQ6IG51bWJlciB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMub3B0aW9ucy5hdXRvR3Jvd01heEhlaWdodCA9IGF1dG9Hcm93TWF4SGVpZ2h0O1xuICAgIGlmICh0aGlzLnRleHRTdGF0aWMpIHtcbiAgICAgIHRoaXMudGV4dFN0YXRpYy5zZXR0aW5ncy5hdXRvR3Jvd01heEhlaWdodCA9IGF1dG9Hcm93TWF4SGVpZ2h0O1xuICAgIH1cblxuICAgIGlmICh0aGlzLnRleHRhcmVhKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGF1dG9Hcm93TWF4SGVpZ2h0KCk6IG51bWJlciB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5hdXRvR3Jvd01heEhlaWdodDtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBhdHRyaWJ1dGVzKGF0dHJpYnV0ZXM6IEFycmF5PE9iamVjdD4gfCBPYmplY3QgfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXM7XG4gICAgaWYgKHRoaXMudGV4dFN0YXRpYykge1xuICAgICAgdGhpcy50ZXh0U3RhdGljLnNldHRpbmdzLmF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnRleHRhcmVhKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG4gIGdldCBhdHRyaWJ1dGVzKCkge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnMuYXR0cmlidXRlcztcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBjaGFyYWN0ZXJDb3VudGVyKGNoYXJhY3RlckNvdW50ZXI6IGJvb2xlYW4pIHtcbiAgICB0aGlzLm9wdGlvbnMuY2hhcmFjdGVyQ291bnRlciA9IGNoYXJhY3RlckNvdW50ZXI7XG5cbiAgICBpZiAodGhpcy50ZXh0YXJlYSkge1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBwcmludGFibGUocHJpbnRhYmxlOiBib29sZWFuKSB7XG4gICAgdGhpcy5vcHRpb25zLnByaW50YWJsZSA9IHByaW50YWJsZTtcblxuICAgIGlmICh0aGlzLnRleHRhcmVhKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IGNoYXJSZW1haW5pbmdUZXh0KGNoYXJSZW1haW5pbmdUZXh0OiBzdHJpbmcpIHtcbiAgICB0aGlzLm9wdGlvbnMuY2hhclJlbWFpbmluZ1RleHQgPSBjaGFyUmVtYWluaW5nVGV4dDtcblxuICAgIGlmICh0aGlzLnRleHRhcmVhKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IGNoYXJNYXhUZXh0KGNoYXJNYXhUZXh0OiBzdHJpbmcpIHtcbiAgICB0aGlzLm9wdGlvbnMuY2hhck1heFRleHQgPSBjaGFyTWF4VGV4dDtcblxuICAgIGlmICh0aGlzLnRleHRhcmVhKSB7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBDb21wb25lbnQgT3V0cHV0XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvKipcbiAgICogQ2FsbGVkIHdoZW4gdGhlIHRleHRhcmVhIHVwZGF0ZXMgaW4gc29tZSB3YXlcbiAgICovXG4gIEBPdXRwdXQoKSB1cGRhdGVkID0gbmV3IEV2ZW50RW1pdHRlcjxTb2hvVGV4dEFyZWFFdmVudD4oKTtcblxuICAvKipcbiAgICogQHRvZG8gQ2hhbmdlIHRvICdjaGFuZ2VkJy5cbiAgICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LW5hdGl2ZVxuICBAT3V0cHV0KCkgY2hhbmdlOiBFdmVudEVtaXR0ZXI8U29ob1RleHRBcmVhRXZlbnRbXT4gPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9UZXh0QXJlYUV2ZW50W10+KCk7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBQdWJsaWMgQVBJXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gUHJpdmF0ZSBNZW1iZXIgRGF0YVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLy8gUmVmZXJlbmNlIHRvIHRoZSBqUXVlcnkgY29udHJvbC5cbiAgcHJpdmF0ZSBqUXVlcnlFbGVtZW50PzogSlF1ZXJ5O1xuXG4gIC8vIFJlZmVyZW5jZSB0byB0aGUgU29Ib1hpIGNvbnRyb2wgYXBpLlxuICBwcml2YXRlIHRleHRhcmVhPzogU29ob1RleHRBcmVhU3RhdGljIHwgbnVsbDtcblxuICAvKipcbiAgICogU3BlY2lmaWMgaG9zdCBsaXN0ZW5lciBmb3IgdGV4dGFyZWEuXG4gICAqXG4gICAqIEBwYXJhbSB0ZXh0YXJlYSB0aGUgSFRNTCBlbGVtZW50XG4gICAqL1xuICBASG9zdExpc3RlbmVyKCdpbnB1dCcsIFsnJGV2ZW50JywgJyRldmVudC50YXJnZXQnXSkgb25pbnB1dChldmVudDogU29ob1RleHRBcmVhRXZlbnQsIHRleHRhcmVhOiBIVE1MVGV4dEFyZWFFbGVtZW50KSB7XG4gICAgdGhpcy5pbnRlcm5hbFZhbHVlID0gdGV4dGFyZWEudmFsdWU7XG4gICAgc3VwZXIud3JpdGVWYWx1ZSh0aGlzLmludGVybmFsVmFsdWUpO1xuICAgIHRoaXMuY2hhbmdlLmVtaXQoW2V2ZW50XSk7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGVsZW1lbnQ6IEVsZW1lbnRSZWYsXG4gICAgcHVibGljIHJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSxcbiAgKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAvLyBXcmFwIHRoZSBlbGVtZW50IGluIGEgalF1ZXJ5IHNlbGVjdG9yLlxuICAgIHRoaXMualF1ZXJ5RWxlbWVudCA9IGpRdWVyeSh0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCk7XG5cbiAgICAvLyBJbml0aWFsaXNlIHRoZSBTb2hvWGkgQ29udHJvbFxuICAgIHRoaXMualF1ZXJ5RWxlbWVudC52YWwoKHRoaXMuaW50ZXJuYWxWYWx1ZSBhcyBhbnkpKTtcbiAgICB0aGlzLmpRdWVyeUVsZW1lbnQudGV4dGFyZWEodGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLnRleHRhcmVhID0gdGhpcy5qUXVlcnlFbGVtZW50LmRhdGEoJ3RleHRhcmVhJyk7XG5cbiAgICBpZiAodGhpcy5pc1JlYWRPbmx5KSB7XG4gICAgICB0aGlzLnRleHRhcmVhPy5yZWFkb25seSgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzRGlzYWJsZWQpIHtcbiAgICAgIHRoaXMudGV4dGFyZWE/LmRpc2FibGUoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pbnRlcm5hbFZhbHVlKSB7XG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQudmFsKHRoaXMuaW50ZXJuYWxWYWx1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQmluZCB0byBqUXVlcnlFbGVtZW50J3MgZXZlbnRzXG4gICAgICovXG4gICAgdGhpcy5qUXVlcnlFbGVtZW50XG4gICAgICAub24oJ2NoYW5nZScsIChfZTogYW55LCBhcmdzOiBhbnlbXSkgPT4gdGhpcy5vbkNoYW5nZShhcmdzKSlcbiAgICAgIC5vbigndXBkYXRlZCcsIChfZTogYW55LCBhcmdzOiBTb2hvVGV4dEFyZWFFdmVudCkgPT4gdGhpcy51cGRhdGVkLm5leHQoYXJncykpO1xuICAgIFxuICAgIHRoaXMucnVuVXBkYXRlZE9uQ2hlY2sgPSB0cnVlO1xuICB9XG5cbiAgbmdBZnRlclZpZXdDaGVja2VkKCkge1xuICAgIGlmICh0aGlzLnJ1blVwZGF0ZWRPbkNoZWNrKSB7XG4gICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnRleHRhcmVhKSB7XG4gICAgICAgICAgdGhpcy50ZXh0YXJlYT8udXBkYXRlZCh0aGlzLm9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucnVuVXBkYXRlZE9uQ2hlY2sgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgdGhlIGNvbnRyb2wgYmVpbmcgY2hhbmdlZC5cbiAgICovXG4gIG9uQ2hhbmdlKGV2ZW50OiBhbnlbXSkge1xuICAgIGlmICghZXZlbnQpIHtcbiAgICAgIC8vIHNvbWV0aW1lcyB0aGUgZXZlbnQgaXMgbm90IGF2YWlsYWJsZVxuICAgICAgdGhpcy5pbnRlcm5hbFZhbHVlID0gdGhpcy5qUXVlcnlFbGVtZW50Py52YWwoKSBhcyBzdHJpbmc7XG4gICAgICBzdXBlci53cml0ZVZhbHVlKHRoaXMuaW50ZXJuYWxWYWx1ZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5jaGFuZ2UuZW1pdChldmVudCk7XG4gIH1cblxuICAvKipcbiAgICogT3ZlcnJpZGUgd3JpdGVWYWx1ZSB0byBhbGxvdyB0aGUgaW5wdXQgdG8gY291bnQgY29ycmVjdGx5XG4gICAqXG4gICAqIEBwYXJhbSB2YWx1ZSAtIHRoZSBuZXcgdmFsdWVcbiAgICovXG4gIHdyaXRlVmFsdWUodmFsdWU6IGFueSkge1xuICAgIHN1cGVyLndyaXRlVmFsdWUodmFsdWUpO1xuXG4gICAgaWYgKHRoaXMualF1ZXJ5RWxlbWVudCkge1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50LnZhbCh2YWx1ZSk7XG4gICAgICBpZiAodGhpcy50ZXh0YXJlYSkge1xuICAgICAgICB0aGlzLnRleHRhcmVhLnVwZGF0ZUNvdW50ZXIoKTtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5hdXRvR3JvdygpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIHRoZSBjb250cm9sIHN0YXR1cyBjaGFuZ2VzIHRvIG9yIGZyb20gXCJESVNBQkxFRFwiLlxuICAgKiBEZXBlbmRpbmcgb24gdGhlIHZhbHVlLCBpdCB3aWxsIGVuYWJsZSBvciBkaXNhYmxlIHRoZSBhcHByb3ByaWF0ZSBET00gZWxlbWVudC5cbiAgICovXG4gIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIE1hcmtzIHRoZSBjb21wb25lbnRzIGFzIHJlcXVpcmluZyBhIHJlYnVpbGQgYWZ0ZXIgdGhlIG5leHQgdXBkYXRlLlxuICAgKi9cbiAgIG1hcmtGb3JSZWZyZXNoKCkge1xuICAgIHRoaXMucnVuVXBkYXRlZE9uQ2hlY2sgPSB0cnVlO1xuICAgIHRoaXMucmVmLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMudGV4dGFyZWEpIHtcbiAgICAgIHRoaXMudGV4dGFyZWEuZGVzdHJveSgpO1xuICAgICAgdGhpcy50ZXh0YXJlYSA9IG51bGw7XG4gICAgfVxuICB9XG59XG4iXX0=