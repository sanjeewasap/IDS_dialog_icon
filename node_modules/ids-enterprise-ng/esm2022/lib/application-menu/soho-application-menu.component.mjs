import { ChangeDetectionStrategy, Component, EventEmitter, HostBinding, Input, Output, } from '@angular/core';
import * as i0 from "@angular/core";
/**
 * Angular Wrapper for the Soho Application Menu Component.
 *
 * This component searches for a nav element with the attribute
 * 'soho-applcation-menu' in the parent's DOM tree, initialising those found with
 * the Soho application menu control.
 */
export class SohoApplicationMenuComponent {
    /** Sets Open on resize */
    set openOnLarge(openOnLarge) {
        this._openOnLarge = openOnLarge;
        if (this.applicationmenu) {
            this.applicationmenu.settings.openOnLarge = this._openOnLarge;
            this.updateRequired = true;
        }
    }
    get openOnLarge() {
        if (this.applicationmenu) {
            return this.applicationmenu.settings.openOnLarge;
        }
        // If called before the component has completed
        // initialisation, return the current value from the
        // options.
        return this._openOnLarge;
    }
    /** Allows the menu to become closed after an actionable header has been selected */
    set dismissOnClickMobile(dismissOnClickMobile) {
        this._dismissOnClickMobile = dismissOnClickMobile;
        if (this.applicationmenu) {
            this.applicationmenu.settings.dismissOnClickMobile = this._dismissOnClickMobile;
            this.updateRequired = true;
        }
    }
    get dismissOnClickMobile() {
        if (this.applicationmenu) {
            return this.applicationmenu.settings.dismissOnClickMobile;
        }
        // If called before the component has completed
        // initialisation, return the current value from the
        // options.
        return this._dismissOnClickMobile;
    }
    /** A list of jQuery elements which trigger the openning and closing application menu. */
    set triggers(triggers) {
        if (triggers) {
            let i = triggers.length;
            while (i--) {
                this._triggers.push(jQuery(triggers[i]));
            }
            if (this.applicationmenu) {
                this.applicationmenu.settings.triggers = this._triggers;
                this.updateRequired = true;
            }
        }
    }
    /**
     * Is the application menu resizable?
     */
    set resizable(resizable) {
        this._resizable = resizable;
        if (this.applicationmenu) {
            this.applicationmenu.settings.resizable = this._resizable;
        }
    }
    get resizable() {
        if (this.applicationmenu) {
            return this.applicationmenu.settings.resizable;
        }
        return this._resizable;
    }
    /**
     * Resizeable Save Position Settings
     */
    set savePosition(savePosition) {
        this._savePosition = savePosition;
        if (this.applicationmenu) {
            this.applicationmenu.settings.resizable = this._savePosition;
        }
    }
    get savePosition() {
        if (this.applicationmenu) {
            return this.applicationmenu.settings.savePosition;
        }
        return this._savePosition;
    }
    /**
     *
     * @param expandSwitcher
     * Menu switcher expand setting to provide callback
     */
    set onExpandSwitcher(expandSwitcher) {
        this._onExpandSwitcher = expandSwitcher;
        if (this.applicationmenu) {
            this.applicationmenu.settings.onExpandSwitcher = this._onExpandSwitcher;
            this.updateRequired = true;
        }
    }
    /**
     *
     * @param collapseSwitcher
     * Menu switcher collapse setting to provide callback
     */
    set onCollapseSwitcher(collapseSwitcher) {
        this._onCollapseSwitcher = collapseSwitcher;
        if (this.applicationmenu) {
            this.applicationmenu.settings.onCollapseSwitcher = this._onCollapseSwitcher;
            this.updateRequired = true;
        }
    }
    /**
     * This will let the Soho controls bind the application menu trigger naturally
     */
    get menuId() {
        return 'application-menu';
    }
    // Constructor.
    constructor(elementRef, ngZone) {
        this.elementRef = elementRef;
        this.ngZone = ngZone;
        // -------------------------------------------
        // Host Bindings
        // -------------------------------------------
        this.appMenu = true;
        this.isPersonalizable = false;
        /** List of jQuery triggers. */
        this._triggers = [];
        /**
         * This event is fired when the visibility of the application menu is changed,
         * is it also called when the item is changed programmatically.
         *
         * @deprecated use accordionExpand and accordionCollapse events instead
         */
        this.visibility = new EventEmitter();
        /**
         * This event is fired when a menu accordion is expamded
         * The event include the anchor element.
         */
        this.accordionExpand = new EventEmitter();
        /**
         * This event is fired when a menu accordion is collapsed
         */
        this.accordionCollapse = new EventEmitter();
        /** This event is fired when the visibility of the application menu is changed */
        this.menuVisibility = new EventEmitter();
        /** This event is fired when the application menu is filtered. */
        this.filtered = new EventEmitter();
        /** flag the need to update the soho/ep control in ngAfterViewChecked. */
        this.updateRequired = false;
    }
    // -------------------------------------------
    // Public API
    // -------------------------------------------
    /**
     * Close the menu.
     */
    closeMenu() {
        this.ngZone.runOutsideAngular(() => this.applicationmenu?.closeMenu());
    }
    /** Open the menu. */
    openMenu(noFocus, userOpened, openedByClass) {
        this.ngZone.runOutsideAngular(() => this.applicationmenu?.openMenu(noFocus, userOpened, openedByClass));
    }
    /**
     * Returns true if the menu is open, otherwise false.
     */
    isOpen() {
        return this.ngZone.runOutsideAngular(() => this.applicationmenu?.isOpen());
    }
    /**
     * Notifies application menu that it has been updated
     */
    updated() {
        this.ngZone.runOutsideAngular(() => this.applicationmenu?.updated());
    }
    /**
     * Closes the panel area controlled by switcher
     */
    closeSwitcherPanel() {
        this.ngZone.runOutsideAngular(() => this.applicationmenu?.closeSwitcherPanel());
    }
    /*
     * Updates Accordion when menus have been lazily loaded
     * TODO: Ed or Tim, there doesn't appear to be a public function for something like this
     * from applicationmenu.js. This is my current work arround (Kris Holleneck)
     */
    updateLazy(applicationMenu, target) {
        const $applicationMenu = jQuery(applicationMenu.elementRef.nativeElement).data('applicationmenu');
        const $accordion = $applicationMenu.accordion;
        const accordion = $accordion.data('accordion');
        this.ngZone.runOutsideAngular(() => {
            setTimeout(() => {
                accordion.updated();
                const header = jQuery(target).closest('.accordion-header');
                accordion.expand(header);
            }, 1);
        });
    }
    /*
     * Toggle and select a specific header
     */
    toggleAndSelectHeader(applicationMenu, header) {
        const $applicationMenu = jQuery(applicationMenu.elementRef.nativeElement).data('applicationmenu');
        const $accordion = $applicationMenu.accordion;
        const accordion = $accordion.data('accordion');
        accordion.headers = $accordion.find('.accordion-header');
        this.ngZone.runOutsideAngular(() => {
            accordion.updated();
            accordion.toggle(jQuery(header));
            accordion.select(jQuery(header));
        });
    }
    // ------------------------------------------
    // Lifecycle Events
    // ------------------------------------------
    ngAfterViewInit() {
        this.ngZone.runOutsideAngular(() => {
            // Wrap for later.
            this.jQueryElement = jQuery(this.elementRef.nativeElement);
            const options = {
                breakpoint: this.breakpoint,
                dismissOnClickMobile: this._dismissOnClickMobile,
                openOnLarge: this._openOnLarge,
                triggers: this._triggers,
                filterable: this.filterable,
                resizable: this._resizable,
                savePosition: this._savePosition,
                onExpandSwitcher: this._onExpandSwitcher,
                onCollapseSwitcher: this._onCollapseSwitcher
            };
            // Initialise the SoHoXi control.
            this.jQueryElement.applicationmenu(options);
            // Once the control is initialised, extract the control
            // plug-in from the element.  The element name is
            // defined by the plug-in, but in this case is 'expandablearea'.
            this.applicationmenu = this.jQueryElement.data('applicationmenu');
            // Initialise any event handlers.
            this.jQueryElement
                .on('expand', (_e, results) => this.ngZone.run(() => this.accordionExpand.next(results)))
                .on('collapse', () => this.ngZone.run(() => this.accordionCollapse.next(true)))
                .on('expand', () => this.ngZone.run(() => this.visibility.next(true)))
                .on('collapse', () => this.ngZone.run(() => this.visibility.next(false)))
                .on('filtered', (_e, results) => this.ngZone.run(() => this.filtered.next(results)))
                .on('applicationmenuopen', () => this.ngZone.run(() => this.menuVisibility.next(true)))
                .on('applicationmenuclose', () => this.ngZone.run(() => this.menuVisibility.next(false)));
        });
    }
    ngAfterViewChecked() {
        if (this.applicationmenu && this.updateRequired) {
            this.ngZone.runOutsideAngular(() => this.applicationmenu?.updated());
            this.updateRequired = false;
        }
    }
    /**
     * Destructor.
     */
    ngOnDestroy() {
        // call outside the angular zone so change detection isn't triggered by the soho component.
        this.ngZone.runOutsideAngular(() => {
            if (this.jQueryElement) {
                this.jQueryElement.off();
                this.jQueryElement = undefined;
            }
            if (this.applicationmenu) {
                this.applicationmenu.destroy();
                this.applicationmenu = null;
            }
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoApplicationMenuComponent, deps: [{ token: i0.ElementRef }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: SohoApplicationMenuComponent, selector: "nav[soho-application-menu]", inputs: { breakpoint: "breakpoint", openOnLarge: "openOnLarge", dismissOnClickMobile: "dismissOnClickMobile", triggers: "triggers", filterable: "filterable", resizable: "resizable", savePosition: "savePosition", onExpandSwitcher: "onExpandSwitcher", onCollapseSwitcher: "onCollapseSwitcher", isPersonalizable: "isPersonalizable" }, outputs: { visibility: "visibility", accordionExpand: "accordionExpand", accordionCollapse: "accordionCollapse", menuVisibility: "menuVisibility", filtered: "filtered" }, host: { properties: { "class.application-menu": "this.appMenu", "class.is-personalizable": "this.isPersonalizable", "id": "this.menuId" } }, ngImport: i0, template: "<ng-content></ng-content>\n", changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoApplicationMenuComponent, decorators: [{
            type: Component,
            args: [{ selector: 'nav[soho-application-menu]', changeDetection: ChangeDetectionStrategy.OnPush, template: "<ng-content></ng-content>\n" }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.NgZone }]; }, propDecorators: { breakpoint: [{
                type: Input
            }], openOnLarge: [{
                type: Input
            }], dismissOnClickMobile: [{
                type: Input
            }], triggers: [{
                type: Input
            }], filterable: [{
                type: Input
            }], resizable: [{
                type: Input
            }], savePosition: [{
                type: Input
            }], onExpandSwitcher: [{
                type: Input
            }], onCollapseSwitcher: [{
                type: Input
            }], appMenu: [{
                type: HostBinding,
                args: ['class.application-menu']
            }], isPersonalizable: [{
                type: HostBinding,
                args: ['class.is-personalizable']
            }, {
                type: Input
            }], menuId: [{
                type: HostBinding,
                args: ['id']
            }], visibility: [{
                type: Output
            }], accordionExpand: [{
                type: Output
            }], accordionCollapse: [{
                type: Output
            }], menuVisibility: [{
                type: Output
            }], filtered: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1hcHBsaWNhdGlvbi1tZW51LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2lkcy1lbnRlcnByaXNlLW5nL3NyYy9saWIvYXBwbGljYXRpb24tbWVudS9zb2hvLWFwcGxpY2F0aW9uLW1lbnUuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvaWRzLWVudGVycHJpc2Utbmcvc3JjL2xpYi9hcHBsaWNhdGlvbi1tZW51L3NvaG8tYXBwbGljYXRpb24tbWVudS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBR0wsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFFVCxZQUFZLEVBQ1osV0FBVyxFQUNYLEtBQUssRUFFTCxNQUFNLEdBRVAsTUFBTSxlQUFlLENBQUM7O0FBRXZCOzs7Ozs7R0FNRztBQU1ILE1BQU0sT0FBTyw0QkFBNEI7SUFTdkMsMEJBQTBCO0lBQzFCLElBQW9CLFdBQVcsQ0FBQyxXQUFnQztRQUM5RCxJQUFJLENBQUMsWUFBWSxHQUFHLFdBQVcsQ0FBQztRQUVoQyxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDeEIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUM7WUFDOUQsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7U0FDNUI7SUFDSCxDQUFDO0lBRUQsSUFBVyxXQUFXO1FBQ3BCLElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUN4QixPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQztTQUNsRDtRQUVELCtDQUErQztRQUMvQyxvREFBb0Q7UUFDcEQsV0FBVztRQUNYLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQztJQUMzQixDQUFDO0lBRUQsb0ZBQW9GO0lBQ3BGLElBQW9CLG9CQUFvQixDQUFDLG9CQUF5QztRQUNoRixJQUFJLENBQUMscUJBQXFCLEdBQUcsb0JBQW9CLENBQUM7UUFFbEQsSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFO1lBQ3hCLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLG9CQUFvQixHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQztZQUNoRixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztTQUM1QjtJQUNILENBQUM7SUFFRCxJQUFXLG9CQUFvQjtRQUM3QixJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDeEIsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQztTQUMzRDtRQUVELCtDQUErQztRQUMvQyxvREFBb0Q7UUFDcEQsV0FBVztRQUNYLE9BQU8sSUFBSSxDQUFDLHFCQUFxQixDQUFDO0lBQ3BDLENBQUM7SUFFRCx5RkFBeUY7SUFDekYsSUFBb0IsUUFBUSxDQUFDLFFBQWtCO1FBRTdDLElBQUksUUFBUSxFQUFFO1lBQ1osSUFBSSxDQUFDLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQztZQUN4QixPQUFPLENBQUMsRUFBRSxFQUFFO2dCQUNWLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzFDO1lBRUQsSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFO2dCQUN4QixJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztnQkFDeEQsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7YUFDNUI7U0FDRjtJQUNILENBQUM7SUFPRDs7T0FFRztJQUNILElBQW9CLFNBQVMsQ0FBQyxTQUE4QjtRQUMxRCxJQUFJLENBQUMsVUFBVSxHQUFHLFNBQVMsQ0FBQztRQUM1QixJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDeEIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUM7U0FDM0Q7SUFDSCxDQUFDO0lBRUQsSUFBVyxTQUFTO1FBQ2xCLElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUN4QixPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQztTQUNoRDtRQUVELE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUN6QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFvQixZQUFZLENBQUMsWUFBaUM7UUFDaEUsSUFBSSxDQUFDLGFBQWEsR0FBRyxZQUFZLENBQUM7UUFDbEMsSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFO1lBQ3hCLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDO1NBQzlEO0lBQ0gsQ0FBQztJQUVELElBQVcsWUFBWTtRQUNyQixJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDeEIsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUM7U0FDbkQ7UUFFRCxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUM7SUFDNUIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxJQUNXLGdCQUFnQixDQUFDLGNBQXlEO1FBQ25GLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxjQUFjLENBQUM7UUFDeEMsSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFO1lBQ3hCLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQztZQUN4RSxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztTQUM1QjtJQUNILENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsSUFDVyxrQkFBa0IsQ0FBQyxnQkFBNkQ7UUFDekYsSUFBSSxDQUFDLG1CQUFtQixHQUFHLGdCQUFnQixDQUFDO1FBQzVDLElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUN4QixJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDNUUsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7U0FDNUI7SUFDSCxDQUFDO0lBVUQ7O09BRUc7SUFDSCxJQUF1QixNQUFNO1FBQzNCLE9BQU8sa0JBQWtCLENBQUM7SUFDNUIsQ0FBQztJQTJERCxlQUFlO0lBQ2YsWUFDVSxVQUFzQixFQUN0QixNQUFjO1FBRGQsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN0QixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBM0V4Qiw4Q0FBOEM7UUFDOUMsZ0JBQWdCO1FBQ2hCLDhDQUE4QztRQUVQLFlBQU8sR0FBRyxJQUFJLENBQUM7UUFFTCxxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFtQjFFLCtCQUErQjtRQUN2QixjQUFTLEdBQWUsRUFBRSxDQUFDO1FBa0JuQzs7Ozs7V0FLRztRQUNPLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBRS9DOzs7V0FHRztRQUNPLG9CQUFlLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUVwRDs7V0FFRztRQUNPLHNCQUFpQixHQUFHLElBQUksWUFBWSxFQUFXLENBQUM7UUFFMUQsaUZBQWlGO1FBQ3ZFLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQVcsQ0FBQztRQUV2RCxpRUFBaUU7UUFDdkQsYUFBUSxHQUFHLElBQUksWUFBWSxFQUFTLENBQUM7UUFFL0MseUVBQXlFO1FBQ2pFLG1CQUFjLEdBQUcsS0FBSyxDQUFDO0lBTTNCLENBQUM7SUFFTCw4Q0FBOEM7SUFDOUMsYUFBYTtJQUNiLDhDQUE4QztJQUU5Qzs7T0FFRztJQUNJLFNBQVM7UUFDZCxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQztJQUN6RSxDQUFDO0lBRUQscUJBQXFCO0lBQ2QsUUFBUSxDQUFDLE9BQWlCLEVBQUUsVUFBb0IsRUFBRSxhQUF1QjtRQUM5RSxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsUUFBUSxDQUFDLE9BQU8sRUFBRSxVQUFVLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBQztJQUMxRyxDQUFDO0lBRUQ7O09BRUc7SUFDSSxNQUFNO1FBQ1gsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUM3RSxDQUFDO0lBRUQ7O09BRUc7SUFDSSxPQUFPO1FBQ1osSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFDdkUsQ0FBQztJQUVEOztPQUVHO0lBQ0ksa0JBQWtCO1FBQ3ZCLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxrQkFBa0IsRUFBRSxDQUFDLENBQUM7SUFDbEYsQ0FBQztJQUVEOzs7O09BSUc7SUFDSSxVQUFVLENBQUMsZUFBNkMsRUFBRSxNQUFXO1FBQzFFLE1BQU0sZ0JBQWdCLEdBQUcsTUFBTSxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDbEcsTUFBTSxVQUFVLEdBQUcsZ0JBQWdCLENBQUMsU0FBUyxDQUFDO1FBQzlDLE1BQU0sU0FBUyxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFFL0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEVBQUU7WUFDakMsVUFBVSxDQUFDLEdBQUcsRUFBRTtnQkFDZCxTQUFTLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ3BCLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsbUJBQW1CLENBQUMsQ0FBQztnQkFDM0QsU0FBUyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMzQixDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDUixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7T0FFRztJQUNJLHFCQUFxQixDQUFDLGVBQTZDLEVBQUUsTUFBVztRQUNyRixNQUFNLGdCQUFnQixHQUFHLE1BQU0sQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQ2xHLE1BQU0sVUFBVSxHQUFHLGdCQUFnQixDQUFDLFNBQVMsQ0FBQztRQUM5QyxNQUFNLFNBQVMsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRS9DLFNBQVMsQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBRXpELElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsR0FBRyxFQUFFO1lBQ2pDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNwQixTQUFTLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ2pDLFNBQVMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsNkNBQTZDO0lBQzdDLG1CQUFtQjtJQUNuQiw2Q0FBNkM7SUFFN0MsZUFBZTtRQUNiLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsR0FBRyxFQUFFO1lBQ2pDLGtCQUFrQjtZQUNsQixJQUFJLENBQUMsYUFBYSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBRTNELE1BQU0sT0FBTyxHQUErQjtnQkFDMUMsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVO2dCQUMzQixvQkFBb0IsRUFBRSxJQUFJLENBQUMscUJBQXFCO2dCQUNoRCxXQUFXLEVBQUUsSUFBSSxDQUFDLFlBQVk7Z0JBQzlCLFFBQVEsRUFBRSxJQUFJLENBQUMsU0FBUztnQkFDeEIsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVO2dCQUMzQixTQUFTLEVBQUUsSUFBSSxDQUFDLFVBQVU7Z0JBQzFCLFlBQVksRUFBRSxJQUFJLENBQUMsYUFBYTtnQkFDaEMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLGlCQUFpQjtnQkFDeEMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLG1CQUFtQjthQUM3QyxDQUFDO1lBRUYsaUNBQWlDO1lBQ2pDLElBQUksQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRTVDLHVEQUF1RDtZQUN2RCxpREFBaUQ7WUFDakQsZ0VBQWdFO1lBQ2hFLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUVsRSxpQ0FBaUM7WUFDakMsSUFBSSxDQUFDLGFBQWE7aUJBQ2YsRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDLEVBQUUsRUFBRSxPQUFjLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7aUJBQy9GLEVBQUUsQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2lCQUM5RSxFQUFFLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7aUJBQ3JFLEVBQUUsQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztpQkFDeEUsRUFBRSxDQUFDLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBRSxPQUFjLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7aUJBQzFGLEVBQUUsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2lCQUN0RixFQUFFLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzlGLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELGtCQUFrQjtRQUNoQixJQUFJLElBQUksQ0FBQyxlQUFlLElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUMvQyxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUNyRSxJQUFJLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQztTQUM3QjtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILFdBQVc7UUFDVCwyRkFBMkY7UUFDM0YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEVBQUU7WUFDakMsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO2dCQUN0QixJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsRUFBRSxDQUFDO2dCQUN6QixJQUFJLENBQUMsYUFBYSxHQUFHLFNBQVMsQ0FBQzthQUNoQztZQUNELElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtnQkFDeEIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDL0IsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7YUFDN0I7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7OEdBOVZVLDRCQUE0QjtrR0FBNUIsNEJBQTRCLHNzQkMxQnpDLDZCQUNBOzsyRkR5QmEsNEJBQTRCO2tCQUx4QyxTQUFTOytCQUNFLDRCQUE0QixtQkFFckIsdUJBQXVCLENBQUMsTUFBTTtzSEFTL0IsVUFBVTtzQkFBekIsS0FBSztnQkFHYyxXQUFXO3NCQUE5QixLQUFLO2dCQXFCYyxvQkFBb0I7c0JBQXZDLEtBQUs7Z0JBcUJjLFFBQVE7c0JBQTNCLEtBQUs7Z0JBa0JVLFVBQVU7c0JBQXpCLEtBQUs7Z0JBS2MsU0FBUztzQkFBNUIsS0FBSztnQkFrQmMsWUFBWTtzQkFBL0IsS0FBSztnQkFxQkssZ0JBQWdCO3NCQUQxQixLQUFLO2dCQWVLLGtCQUFrQjtzQkFENUIsS0FBSztnQkFhaUMsT0FBTztzQkFBN0MsV0FBVzt1QkFBQyx3QkFBd0I7Z0JBRVksZ0JBQWdCO3NCQUFoRSxXQUFXO3VCQUFDLHlCQUF5Qjs7c0JBQUcsS0FBSztnQkFLdkIsTUFBTTtzQkFBNUIsV0FBVzt1QkFBQyxJQUFJO2dCQXVDUCxVQUFVO3NCQUFuQixNQUFNO2dCQU1HLGVBQWU7c0JBQXhCLE1BQU07Z0JBS0csaUJBQWlCO3NCQUExQixNQUFNO2dCQUdHLGNBQWM7c0JBQXZCLE1BQU07Z0JBR0csUUFBUTtzQkFBakIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0NoZWNrZWQsXG4gIEFmdGVyVmlld0luaXQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIElucHV0LFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbiAgTmdab25lLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuLyoqXG4gKiBBbmd1bGFyIFdyYXBwZXIgZm9yIHRoZSBTb2hvIEFwcGxpY2F0aW9uIE1lbnUgQ29tcG9uZW50LlxuICpcbiAqIFRoaXMgY29tcG9uZW50IHNlYXJjaGVzIGZvciBhIG5hdiBlbGVtZW50IHdpdGggdGhlIGF0dHJpYnV0ZVxuICogJ3NvaG8tYXBwbGNhdGlvbi1tZW51JyBpbiB0aGUgcGFyZW50J3MgRE9NIHRyZWUsIGluaXRpYWxpc2luZyB0aG9zZSBmb3VuZCB3aXRoXG4gKiB0aGUgU29obyBhcHBsaWNhdGlvbiBtZW51IGNvbnRyb2wuXG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25hdltzb2hvLWFwcGxpY2F0aW9uLW1lbnVdJywgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICB0ZW1wbGF0ZVVybDogJ3NvaG8tYXBwbGljYXRpb24tbWVudS5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIFNvaG9BcHBsaWNhdGlvbk1lbnVDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBBZnRlclZpZXdDaGVja2VkLCBPbkRlc3Ryb3kge1xuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQ29tcG9uZW50IElucHV0c1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLyoqIEJyZWFrcG9pbnQuICovXG4gIEBJbnB1dCgpIHB1YmxpYyBicmVha3BvaW50PzogU29ob0FwcGxpY2F0aW9uTWVudUJyZWFrUG9pbnQ7XG5cbiAgLyoqIFNldHMgT3BlbiBvbiByZXNpemUgKi9cbiAgQElucHV0KCkgcHVibGljIHNldCBvcGVuT25MYXJnZShvcGVuT25MYXJnZTogYm9vbGVhbiB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMuX29wZW5PbkxhcmdlID0gb3Blbk9uTGFyZ2U7XG5cbiAgICBpZiAodGhpcy5hcHBsaWNhdGlvbm1lbnUpIHtcbiAgICAgIHRoaXMuYXBwbGljYXRpb25tZW51LnNldHRpbmdzLm9wZW5PbkxhcmdlID0gdGhpcy5fb3Blbk9uTGFyZ2U7XG4gICAgICB0aGlzLnVwZGF0ZVJlcXVpcmVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0IG9wZW5PbkxhcmdlKCk6IGJvb2xlYW4gfCB1bmRlZmluZWQge1xuICAgIGlmICh0aGlzLmFwcGxpY2F0aW9ubWVudSkge1xuICAgICAgcmV0dXJuIHRoaXMuYXBwbGljYXRpb25tZW51LnNldHRpbmdzLm9wZW5PbkxhcmdlO1xuICAgIH1cblxuICAgIC8vIElmIGNhbGxlZCBiZWZvcmUgdGhlIGNvbXBvbmVudCBoYXMgY29tcGxldGVkXG4gICAgLy8gaW5pdGlhbGlzYXRpb24sIHJldHVybiB0aGUgY3VycmVudCB2YWx1ZSBmcm9tIHRoZVxuICAgIC8vIG9wdGlvbnMuXG4gICAgcmV0dXJuIHRoaXMuX29wZW5PbkxhcmdlO1xuICB9XG5cbiAgLyoqIEFsbG93cyB0aGUgbWVudSB0byBiZWNvbWUgY2xvc2VkIGFmdGVyIGFuIGFjdGlvbmFibGUgaGVhZGVyIGhhcyBiZWVuIHNlbGVjdGVkICovXG4gIEBJbnB1dCgpIHB1YmxpYyBzZXQgZGlzbWlzc09uQ2xpY2tNb2JpbGUoZGlzbWlzc09uQ2xpY2tNb2JpbGU6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLl9kaXNtaXNzT25DbGlja01vYmlsZSA9IGRpc21pc3NPbkNsaWNrTW9iaWxlO1xuXG4gICAgaWYgKHRoaXMuYXBwbGljYXRpb25tZW51KSB7XG4gICAgICB0aGlzLmFwcGxpY2F0aW9ubWVudS5zZXR0aW5ncy5kaXNtaXNzT25DbGlja01vYmlsZSA9IHRoaXMuX2Rpc21pc3NPbkNsaWNrTW9iaWxlO1xuICAgICAgdGhpcy51cGRhdGVSZXF1aXJlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldCBkaXNtaXNzT25DbGlja01vYmlsZSgpIHtcbiAgICBpZiAodGhpcy5hcHBsaWNhdGlvbm1lbnUpIHtcbiAgICAgIHJldHVybiB0aGlzLmFwcGxpY2F0aW9ubWVudS5zZXR0aW5ncy5kaXNtaXNzT25DbGlja01vYmlsZTtcbiAgICB9XG5cbiAgICAvLyBJZiBjYWxsZWQgYmVmb3JlIHRoZSBjb21wb25lbnQgaGFzIGNvbXBsZXRlZFxuICAgIC8vIGluaXRpYWxpc2F0aW9uLCByZXR1cm4gdGhlIGN1cnJlbnQgdmFsdWUgZnJvbSB0aGVcbiAgICAvLyBvcHRpb25zLlxuICAgIHJldHVybiB0aGlzLl9kaXNtaXNzT25DbGlja01vYmlsZTtcbiAgfVxuXG4gIC8qKiBBIGxpc3Qgb2YgalF1ZXJ5IGVsZW1lbnRzIHdoaWNoIHRyaWdnZXIgdGhlIG9wZW5uaW5nIGFuZCBjbG9zaW5nIGFwcGxpY2F0aW9uIG1lbnUuICovXG4gIEBJbnB1dCgpIHB1YmxpYyBzZXQgdHJpZ2dlcnModHJpZ2dlcnM6IHN0cmluZ1tdKSB7XG5cbiAgICBpZiAodHJpZ2dlcnMpIHtcbiAgICAgIGxldCBpID0gdHJpZ2dlcnMubGVuZ3RoO1xuICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICB0aGlzLl90cmlnZ2Vycy5wdXNoKGpRdWVyeSh0cmlnZ2Vyc1tpXSkpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5hcHBsaWNhdGlvbm1lbnUpIHtcbiAgICAgICAgdGhpcy5hcHBsaWNhdGlvbm1lbnUuc2V0dGluZ3MudHJpZ2dlcnMgPSB0aGlzLl90cmlnZ2VycztcbiAgICAgICAgdGhpcy51cGRhdGVSZXF1aXJlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIElzIHRoZSBhcHBsaWNhdGlvbiBtZW51IGZpbHRlcmFibGU/XG4gICAqL1xuICBASW5wdXQoKSBwdWJsaWMgZmlsdGVyYWJsZT86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIElzIHRoZSBhcHBsaWNhdGlvbiBtZW51IHJlc2l6YWJsZT9cbiAgICovXG4gIEBJbnB1dCgpIHB1YmxpYyBzZXQgcmVzaXphYmxlKHJlc2l6YWJsZTogYm9vbGVhbiB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMuX3Jlc2l6YWJsZSA9IHJlc2l6YWJsZTtcbiAgICBpZiAodGhpcy5hcHBsaWNhdGlvbm1lbnUpIHtcbiAgICAgIHRoaXMuYXBwbGljYXRpb25tZW51LnNldHRpbmdzLnJlc2l6YWJsZSA9IHRoaXMuX3Jlc2l6YWJsZTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0IHJlc2l6YWJsZSgpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICBpZiAodGhpcy5hcHBsaWNhdGlvbm1lbnUpIHtcbiAgICAgIHJldHVybiB0aGlzLmFwcGxpY2F0aW9ubWVudS5zZXR0aW5ncy5yZXNpemFibGU7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuX3Jlc2l6YWJsZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNpemVhYmxlIFNhdmUgUG9zaXRpb24gU2V0dGluZ3NcbiAgICovXG4gIEBJbnB1dCgpIHB1YmxpYyBzZXQgc2F2ZVBvc2l0aW9uKHNhdmVQb3NpdGlvbjogYm9vbGVhbiB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMuX3NhdmVQb3NpdGlvbiA9IHNhdmVQb3NpdGlvbjtcbiAgICBpZiAodGhpcy5hcHBsaWNhdGlvbm1lbnUpIHtcbiAgICAgIHRoaXMuYXBwbGljYXRpb25tZW51LnNldHRpbmdzLnJlc2l6YWJsZSA9IHRoaXMuX3NhdmVQb3NpdGlvbjtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0IHNhdmVQb3NpdGlvbigpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICBpZiAodGhpcy5hcHBsaWNhdGlvbm1lbnUpIHtcbiAgICAgIHJldHVybiB0aGlzLmFwcGxpY2F0aW9ubWVudS5zZXR0aW5ncy5zYXZlUG9zaXRpb247XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuX3NhdmVQb3NpdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gZXhwYW5kU3dpdGNoZXJcbiAgICogTWVudSBzd2l0Y2hlciBleHBhbmQgc2V0dGluZyB0byBwcm92aWRlIGNhbGxiYWNrXG4gICAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgc2V0IG9uRXhwYW5kU3dpdGNoZXIoZXhwYW5kU3dpdGNoZXI6IFNvaG9BcHBsaWNhdGlvbk1lbnVFeHBhbmRTd2l0Y2hlckZ1bmN0aW9uKSB7XG4gICAgdGhpcy5fb25FeHBhbmRTd2l0Y2hlciA9IGV4cGFuZFN3aXRjaGVyO1xuICAgIGlmICh0aGlzLmFwcGxpY2F0aW9ubWVudSkge1xuICAgICAgdGhpcy5hcHBsaWNhdGlvbm1lbnUuc2V0dGluZ3Mub25FeHBhbmRTd2l0Y2hlciA9IHRoaXMuX29uRXhwYW5kU3dpdGNoZXI7XG4gICAgICB0aGlzLnVwZGF0ZVJlcXVpcmVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGNvbGxhcHNlU3dpdGNoZXJcbiAgICogTWVudSBzd2l0Y2hlciBjb2xsYXBzZSBzZXR0aW5nIHRvIHByb3ZpZGUgY2FsbGJhY2tcbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgb25Db2xsYXBzZVN3aXRjaGVyKGNvbGxhcHNlU3dpdGNoZXI6IFNvaG9BcHBsaWNhdGlvbk1lbnVDb2xsYXBzZVN3aXRjaGVyRnVuY3Rpb24pIHtcbiAgICB0aGlzLl9vbkNvbGxhcHNlU3dpdGNoZXIgPSBjb2xsYXBzZVN3aXRjaGVyO1xuICAgIGlmICh0aGlzLmFwcGxpY2F0aW9ubWVudSkge1xuICAgICAgdGhpcy5hcHBsaWNhdGlvbm1lbnUuc2V0dGluZ3Mub25Db2xsYXBzZVN3aXRjaGVyID0gdGhpcy5fb25Db2xsYXBzZVN3aXRjaGVyO1xuICAgICAgdGhpcy51cGRhdGVSZXF1aXJlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBIb3N0IEJpbmRpbmdzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLmFwcGxpY2F0aW9uLW1lbnUnKSBhcHBNZW51ID0gdHJ1ZTtcblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLmlzLXBlcnNvbmFsaXphYmxlJykgQElucHV0KCkgaXNQZXJzb25hbGl6YWJsZSA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBUaGlzIHdpbGwgbGV0IHRoZSBTb2hvIGNvbnRyb2xzIGJpbmQgdGhlIGFwcGxpY2F0aW9uIG1lbnUgdHJpZ2dlciBuYXR1cmFsbHlcbiAgICovXG4gIEBIb3N0QmluZGluZygnaWQnKSBnZXQgbWVudUlkKCkge1xuICAgIHJldHVybiAnYXBwbGljYXRpb24tbWVudSc7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFByaXZhdGUgTWVtYmVyIERhdGFcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8qKiBSZWZlcmVuY2UgdG8gdGhlIGpRdWVyeSBlbGVtZW50LiAqL1xuICBwcml2YXRlIGpRdWVyeUVsZW1lbnQ/OiBKUXVlcnk7XG5cbiAgLyoqIFJlZmVyZW5jZSB0byB0aGUgYW5ub3RhdGVkIFNvSG9YaSBjb250cm9sICovXG4gIHByaXZhdGUgYXBwbGljYXRpb25tZW51PzogU29ob0FwcGxpY2F0aW9uTWVudVN0YXRpYyB8IG51bGw7XG5cbiAgLyoqIExpc3Qgb2YgalF1ZXJ5IHRyaWdnZXJzLiAqL1xuICBwcml2YXRlIF90cmlnZ2VyczogQXJyYXk8YW55PiA9IFtdO1xuXG4gIC8qKiBPcGVuIG9uIHJlc2l6ZSAqL1xuICBwcml2YXRlIF9vcGVuT25MYXJnZT86IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG5cbiAgLyoqIERpc21pc3MgdGhlIG1lbnUgd2hlbiBhbiBpdGVtIGlzIGNsaWNrZWQgaW4gdGhlIG1vYmlsZSBicmVha3BvaW50cyAqL1xuICBwcml2YXRlIF9kaXNtaXNzT25DbGlja01vYmlsZT86IGJvb2xlYW47XG5cbiAgcHJpdmF0ZSBfcmVzaXphYmxlPzogYm9vbGVhbjtcblxuICBwcml2YXRlIF9zYXZlUG9zaXRpb24/OiBib29sZWFuO1xuXG4gIC8qKiBNZW51IHN3aXRjaGVyIGV4cGFuZCBjYWxsYmFjayAgKi9cbiAgcHJpdmF0ZSBfb25FeHBhbmRTd2l0Y2hlcj86IFNvaG9BcHBsaWNhdGlvbk1lbnVFeHBhbmRTd2l0Y2hlckZ1bmN0aW9uO1xuXG4gIC8qKiBNZW51IHN3aXRjaGVyIGNvbGxhcHNlIGNhbGxiYWNrICAqL1xuICBwcml2YXRlIF9vbkNvbGxhcHNlU3dpdGNoZXI/OiBTb2hvQXBwbGljYXRpb25NZW51Q29sbGFwc2VTd2l0Y2hlckZ1bmN0aW9uO1xuXG4gIC8qKlxuICAgKiBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gdGhlIHZpc2liaWxpdHkgb2YgdGhlIGFwcGxpY2F0aW9uIG1lbnUgaXMgY2hhbmdlZCxcbiAgICogaXMgaXQgYWxzbyBjYWxsZWQgd2hlbiB0aGUgaXRlbSBpcyBjaGFuZ2VkIHByb2dyYW1tYXRpY2FsbHkuXG4gICAqXG4gICAqIEBkZXByZWNhdGVkIHVzZSBhY2NvcmRpb25FeHBhbmQgYW5kIGFjY29yZGlvbkNvbGxhcHNlIGV2ZW50cyBpbnN0ZWFkXG4gICAqL1xuICBAT3V0cHV0KCkgdmlzaWJpbGl0eSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIC8qKlxuICAgKiBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gYSBtZW51IGFjY29yZGlvbiBpcyBleHBhbWRlZFxuICAgKiBUaGUgZXZlbnQgaW5jbHVkZSB0aGUgYW5jaG9yIGVsZW1lbnQuXG4gICAqL1xuICBAT3V0cHV0KCkgYWNjb3JkaW9uRXhwYW5kID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgLyoqXG4gICAqIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiBhIG1lbnUgYWNjb3JkaW9uIGlzIGNvbGxhcHNlZFxuICAgKi9cbiAgQE91dHB1dCgpIGFjY29yZGlvbkNvbGxhcHNlID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuXG4gIC8qKiBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gdGhlIHZpc2liaWxpdHkgb2YgdGhlIGFwcGxpY2F0aW9uIG1lbnUgaXMgY2hhbmdlZCAqL1xuICBAT3V0cHV0KCkgbWVudVZpc2liaWxpdHkgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG5cbiAgLyoqIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiB0aGUgYXBwbGljYXRpb24gbWVudSBpcyBmaWx0ZXJlZC4gKi9cbiAgQE91dHB1dCgpIGZpbHRlcmVkID0gbmV3IEV2ZW50RW1pdHRlcjxhbnlbXT4oKTtcblxuICAvKiogZmxhZyB0aGUgbmVlZCB0byB1cGRhdGUgdGhlIHNvaG8vZXAgY29udHJvbCBpbiBuZ0FmdGVyVmlld0NoZWNrZWQuICovXG4gIHByaXZhdGUgdXBkYXRlUmVxdWlyZWQgPSBmYWxzZTtcblxuICAvLyBDb25zdHJ1Y3Rvci5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxuICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsXG4gICkgeyB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBQdWJsaWMgQVBJXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvKipcbiAgICogQ2xvc2UgdGhlIG1lbnUuXG4gICAqL1xuICBwdWJsaWMgY2xvc2VNZW51KCkge1xuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuYXBwbGljYXRpb25tZW51Py5jbG9zZU1lbnUoKSk7XG4gIH1cblxuICAvKiogT3BlbiB0aGUgbWVudS4gKi9cbiAgcHVibGljIG9wZW5NZW51KG5vRm9jdXM/OiBib29sZWFuLCB1c2VyT3BlbmVkPzogYm9vbGVhbiwgb3BlbmVkQnlDbGFzcz86IGJvb2xlYW4pIHtcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLmFwcGxpY2F0aW9ubWVudT8ub3Blbk1lbnUobm9Gb2N1cywgdXNlck9wZW5lZCwgb3BlbmVkQnlDbGFzcykpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgbWVudSBpcyBvcGVuLCBvdGhlcndpc2UgZmFsc2UuXG4gICAqL1xuICBwdWJsaWMgaXNPcGVuKCk6IGJvb2xlYW4gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLmFwcGxpY2F0aW9ubWVudT8uaXNPcGVuKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIE5vdGlmaWVzIGFwcGxpY2F0aW9uIG1lbnUgdGhhdCBpdCBoYXMgYmVlbiB1cGRhdGVkXG4gICAqL1xuICBwdWJsaWMgdXBkYXRlZCgpIHtcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLmFwcGxpY2F0aW9ubWVudT8udXBkYXRlZCgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbG9zZXMgdGhlIHBhbmVsIGFyZWEgY29udHJvbGxlZCBieSBzd2l0Y2hlclxuICAgKi9cbiAgcHVibGljIGNsb3NlU3dpdGNoZXJQYW5lbCgpIHtcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLmFwcGxpY2F0aW9ubWVudT8uY2xvc2VTd2l0Y2hlclBhbmVsKCkpO1xuICB9XG5cbiAgLypcbiAgICogVXBkYXRlcyBBY2NvcmRpb24gd2hlbiBtZW51cyBoYXZlIGJlZW4gbGF6aWx5IGxvYWRlZFxuICAgKiBUT0RPOiBFZCBvciBUaW0sIHRoZXJlIGRvZXNuJ3QgYXBwZWFyIHRvIGJlIGEgcHVibGljIGZ1bmN0aW9uIGZvciBzb21ldGhpbmcgbGlrZSB0aGlzXG4gICAqIGZyb20gYXBwbGljYXRpb25tZW51LmpzLiBUaGlzIGlzIG15IGN1cnJlbnQgd29yayBhcnJvdW5kIChLcmlzIEhvbGxlbmVjaylcbiAgICovXG4gIHB1YmxpYyB1cGRhdGVMYXp5KGFwcGxpY2F0aW9uTWVudTogU29ob0FwcGxpY2F0aW9uTWVudUNvbXBvbmVudCwgdGFyZ2V0OiBhbnkpIHtcbiAgICBjb25zdCAkYXBwbGljYXRpb25NZW51ID0galF1ZXJ5KGFwcGxpY2F0aW9uTWVudS5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpLmRhdGEoJ2FwcGxpY2F0aW9ubWVudScpO1xuICAgIGNvbnN0ICRhY2NvcmRpb24gPSAkYXBwbGljYXRpb25NZW51LmFjY29yZGlvbjtcbiAgICBjb25zdCBhY2NvcmRpb24gPSAkYWNjb3JkaW9uLmRhdGEoJ2FjY29yZGlvbicpO1xuXG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGFjY29yZGlvbi51cGRhdGVkKCk7XG4gICAgICAgIGNvbnN0IGhlYWRlciA9IGpRdWVyeSh0YXJnZXQpLmNsb3Nlc3QoJy5hY2NvcmRpb24taGVhZGVyJyk7XG4gICAgICAgIGFjY29yZGlvbi5leHBhbmQoaGVhZGVyKTtcbiAgICAgIH0sIDEpO1xuICAgIH0pO1xuICB9XG5cbiAgLypcbiAgICogVG9nZ2xlIGFuZCBzZWxlY3QgYSBzcGVjaWZpYyBoZWFkZXJcbiAgICovXG4gIHB1YmxpYyB0b2dnbGVBbmRTZWxlY3RIZWFkZXIoYXBwbGljYXRpb25NZW51OiBTb2hvQXBwbGljYXRpb25NZW51Q29tcG9uZW50LCBoZWFkZXI6IGFueSkge1xuICAgIGNvbnN0ICRhcHBsaWNhdGlvbk1lbnUgPSBqUXVlcnkoYXBwbGljYXRpb25NZW51LmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCkuZGF0YSgnYXBwbGljYXRpb25tZW51Jyk7XG4gICAgY29uc3QgJGFjY29yZGlvbiA9ICRhcHBsaWNhdGlvbk1lbnUuYWNjb3JkaW9uO1xuICAgIGNvbnN0IGFjY29yZGlvbiA9ICRhY2NvcmRpb24uZGF0YSgnYWNjb3JkaW9uJyk7XG5cbiAgICBhY2NvcmRpb24uaGVhZGVycyA9ICRhY2NvcmRpb24uZmluZCgnLmFjY29yZGlvbi1oZWFkZXInKTtcblxuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIGFjY29yZGlvbi51cGRhdGVkKCk7XG4gICAgICBhY2NvcmRpb24udG9nZ2xlKGpRdWVyeShoZWFkZXIpKTtcbiAgICAgIGFjY29yZGlvbi5zZWxlY3QoalF1ZXJ5KGhlYWRlcikpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIExpZmVjeWNsZSBFdmVudHNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIC8vIFdyYXAgZm9yIGxhdGVyLlxuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50ID0galF1ZXJ5KHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KTtcblxuICAgICAgY29uc3Qgb3B0aW9uczogU29ob0FwcGxpY2F0aW9uTWVudU9wdGlvbnMgPSB7XG4gICAgICAgIGJyZWFrcG9pbnQ6IHRoaXMuYnJlYWtwb2ludCxcbiAgICAgICAgZGlzbWlzc09uQ2xpY2tNb2JpbGU6IHRoaXMuX2Rpc21pc3NPbkNsaWNrTW9iaWxlLFxuICAgICAgICBvcGVuT25MYXJnZTogdGhpcy5fb3Blbk9uTGFyZ2UsXG4gICAgICAgIHRyaWdnZXJzOiB0aGlzLl90cmlnZ2VycyxcbiAgICAgICAgZmlsdGVyYWJsZTogdGhpcy5maWx0ZXJhYmxlLFxuICAgICAgICByZXNpemFibGU6IHRoaXMuX3Jlc2l6YWJsZSxcbiAgICAgICAgc2F2ZVBvc2l0aW9uOiB0aGlzLl9zYXZlUG9zaXRpb24sXG4gICAgICAgIG9uRXhwYW5kU3dpdGNoZXI6IHRoaXMuX29uRXhwYW5kU3dpdGNoZXIsXG4gICAgICAgIG9uQ29sbGFwc2VTd2l0Y2hlcjogdGhpcy5fb25Db2xsYXBzZVN3aXRjaGVyXG4gICAgICB9O1xuXG4gICAgICAvLyBJbml0aWFsaXNlIHRoZSBTb0hvWGkgY29udHJvbC5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5hcHBsaWNhdGlvbm1lbnUob3B0aW9ucyk7XG5cbiAgICAgIC8vIE9uY2UgdGhlIGNvbnRyb2wgaXMgaW5pdGlhbGlzZWQsIGV4dHJhY3QgdGhlIGNvbnRyb2xcbiAgICAgIC8vIHBsdWctaW4gZnJvbSB0aGUgZWxlbWVudC4gIFRoZSBlbGVtZW50IG5hbWUgaXNcbiAgICAgIC8vIGRlZmluZWQgYnkgdGhlIHBsdWctaW4sIGJ1dCBpbiB0aGlzIGNhc2UgaXMgJ2V4cGFuZGFibGVhcmVhJy5cbiAgICAgIHRoaXMuYXBwbGljYXRpb25tZW51ID0gdGhpcy5qUXVlcnlFbGVtZW50LmRhdGEoJ2FwcGxpY2F0aW9ubWVudScpO1xuXG4gICAgICAvLyBJbml0aWFsaXNlIGFueSBldmVudCBoYW5kbGVycy5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudFxuICAgICAgICAub24oJ2V4cGFuZCcsIChfZSwgcmVzdWx0czogYW55W10pID0+IHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLmFjY29yZGlvbkV4cGFuZC5uZXh0KHJlc3VsdHMpKSlcbiAgICAgICAgLm9uKCdjb2xsYXBzZScsICgpID0+IHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLmFjY29yZGlvbkNvbGxhcHNlLm5leHQodHJ1ZSkpKVxuICAgICAgICAub24oJ2V4cGFuZCcsICgpID0+IHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLnZpc2liaWxpdHkubmV4dCh0cnVlKSkpXG4gICAgICAgIC5vbignY29sbGFwc2UnLCAoKSA9PiB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gdGhpcy52aXNpYmlsaXR5Lm5leHQoZmFsc2UpKSlcbiAgICAgICAgLm9uKCdmaWx0ZXJlZCcsIChfZSwgcmVzdWx0czogYW55W10pID0+IHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLmZpbHRlcmVkLm5leHQocmVzdWx0cykpKVxuICAgICAgICAub24oJ2FwcGxpY2F0aW9ubWVudW9wZW4nLCAoKSA9PiB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gdGhpcy5tZW51VmlzaWJpbGl0eS5uZXh0KHRydWUpKSlcbiAgICAgICAgLm9uKCdhcHBsaWNhdGlvbm1lbnVjbG9zZScsICgpID0+IHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLm1lbnVWaXNpYmlsaXR5Lm5leHQoZmFsc2UpKSk7XG4gICAgfSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0NoZWNrZWQoKSB7XG4gICAgaWYgKHRoaXMuYXBwbGljYXRpb25tZW51ICYmIHRoaXMudXBkYXRlUmVxdWlyZWQpIHtcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuYXBwbGljYXRpb25tZW51Py51cGRhdGVkKCkpO1xuICAgICAgdGhpcy51cGRhdGVSZXF1aXJlZCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEZXN0cnVjdG9yLlxuICAgKi9cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgLy8gY2FsbCBvdXRzaWRlIHRoZSBhbmd1bGFyIHpvbmUgc28gY2hhbmdlIGRldGVjdGlvbiBpc24ndCB0cmlnZ2VyZWQgYnkgdGhlIHNvaG8gY29tcG9uZW50LlxuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIGlmICh0aGlzLmpRdWVyeUVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5qUXVlcnlFbGVtZW50Lm9mZigpO1xuICAgICAgICB0aGlzLmpRdWVyeUVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5hcHBsaWNhdGlvbm1lbnUpIHtcbiAgICAgICAgdGhpcy5hcHBsaWNhdGlvbm1lbnUuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLmFwcGxpY2F0aW9ubWVudSA9IG51bGw7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cbiIsIjxuZy1jb250ZW50PjwvbmctY29udGVudD5cbiJdfQ==