import { ChangeDetectionStrategy, Component, EventEmitter, Output, HostListener, HostBinding, Input } from '@angular/core';
import { BaseControlValueAccessor, provideControlValueAccessor } from '../utils/base-control-value-accessor';
import * as i0 from "@angular/core";
export class SohoInputComponent extends BaseControlValueAccessor {
    /**
     * Constructor.
     *
     * @param element the owning element.
     * @param changeDetectionRef change detection.
     */
    constructor(element, ngZone) {
        super();
        this.element = element;
        this.ngZone = ngZone;
        /**
         * todo: work around until landmark can change code to allow the initial format.
         * Right now landmark initially formats the value to current locale.
         */
        this.fireInputEventKludge = true;
        /**
         * Available Soho Template events as Output (EventEmitters passing the event)
         * Should match the Soho event names for the component
         *
         * @todo replace override of native attribute
         */
        // eslint-disable-next-line @angular-eslint/no-output-native, @angular-eslint/no-output-rename
        this.change = new EventEmitter();
        /**
         * Input controls managed their disabled state via the 'disabled' attribute.
         * We use null as the default, rather than false, to ensure the attribute is
         * not displayed.
         *
         *
         */
        this.isDisabled = undefined;
        /**
         * Clearable attribute. Adds a clear icon in input if true.
         */
        this.clearable = false;
    }
    onKeyUp(_event) {
        // This is required if masking is used, otherwise the
        // the form binding does not see updates.
        this.internalValue = this.jQueryElement?.val();
    }
    ngAfterViewInit() {
        this.jQueryElement = jQuery(this.element.nativeElement);
        // Bind to jQueryElement's events
        this.jQueryElement
            .on('change', (_e, args) => this.onChange(args));
        // There is no SoHoXi control initializer for input
        if (this.clearable) {
            this.jQueryElement.clearable();
        }
        // Make sure the value of the control is set appropriately.
        if (this.internalValue) {
            this.jQueryElement.val(this.internalValue);
        }
    }
    ngOnDestroy() {
        // No jQuery control.
        this.jQueryElement?.off();
        this.jQueryElement?.remove();
    }
    /**
     * Handle the control being changed.
     */
    onChange(event) {
        if (!event) {
            // sometimes the event is not available
            this.internalValue = this.jQueryElement?.val();
            super.writeValue(this.internalValue);
            return;
        }
        this.change.emit(event);
    }
    /**
     * Override writeValue to allow the mask input
     * element to be updated correctly.
     *
     * @param value - the new value
     */
    writeValue(value) {
        super.writeValue(value);
        if (this.jQueryElement) {
            // The processing is required to ensure we use the correct format
            // in the control.
            this.jQueryElement.val(value);
            if (this.fireInputEventKludge) {
                this.ngZone.runOutsideAngular(() => {
                    setTimeout(() => {
                        this.element.nativeElement.dispatchEvent(new Event('input'));
                    });
                });
            }
        }
    }
    /**
     * This function is called when the control status changes to or from "DISABLED".
     * Depending on the value, it will enable or disable the appropriate DOM element.
     */
    setDisabledState(isDisabled) {
        this.isDisabled = isDisabled ? true : undefined;
    }
    getValue() {
        return this.internalValue;
    }
    setValue(value) {
        this.writeValue(value);
    }
    focus() {
        this.element.nativeElement.focus();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoInputComponent, deps: [{ token: i0.ElementRef }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: SohoInputComponent, selector: "input[soho-input]", inputs: { fireInputEventKludge: "fireInputEventKludge", isDisabled: "isDisabled", clearable: "clearable" }, outputs: { change: "change" }, host: { listeners: { "keyup": "onKeyUp($event)" }, properties: { "attr.disabled": "this.isDisabled", "attr.data-clearable": "this.clearable" } }, providers: [provideControlValueAccessor(SohoInputComponent)], usesInheritance: true, ngImport: i0, template: '<ng-content></ng-content>', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoInputComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'input[soho-input]',
                    template: '<ng-content></ng-content>',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [provideControlValueAccessor(SohoInputComponent)]
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.NgZone }]; }, propDecorators: { fireInputEventKludge: [{
                type: Input
            }], change: [{
                type: Output
            }], isDisabled: [{
                type: HostBinding,
                args: ['attr.disabled']
            }, {
                type: Input
            }], clearable: [{
                type: HostBinding,
                args: ['attr.data-clearable']
            }, {
                type: Input
            }], onKeyUp: [{
                type: HostListener,
                args: ['keyup', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1pbnB1dC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9pZHMtZW50ZXJwcmlzZS1uZy9zcmMvbGliL2lucHV0L3NvaG8taW5wdXQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUVULFlBQVksRUFFWixNQUFNLEVBQ04sWUFBWSxFQUNaLFdBQVcsRUFDWCxLQUFLLEVBQ04sTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUNMLHdCQUF3QixFQUN4QiwyQkFBMkIsRUFDNUIsTUFBTSxzQ0FBc0MsQ0FBQzs7QUFROUMsTUFBTSxPQUFPLGtCQUFtQixTQUFRLHdCQUFnQztJQXVDdEU7Ozs7O09BS0c7SUFDSCxZQUNVLE9BQW1CLEVBQ25CLE1BQWM7UUFFdEIsS0FBSyxFQUFFLENBQUM7UUFIQSxZQUFPLEdBQVAsT0FBTyxDQUFZO1FBQ25CLFdBQU0sR0FBTixNQUFNLENBQVE7UUE3Q3hCOzs7V0FHRztRQUNNLHlCQUFvQixHQUFHLElBQUksQ0FBQztRQUdyQzs7Ozs7V0FLRztRQUNILDhGQUE4RjtRQUNwRixXQUFNLEdBQW1DLElBQUksWUFBWSxFQUFvQixDQUFDO1FBRXhGOzs7Ozs7V0FNRztRQUVILGVBQVUsR0FBd0IsU0FBUyxDQUFDO1FBRTVDOztXQUVHO1FBRUgsY0FBUyxHQUF3QixLQUFLLENBQUM7SUFrQnZDLENBQUM7SUFHRCxPQUFPLENBQUMsTUFBcUI7UUFDM0IscURBQXFEO1FBQ3JELHlDQUF5QztRQUN6QyxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFZLENBQUM7SUFDM0QsQ0FBQztJQUVELGVBQWU7UUFDYixJQUFJLENBQUMsYUFBYSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBRXhELGlDQUFp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T3BDLFNBQVM7c0JBRFIsV0FBVzt1QkFBQyxxQkFBcUI7O3NCQUFHLEtBQUs7Z0JBc0IxQyxPQUFPO3NCQUROLFlBQVk7dUJBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbiAgSG9zdExpc3RlbmVyLFxuICBIb3N0QmluZGluZyxcbiAgSW5wdXQsIE5nWm9uZVxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHtcbiAgQmFzZUNvbnRyb2xWYWx1ZUFjY2Vzc29yLFxuICBwcm92aWRlQ29udHJvbFZhbHVlQWNjZXNzb3Jcbn0gZnJvbSAnLi4vdXRpbHMvYmFzZS1jb250cm9sLXZhbHVlLWFjY2Vzc29yJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnaW5wdXRbc29oby1pbnB1dF0nLCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIHRlbXBsYXRlOiAnPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PicsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBwcm92aWRlcnM6IFtwcm92aWRlQ29udHJvbFZhbHVlQWNjZXNzb3IoU29ob0lucHV0Q29tcG9uZW50KV1cbn0pXG5leHBvcnQgY2xhc3MgU29ob0lucHV0Q29tcG9uZW50IGV4dGVuZHMgQmFzZUNvbnRyb2xWYWx1ZUFjY2Vzc29yPHN0cmluZz4gaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuXG4gIC8qKlxuICAgKiB0b2RvOiB3b3JrIGFyb3VuZCB1bnRpbCBsYW5kbWFyayBjYW4gY2hhbmdlIGNvZGUgdG8gYWxsb3cgdGhlIGluaXRpYWwgZm9ybWF0LlxuICAgKiBSaWdodCBub3cgbGFuZG1hcmsgaW5pdGlhbGx5IGZvcm1hdHMgdGhlIHZhbHVlIHRvIGN1cnJlbnQgbG9jYWxlLlxuICAgKi9cbiAgQElucHV0KCkgZmlyZUlucHV0RXZlbnRLbHVkZ2UgPSB0cnVlO1xuXG4gIFxuICAvKipcbiAgICogQXZhaWxhYmxlIFNvaG8gVGVtcGxhdGUgZXZlbnRzIGFzIE91dHB1dCAoRXZlbnRFbWl0dGVycyBwYXNzaW5nIHRoZSBldmVudClcbiAgICogU2hvdWxkIG1hdGNoIHRoZSBTb2hvIGV2ZW50IG5hbWVzIGZvciB0aGUgY29tcG9uZW50XG4gICAqXG4gICAqIEB0b2RvIHJlcGxhY2Ugb3ZlcnJpZGUgb2YgbmF0aXZlIGF0dHJpYnV0ZVxuICAgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtbmF0aXZlLCBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LXJlbmFtZVxuICBAT3V0cHV0KCkgY2hhbmdlOiBFdmVudEVtaXR0ZXI8U29ob0lucHV0RXZlbnRbXT4gPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9JbnB1dEV2ZW50W10+KCk7XG4gIFxuICAvKipcbiAgICogSW5wdXQgY29udHJvbHMgbWFuYWdlZCB0aGVpciBkaXNhYmxlZCBzdGF0ZSB2aWEgdGhlICdkaXNhYmxlZCcgYXR0cmlidXRlLlxuICAgKiBXZSB1c2UgbnVsbCBhcyB0aGUgZGVmYXVsdCwgcmF0aGVyIHRoYW4gZmFsc2UsIHRvIGVuc3VyZSB0aGUgYXR0cmlidXRlIGlzXG4gICAqIG5vdCBkaXNwbGF5ZWQuXG4gICAqXG4gICAqXG4gICAqL1xuICBASG9zdEJpbmRpbmcoJ2F0dHIuZGlzYWJsZWQnKSBASW5wdXQoKVxuICBpc0Rpc2FibGVkOiBib29sZWFuIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xuICBcbiAgLyoqXG4gICAqIENsZWFyYWJsZSBhdHRyaWJ1dGUuIEFkZHMgYSBjbGVhciBpY29uIGluIGlucHV0IGlmIHRydWUuXG4gICAqL1xuICBASG9zdEJpbmRpbmcoJ2F0dHIuZGF0YS1jbGVhcmFibGUnKSBASW5wdXQoKVxuICBjbGVhcmFibGU6IGJvb2xlYW4gfCB1bmRlZmluZWQgPSBmYWxzZTtcblxuICAvKipcbiAgICogTG9jYWwgdmFyaWFibGVzXG4gICAqL1xuICBwcml2YXRlIGpRdWVyeUVsZW1lbnQ/OiBKUXVlcnk7XG5cbiAgLyoqXG4gICAqIENvbnN0cnVjdG9yLlxuICAgKlxuICAgKiBAcGFyYW0gZWxlbWVudCB0aGUgb3duaW5nIGVsZW1lbnQuXG4gICAqIEBwYXJhbSBjaGFuZ2VEZXRlY3Rpb25SZWYgY2hhbmdlIGRldGVjdGlvbi5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZWxlbWVudDogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lXG4gICkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdrZXl1cCcsIFsnJGV2ZW50J10pXG4gIG9uS2V5VXAoX2V2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgLy8gVGhpcyBpcyByZXF1aXJlZCBpZiBtYXNraW5nIGlzIHVzZWQsIG90aGVyd2lzZSB0aGVcbiAgICAvLyB0aGUgZm9ybSBiaW5kaW5nIGRvZXMgbm90IHNlZSB1cGRhdGVzLlxuICAgIHRoaXMuaW50ZXJuYWxWYWx1ZSA9IHRoaXMualF1ZXJ5RWxlbWVudD8udmFsKCkgYXMgc3RyaW5nO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMualF1ZXJ5RWxlbWVudCA9IGpRdWVyeSh0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCk7XG5cbiAgICAvLyBCaW5kIHRvIGpRdWVyeUVsZW1lbnQncyBldmVudHNcbiAgICB0aGlzLmpRdWVyeUVsZW1lbnRcbiAgICAgIC5vbignY2hhbmdlJywgKF9lOiBhbnksIGFyZ3M6IGFueVtdKSA9PiB0aGlzLm9uQ2hhbmdlKGFyZ3MpKTtcblxuICAgIC8vIFRoZXJlIGlzIG5vIFNvSG9YaSBjb250cm9sIGluaXRpYWxpemVyIGZvciBpbnB1dFxuXG4gICAgaWYgKHRoaXMuY2xlYXJhYmxlKSB7XG4gICAgICAodGhpcy5qUXVlcnlFbGVtZW50IGFzIGFueSkuY2xlYXJhYmxlKCk7XG4gICAgfVxuXG4gICAgLy8gTWFrZSBzdXJlIHRoZSB2YWx1ZSBvZiB0aGUgY29udHJvbCBpcyBzZXQgYXBwcm9wcmlhdGVseS5cbiAgICBpZiAodGhpcy5pbnRlcm5hbFZhbHVlKSB7XG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQudmFsKHRoaXMuaW50ZXJuYWxWYWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgLy8gTm8galF1ZXJ5IGNvbnRyb2wuXG4gICAgdGhpcy5qUXVlcnlFbGVtZW50Py5vZmYoKTtcbiAgICB0aGlzLmpRdWVyeUVsZW1lbnQ/LnJlbW92ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSB0aGUgY29udHJvbCBiZWluZyBjaGFuZ2VkLlxuICAgKi9cbiAgb25DaGFuZ2UoZXZlbnQ6IGFueVtdKSB7XG4gICAgaWYgKCFldmVudCkge1xuICAgICAgLy8gc29tZXRpbWVzIHRoZSBldmVudCBpcyBub3QgYXZhaWxhYmxlXG4gICAgICB0aGlzLmludGVybmFsVmFsdWUgPSB0aGlzLmpRdWVyeUVsZW1lbnQ/LnZhbCgpIGFzIHN0cmluZztcbiAgICAgIHN1cGVyLndyaXRlVmFsdWUodGhpcy5pbnRlcm5hbFZhbHVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmNoYW5nZS5lbWl0KGV2ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPdmVycmlkZSB3cml0ZVZhbHVlIHRvIGFsbG93IHRoZSBtYXNrIGlucHV0XG4gICAqIGVsZW1lbnQgdG8gYmUgdXBkYXRlZCBjb3JyZWN0bHkuXG4gICAqXG4gICAqIEBwYXJhbSB2YWx1ZSAtIHRoZSBuZXcgdmFsdWVcbiAgICovXG4gIHdyaXRlVmFsdWUodmFsdWU6IGFueSkge1xuICAgIHN1cGVyLndyaXRlVmFsdWUodmFsdWUpO1xuXG4gICAgaWYgKHRoaXMualF1ZXJ5RWxlbWVudCkge1xuICAgICAgLy8gVGhlIHByb2Nlc3NpbmcgaXMgcmVxdWlyZWQgdG8gZW5zdXJlIHdlIHVzZSB0aGUgY29ycmVjdCBmb3JtYXRcbiAgICAgIC8vIGluIHRoZSBjb250cm9sLlxuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50LnZhbCh2YWx1ZSk7XG5cbiAgICAgIGlmICh0aGlzLmZpcmVJbnB1dEV2ZW50S2x1ZGdlKSB7XG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKFxuICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnaW5wdXQnKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbiB0aGUgY29udHJvbCBzdGF0dXMgY2hhbmdlcyB0byBvciBmcm9tIFwiRElTQUJMRURcIi5cbiAgICogRGVwZW5kaW5nIG9uIHRoZSB2YWx1ZSwgaXQgd2lsbCBlbmFibGUgb3IgZGlzYWJsZSB0aGUgYXBwcm9wcmlhdGUgRE9NIGVsZW1lbnQuXG4gICAqL1xuICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4gfCB1bmRlZmluZWQpOiB2b2lkIHtcbiAgICB0aGlzLmlzRGlzYWJsZWQgPSBpc0Rpc2FibGVkID8gdHJ1ZSA6IHVuZGVmaW5lZDtcbiAgfVxuXG4gIGdldFZhbHVlKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuaW50ZXJuYWxWYWx1ZTtcbiAgfVxuXG4gIHNldFZhbHVlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICB0aGlzLndyaXRlVmFsdWUodmFsdWUpO1xuICB9XG5cbiAgZm9jdXMoKSB7XG4gICAgdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgfVxufVxuIl19