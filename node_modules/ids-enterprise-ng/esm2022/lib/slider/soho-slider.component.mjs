import { ChangeDetectionStrategy, Component, EventEmitter, HostBinding, Input, Output, } from '@angular/core';
import { BaseControlValueAccessor, provideControlValueAccessor } from '../utils/base-control-value-accessor';
import * as i0 from "@angular/core";
export class SohoSliderComponent extends BaseControlValueAccessor {
    /** Minimum Value */
    set min(min) {
        this.options.min = min;
    }
    get min() {
        return this.options.min;
    }
    /** Maximum Value */
    set max(max) {
        this.options.max = max;
    }
    get max() {
        return this.options.max;
    }
    /** Increment or decrement by step value */
    set step(step) {
        this.options.step = step;
    }
    get step() {
        return this.options.step;
    }
    /** value or a range of values */
    set value(value) {
        this.options.value = value;
        if (this.slider && value) {
            this.slider.setValue(value[0], value[1]);
        }
    }
    get value() {
        if (this.slider) {
            return this.slider.value();
        }
        return this.options.value;
    }
    /** Choose a range of values or select a value */
    set range(range) {
        this.options.range = range;
    }
    get range() {
        return this.options.range;
    }
    /** An array of ticks that provide the value, description and color details */
    set ticks(ticks) {
        this.options.ticks = JSON.parse(ticks);
    }
    /** Persist tooltip */
    set persistTooltip(persistTooltip) {
        this.options.persistTooltip = persistTooltip;
    }
    /** Option to control the position of tooltip. ['top' , 'bottom'] */
    set tooltipPosition(tooltipPosition) {
        this.options.tooltipPosition = tooltipPosition;
    }
    /** Tooltip Content */
    set tooltipContent(tooltipContent) {
        this.options.tooltipContent = tooltipContent;
    }
    /** Set vertical class to render the slider vertically */
    set vertical(isVertical) {
        this.isVertical = isVertical;
    }
    /** Add extra attributes like id's to the component **/
    set attributes(attributes) {
        this.options.attributes = attributes;
    }
    /** Bind attributes to input element */
    get isSlider() {
        return true;
    }
    get isVerticalSlider() {
        return this.isVertical;
    }
    get sliderType() {
        return 'range';
    }
    constructor(element, ngZone) {
        super();
        this.element = element;
        this.ngZone = ngZone;
        /**
         * Called when the slider control changes
         *
         * @todo replace override of native element
         */
        // eslint-disable-next-line @angular-eslint/no-output-native
        this.change = new EventEmitter();
        /** Called when the slider is being slid */
        this.sliding = new EventEmitter();
        /** Called when the slider starts to be slid */
        this.slidestart = new EventEmitter();
        /** Called when the slider is finished sliding, change will also fire here. */
        this.slidestop = new EventEmitter();
        /** Called when the slider is updated when the model value changes */
        this.updated = new EventEmitter();
        /**
         * Local variables
         */
        this.isDisabled = undefined;
        this.isReadOnly = undefined;
        this.isVertical = false;
        this.isVerticalOriginal = false;
        this.options = {};
    }
    set disabled(value) {
        this.isDisabled = value;
        if (this.slider) {
            if (value) {
                this.ngZone.runOutsideAngular(() => this.slider?.disable());
                this.isDisabled = true;
            }
            else {
                this.ngZone.runOutsideAngular(() => this.slider?.enable());
                this.isDisabled = false;
                this.isReadOnly = false;
            }
        }
    }
    get disabled() {
        return this.isDisabled;
    }
    set readonly(value) {
        this.isReadOnly = value;
        if (value) {
            this.ngZone.runOutsideAngular(() => this.slider?.readonly());
            this.isReadOnly = true;
        }
        else {
            this.ngZone.runOutsideAngular(() => this.slider?.enable());
            this.isReadOnly = false;
            this.isDisabled = false;
        }
    }
    get readonly() {
        return this.isReadOnly;
    }
    ngAfterViewInit() {
        this.ngZone.runOutsideAngular(() => {
            this.jQueryElement = jQuery(this.element.nativeElement);
            this.jQueryElement.slider(this.options);
            this.slider = this.jQueryElement.data('slider');
            // Bind to events
            this.jQueryElement
                .on('slidestart', (event) => this.onSlideStop(event))
                .on('slidestop', (event) => this.onSlideStart(event))
                .on('sliding', (event) => this.onSliding(event))
                .on('change', (event) => this.onChange(event))
                .on('updated', (event) => this.onUpdated(event));
            this.runUpdatedOnCheck = true;
        });
    }
    ngAfterViewChecked() {
        if (this.slider && this.runUpdatedOnCheck) {
            // Ensure the default disabled flag is applied.
            this.disabled = this.isDisabled;
            // Delay updated a bit so the class is also set for updated to render correctly.
            if (this.isVerticalOriginal !== this.isVertical) {
                this.slider.updated();
                this.isVerticalOriginal = this.isVertical;
            }
            this.ngZone.runOutsideAngular(() => {
                this.runUpdatedOnCheck = false;
            });
        }
    }
    ngOnDestroy() {
        if (this.slider) {
            this.slider.destroy();
            this.slider = null;
        }
    }
    onChange(event) {
        const newValue = this.jQueryElement?.val();
        if (this.internalValue !== newValue) {
            // Update the model ...
            this.internalValue = newValue;
            event.data = newValue;
            // ... then emit the changed value.
            this.change.emit(event);
        }
    }
    onSliding(event) {
        event.data = this.jQueryElement?.val();
        this.sliding.emit(event);
    }
    onSlideStart(event) {
        event.data = this.jQueryElement?.val();
        this.slidestart.emit(event);
    }
    onSlideStop(event) {
        event.data = this.jQueryElement?.val();
        this.slidestop.emit(event);
    }
    onUpdated(event) {
        event.data = this.jQueryElement?.val();
        this.updated.emit(event);
    }
    /**
     * This function is called when the control status changes to or from "DISABLED".
     * Depending on the value, it will enable or disable the appropriate DOM element.
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoSliderComponent, deps: [{ token: i0.ElementRef }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: SohoSliderComponent, selector: "input[soho-slider]", inputs: { min: "min", max: "max", step: "step", value: "value", range: "range", ticks: "ticks", persistTooltip: "persistTooltip", tooltipPosition: "tooltipPosition", tooltipContent: "tooltipContent", vertical: "vertical", attributes: "attributes", disabled: "disabled", readonly: "readonly" }, outputs: { change: "change", sliding: "sliding", slidestart: "slidestart", slidestop: "slidestop", updated: "updated" }, host: { properties: { "class.slider": "this.isSlider", "class.vertical": "this.isVerticalSlider", "attr.type": "this.sliderType" } }, providers: [provideControlValueAccessor(SohoSliderComponent)], usesInheritance: true, ngImport: i0, template: '<ng-content></ng-content>', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoSliderComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'input[soho-slider]',
                    template: '<ng-content></ng-content>',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [provideControlValueAccessor(SohoSliderComponent)]
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.NgZone }]; }, propDecorators: { min: [{
                type: Input
            }], max: [{
                type: Input
            }], step: [{
                type: Input
            }], value: [{
                type: Input
            }], range: [{
                type: Input
            }], ticks: [{
                type: Input
            }], persistTooltip: [{
                type: Input
            }], tooltipPosition: [{
                type: Input
            }], tooltipContent: [{
                type: Input
            }], vertical: [{
                type: Input
            }], attributes: [{
                type: Input
            }], change: [{
                type: Output
            }], sliding: [{
                type: Output
            }], slidestart: [{
                type: Output
            }], slidestop: [{
                type: Output
            }], updated: [{
                type: Output
            }], isSlider: [{
                type: HostBinding,
                args: ['class.slider']
            }], isVerticalSlider: [{
                type: HostBinding,
                args: ['class.vertical']
            }], sliderType: [{
                type: HostBinding,
                args: ['attr.type']
            }], disabled: [{
                type: Input
            }], readonly: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1zbGlkZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvaWRzLWVudGVycHJpc2Utbmcvc3JjL2xpYi9zbGlkZXIvc29oby1zbGlkZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFHTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUVULFlBQVksRUFDWixXQUFXLEVBQ1gsS0FBSyxFQUdMLE1BQU0sR0FDUCxNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQ0wsd0JBQXdCLEVBQ3hCLDJCQUEyQixFQUM1QixNQUFNLHNDQUFzQyxDQUFDOztBQVM5QyxNQUFNLE9BQU8sbUJBQW9CLFNBQVEsd0JBQWdDO0lBT3ZFLG9CQUFvQjtJQUNwQixJQUFvQixHQUFHLENBQUMsR0FBdUI7UUFDN0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO0lBQ3pCLENBQUM7SUFDRCxJQUFXLEdBQUc7UUFDWixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDO0lBQzFCLENBQUM7SUFFRCxvQkFBb0I7SUFDcEIsSUFBb0IsR0FBRyxDQUFDLEdBQXVCO1FBQzdDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztJQUN6QixDQUFDO0lBQ0QsSUFBVyxHQUFHO1FBQ1osT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQztJQUMxQixDQUFDO0lBQ0QsMkNBQTJDO0lBQzNDLElBQW9CLElBQUksQ0FBQyxJQUF3QjtRQUMvQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDM0IsQ0FBQztJQUNELElBQVcsSUFBSTtRQUNiLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7SUFDM0IsQ0FBQztJQUVELGlDQUFpQztJQUNqQyxJQUFvQixLQUFLLENBQUMsS0FBMkI7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S0FBSztzQkFBeEIsS0FBSztnQkFLTyxjQUFjO3NCQUExQixLQUFLO2dCQUtPLGVBQWU7c0JBQTNCLEtBQUs7Z0JBS08sY0FBYztzQkFBMUIsS0FBSztnQkFLTyxRQUFRO3NCQUFwQixLQUFLO2dCQUtPLFVBQVU7c0JBQXRCLEtBQUs7Z0JBVUksTUFBTTtzQkFBZixNQUFNO2dCQUdHLE9BQU87c0JBQWhCLE1BQU07Z0JBR0csVUFBVTtzQkFBbkIsTUFBTTtnQkFHRyxTQUFTO3NCQUFsQixNQUFNO2dCQUdHLE9BQU87c0JBQWhCLE1BQU07Z0JBRzBCLFFBQVE7c0JBQXhDLFdBQVc7dUJBQUMsY0FBYztnQkFJUSxnQkFBZ0I7c0JBQWxELFdBQVc7dUJBQUMsZ0JBQWdCO2dCQUlDLFVBQVU7c0JBQXZDLFdBQVc7dUJBQUMsV0FBVztnQkFvQlgsUUFBUTtzQkFBcEIsS0FBSztnQkFrQk8sUUFBUTtzQkFBcEIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0NoZWNrZWQsXG4gIEFmdGVyVmlld0luaXQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIElucHV0LFxuICBOZ1pvbmUsXG4gIE9uRGVzdHJveSxcbiAgT3V0cHV0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHtcbiAgQmFzZUNvbnRyb2xWYWx1ZUFjY2Vzc29yLFxuICBwcm92aWRlQ29udHJvbFZhbHVlQWNjZXNzb3Jcbn0gZnJvbSAnLi4vdXRpbHMvYmFzZS1jb250cm9sLXZhbHVlLWFjY2Vzc29yJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnaW5wdXRbc29oby1zbGlkZXJdJywgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICB0ZW1wbGF0ZTogJzxuZy1jb250ZW50PjwvbmctY29udGVudD4nLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgcHJvdmlkZXJzOiBbcHJvdmlkZUNvbnRyb2xWYWx1ZUFjY2Vzc29yKFNvaG9TbGlkZXJDb21wb25lbnQpXVxufSlcblxuZXhwb3J0IGNsYXNzIFNvaG9TbGlkZXJDb21wb25lbnQgZXh0ZW5kcyBCYXNlQ29udHJvbFZhbHVlQWNjZXNzb3I8bnVtYmVyPiBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIEFmdGVyVmlld0NoZWNrZWQsIE9uRGVzdHJveSB7XG5cbiAgLyoqXG4gICAqIEZsYWcgdG8gZm9yY2UgYW4gdXBkYXRlIG9mIHRoZSBjb250cm9sIGFmdGVyIHRoZSB2aWV3IGlzIGNyZWF0ZWQuXG4gICAqL1xuICBwcml2YXRlIHJ1blVwZGF0ZWRPbkNoZWNrPzogYm9vbGVhbjtcblxuICAvKiogTWluaW11bSBWYWx1ZSAqL1xuICBASW5wdXQoKSBwdWJsaWMgc2V0IG1pbihtaW46IG51bWJlciB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMub3B0aW9ucy5taW4gPSBtaW47XG4gIH1cbiAgcHVibGljIGdldCBtaW4oKTogbnVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLm1pbjtcbiAgfVxuXG4gIC8qKiBNYXhpbXVtIFZhbHVlICovXG4gIEBJbnB1dCgpIHB1YmxpYyBzZXQgbWF4KG1heDogbnVtYmVyIHwgdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5vcHRpb25zLm1heCA9IG1heDtcbiAgfVxuICBwdWJsaWMgZ2V0IG1heCgpOiBudW1iZXIgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnMubWF4O1xuICB9XG4gIC8qKiBJbmNyZW1lbnQgb3IgZGVjcmVtZW50IGJ5IHN0ZXAgdmFsdWUgKi9cbiAgQElucHV0KCkgcHVibGljIHNldCBzdGVwKHN0ZXA6IG51bWJlciB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMub3B0aW9ucy5zdGVwID0gc3RlcDtcbiAgfVxuICBwdWJsaWMgZ2V0IHN0ZXAoKTogbnVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLnN0ZXA7XG4gIH1cblxuICAvKiogdmFsdWUgb3IgYSByYW5nZSBvZiB2YWx1ZXMgKi9cbiAgQElucHV0KCkgcHVibGljIHNldCB2YWx1ZSh2YWx1ZTogbnVtYmVyW10gfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLm9wdGlvbnMudmFsdWUgPSB2YWx1ZTtcbiAgICBpZiAodGhpcy5zbGlkZXIgJiYgdmFsdWUpIHtcbiAgICAgIHRoaXMuc2xpZGVyLnNldFZhbHVlKHZhbHVlWzBdLCB2YWx1ZVsxXSk7XG4gICAgfVxuICB9XG4gIHB1YmxpYyBnZXQgdmFsdWUoKTogbnVtYmVyW10gfCB1bmRlZmluZWQge1xuICAgIGlmICh0aGlzLnNsaWRlcikge1xuICAgICAgcmV0dXJuIHRoaXMuc2xpZGVyLnZhbHVlKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLm9wdGlvbnMudmFsdWU7XG4gIH1cblxuICAvKiogQ2hvb3NlIGEgcmFuZ2Ugb2YgdmFsdWVzIG9yIHNlbGVjdCBhIHZhbHVlICovXG4gIEBJbnB1dCgpIHB1YmxpYyBzZXQgcmFuZ2UocmFuZ2U6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLm9wdGlvbnMucmFuZ2UgPSByYW5nZTtcbiAgfVxuICBwdWJsaWMgZ2V0IHJhbmdlKCk6IGJvb2xlYW4gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnMucmFuZ2U7XG4gIH1cblxuICAvKiogQW4gYXJyYXkgb2YgdGlja3MgdGhhdCBwcm92aWRlIHRoZSB2YWx1ZSwgZGVzY3JpcHRpb24gYW5kIGNvbG9yIGRldGFpbHMgKi9cbiAgQElucHV0KCkgcHVibGljIHNldCB0aWNrcyh0aWNrczogc3RyaW5nKSB7XG4gICAgdGhpcy5vcHRpb25zLnRpY2tzID0gSlNPTi5wYXJzZSh0aWNrcyk7XG4gIH1cblxuICAvKiogUGVyc2lzdCB0b29sdGlwICovXG4gIEBJbnB1dCgpIHNldCBwZXJzaXN0VG9vbHRpcChwZXJzaXN0VG9vbHRpcDogYm9vbGVhbikge1xuICAgIHRoaXMub3B0aW9ucy5wZXJzaXN0VG9vbHRpcCA9IHBlcnNpc3RUb29sdGlwO1xuICB9XG5cbiAgLyoqIE9wdGlvbiB0byBjb250cm9sIHRoZSBwb3NpdGlvbiBvZiB0b29sdGlwLiBbJ3RvcCcgLCAnYm90dG9tJ10gKi9cbiAgQElucHV0KCkgc2V0IHRvb2x0aXBQb3NpdGlvbih0b29sdGlwUG9zaXRpb246ICd0b3AnIHwgJ2JvdHRvbScpIHtcbiAgICB0aGlzLm9wdGlvbnMudG9vbHRpcFBvc2l0aW9uID0gdG9vbHRpcFBvc2l0aW9uO1xuICB9XG5cbiAgLyoqIFRvb2x0aXAgQ29udGVudCAqL1xuICBASW5wdXQoKSBzZXQgdG9vbHRpcENvbnRlbnQodG9vbHRpcENvbnRlbnQ6IHN0cmluZ1tdKSB7XG4gICAgdGhpcy5vcHRpb25zLnRvb2x0aXBDb250ZW50ID0gdG9vbHRpcENvbnRlbnQ7XG4gIH1cblxuICAvKiogU2V0IHZlcnRpY2FsIGNsYXNzIHRvIHJlbmRlciB0aGUgc2xpZGVyIHZlcnRpY2FsbHkgKi9cbiAgQElucHV0KCkgc2V0IHZlcnRpY2FsKGlzVmVydGljYWw6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmlzVmVydGljYWwgPSBpc1ZlcnRpY2FsO1xuICB9XG5cbiAgLyoqIEFkZCBleHRyYSBhdHRyaWJ1dGVzIGxpa2UgaWQncyB0byB0aGUgY29tcG9uZW50ICoqL1xuICBASW5wdXQoKSBzZXQgYXR0cmlidXRlcyhhdHRyaWJ1dGVzOiBBcnJheTxPYmplY3Q+IHwgT2JqZWN0KSB7XG4gICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGxlZCB3aGVuIHRoZSBzbGlkZXIgY29udHJvbCBjaGFuZ2VzXG4gICAqXG4gICAqIEB0b2RvIHJlcGxhY2Ugb3ZlcnJpZGUgb2YgbmF0aXZlIGVsZW1lbnRcbiAgICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LW5hdGl2ZVxuICBAT3V0cHV0KCkgY2hhbmdlOiBFdmVudEVtaXR0ZXI8U29ob1NsaWRlckV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8U29ob1NsaWRlckV2ZW50PigpO1xuXG4gIC8qKiBDYWxsZWQgd2hlbiB0aGUgc2xpZGVyIGlzIGJlaW5nIHNsaWQgKi9cbiAgQE91dHB1dCgpIHNsaWRpbmc6IEV2ZW50RW1pdHRlcjxTb2hvU2xpZGVyRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxTb2hvU2xpZGVyRXZlbnQ+KCk7XG5cbiAgLyoqIENhbGxlZCB3aGVuIHRoZSBzbGlkZXIgc3RhcnRzIHRvIGJlIHNsaWQgKi9cbiAgQE91dHB1dCgpIHNsaWRlc3RhcnQ6IEV2ZW50RW1pdHRlcjxTb2hvU2xpZGVyRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxTb2hvU2xpZGVyRXZlbnQ+KCk7XG5cbiAgLyoqIENhbGxlZCB3aGVuIHRoZSBzbGlkZXIgaXMgZmluaXNoZWQgc2xpZGluZywgY2hhbmdlIHdpbGwgYWxzbyBmaXJlIGhlcmUuICovXG4gIEBPdXRwdXQoKSBzbGlkZXN0b3A6IEV2ZW50RW1pdHRlcjxTb2hvU2xpZGVyRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxTb2hvU2xpZGVyRXZlbnQ+KCk7XG5cbiAgLyoqIENhbGxlZCB3aGVuIHRoZSBzbGlkZXIgaXMgdXBkYXRlZCB3aGVuIHRoZSBtb2RlbCB2YWx1ZSBjaGFuZ2VzICovXG4gIEBPdXRwdXQoKSB1cGRhdGVkOiBFdmVudEVtaXR0ZXI8U29ob1NsaWRlckV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8U29ob1NsaWRlckV2ZW50PigpO1xuXG4gIC8qKiBCaW5kIGF0dHJpYnV0ZXMgdG8gaW5wdXQgZWxlbWVudCAqL1xuICBASG9zdEJpbmRpbmcoJ2NsYXNzLnNsaWRlcicpIGdldCBpc1NsaWRlcigpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnY2xhc3MudmVydGljYWwnKSBnZXQgaXNWZXJ0aWNhbFNsaWRlcigpIHtcbiAgICByZXR1cm4gdGhpcy5pc1ZlcnRpY2FsO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLnR5cGUnKSBnZXQgc2xpZGVyVHlwZSgpIHtcbiAgICByZXR1cm4gJ3JhbmdlJztcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2NhbCB2YXJpYWJsZXNcbiAgICovXG4gIHByaXZhdGUgaXNEaXNhYmxlZD86IGJvb2xlYW4gPSB1bmRlZmluZWQ7XG4gIHByaXZhdGUgaXNSZWFkT25seT86IGJvb2xlYW4gPSB1bmRlZmluZWQ7XG4gIHByaXZhdGUgaXNWZXJ0aWNhbCA9IGZhbHNlO1xuICBwcml2YXRlIGlzVmVydGljYWxPcmlnaW5hbCA9IGZhbHNlO1xuXG4gIHByaXZhdGUgalF1ZXJ5RWxlbWVudD86IEpRdWVyeTtcbiAgcHJpdmF0ZSBzbGlkZXI/OiBTb2hvU2xpZGVyU3RhdGljIHwgbnVsbDtcbiAgcHJpdmF0ZSBvcHRpb25zOiBTb2hvU2xpZGVyT3B0aW9ucyA9IHt9O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudDogRWxlbWVudFJlZiwgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSwpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IGRpc2FibGVkKHZhbHVlOiBib29sZWFuIHwgdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5pc0Rpc2FibGVkID0gdmFsdWU7XG4gICAgaWYgKHRoaXMuc2xpZGVyKSB7XG4gICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4gdGhpcy5zbGlkZXI/LmRpc2FibGUoKSk7XG4gICAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLnNsaWRlcj8uZW5hYmxlKCkpO1xuICAgICAgICB0aGlzLmlzRGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc1JlYWRPbmx5ID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ2V0IGRpc2FibGVkKCk6IGJvb2xlYW4gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmlzRGlzYWJsZWQ7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgcmVhZG9ubHkodmFsdWU6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLmlzUmVhZE9ubHkgPSB2YWx1ZTtcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuc2xpZGVyPy5yZWFkb25seSgpKTtcbiAgICAgIHRoaXMuaXNSZWFkT25seSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuc2xpZGVyPy5lbmFibGUoKSk7XG4gICAgICB0aGlzLmlzUmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGdldCByZWFkb25seSgpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5pc1JlYWRPbmx5O1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudCA9IGpRdWVyeSh0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCk7XG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQuc2xpZGVyKHRoaXMub3B0aW9ucyk7XG4gICAgICB0aGlzLnNsaWRlciA9IHRoaXMualF1ZXJ5RWxlbWVudC5kYXRhKCdzbGlkZXInKTtcblxuICAgICAgLy8gQmluZCB0byBldmVudHNcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudFxuICAgICAgICAub24oJ3NsaWRlc3RhcnQnLCAoZXZlbnQ6IFNvaG9TbGlkZXJFdmVudCkgPT4gdGhpcy5vblNsaWRlU3RvcChldmVudCkpXG4gICAgICAgIC5vbignc2xpZGVzdG9wJywgKGV2ZW50OiBTb2hvU2xpZGVyRXZlbnQpID0+IHRoaXMub25TbGlkZVN0YXJ0KGV2ZW50KSlcbiAgICAgICAgLm9uKCdzbGlkaW5nJywgKGV2ZW50OiBTb2hvU2xpZGVyRXZlbnQpID0+IHRoaXMub25TbGlkaW5nKGV2ZW50KSlcbiAgICAgICAgLm9uKCdjaGFuZ2UnLCAoZXZlbnQ6IFNvaG9TbGlkZXJFdmVudCkgPT4gdGhpcy5vbkNoYW5nZShldmVudCkpXG4gICAgICAgIC5vbigndXBkYXRlZCcsIChldmVudDogU29ob1NsaWRlckV2ZW50KSA9PiB0aGlzLm9uVXBkYXRlZChldmVudCkpO1xuXG4gICAgICB0aGlzLnJ1blVwZGF0ZWRPbkNoZWNrID0gdHJ1ZTtcbiAgICB9KTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpIHtcbiAgICBpZiAodGhpcy5zbGlkZXIgJiYgdGhpcy5ydW5VcGRhdGVkT25DaGVjaykge1xuICAgICAgLy8gRW5zdXJlIHRoZSBkZWZhdWx0IGRpc2FibGVkIGZsYWcgaXMgYXBwbGllZC5cbiAgICAgIHRoaXMuZGlzYWJsZWQgPSB0aGlzLmlzRGlzYWJsZWQ7XG4gICAgICAvLyBEZWxheSB1cGRhdGVkIGEgYml0IHNvIHRoZSBjbGFzcyBpcyBhbHNvIHNldCBmb3IgdXBkYXRlZCB0byByZW5kZXIgY29ycmVjdGx5LlxuICAgICAgaWYgKHRoaXMuaXNWZXJ0aWNhbE9yaWdpbmFsICE9PSB0aGlzLmlzVmVydGljYWwpIHtcbiAgICAgICAgdGhpcy5zbGlkZXIudXBkYXRlZCgpO1xuICAgICAgICB0aGlzLmlzVmVydGljYWxPcmlnaW5hbCA9IHRoaXMuaXNWZXJ0aWNhbDtcbiAgICAgIH1cblxuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICB0aGlzLnJ1blVwZGF0ZWRPbkNoZWNrID0gZmFsc2U7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5zbGlkZXIpIHtcbiAgICAgIHRoaXMuc2xpZGVyLmRlc3Ryb3koKTtcbiAgICAgIHRoaXMuc2xpZGVyID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBvbkNoYW5nZShldmVudDogU29ob1NsaWRlckV2ZW50KSB7XG4gICAgY29uc3QgbmV3VmFsdWUgPSB0aGlzLmpRdWVyeUVsZW1lbnQ/LnZhbCgpIGFzIG51bWJlcjtcbiAgICBpZiAodGhpcy5pbnRlcm5hbFZhbHVlICE9PSBuZXdWYWx1ZSkge1xuICAgICAgLy8gVXBkYXRlIHRoZSBtb2RlbCAuLi5cbiAgICAgIHRoaXMuaW50ZXJuYWxWYWx1ZSA9IG5ld1ZhbHVlO1xuICAgICAgZXZlbnQuZGF0YSA9IG5ld1ZhbHVlO1xuXG4gICAgICAvLyAuLi4gdGhlbiBlbWl0IHRoZSBjaGFuZ2VkIHZhbHVlLlxuICAgICAgdGhpcy5jaGFuZ2UuZW1pdChldmVudCk7XG4gICAgfVxuICB9XG5cbiAgb25TbGlkaW5nKGV2ZW50OiBTb2hvU2xpZGVyRXZlbnQpIHtcbiAgICBldmVudC5kYXRhID0gdGhpcy5qUXVlcnlFbGVtZW50Py52YWwoKTtcbiAgICB0aGlzLnNsaWRpbmcuZW1pdChldmVudCk7XG4gIH1cblxuICBvblNsaWRlU3RhcnQoZXZlbnQ6IFNvaG9TbGlkZXJFdmVudCkge1xuICAgIGV2ZW50LmRhdGEgPSB0aGlzLmpRdWVyeUVsZW1lbnQ/LnZhbCgpO1xuICAgIHRoaXMuc2xpZGVzdGFydC5lbWl0KGV2ZW50KTtcbiAgfVxuXG4gIG9uU2xpZGVTdG9wKGV2ZW50OiBTb2hvU2xpZGVyRXZlbnQpIHtcbiAgICBldmVudC5kYXRhID0gdGhpcy5qUXVlcnlFbGVtZW50Py52YWwoKTtcbiAgICB0aGlzLnNsaWRlc3RvcC5lbWl0KGV2ZW50KTtcbiAgfVxuXG4gIG9uVXBkYXRlZChldmVudDogU29ob1NsaWRlckV2ZW50KSB7XG4gICAgZXZlbnQuZGF0YSA9IHRoaXMualF1ZXJ5RWxlbWVudD8udmFsKCk7XG4gICAgdGhpcy51cGRhdGVkLmVtaXQoZXZlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW4gdGhlIGNvbnRyb2wgc3RhdHVzIGNoYW5nZXMgdG8gb3IgZnJvbSBcIkRJU0FCTEVEXCIuXG4gICAqIERlcGVuZGluZyBvbiB0aGUgdmFsdWUsIGl0IHdpbGwgZW5hYmxlIG9yIGRpc2FibGUgdGhlIGFwcHJvcHJpYXRlIERPTSBlbGVtZW50LlxuICAgKi9cbiAgc2V0RGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XG4gIH1cbn1cbiJdfQ==