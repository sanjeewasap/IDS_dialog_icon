import { Component, ChangeDetectionStrategy, EventEmitter, HostBinding, Input, Output } from '@angular/core';
import { BaseControlValueAccessor, provideControlValueAccessor } from '../utils/base-control-value-accessor';
import * as i0 from "@angular/core";
export class SohoSpinboxComponent extends BaseControlValueAccessor {
    set disabled(value) {
        this.internalIsDisabled = value;
        if (this.spinbox) {
            if (value) {
                this.ngZone.runOutsideAngular(() => this.spinbox?.disable());
            }
            else {
                this.ngZone.runOutsideAngular(() => this.spinbox?.enable());
            }
        }
        else {
            this.runUpdatedOnCheck = true;
        }
    }
    get disabled() {
        return this.internalIsDisabled;
    }
    get spinboxType() {
        return 'text';
    }
    /**
     * Value of the spin box.
     */
    set value(val) {
        if (this.spinbox) {
            this.spinbox.updateVal(val);
        }
        this.internalValue = val;
    }
    get value() {
        return this.internalValue;
    }
    set attrDisabled(_value) {
        console.warn(`soho-spinbox 'disabled' input has been deprecated, please use '[attr.disabled]'.`);
    }
    updateVal(value) {
        if (this.spinbox) {
            this.spinbox.updateVal(value);
        }
        this.value = value;
    }
    /**
     * Creates an instance of SohoSpinboxComponent.
     *
     * @param element matched element.
     * @param ngZone angular zone.
     *
     */
    constructor(element, ngZone) {
        super();
        this.element = element;
        this.ngZone = ngZone;
        /**
         * @todo replace override of native element
         */
        // eslint-disable-next-line @angular-eslint/no-output-native
        this.change = new EventEmitter();
        // Set the spinbox class.
        this.spinboxClass = true;
        this.options = {};
    }
    ngAfterViewInit() {
        // call outside the angular zone so change detection
        // isn't triggered by the soho component.
        this.ngZone.runOutsideAngular(() => {
            // assign element to local variable
            this.jQueryElement = jQuery(this.element.nativeElement);
            // initialise the spinbox control
            this.jQueryElement.spinbox(this.options);
            // extract the api
            this.spinbox = this.jQueryElement.data('spinbox');
            // @todo - add event binding control so we don't bind if not required.
            this.jQueryElement
                .on('change', (event) => this.onChange(event));
            // Make sure the value of the control is set appropriately.
            if (this.internalValue) {
                this.jQueryElement.val(this.internalValue);
            }
            this.runUpdatedOnCheck = true;
        });
    }
    ngAfterViewChecked() {
        if (this.runUpdatedOnCheck) {
            // Enforce the initial disabled value (this handles the zone internall)
            this.disabled = this.internalIsDisabled;
            this.runUpdatedOnCheck = false;
        }
    }
    ngOnDestroy() {
        this.ngZone.runOutsideAngular(() => {
            if (this.jQueryElement) {
                // remove the event listeners on this element.
                this.jQueryElement.off();
                this.jQueryElement = undefined;
            }
            // Destroy any widget resources.
            this.spinbox?.destroy();
            this.spinbox = null;
        });
    }
    onChange(_event) {
        // When the request for data has completed, make sure we
        // update the 'dropdown' control.
        this.ngZone.run(() => {
            const newValue = this.jQueryElement?.val();
            if (this.internalValue !== newValue) {
                // Update the model ...
                this.internalValue = this.jQueryElement?.val();
                // ... then emit the changed value.
                this.change.emit(this.internalValue);
            }
        });
    }
    /**
     * Override writeValue to allow the input element to be updated correctly.
     *
     * @param value the new value
     */
    writeValue(value) {
        super.writeValue(value);
        if (this.jQueryElement) {
            // The processing is required to ensure we use the correct format
            // in the control.
            this.jQueryElement.val(value);
        }
    }
    /**
     * This function is called when the control status changes to or from "DISABLED".
     * Depending on the value, it will enable or disable the appropriate DOM element.
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoSpinboxComponent, deps: [{ token: i0.ElementRef }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: SohoSpinboxComponent, selector: "input[soho-spinbox]", inputs: { disabled: "disabled", id: "id", name: "name", min: "min", max: "max", value: "value", step: "step", attrDisabled: "attrDisabled" }, outputs: { change: "change" }, host: { properties: { "class.spinbox": "this.spinboxClass", "attr.type": "this.spinboxType", "attr.id": "this.id", "attr.name": "this.name", "attr.min": "this.min", "attr.max": "this.max", "attr.value": "this.value", "attr.step": "this.step" } }, providers: [provideControlValueAccessor(SohoSpinboxComponent)], usesInheritance: true, ngImport: i0, template: '<ng-content></ng-content>', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoSpinboxComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'input[soho-spinbox]',
                    template: '<ng-content></ng-content>',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [provideControlValueAccessor(SohoSpinboxComponent)]
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.NgZone }]; }, propDecorators: { disabled: [{
                type: Input
            }], change: [{
                type: Output
            }], spinboxClass: [{
                type: HostBinding,
                args: ['class.spinbox']
            }], spinboxType: [{
                type: HostBinding,
                args: ['attr.type']
            }], id: [{
                type: HostBinding,
                args: ['attr.id']
            }, {
                type: Input
            }], name: [{
                type: HostBinding,
                args: ['attr.name']
            }, {
                type: Input
            }], min: [{
                type: HostBinding,
                args: ['attr.min']
            }, {
                type: Input
            }], max: [{
                type: HostBinding,
                args: ['attr.max']
            }, {
                type: Input
            }], value: [{
                type: HostBinding,
                args: ['attr.value']
            }, {
                type: Input
            }], step: [{
                type: HostBinding,
                args: ['attr.step']
            }, {
                type: Input
            }], attrDisabled: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1zcGluYm94LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2lkcy1lbnRlcnByaXNlLW5nL3NyYy9saWIvc3BpbmJveC9zb2hvLXNwaW5ib3guY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFHTCxTQUFTLEVBQ1QsdUJBQXVCLEVBRXZCLFlBQVksRUFDWixXQUFXLEVBQ1gsS0FBSyxFQUVMLE1BQU0sRUFFUCxNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQ0wsd0JBQXdCLEVBQ3hCLDJCQUEyQixFQUM1QixNQUFNLHNDQUFzQyxDQUFDOztBQVE5QyxNQUFNLE9BQU8sb0JBQXFCLFNBQVEsd0JBQWdDO0lBTXhFLElBQWEsUUFBUSxDQUFDLEtBQTBCO1FBQzlDLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxLQUFLLENBQUM7UUFDaEMsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2hCLElBQUksS0FBSyxFQUFFO2dCQUNULElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDO2FBQzlEO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO2FBQzdEO1NBQ0Y7YUFBTTtZQUNMLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUM7U0FDL0I7SUFDSCxDQUFDO0lBQ0QsSUFBSSxRQUFRO1FBQ1YsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUM7SUFDakMsQ0FBQztJQVdELElBQThCLFdBQVc7UUFDdkMsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQU9EOztPQUVHO0lBQ0gsSUFBK0MsS0FBSyxDQUFDLEdBQTBC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SztnQkFvQkksTUFBTTtzQkFBZixNQUFNO2dCQUd1QixZQUFZO3NCQUF6QyxXQUFXO3VCQUFDLGVBQWU7Z0JBRUUsV0FBVztzQkFBeEMsV0FBVzt1QkFBQyxXQUFXO2dCQUlTLEVBQUU7c0JBQWxDLFdBQVc7dUJBQUMsU0FBUzs7c0JBQUcsS0FBSztnQkFDSyxJQUFJO3NCQUF0QyxXQUFXO3VCQUFDLFdBQVc7O3NCQUFHLEtBQUs7Z0JBQ0UsR0FBRztzQkFBcEMsV0FBVzt1QkFBQyxVQUFVOztzQkFBRyxLQUFLO2dCQUNHLEdBQUc7c0JBQXBDLFdBQVc7dUJBQUMsVUFBVTs7c0JBQUcsS0FBSztnQkFLZ0IsS0FBSztzQkFBbkQsV0FBVzt1QkFBQyxZQUFZOztzQkFBRyxLQUFLO2dCQVVFLElBQUk7c0JBQXRDLFdBQVc7dUJBQUMsV0FBVzs7c0JBQUcsS0FBSztnQkFFbkIsWUFBWTtzQkFBeEIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0NoZWNrZWQsXG4gIEFmdGVyVmlld0luaXQsXG4gIENvbXBvbmVudCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIElucHV0LFxuICBPbkRlc3Ryb3ksXG4gIE91dHB1dCxcbiAgTmdab25lXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQge1xuICBCYXNlQ29udHJvbFZhbHVlQWNjZXNzb3IsXG4gIHByb3ZpZGVDb250cm9sVmFsdWVBY2Nlc3NvclxufSBmcm9tICcuLi91dGlscy9iYXNlLWNvbnRyb2wtdmFsdWUtYWNjZXNzb3InO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdpbnB1dFtzb2hvLXNwaW5ib3hdJywgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICB0ZW1wbGF0ZTogJzxuZy1jb250ZW50PjwvbmctY29udGVudD4nLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgcHJvdmlkZXJzOiBbcHJvdmlkZUNvbnRyb2xWYWx1ZUFjY2Vzc29yKFNvaG9TcGluYm94Q29tcG9uZW50KV1cbn0pXG5leHBvcnQgY2xhc3MgU29ob1NwaW5ib3hDb21wb25lbnQgZXh0ZW5kcyBCYXNlQ29udHJvbFZhbHVlQWNjZXNzb3I8bnVtYmVyPiBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIEFmdGVyVmlld0NoZWNrZWQsIE9uRGVzdHJveSB7XG5cbiAgLyoqIERpc2FibGVkIGZsYWcgLSB1c2VkIGJ5IGluaXRpYWxpc2F0aW9uLiAqL1xuICBpbnRlcm5hbElzRGlzYWJsZWQ/OiBib29sZWFuO1xuICBwcml2YXRlIHJ1blVwZGF0ZWRPbkNoZWNrPzogYm9vbGVhbjtcblxuICBASW5wdXQoKSBzZXQgZGlzYWJsZWQodmFsdWU6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLmludGVybmFsSXNEaXNhYmxlZCA9IHZhbHVlO1xuICAgIGlmICh0aGlzLnNwaW5ib3gpIHtcbiAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLnNwaW5ib3g/LmRpc2FibGUoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLnNwaW5ib3g/LmVuYWJsZSgpKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5ydW5VcGRhdGVkT25DaGVjayA9IHRydWU7XG4gICAgfVxuICB9XG4gIGdldCBkaXNhYmxlZCgpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5pbnRlcm5hbElzRGlzYWJsZWQ7XG4gIH1cblxuICAvKipcbiAgICogQHRvZG8gcmVwbGFjZSBvdmVycmlkZSBvZiBuYXRpdmUgZWxlbWVudFxuICAgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtbmF0aXZlXG4gIEBPdXRwdXQoKSBjaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPG51bWJlcj4oKTtcblxuICAvLyBTZXQgdGhlIHNwaW5ib3ggY2xhc3MuXG4gIEBIb3N0QmluZGluZygnY2xhc3Muc3BpbmJveCcpIHNwaW5ib3hDbGFzcyA9IHRydWU7XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLnR5cGUnKSBnZXQgc3BpbmJveFR5cGUoKSB7XG4gICAgcmV0dXJuICd0ZXh0JztcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnYXR0ci5pZCcpIEBJbnB1dCgpIGlkPzogc3RyaW5nO1xuICBASG9zdEJpbmRpbmcoJ2F0dHIubmFtZScpIEBJbnB1dCgpIG5hbWU/OiBzdHJpbmc7XG4gIEBIb3N0QmluZGluZygnYXR0ci5taW4nKSBASW5wdXQoKSBtaW4/OiBudW1iZXI7XG4gIEBIb3N0QmluZGluZygnYXR0ci5tYXgnKSBASW5wdXQoKSBtYXg/OiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIFZhbHVlIG9mIHRoZSBzcGluIGJveC5cbiAgICovXG4gIEBIb3N0QmluZGluZygnYXR0ci52YWx1ZScpIEBJbnB1dCgpIHB1YmxpYyBzZXQgdmFsdWUodmFsOiBudW1iZXIgfCBzdHJpbmcgfCBhbnkpIHtcbiAgICBpZiAodGhpcy5zcGluYm94KSB7XG4gICAgICB0aGlzLnNwaW5ib3gudXBkYXRlVmFsKHZhbCk7XG4gICAgfVxuICAgIHRoaXMuaW50ZXJuYWxWYWx1ZSA9IHZhbDtcbiAgfVxuICBwdWJsaWMgZ2V0IHZhbHVlKCk6IG51bWJlciB8IHN0cmluZyB8IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuaW50ZXJuYWxWYWx1ZTtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnYXR0ci5zdGVwJykgQElucHV0KCkgc3RlcD86IGJvb2xlYW47XG5cbiAgQElucHV0KCkgc2V0IGF0dHJEaXNhYmxlZChfdmFsdWU6IGJvb2xlYW4pIHtcbiAgICBjb25zb2xlLndhcm4oYHNvaG8tc3BpbmJveCAnZGlzYWJsZWQnIGlucHV0IGhhcyBiZWVuIGRlcHJlY2F0ZWQsIHBsZWFzZSB1c2UgJ1thdHRyLmRpc2FibGVkXScuYCk7XG4gIH1cblxuICBwcml2YXRlIG9wdGlvbnM6IFNvaG9TcGluYm94T3B0aW9ucyA9IHt9O1xuICBwcml2YXRlIGpRdWVyeUVsZW1lbnQ/OiBKUXVlcnk7XG4gIHByaXZhdGUgc3BpbmJveD86IFNvaG9TcGluYm94U3RhdGljIHwgbnVsbDtcblxuICB1cGRhdGVWYWwodmFsdWU6IHN0cmluZyB8IG51bWJlcikge1xuICAgIGlmICh0aGlzLnNwaW5ib3gpIHtcbiAgICAgIHRoaXMuc3BpbmJveC51cGRhdGVWYWwodmFsdWUpO1xuICAgIH1cbiAgICB0aGlzLnZhbHVlID0gdmFsdWUgYXMgbnVtYmVyO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgU29ob1NwaW5ib3hDb21wb25lbnQuXG4gICAqXG4gICAqIEBwYXJhbSBlbGVtZW50IG1hdGNoZWQgZWxlbWVudC5cbiAgICogQHBhcmFtIG5nWm9uZSBhbmd1bGFyIHpvbmUuXG4gICAqXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnQ6IEVsZW1lbnRSZWYsIHByaXZhdGUgbmdab25lOiBOZ1pvbmUpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIC8vIGNhbGwgb3V0c2lkZSB0aGUgYW5ndWxhciB6b25lIHNvIGNoYW5nZSBkZXRlY3Rpb25cbiAgICAvLyBpc24ndCB0cmlnZ2VyZWQgYnkgdGhlIHNvaG8gY29tcG9uZW50LlxuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIC8vIGFzc2lnbiBlbGVtZW50IHRvIGxvY2FsIHZhcmlhYmxlXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQgPSBqUXVlcnkodGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQpO1xuXG4gICAgICAvLyBpbml0aWFsaXNlIHRoZSBzcGluYm94IGNvbnRyb2xcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5zcGluYm94KHRoaXMub3B0aW9ucyk7XG5cbiAgICAgIC8vIGV4dHJhY3QgdGhlIGFwaVxuICAgICAgdGhpcy5zcGluYm94ID0gdGhpcy5qUXVlcnlFbGVtZW50LmRhdGEoJ3NwaW5ib3gnKTtcblxuICAgICAgLy8gQHRvZG8gLSBhZGQgZXZlbnQgYmluZGluZyBjb250cm9sIHNvIHdlIGRvbid0IGJpbmQgaWYgbm90IHJlcXVpcmVkLlxuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50XG4gICAgICAgIC5vbignY2hhbmdlJywgKGV2ZW50OiBTb2hvU3BpbmJveEV2ZW50KSA9PiB0aGlzLm9uQ2hhbmdlKGV2ZW50KSk7XG5cbiAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgdmFsdWUgb2YgdGhlIGNvbnRyb2wgaXMgc2V0IGFwcHJvcHJpYXRlbHkuXG4gICAgICBpZiAodGhpcy5pbnRlcm5hbFZhbHVlKSB7XG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC52YWwodGhpcy5pbnRlcm5hbFZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5ydW5VcGRhdGVkT25DaGVjayA9IHRydWU7XG4gICAgfSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0NoZWNrZWQoKSB7XG4gICAgaWYgKHRoaXMucnVuVXBkYXRlZE9uQ2hlY2spIHtcbiAgICAgIC8vIEVuZm9yY2UgdGhlIGluaXRpYWwgZGlzYWJsZWQgdmFsdWUgKHRoaXMgaGFuZGxlcyB0aGUgem9uZSBpbnRlcm5hbGwpXG4gICAgICB0aGlzLmRpc2FibGVkID0gdGhpcy5pbnRlcm5hbElzRGlzYWJsZWQ7XG4gICAgICB0aGlzLnJ1blVwZGF0ZWRPbkNoZWNrID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgaWYgKHRoaXMualF1ZXJ5RWxlbWVudCkge1xuICAgICAgICAvLyByZW1vdmUgdGhlIGV2ZW50IGxpc3RlbmVycyBvbiB0aGlzIGVsZW1lbnQuXG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vZmYoKTtcbiAgICAgICAgdGhpcy5qUXVlcnlFbGVtZW50ID0gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgICAvLyBEZXN0cm95IGFueSB3aWRnZXQgcmVzb3VyY2VzLlxuICAgICAgdGhpcy5zcGluYm94Py5kZXN0cm95KCk7XG4gICAgICB0aGlzLnNwaW5ib3ggPSBudWxsO1xuICAgIH0pO1xuICB9XG5cbiAgb25DaGFuZ2UoX2V2ZW50OiBTb2hvU3BpbmJveEV2ZW50KSB7XG4gICAgLy8gV2hlbiB0aGUgcmVxdWVzdCBmb3IgZGF0YSBoYXMgY29tcGxldGVkLCBtYWtlIHN1cmUgd2VcbiAgICAvLyB1cGRhdGUgdGhlICdkcm9wZG93bicgY29udHJvbC5cbiAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgY29uc3QgbmV3VmFsdWUgPSB0aGlzLmpRdWVyeUVsZW1lbnQ/LnZhbCgpO1xuICAgICAgaWYgKHRoaXMuaW50ZXJuYWxWYWx1ZSAhPT0gbmV3VmFsdWUpIHtcbiAgICAgICAgLy8gVXBkYXRlIHRoZSBtb2RlbCAuLi5cbiAgICAgICAgdGhpcy5pbnRlcm5hbFZhbHVlID0gdGhpcy5qUXVlcnlFbGVtZW50Py52YWwoKSBhcyBudW1iZXI7XG5cbiAgICAgICAgLy8gLi4uIHRoZW4gZW1pdCB0aGUgY2hhbmdlZCB2YWx1ZS5cbiAgICAgICAgdGhpcy5jaGFuZ2UuZW1pdCh0aGlzLmludGVybmFsVmFsdWUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE92ZXJyaWRlIHdyaXRlVmFsdWUgdG8gYWxsb3cgdGhlIGlucHV0IGVsZW1lbnQgdG8gYmUgdXBkYXRlZCBjb3JyZWN0bHkuXG4gICAqXG4gICAqIEBwYXJhbSB2YWx1ZSB0aGUgbmV3IHZhbHVlXG4gICAqL1xuICB3cml0ZVZhbHVlKHZhbHVlOiBudW1iZXIpIHtcbiAgICBzdXBlci53cml0ZVZhbHVlKHZhbHVlKTtcblxuICAgIGlmICh0aGlzLmpRdWVyeUVsZW1lbnQpIHtcbiAgICAgIC8vIFRoZSBwcm9jZXNzaW5nIGlzIHJlcXVpcmVkIHRvIGVuc3VyZSB3ZSB1c2UgdGhlIGNvcnJlY3QgZm9ybWF0XG4gICAgICAvLyBpbiB0aGUgY29udHJvbC5cbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC52YWwodmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIHRoZSBjb250cm9sIHN0YXR1cyBjaGFuZ2VzIHRvIG9yIGZyb20gXCJESVNBQkxFRFwiLlxuICAgKiBEZXBlbmRpbmcgb24gdGhlIHZhbHVlLCBpdCB3aWxsIGVuYWJsZSBvciBkaXNhYmxlIHRoZSBhcHByb3ByaWF0ZSBET00gZWxlbWVudC5cbiAgICovXG4gIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xuICB9XG59XG4iXX0=