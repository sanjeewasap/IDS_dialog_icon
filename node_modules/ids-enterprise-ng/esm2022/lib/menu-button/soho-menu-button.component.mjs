import { ChangeDetectionStrategy, Component, EventEmitter, HostBinding, Input, Output } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "../icon/soho-icon.component";
export class SohoMenuButtonComponent {
    get isBtnMenu() {
        return true;
    }
    get buttonType() {
        return 'button';
    }
    set autoFocus(value) {
        this.options.autoFocus = value;
        if (this.menuButton) {
            this.menuButton.settings.autoFocus = value;
            this.markForRefresh();
        }
    }
    set mouseFocus(value) {
        this.options.mouseFocus = value;
        if (this.menuButton) {
            this.menuButton.settings.mouseFocus = value;
            this.markForRefresh();
        }
    }
    set showArrow(value) {
        this.options.showArrow = value;
        if (this.menuButton) {
            this.menuButton.settings.showArrow = value;
            this.markForRefresh();
        }
    }
    set returnFocus(value) {
        this.options.returnFocus = value;
        if (this.menuButton) {
            this.menuButton.settings.returnFocus = value;
            this.markForRefresh();
        }
    }
    get returnFocus() {
        return this.options.returnFocus || false;
    }
    set trigger(trigger) {
        this.options.trigger = trigger;
        if (this.menuButton) {
            this.menuButton.settings.trigger = trigger;
            this.markForRefresh();
        }
    }
    set menu(menu) {
        this.options.menu = menu;
        if (this.menuButton) {
            this.menuButton.settings.menu = menu;
            this.markForRefresh();
        }
    }
    set ajaxBeforeOpenFunction(fn) {
        this.options.beforeOpen = fn;
        if (this.menuButton) {
            this.menuButton.settings.beforeOpen = fn;
            // No update required.
        }
    }
    set hideMenuArrow(value) {
        this.buttonOptions.hideMenuArrow = value;
        if (this.button) {
            this.button.settings.hideMenuArrow = value;
            this.markForRefresh();
            // todo: menubutton.js updated() function doesn't seem to tear down the control and rebuild with new settings
        }
    }
    get hideMenuArrow() {
        return this.buttonOptions.hideMenuArrow;
    }
    set offset(value) {
        this.options.offset = value;
        if (this.menuButton) {
            this.menuButton.settings.offset = value;
            this.markForRefresh();
        }
    }
    get offset() {
        return this.menuButton?.settings?.offset || this.options.offset;
    }
    set attachToBody(value) {
        this.options.attachToBody = value;
        if (this.menuButton) {
            this.menuButton.settings.attachToBody = value;
            this.markForRefresh();
        }
    }
    get attachToBody() {
        return this.options.attachToBody;
    }
    set removeOnDestroy(value) {
        this.options.removeOnDestroy = value;
        if (this.menuButton) {
            this.menuButton.settings.removeOnDestroy = value;
            this.markForRefresh();
        }
    }
    get removeOnDestroy() {
        return this.options.removeOnDestroy;
    }
    set ripple(value) {
        this.buttonOptions.ripple = value;
        if (this.button) {
            this.button.settings.ripple = value;
            this.markForRefresh();
        }
    }
    get ripple() {
        return this.button?.settings?.ripple || this.buttonOptions.ripple;
    }
    constructor(element, ref, ngZone) {
        this.element = element;
        this.ref = ref;
        this.ngZone = ngZone;
        // -------------------------------------------
        // Default options block
        // -------------------------------------------
        this.options = {};
        this.buttonOptions = {};
        // -------------------------------------------
        // Component Output
        // -------------------------------------------
        this.selected = new EventEmitter();
        this.beforeopen = new EventEmitter();
        // eslint-disable-next-line @angular-eslint/no-output-rename
        /**
         * @todo remove override of native element
         */
        // eslint-disable-next-line @angular-eslint/no-output-native, @angular-eslint/no-output-rename
        this.open$ = new EventEmitter();
        /**
         * @todo remove override of native element
         */
        // eslint-disable-next-line @angular-eslint/no-output-native, @angular-eslint/no-output-rename
        this.close$ = new EventEmitter();
    }
    ngAfterViewInit() {
        // call outside the angular zone so change detection
        // isn't triggered by the soho component.
        this.ngZone.runOutsideAngular(() => {
            // Wrap the element in a jQuery selector.
            this.jQueryElement = jQuery(this.element.nativeElement);
            // Initialise the soho-button widget.
            this.jQueryElement.button(this.buttonOptions);
            // Retrieve the soho button api.
            this.button = this.jQueryElement.data('button');
            // Initialise the SohoXi Control
            this.jQueryElement.popupmenu(this.options);
            // Retrieve the enterprise api
            this.menuButton = this.jQueryElement.data('popupmenu');
            // Initialize title attribute as a soho tooltip
            if (this.jQueryElement.has('[title]')) {
                this.jQueryElement.tooltip();
            }
            // Add listeners to emit events
            this.jQueryElement
                .on('selected', (e, args) => this.onSelected(e, args))
                .on('beforeopen', (e, args) => this.onBeforeOpen(e, args))
                .on('close', (e, args) => this.onClose(e, args))
                .on('open', (e, args) => this.onOpen(e, args));
        });
    }
    ngAfterViewChecked() {
        if (this.runUpdatedOnCheck) {
            this.ngZone.runOutsideAngular(() => {
                this.menuButton?.updated(this.options);
                this.button?.updated(this.buttonOptions);
                this.runUpdatedOnCheck = false;
            });
        }
    }
    onSelected(e, args) {
        this.ngZone.run(() => {
            this.selected.emit({ e, args });
        });
    }
    onBeforeOpen(e, args) {
        this.ngZone.run(() => {
            this.beforeopen.emit({ e, args });
        });
    }
    onClose(e, args) {
        this.ngZone.run(() => {
            this.close$.emit({ e, args });
        });
    }
    onOpen(e, args) {
        this.ngZone.run(() => {
            this.open$.emit({ e, args });
        });
    }
    updated(menuSettings, buttonSettings) {
        this.ngZone.runOutsideAngular(() => {
            this.menuButton?.updated(menuSettings);
            this.button?.updated(buttonSettings);
        });
    }
    teardown() {
        this.ngZone.runOutsideAngular(() => {
            this.menuButton?.teardown();
        });
    }
    close() {
        this.ngZone.runOutsideAngular(() => {
            this.menuButton?.close();
        });
    }
    open(event, ajaxReturn, useDelay) {
        this.ngZone.runOutsideAngular(() => {
            this.menuButton?.open(event, ajaxReturn, useDelay);
        });
    }
    ngOnDestroy() {
        this.ngZone.runOutsideAngular(() => {
            if (this.jQueryElement) {
                // remove the event listeners on this element.
                this.jQueryElement.off();
                const tooltipApi = this.jQueryElement.data('tooltip');
                tooltipApi?.destroy?.();
                const popupmenuApi = this.jQueryElement.data('popupmenu');
                popupmenuApi?.destroy?.();
                this.jQueryElement = undefined;
            }
            // Destroy any widget resources.
            if (this.menuButton) {
                // @todo raise an issue on this failing on removeData!
                this.menuButton.destroy();
                this.menuButton = null;
            }
            if (this.button) {
                this.button.destroy();
                this.button = null;
            }
        });
    }
    /**
     * Marks the components as requiring a rebuild after the next update.
     */
    markForRefresh() {
        // Run updated on the next updated check.
        this.runUpdatedOnCheck = true;
        // ... make sure the change detector kicks in, otherwise if the inputs
        // were change programmatially the component may not be eligible for
        // updating.
        this.ref.markForCheck();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoMenuButtonComponent, deps: [{ token: i0.ElementRef }, { token: i0.ChangeDetectorRef }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: SohoMenuButtonComponent, selector: "[soho-menu-button]", inputs: { icon: "icon", autoFocus: "autoFocus", mouseFocus: "mouseFocus", showArrow: "showArrow", returnFocus: "returnFocus", trigger: "trigger", menu: "menu", ajaxBeforeOpenFunction: "ajaxBeforeOpenFunction", hideMenuArrow: "hideMenuArrow", offset: "offset", attachToBody: "attachToBody", removeOnDestroy: "removeOnDestroy", ripple: "ripple" }, outputs: { selected: "selected", beforeopen: "beforeopen", open$: "open", close$: "close" }, host: { properties: { "class.btn-menu": "this.isBtnMenu", "attr.type": "this.buttonType" } }, ngImport: i0, template: "<svg soho-icon *ngIf=\"icon\" [icon]=\"icon\"></svg>\n<ng-content></ng-content>\n<svg *ngIf=\"!hideMenuArrow\" soho-icon [icon]=\"'dropdown'\"></svg>\n", styles: [":host ::ng-deep .icon.icon-dropdown:not([soho-icon]){display:none}\n"], dependencies: [{ kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i2.SohoIconComponent, selector: "svg[soho-icon]", inputs: ["isEmptyState", "extraIconClass", "alert", "icon"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoMenuButtonComponent, decorators: [{
            type: Component,
            args: [{ selector: '[soho-menu-button]', changeDetection: ChangeDetectionStrategy.OnPush, template: "<svg soho-icon *ngIf=\"icon\" [icon]=\"icon\"></svg>\n<ng-content></ng-content>\n<svg *ngIf=\"!hideMenuArrow\" soho-icon [icon]=\"'dropdown'\"></svg>\n", styles: [":host ::ng-deep .icon.icon-dropdown:not([soho-icon]){display:none}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.ChangeDetectorRef }, { type: i0.NgZone }]; }, propDecorators: { isBtnMenu: [{
                type: HostBinding,
                args: ['class.btn-menu']
            }], buttonType: [{
                type: HostBinding,
                args: ['attr.type']
            }], selected: [{
                type: Output
            }], beforeopen: [{
                type: Output
            }], open$: [{
                type: Output,
                args: ['open']
            }], close$: [{
                type: Output,
                args: ['close']
            }], icon: [{
                type: Input
            }], autoFocus: [{
                type: Input
            }], mouseFocus: [{
                type: Input
            }], showArrow: [{
                type: Input
            }], returnFocus: [{
                type: Input
            }], trigger: [{
                type: Input
            }], menu: [{
                type: Input
            }], ajaxBeforeOpenFunction: [{
                type: Input
            }], hideMenuArrow: [{
                type: Input
            }], offset: [{
                type: Input
            }], attachToBody: [{
                type: Input
            }], removeOnDestroy: [{
                type: Input
            }], ripple: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1tZW51LWJ1dHRvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9pZHMtZW50ZXJwcmlzZS1uZy9zcmMvbGliL21lbnUtYnV0dG9uL3NvaG8tbWVudS1idXR0b24uY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvaWRzLWVudGVycHJpc2Utbmcvc3JjL2xpYi9tZW51LWJ1dHRvbi9zb2hvLW1lbnUtYnV0dG9uLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUVULFlBQVksRUFDWixXQUFXLEVBQ1gsS0FBSyxFQUVMLE1BQU0sRUFJUCxNQUFNLGVBQWUsQ0FBQzs7OztBQVF2QixNQUFNLE9BQU8sdUJBQXVCO0lBQ2xDLElBQW1DLFNBQVM7UUFDMUMsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0QsSUFBOEIsVUFBVTtRQUN0QyxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBa0RELElBQWEsU0FBUyxDQUFDLEtBQWM7UUFDbkMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1FBQy9CLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNsQixJQUFJLENBQUMsVUFBa0IsQ0FBQyxRQUFRLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztZQUNwRCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDdkI7SUFDSCxDQUFDO0lBRUQsSUFBYSxVQUFVLENBQUMsS0FBYztRQUNwQyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7UUFDaEMsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2xCLElBQUksQ0FBQyxVQUFrQixDQUFDLFFBQVEsQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDO1lBQ3JELElBQUksQ0FBQyxjQUFjLEVBQUUs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QkFXTyxlQUFlO3NCQUEzQixLQUFLO2dCQVdPLE1BQU07c0JBQWxCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIEhvc3RCaW5kaW5nLFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBPdXRwdXQsXG4gIE5nWm9uZSxcbiAgQWZ0ZXJWaWV3Q2hlY2tlZCxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ1tzb2hvLW1lbnUtYnV0dG9uXScsIC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgdGVtcGxhdGVVcmw6ICdzb2hvLW1lbnUtYnV0dG9uLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vc29oby1tZW51LWJ1dHRvbi5jb21wb25lbnQuY3NzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIFNvaG9NZW51QnV0dG9uQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgQWZ0ZXJWaWV3Q2hlY2tlZCwgT25EZXN0cm95IHtcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5idG4tbWVudScpIGdldCBpc0J0bk1lbnUoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLnR5cGUnKSBnZXQgYnV0dG9uVHlwZSgpIHtcbiAgICByZXR1cm4gJ2J1dHRvbic7XG4gIH1cblxuICAvKiogVGhlIHVuZGVybHlpbmcgalF1ZXJ5IGluc3RhbmNlLiAqL1xuICBwcml2YXRlIGpRdWVyeUVsZW1lbnQ/OiBKUXVlcnk7XG5cbiAgLyoqIFRoZSBlbnRlcnByaXNlIHdpZGdldCBhcGkuICovXG4gIHByaXZhdGUgbWVudUJ1dHRvbj86IFNvaG9Qb3B1cE1lbnVTdGF0aWMgfCBudWxsO1xuXG4gIC8qKiBUaGUgYnV0dG9uIHdpZGdldCBhcGkgKi9cbiAgcHJpdmF0ZSBidXR0b24/OiBTb2hvQnV0dG9uU3RhdGljIHwgbnVsbDtcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIERlZmF1bHQgb3B0aW9ucyBibG9ja1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgcHJpdmF0ZSBvcHRpb25zOiBTb2hvUG9wdXBNZW51T3B0aW9ucyA9IHt9O1xuXG4gIHByaXZhdGUgYnV0dG9uT3B0aW9uczogU29ob0J1dHRvbk9wdGlvbnMgPSB7fTtcblxuICAvKipcbiAgICogRmxhZyB0byBmb3JjZSBhbiB1cGRhdGUgb2YgdGhlIGNvbnRyb2wgYWZ0ZXIgdGhlIHZpZXcgaXMgY3JlYXRlZC5cbiAgICovXG4gIHByaXZhdGUgcnVuVXBkYXRlZE9uQ2hlY2s/OiBib29sZWFuO1xuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQ29tcG9uZW50IE91dHB1dFxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgQE91dHB1dCgpIHNlbGVjdGVkID0gbmV3IEV2ZW50RW1pdHRlcjxTb2hvQ29udGV4dE1lbnVFdmVudD4oKTtcbiAgQE91dHB1dCgpIGJlZm9yZW9wZW4gPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9Db250ZXh0TWVudUV2ZW50PigpO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L25vLW91dHB1dC1yZW5hbWVcblxuICAvKipcbiAgICogQHRvZG8gcmVtb3ZlIG92ZXJyaWRlIG9mIG5hdGl2ZSBlbGVtZW50XG4gICAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L25vLW91dHB1dC1uYXRpdmUsIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtcmVuYW1lXG4gIEBPdXRwdXQoJ29wZW4nKSBvcGVuJCA9IG5ldyBFdmVudEVtaXR0ZXI8U29ob0NvbnRleHRNZW51RXZlbnQ+KCk7XG4gIC8qKlxuICAgKiBAdG9kbyByZW1vdmUgb3ZlcnJpZGUgb2YgbmF0aXZlIGVsZW1lbnRcbiAgICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LW5hdGl2ZSwgQGFuZ3VsYXItZXNsaW50L25vLW91dHB1dC1yZW5hbWVcbiAgQE91dHB1dCgnY2xvc2UnKSBjbG9zZSQgPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9Db250ZXh0TWVudUV2ZW50PigpO1xuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQ29tcG9uZW50IElucHV0c1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLyoqIFRoZSBpY29uIHRvIGJlIHVzZWQuICovXG4gIEBJbnB1dCgpIGljb24/OiBzdHJpbmc7XG5cbiAgQElucHV0KCkgc2V0IGF1dG9Gb2N1cyh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMub3B0aW9ucy5hdXRvRm9jdXMgPSB2YWx1ZTtcbiAgICBpZiAodGhpcy5tZW51QnV0dG9uKSB7XG4gICAgICAodGhpcy5tZW51QnV0dG9uIGFzIGFueSkuc2V0dGluZ3MuYXV0b0ZvY3VzID0gdmFsdWU7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IG1vdXNlRm9jdXModmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLm9wdGlvbnMubW91c2VGb2N1cyA9IHZhbHVlO1xuICAgIGlmICh0aGlzLm1lbnVCdXR0b24pIHtcbiAgICAgICh0aGlzLm1lbnVCdXR0b24gYXMgYW55KS5zZXR0aW5ncy5tb3VzZUZvY3VzID0gdmFsdWU7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IHNob3dBcnJvdyh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMub3B0aW9ucy5zaG93QXJyb3cgPSB2YWx1ZTtcbiAgICBpZiAodGhpcy5tZW51QnV0dG9uKSB7XG4gICAgICAodGhpcy5tZW51QnV0dG9uIGFzIGFueSkuc2V0dGluZ3Muc2hvd0Fycm93ID0gdmFsdWU7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IHJldHVybkZvY3VzKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5vcHRpb25zLnJldHVybkZvY3VzID0gdmFsdWU7XG4gICAgaWYgKHRoaXMubWVudUJ1dHRvbikge1xuICAgICAgKHRoaXMubWVudUJ1dHRvbiBhcyBhbnkpLnNldHRpbmdzLnJldHVybkZvY3VzID0gdmFsdWU7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IHJldHVybkZvY3VzKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnMucmV0dXJuRm9jdXMgfHwgZmFsc2U7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgdHJpZ2dlcih0cmlnZ2VyOiBTb2hvUG9wdXBNZW51VHJpZ2dlcikge1xuICAgIHRoaXMub3B0aW9ucy50cmlnZ2VyID0gdHJpZ2dlcjtcbiAgICBpZiAodGhpcy5tZW51QnV0dG9uKSB7XG4gICAgICAodGhpcy5tZW51QnV0dG9uIGFzIGFueSkuc2V0dGluZ3MudHJpZ2dlciA9IHRyaWdnZXI7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IG1lbnUobWVudTogc3RyaW5nIHwgSlF1ZXJ5PEhUTUxFbGVtZW50Pikge1xuICAgIHRoaXMub3B0aW9ucy5tZW51ID0gbWVudTtcbiAgICBpZiAodGhpcy5tZW51QnV0dG9uKSB7XG4gICAgICAodGhpcy5tZW51QnV0dG9uIGFzIGFueSkuc2V0dGluZ3MubWVudSA9IG1lbnU7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IGFqYXhCZWZvcmVPcGVuRnVuY3Rpb24oZm46IEFqYXhCZWZvcmVPcGVuRnVuY3Rpb24pIHtcbiAgICB0aGlzLm9wdGlvbnMuYmVmb3JlT3BlbiA9IGZuO1xuICAgIGlmICh0aGlzLm1lbnVCdXR0b24pIHtcbiAgICAgICh0aGlzLm1lbnVCdXR0b24gYXMgYW55KS5zZXR0aW5ncy5iZWZvcmVPcGVuID0gZm47XG4gICAgICAvLyBObyB1cGRhdGUgcmVxdWlyZWQuXG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IGhpZGVNZW51QXJyb3codmFsdWU6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLmJ1dHRvbk9wdGlvbnMuaGlkZU1lbnVBcnJvdyA9IHZhbHVlO1xuICAgIGlmICh0aGlzLmJ1dHRvbikge1xuICAgICAgdGhpcy5idXR0b24uc2V0dGluZ3MuaGlkZU1lbnVBcnJvdyA9IHZhbHVlO1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgICAgLy8gdG9kbzogbWVudWJ1dHRvbi5qcyB1cGRhdGVkKCkgZnVuY3Rpb24gZG9lc24ndCBzZWVtIHRvIHRlYXIgZG93biB0aGUgY29udHJvbCBhbmQgcmVidWlsZCB3aXRoIG5ldyBzZXR0aW5nc1xuICAgIH1cbiAgfVxuXG4gIGdldCBoaWRlTWVudUFycm93KCk6IGJvb2xlYW4gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmJ1dHRvbk9wdGlvbnMuaGlkZU1lbnVBcnJvdztcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBvZmZzZXQodmFsdWU6IFNvaG9Qb3B1cG1lbnVPZmZzZXQgfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLm9wdGlvbnMub2Zmc2V0ID0gdmFsdWU7XG4gICAgaWYgKHRoaXMubWVudUJ1dHRvbikge1xuICAgICAgKHRoaXMubWVudUJ1dHRvbiBhcyBhbnkpLnNldHRpbmdzLm9mZnNldCA9IHZhbHVlO1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIGdldCBvZmZzZXQoKTogU29ob1BvcHVwbWVudU9mZnNldCB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMubWVudUJ1dHRvbj8uc2V0dGluZ3M/Lm9mZnNldCB8fCB0aGlzLm9wdGlvbnMub2Zmc2V0O1xuICB9XG5cbiAgQElucHV0KCkgc2V0IGF0dGFjaFRvQm9keSh2YWx1ZTogYm9vbGVhbiB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMub3B0aW9ucy5hdHRhY2hUb0JvZHkgPSB2YWx1ZTtcbiAgICBpZiAodGhpcy5tZW51QnV0dG9uKSB7XG4gICAgICAodGhpcy5tZW51QnV0dG9uIGFzIGFueSkuc2V0dGluZ3MuYXR0YWNoVG9Cb2R5ID0gdmFsdWU7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG4gIGdldCBhdHRhY2hUb0JvZHkoKTogYm9vbGVhbiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5hdHRhY2hUb0JvZHk7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgcmVtb3ZlT25EZXN0cm95KHZhbHVlOiBib29sZWFuIHwgdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5vcHRpb25zLnJlbW92ZU9uRGVzdHJveSA9IHZhbHVlO1xuICAgIGlmICh0aGlzLm1lbnVCdXR0b24pIHtcbiAgICAgICh0aGlzLm1lbnVCdXR0b24gYXMgYW55KS5zZXR0aW5ncy5yZW1vdmVPbkRlc3Ryb3kgPSB2YWx1ZTtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cbiAgZ2V0IHJlbW92ZU9uRGVzdHJveSgpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLnJlbW92ZU9uRGVzdHJveTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCByaXBwbGUodmFsdWU6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLmJ1dHRvbk9wdGlvbnMucmlwcGxlID0gdmFsdWU7XG4gICAgaWYgKHRoaXMuYnV0dG9uKSB7XG4gICAgICAodGhpcy5idXR0b24gYXMgYW55KS5zZXR0aW5ncy5yaXBwbGUgPSB2YWx1ZTtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICBnZXQgcmlwcGxlKCk6IGJvb2xlYW4gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmJ1dHRvbj8uc2V0dGluZ3M/LnJpcHBsZSB8fCB0aGlzLmJ1dHRvbk9wdGlvbnMucmlwcGxlO1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBlbGVtZW50OiBFbGVtZW50UmVmLFxuICAgIHByaXZhdGUgcmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lKSB7IH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgLy8gY2FsbCBvdXRzaWRlIHRoZSBhbmd1bGFyIHpvbmUgc28gY2hhbmdlIGRldGVjdGlvblxuICAgIC8vIGlzbid0IHRyaWdnZXJlZCBieSB0aGUgc29obyBjb21wb25lbnQuXG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuXG4gICAgICAvLyBXcmFwIHRoZSBlbGVtZW50IGluIGEgalF1ZXJ5IHNlbGVjdG9yLlxuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50ID0galF1ZXJ5KHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50KTtcblxuICAgICAgLy8gSW5pdGlhbGlzZSB0aGUgc29oby1idXR0b24gd2lkZ2V0LlxuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50LmJ1dHRvbih0aGlzLmJ1dHRvbk9wdGlvbnMpO1xuXG4gICAgICAvLyBSZXRyaWV2ZSB0aGUgc29obyBidXR0b24gYXBpLlxuICAgICAgdGhpcy5idXR0b24gPSB0aGlzLmpRdWVyeUVsZW1lbnQuZGF0YSgnYnV0dG9uJyk7XG5cbiAgICAgIC8vIEluaXRpYWxpc2UgdGhlIFNvaG9YaSBDb250cm9sXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQucG9wdXBtZW51KHRoaXMub3B0aW9ucyk7XG5cbiAgICAgIC8vIFJldHJpZXZlIHRoZSBlbnRlcnByaXNlIGFwaVxuICAgICAgdGhpcy5tZW51QnV0dG9uID0gdGhpcy5qUXVlcnlFbGVtZW50LmRhdGEoJ3BvcHVwbWVudScpO1xuXG4gICAgICAvLyBJbml0aWFsaXplIHRpdGxlIGF0dHJpYnV0ZSBhcyBhIHNvaG8gdG9vbHRpcFxuICAgICAgaWYgKHRoaXMualF1ZXJ5RWxlbWVudC5oYXMoJ1t0aXRsZV0nKSkge1xuICAgICAgICB0aGlzLmpRdWVyeUVsZW1lbnQudG9vbHRpcCgpO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGQgbGlzdGVuZXJzIHRvIGVtaXQgZXZlbnRzXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnRcbiAgICAgICAgLm9uKCdzZWxlY3RlZCcsIChlOiBKUXVlcnkuVHJpZ2dlcmVkRXZlbnQsIGFyZ3M6IEpRdWVyeSkgPT4gdGhpcy5vblNlbGVjdGVkKGUsIGFyZ3MpKVxuICAgICAgICAub24oJ2JlZm9yZW9wZW4nLCAoZTogSlF1ZXJ5LlRyaWdnZXJlZEV2ZW50LCBhcmdzOiBKUXVlcnkpID0+IHRoaXMub25CZWZvcmVPcGVuKGUsIGFyZ3MpKVxuICAgICAgICAub24oJ2Nsb3NlJywgKGU6IEpRdWVyeS5UcmlnZ2VyZWRFdmVudCwgYXJnczogSlF1ZXJ5KSA9PiB0aGlzLm9uQ2xvc2UoZSwgYXJncykpXG4gICAgICAgIC5vbignb3BlbicsIChlOiBKUXVlcnkuVHJpZ2dlcmVkRXZlbnQsIGFyZ3M6IEpRdWVyeSkgPT4gdGhpcy5vbk9wZW4oZSwgYXJncykpO1xuICAgIH0pO1xuICB9XG5cbiAgbmdBZnRlclZpZXdDaGVja2VkKCkge1xuICAgIGlmICh0aGlzLnJ1blVwZGF0ZWRPbkNoZWNrKSB7XG4gICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIHRoaXMubWVudUJ1dHRvbj8udXBkYXRlZCh0aGlzLm9wdGlvbnMpO1xuICAgICAgICB0aGlzLmJ1dHRvbj8udXBkYXRlZCh0aGlzLmJ1dHRvbk9wdGlvbnMpO1xuICAgICAgICB0aGlzLnJ1blVwZGF0ZWRPbkNoZWNrID0gZmFsc2U7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG9uU2VsZWN0ZWQoZTogSlF1ZXJ5LlRyaWdnZXJlZEV2ZW50LCBhcmdzOiBKUXVlcnkpIHtcbiAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgdGhpcy5zZWxlY3RlZC5lbWl0KHsgZSwgYXJncyB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgb25CZWZvcmVPcGVuKGU6IEpRdWVyeS5UcmlnZ2VyZWRFdmVudCwgYXJnczogSlF1ZXJ5KSB7XG4gICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgIHRoaXMuYmVmb3Jlb3Blbi5lbWl0KHsgZSwgYXJncyB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgb25DbG9zZShlOiBKUXVlcnkuVHJpZ2dlcmVkRXZlbnQsIGFyZ3M6IEpRdWVyeSkge1xuICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlJC5lbWl0KHsgZSwgYXJncyB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgb25PcGVuKGU6IEpRdWVyeS5UcmlnZ2VyZWRFdmVudCwgYXJnczogSlF1ZXJ5KSB7XG4gICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgIHRoaXMub3BlbiQuZW1pdCh7IGUsIGFyZ3MgfSk7XG4gICAgfSk7XG4gIH1cblxuICB1cGRhdGVkKG1lbnVTZXR0aW5ncz86IFNvaG9Qb3B1cE1lbnVPcHRpb25zLCBidXR0b25TZXR0aW5ncz86IFNvaG9CdXR0b25PcHRpb25zKSB7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgdGhpcy5tZW51QnV0dG9uPy51cGRhdGVkKG1lbnVTZXR0aW5ncyk7XG4gICAgICB0aGlzLmJ1dHRvbj8udXBkYXRlZChidXR0b25TZXR0aW5ncyk7XG4gICAgfSk7XG4gIH1cblxuICB0ZWFyZG93bigpIHtcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICB0aGlzLm1lbnVCdXR0b24/LnRlYXJkb3duKCk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgY2xvc2UoKTogdm9pZCB7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgdGhpcy5tZW51QnV0dG9uPy5jbG9zZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIG9wZW4oZXZlbnQ6IEpRdWVyeS5UcmlnZ2VyZWRFdmVudCwgYWpheFJldHVybj86IGJvb2xlYW4sIHVzZURlbGF5PzogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIHRoaXMubWVudUJ1dHRvbj8ub3BlbihldmVudCwgYWpheFJldHVybiwgdXNlRGVsYXkpO1xuICAgIH0pO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgaWYgKHRoaXMualF1ZXJ5RWxlbWVudCkge1xuICAgICAgICAvLyByZW1vdmUgdGhlIGV2ZW50IGxpc3RlbmVycyBvbiB0aGlzIGVsZW1lbnQuXG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vZmYoKTtcbiAgICAgICAgY29uc3QgdG9vbHRpcEFwaSA9IHRoaXMualF1ZXJ5RWxlbWVudC5kYXRhKCd0b29sdGlwJyk7XG4gICAgICAgIHRvb2x0aXBBcGk/LmRlc3Ryb3k/LigpO1xuICAgICAgICBjb25zdCBwb3B1cG1lbnVBcGkgPSB0aGlzLmpRdWVyeUVsZW1lbnQuZGF0YSgncG9wdXBtZW51Jyk7XG4gICAgICAgIHBvcHVwbWVudUFwaT8uZGVzdHJveT8uKCk7XG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgICAgLy8gRGVzdHJveSBhbnkgd2lkZ2V0IHJlc291cmNlcy5cbiAgICAgIGlmICh0aGlzLm1lbnVCdXR0b24pIHtcbiAgICAgICAgLy8gQHRvZG8gcmFpc2UgYW4gaXNzdWUgb24gdGhpcyBmYWlsaW5nIG9uIHJlbW92ZURhdGEhXG4gICAgICAgIHRoaXMubWVudUJ1dHRvbi5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMubWVudUJ1dHRvbiA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmJ1dHRvbikge1xuICAgICAgICB0aGlzLmJ1dHRvbi5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMuYnV0dG9uID0gbnVsbDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNYXJrcyB0aGUgY29tcG9uZW50cyBhcyByZXF1aXJpbmcgYSByZWJ1aWxkIGFmdGVyIHRoZSBuZXh0IHVwZGF0ZS5cbiAgICovXG4gIG1hcmtGb3JSZWZyZXNoKCkge1xuICAgIC8vIFJ1biB1cGRhdGVkIG9uIHRoZSBuZXh0IHVwZGF0ZWQgY2hlY2suXG4gICAgdGhpcy5ydW5VcGRhdGVkT25DaGVjayA9IHRydWU7XG5cbiAgICAvLyAuLi4gbWFrZSBzdXJlIHRoZSBjaGFuZ2UgZGV0ZWN0b3Iga2lja3MgaW4sIG90aGVyd2lzZSBpZiB0aGUgaW5wdXRzXG4gICAgLy8gd2VyZSBjaGFuZ2UgcHJvZ3JhbW1hdGlhbGx5IHRoZSBjb21wb25lbnQgbWF5IG5vdCBiZSBlbGlnaWJsZSBmb3JcbiAgICAvLyB1cGRhdGluZy5cbiAgICB0aGlzLnJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgfVxufVxuIiwiPHN2ZyBzb2hvLWljb24gKm5nSWY9XCJpY29uXCIgW2ljb25dPVwiaWNvblwiPjwvc3ZnPlxuPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuPHN2ZyAqbmdJZj1cIiFoaWRlTWVudUFycm93XCIgc29oby1pY29uIFtpY29uXT1cIidkcm9wZG93bidcIj48L3N2Zz5cbiJdfQ==