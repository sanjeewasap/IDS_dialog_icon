import { Component, EventEmitter, HostBinding, Input, Output, Self, Optional, ChangeDetectionStrategy } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
/**
 * Angular wrapper for the `dropdown` widget in the ids-enterprise controls.
 */
export class SohoDropDownComponent {
    /**
     * Used to provide unnamed controls with a unique id.
     */
    static { this.counter = 0; }
    /**
     * Sets the dropdown to close on selecting a value (helpful for multi-select)
     */
    set closeOnSelect(closeOnSelect) {
        this.options.closeOnSelect = closeOnSelect;
        if (this.dropdown) {
            this.dropdown.settings.closeOnSelect = closeOnSelect;
            this.markForRefresh();
        }
    }
    get closeOnSelect() {
        return this.options.closeOnSelect;
    }
    /**
     * Append a css class to the dropdown-list
     */
    set cssClass(cssClass) {
        this.options.cssClass = cssClass;
    }
    get cssClass() {
        return this.options.cssClass;
    }
    /**
     * Typing debounce for search
     */
    set delay(delay) {
        this.options.delay = delay;
    }
    get delay() {
        return this.options.delay;
    }
    /**
     * Sets the icon used as the Dropdown Indicator
     */
    set dropdownIcon(icon) {
        this.options.dropdownIcon = icon;
        if (this.dropdown) {
            this.dropdown.settings.dropdownIcon = icon;
            this.markForRefresh();
        }
    }
    get dropdownIcon() {
        return this.options.dropdownIcon;
    }
    /**
     * Initialize the empty value
     */
    set empty(empty) {
        this.options.empty = empty;
    }
    get empty() {
        return this.options.empty;
    }
    /**
     * Value of the maximum number of selected elements (must have multiple set to true)
     */
    set maxSelected(maxSelected) {
        this.options.maxSelected = maxSelected;
    }
    get maxSelected() {
        return this.options.maxSelected;
    }
    /**
     * Flag to move the selected values to the top of the dropdown
     *
     * @deprecated use moveSelected
     */
    set moveSelectedToTop(moveSelectedToTop) {
        console.warn(`'moveSelectedToTop' has been deprecated, please use 'moveSelected'.`);
        this.options.moveSelectedToTop = moveSelectedToTop; // eslint-disable-line
    }
    get moveSelectedToTop() {
        return this.options.moveSelectedToTop;
    }
    set moveSelected(moveSelected) {
        this.options.moveSelected = moveSelected;
        if (this.dropdown) {
            this.dropdown.settings.moveSelected = moveSelected;
            this.markForRefresh();
        }
    }
    get moveSelected() {
        return this.options.moveSelected;
    }
    set showEmptyGroupHeaders(showEmptyGroupHeaders) {
        this.options.showEmptyGroupHeaders = showEmptyGroupHeaders;
        if (this.dropdown) {
            this.dropdown.settings.showEmptyGroupHeaders = showEmptyGroupHeaders;
            this.markForRefresh();
        }
    }
    get showEmptyGroupHeaders() {
        return this.options.showEmptyGroupHeaders;
    }
    set sourceArguments(sourceArguments) {
        this.options.sourceArguments = sourceArguments;
        if (this.dropdown) {
            this.dropdown.settings.sourceArguments = sourceArguments;
            this.markForRefresh();
        }
    }
    get sourceArguments() {
        return this.options.sourceArguments;
    }
    /**
     * Determines the frequency of reloading data from an external source
     */
    set reload(reload) {
        this.options.reload = reload;
        if (this.dropdown) {
            this.dropdown.settings.reload = reload;
            this.markForRefresh();
        }
    }
    get reload() {
        return this.options.reload;
    }
    /**
     * If set the width of the dropdown is limited to this pixel width.
     * Use 300 for the 300 px size fields. Default is size of the largest data.
     */
    set maxWidth(maxWidth) {
        this.options.maxWidth = maxWidth;
        if (this.dropdown) {
            // @todo this property can not be updated once the control
            // has been initialised.
            this.dropdown.settings.maxWidth = maxWidth;
            this.markForRefresh();
        }
    }
    get maxWidth() {
        return this.options.maxWidth;
    }
    /**
     * Sets the exact width of the open list, by default its the size of the field
     */
    set width(width) {
        this.options.width = width;
        if (this.dropdown) {
            this.dropdown.settings.width = width;
            this.markForRefresh();
        }
    }
    get width() {
        return this.options.width;
    }
    set filterMode(filterMode) {
        this.options.filterMode = filterMode;
        if (this.dropdown) {
            this.dropdown.settings.filterMode = filterMode;
            this.markForRefresh();
        }
    }
    get filterMode() {
        return this.options.filterMode;
    }
    set virtualScroll(virtualScroll) {
        this.options.virtualScroll = virtualScroll;
        if (this.dropdown) {
            this.dropdown.settings.virtualScroll = virtualScroll;
            this.markForRefresh();
        }
    }
    get virtualScroll() {
        return this.options.virtualScroll;
    }
    /**
     * Sets the select element as a multi-select
     */
    set multiple(multiple) {
        this.options.multiple = multiple;
        if (this.dropdown) {
            this.dropdown.settings.multiple = multiple;
            this.markForRefresh();
        }
    }
    get multiple() {
        return this.options.multiple;
    }
    /**
     * Flag to add/remove search functionality from the dropdown
     */
    set noSearch(noSearch) {
        // Assume any value is true to allow the noSearch attribute to be added
        // without a boolean value.
        const value = noSearch !== null && noSearch !== 'false';
        this.options.noSearch = value;
        if (this.dropdown) {
            this.dropdown.settings.noSearch = value;
            this.markForRefresh();
        }
    }
    get noSearch() {
        return this.options.noSearch;
    }
    /**
     * Existent as a helper... should use framework's API to get data and
     * then create and pass to the control to use
     */
    set source(source) {
        this.options.source = source;
    }
    get source() {
        return this.options.source;
    }
    /**
     * Initialize the showSelectAll value for multi-select drop downs
     */
    set showSelectAll(selectAll) {
        this.options.showSelectAll = selectAll;
    }
    get showSelectAll() {
        return this.options.showSelectAll;
    }
    /**
     * Initialize the showTags value for multi-select drop downs
     */
    set showTags(showTags) {
        this.options.showTags = showTags;
    }
    get showTags() {
        return this.options.showTags;
    }
    /**
     * If true, moves the Searchfield in the Dropdown list from directly on top of the pseudo-lement
     * to underneath/above, providing visibility into the currently selected results.
     */
    set showSearchUnderSelected(showSearchUnderSelected) {
        this.options.showSearchUnderSelected = showSearchUnderSelected;
    }
    get showSearchUnderSelected() {
        return this.options.showSearchUnderSelected;
    }
    /**
     * If defined, passes along 'clickHandler' and 'dismissHandler' functions to any Tags
     */
    set tagSettings(tagSettings) {
        this.options.tagSettings = tagSettings;
    }
    get tagSettings() {
        return this.options.tagSettings;
    }
    /**
     * If defined, passes along 'clickHandler' and 'dismissHandler' functions to any Tags
     */
    set allTextString(allTextString) {
        this.options.allTextString = allTextString;
    }
    get allTextString() {
        return this.options.allTextString;
    }
    /**
     * @param appendTo additional classes
     */
    set appendTo(appendTo) {
        this.options.appendTo = appendTo;
    }
    /**Custom text string for `Selected` text header use in MultiSelect */
    set selectedTextString(selectedTextString) {
        this.options.selectedTextString = selectedTextString;
    }
    get selectedTextString() {
        return this.options.tagSettings;
    }
    set attributes(attributes) {
        this.options.attributes = attributes;
    }
    get attributes() {
        return this.options.attributes;
    }
    /**
     * Bind attributes to the host select element
     */
    /**
     * Assign the id for the control
     * (maps to the name to use on a label's 'for' attribute)
     */
    get id() {
        return this.name;
    }
    get isMultiple() {
        return this.options.multiple;
    }
    get isDropdown() {
        return !this.options.multiple;
    }
    get isMultiSelect() {
        return this.options.multiple;
    }
    set readonly(readonly) {
        this.isReadOnly = readonly;
        if (this.dropdown) {
            if (readonly) {
                this.dropdown.readonly();
            }
            else if (readonly === false) {
                this.dropdown.enable();
            }
        }
    }
    get readonly() {
        return this.isReadOnly;
    }
    /**
     * Creates an instance of SohoDropDownComponent.
     *
     * @param element the element this component encapsulates.
     * @param ngZone the angular zone for this component
     * @param ngControl any associated form control (optional)
     * @param ref the change detector reference, must not be null.
     */
    constructor(element, ngZone, ngControl, ref) {
        this.element = element;
        this.ngZone = ngZone;
        this.ngControl = ngControl;
        this.ref = ref;
        /**
         * Default block of options, use the accessors to modify.
         */
        this.options = {
            reload: 'none'
        };
        this.isReadOnly = undefined;
        /**
         * Name for the dropdown control. Necessary for ngModel to function.
         */
        this.name = `soho-dropdown-${SohoDropDownComponent.counter++}`;
        /**
         * Called when the dropdown value changes
         *
         * @todo replace override of native attribute
         */
        // eslint-disable-next-line @angular-eslint/no-output-rename, @angular-eslint/no-output-native
        this.change$ = new EventEmitter();
        /**
         * Called when the dropdown updates in some way.
         */
        // eslint-disable-next-line @angular-eslint/no-output-rename
        this.updated$ = new EventEmitter();
        /**
         * Fired when the dropdown list is closed.
         */
        // eslint-disable-next-line @angular-eslint/no-output-rename
        this.listClosed$ = new EventEmitter();
        /**
         * Fired when the dropdown list is opened.
         */
        // eslint-disable-next-line @angular-eslint/no-output-rename
        this.listOpened$ = new EventEmitter();
        /**
         * This event is fired when a key is pressed
         */
        // eslint-disable-next-line @angular-eslint/no-output-rename, @angular-eslint/no-output-native
        this.keydown$ = new EventEmitter();
        // Is the control using a form control and/or ngModel?
        if (this.ngControl) {
            // Wrap the accessor to allow updates to be pushed,
            // but also use the standard accessors provided by angular.
            this.valueAccessor =
                new SohoDropDownControlValueAccessorDelegator(this.ngControl.valueAccessor, this);
            // ... change the accessor on the control to use ours.
            this.ngControl.valueAccessor = this.valueAccessor;
        }
    }
    ngAfterViewInit() {
        // call outside the angular zone so change detection
        // isn't triggered by the soho component.
        this.ngZone.runOutsideAngular(() => {
            // assign element to local variable
            this.jQueryElement = jQuery(this.element.nativeElement);
            this.options.onKeyDown = (e) => this.ngZone.run(() => this.keydown$.next(e));
            // initialise the dropdown control
            this.jQueryElement.dropdown(this.options);
            // extract the api
            this.dropdown = this.jQueryElement.data('dropdown');
            // @todo - add event binding control so we don't bind if not required.
            this.jQueryElement
                .on('change', (event) => this.onChanged(event))
                .on('updated', (event) => this.onUpdated(event))
                .on('requestend', (event, searchTerm, data) => this.onRequestEnd(event, searchTerm, data))
                .on('listclosed', (event, action) => this.onListClosed(event, action))
                .on('listopened', (event) => this.onListOpened(event));
            this.runUpdatedOnCheck = true;
        });
    }
    ngAfterViewChecked() {
        if (this.runUpdatedOnCheck) {
            this.ngZone.runOutsideAngular(() => {
                // We need to update the control AFTER the model
                // has been updated (assuming there is one), so
                // execute updated after angular has generated
                // the model and the view markup.
                setTimeout(() => this.updated());
                if (this.readonly) {
                    this.dropdown?.readonly();
                }
                else if (this.readonly === false) {
                    this.dropdown?.enable();
                }
                this.runUpdatedOnCheck = false;
            });
        }
    }
    ngOnDestroy() {
        this.ngZone.runOutsideAngular(() => {
            if (this.jQueryElement) {
                // remove the event listeners on this element.
                this.jQueryElement.off();
                this.jQueryElement = undefined;
            }
            // Destroy any widget resources.
            this.dropdown?.destroy();
            this.dropdown = null;
        });
    }
    /**
     * Event handler for the 'requestend' event on the dropdown 'component'.
     *
     *
     * @param event the standard jQuery event.
     * @param data any data passed by the dropdown (todo the type)
     *
     */
    onRequestEnd(_event, _searchTerm, _data) {
        // When the request for data has completed, make sure we
        // update the 'dropdown' control.
        this.ngZone.run(() => {
            this.ref.markForCheck();
        });
    }
    onUpdated(event) {
        // Fire the event, in the angular zone.
        this.ngZone.run(() => this.updated$.next(event));
    }
    /**
     * Event handler for the 'changed' event on the 'dropdown' component.
     *
     *
     * @param event the standard jQuery event.
     *
     */
    onChanged(event) {
        // Retrieve the value from the 'dropdown' component.
        const val = this.jQueryElement?.val();
        this.ngZone.run(() => {
            // This value needs to be converted into an options value, which is
            // generated by the {SelectControlValueAccessor}.
            if (this.valueAccessor) {
                const optionValue = this.valueAccessor.convertToOptionValue(val);
                // Make sure calls to angular are made in the right zone.
                // ... update the model (which will fire change
                // detection if required).
                if (this.valueAccessor && this.valueAccessor.onChangeFn) {
                    this.valueAccessor.onChangeFn(optionValue);
                }
            }
            // @todo - this wants to be the real value, so we may need to look
            // that up.
            event.data = val;
            this.change$.emit(event);
        });
    }
    /**
     * Handles the 'listopened' event triggered by the underlying jQuery control.
     *
     * @param event the fired event.
     */
    onListOpened(event) {
        this.ngZone.run(() => {
            this.listOpened$.emit(event);
        });
    }
    /**
     * Handles the 'listclosed' event triggered by the underlying jQuery control.
     *
     * @param event the fired event.
     */
    onListClosed(event, action) {
        this.ngZone.run(() => {
            // Make sure the event is fixed up for dispatch
            event.action = action;
            this.listClosed$.emit(event);
        });
    }
    /**
     * In case options are being bound asynchronously, you will need to trigger updated on
     * soho dropdown control so it updates its value labels.
     */
    updated() {
        if (this.dropdown) {
            // Calling updated when an item is selected, loses the selection!
            this.ngZone.runOutsideAngular(() => this.dropdown?.updated());
        }
        return this;
    }
    // -------------------------------------------
    // Component Input
    // -------------------------------------------
    set disabled(value) {
        if (this.dropdown) {
            if (value) {
                this.ngZone.runOutsideAngular(() => this.dropdown?.disable());
            }
            else {
                this.ngZone.runOutsideAngular(() => this.dropdown?.enable());
            }
        }
    }
    /**
     * @description
     *
     * Soho-dropdown is not a native element - need this to set focus programmatically.
     * 'name' attribute must be set on the control for this to work correctly.
     */
    setFocus() {
        if (this.jQueryElement) {
            this.ngZone.runOutsideAngular(() => {
                this.jQueryElement?.trigger('activated');
            });
        }
    }
    /**
     * @description
     *
     * Sets the value of the dropdown.
     *
     * @todo this may need to involve mapping from actual value
     * if ngModel is used.
     *
     * This is the model value that is to be set.
     * @param value - the internal value to select
     */
    selectValue(value) {
        if (this.dropdown) {
            this.ngZone.runOutsideAngular(() => {
                this.dropdown?.selectValue(value);
            });
        }
    }
    /**
     * Marks the components as requiring a rebuild after the next update.
     */
    markForRefresh() {
        // Run updated on the next updated check.
        this.runUpdatedOnCheck = true;
        // ... make sure the change detector kicks in, otherwise if the inputs
        // were change programmatially the component may not be eligible for
        // updating.
        this.ref.markForCheck();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoDropDownComponent, deps: [{ token: i0.ElementRef }, { token: i0.NgZone }, { token: i1.NgControl, optional: true, self: true }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: SohoDropDownComponent, selector: "select[soho-dropdown]", inputs: { closeOnSelect: "closeOnSelect", cssClass: "cssClass", delay: "delay", dropdownIcon: "dropdownIcon", empty: "empty", maxSelected: "maxSelected", moveSelectedToTop: "moveSelectedToTop", moveSelected: "moveSelected", showEmptyGroupHeaders: "showEmptyGroupHeaders", sourceArguments: "sourceArguments", reload: "reload", maxWidth: "maxWidth", width: "width", filterMode: "filterMode", virtualScroll: "virtualScroll", multiple: "multiple", name: "name", noSearch: "noSearch", source: "source", showSelectAll: "showSelectAll", showTags: "showTags", showSearchUnderSelected: "showSearchUnderSelected", tagSettings: "tagSettings", allTextString: "allTextString", appendTo: "appendTo", selectedTextString: "selectedTextString", attributes: "attributes", readonly: "readonly", disabled: "disabled" }, outputs: { change$: "change", updated$: "updated", listClosed$: "listclosed", listOpened$: "listopened", keydown$: "keydown" }, host: { properties: { "id": "this.id", "attr.multiple": "this.isMultiple", "class.dropdown": "this.isDropdown", "class.multiselect": "this.isMultiSelect" } }, ngImport: i0, template: '<ng-content></ng-content>', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoDropDownComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'select[soho-dropdown]',
                    template: '<ng-content></ng-content>',
                    changeDetection: ChangeDetectionStrategy.OnPush
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.NgZone }, { type: i1.NgControl, decorators: [{
                    type: Self
                }, {
                    type: Optional
                }] }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { closeOnSelect: [{
                type: Input
            }], cssClass: [{
                type: Input
            }], delay: [{
                type: Input
            }], dropdownIcon: [{
                type: Input
            }], empty: [{
                type: Input
            }], maxSelected: [{
                type: Input
            }], moveSelectedToTop: [{
                type: Input
            }], moveSelected: [{
                type: Input
            }], showEmptyGroupHeaders: [{
                type: Input
            }], sourceArguments: [{
                type: Input
            }], reload: [{
                type: Input
            }], maxWidth: [{
                type: Input
            }], width: [{
                type: Input
            }], filterMode: [{
                type: Input
            }], virtualScroll: [{
                type: Input
            }], multiple: [{
                type: Input
            }], name: [{
                type: Input
            }], noSearch: [{
                type: Input
            }], source: [{
                type: Input
            }], showSelectAll: [{
                type: Input
            }], showTags: [{
                type: Input
            }], showSearchUnderSelected: [{
                type: Input
            }], tagSettings: [{
                type: Input
            }], allTextString: [{
                type: Input
            }], appendTo: [{
                type: Input
            }], selectedTextString: [{
                type: Input
            }], attributes: [{
                type: Input
            }], change$: [{
                type: Output,
                args: ['change']
            }], updated$: [{
                type: Output,
                args: ['updated']
            }], listClosed$: [{
                type: Output,
                args: ['listclosed']
            }], listOpened$: [{
                type: Output,
                args: ['listopened']
            }], keydown$: [{
                type: Output,
                args: ['keydown']
            }], id: [{
                type: HostBinding,
                args: ['id']
            }], isMultiple: [{
                type: HostBinding,
                args: ['attr.multiple']
            }], isDropdown: [{
                type: HostBinding,
                args: ['class.dropdown']
            }], isMultiSelect: [{
                type: HostBinding,
                args: ['class.multiselect']
            }], readonly: [{
                type: Input
            }], disabled: [{
                type: Input
            }] } });
/**
 * Provides a 'wrapper' around the {ControlValueAccessor} added by
 * angular when handling `select` elements.
 *
 * This class allows the {SohoDropDownComponent} to interoperate with
 * the {ControlValueAccessor}.  Specifically, providing access to the
 * onChange function, which we must call when the value of the dropdown
 * is modified.
 *
 * It also exposes the encoding used storing complex objects as
 * values in the 'option' elements.
 *
 * See https://github.com/angular/angular/blob/master/packages/forms/src/directives/select_multiple_control_value_accessor.ts.
 *
 *
 *
 */
class SohoDropDownControlValueAccessorDelegator {
    /**
     * Creates an instance of SohoDropDownControlValueAccessorDelegate.
     *
     * @param delegate the value accessor
     * @param dropdown the dropdown linked to the accessor
     *
     */
    constructor(delegate, dropdown) {
        this.delegate = delegate;
        this.dropdown = dropdown;
    }
    writeValue(value) {
        // Just pass it on.
        this.delegate.writeValue(value);
        // @todo reduce the number of calls to this!
        this.dropdown.markForRefresh();
    }
    registerOnChange(fn) {
        // Keep a reference to the change function, then we an call it.
        this.onChangeFn = fn;
        // Give the delegate a chance to store this too.
        this.delegate.registerOnChange(fn);
    }
    registerOnTouched(fn) {
        this.delegate.registerOnTouched(fn);
    }
    /**
     * Update the jQuery widget with the request disabled state.
     *
     * @param isDisabled true if the control should be disabled; otherwise false.
     *
     */
    setDisabledState(isDisabled) {
        this.dropdown.disabled = isDisabled;
        if (this.delegate.setDisabledState) {
            this.delegate.setDisabledState(isDisabled);
        }
    }
    /**
     * Convert the 'real' value into the corresponding
     * option value.
     *
     *
     * @param value the value of the option; must not be null.
     * @returns the string optipnValue of the otion elemen.
     *
     */
    convertToOptionValue(value) {
        const delegate = this.delegate;
        const id = delegate._getOptionId(value);
        return this.buildValueString(id, value);
    }
    /**
     * Copy of the "valuestring" builder used by the Angular
     * Select and MultiSelect
     *
     * @param id option id (ordinal)
     * @param value the actual value
     */
    buildValueString(id, value) {
        if (id == null) {
            return '' + value;
        }
        if (typeof value === 'string') {
            value = '\'' + value + '\'';
        }
        if (value && typeof value === 'object') {
            value = 'Object';
        }
        return (id + ': ' + value).slice(0, 50);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1kcm9wZG93bi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9pZHMtZW50ZXJwcmlzZS1uZy9zcmMvbGliL2Ryb3Bkb3duL3NvaG8tZHJvcGRvd24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCxTQUFTLEVBRVQsWUFBWSxFQUNaLFdBQVcsRUFDWCxLQUFLLEVBRUwsTUFBTSxFQUVOLElBQUksRUFDSixRQUFRLEVBRVIsdUJBQXVCLEVBRXhCLE1BQU0sZUFBZSxDQUFDOzs7QUFPdkI7O0dBRUc7QUFNSCxNQUFNLE9BQU8scUJBQXFCO0lBQ2hDOztPQUVHO2FBQ1ksWUFBTyxHQUFHLENBQUMsQ0FBQztJQStCM0I7O09BRUc7SUFDSCxJQUNXLGFBQWEsQ0FBQyxhQUFrQztRQUN6RCxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7UUFDM0MsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7WUFDckQsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1NBQ3ZCO0lBQ0gsQ0FBQztJQUVELElBQVcsYUFBYTtRQUN0QixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDO0lBQ3BDLENBQUM7SUFFRDs7T0FFRztJQUNILElBQ1csUUFBUSxDQUFDLFFBQTRCO1FBQzlDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztJQUNuQyxDQUFDO0lBRUQsSUFBVyxRQUFRO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7SUFDL0IsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFDVyxLQUFLLENBQUMsS0FBeUI7UUFDeEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEdBQUcsS0FBSyxD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XG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZyxcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT3V0cHV0LFxuICBOZ1pvbmUsXG4gIFNlbGYsXG4gIE9wdGlvbmFsLFxuICBBZnRlclZpZXdDaGVja2VkLFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7XG4gIE5nQ29udHJvbCxcbiAgQ29udHJvbFZhbHVlQWNjZXNzb3Jcbn0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuXG4vKipcbiAqIEFuZ3VsYXIgd3JhcHBlciBmb3IgdGhlIGBkcm9wZG93bmAgd2lkZ2V0IGluIHRoZSBpZHMtZW50ZXJwcmlzZSBjb250cm9scy5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnc2VsZWN0W3NvaG8tZHJvcGRvd25dJywgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICB0ZW1wbGF0ZTogJzxuZy1jb250ZW50PjwvbmctY29udGVudD4nLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBTb2hvRHJvcERvd25Db21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBBZnRlclZpZXdDaGVja2VkLCBPbkRlc3Ryb3kge1xuICAvKipcbiAgICogVXNlZCB0byBwcm92aWRlIHVubmFtZWQgY29udHJvbHMgd2l0aCBhIHVuaXF1ZSBpZC5cbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGNvdW50ZXIgPSAwO1xuXG4gIC8qKlxuICAgKiBGbGFnIHRvIGZvcmNlIGFuIHVwZGF0ZSBvZiB0aGUgY29udHJvbCBhZnRlciB0aGUgdmlldyBpcyBjcmVhdGVkLlxuICAgKi9cbiAgcHJpdmF0ZSBydW5VcGRhdGVkT25DaGVjaz86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEludGVncmF0aW9uIHdpdGggdGhlIEFuZ3VsYXIgQ29udHJvbFZhbHVlQWNjZXNzb3IgZm9yIGZvcm0gY29udHJvbHMuXG4gICAqL1xuICBwcml2YXRlIHZhbHVlQWNjZXNzb3I/OiBTb2hvRHJvcERvd25Db250cm9sVmFsdWVBY2Nlc3NvckRlbGVnYXRvcjtcblxuICAvKipcbiAgICogU2VsZWN0b3IgZm9yIG9yaWdpbmF0aW5nIGVsZW1lbnQuXG4gICAqL1xuICBwcml2YXRlIGpRdWVyeUVsZW1lbnQ/OiBKUXVlcnk7XG5cbiAgLyoqXG4gICAqIFJlZmVyZW5jZSB0byB0aGUgSURTIEVudGVycHJpc2UgQXBpLlxuICAgKi9cbiAgcHJpdmF0ZSBkcm9wZG93bj86IFNvaG9Ecm9wRG93blN0YXRpYyB8IG51bGw7XG5cbiAgLyoqXG4gICAqIERlZmF1bHQgYmxvY2sgb2Ygb3B0aW9ucywgdXNlIHRoZSBhY2Nlc3NvcnMgdG8gbW9kaWZ5LlxuICAgKi9cbiAgcHJpdmF0ZSBvcHRpb25zOiBTb2hvRHJvcERvd25PcHRpb25zID0ge1xuICAgIHJlbG9hZDogJ25vbmUnXG4gIH07XG5cbiAgcHJpdmF0ZSBpc1JlYWRPbmx5PzogYm9vbGVhbiA9IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogU2V0cyB0aGUgZHJvcGRvd24gdG8gY2xvc2Ugb24gc2VsZWN0aW5nIGEgdmFsdWUgKGhlbHBmdWwgZm9yIG11bHRpLXNlbGVjdClcbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgY2xvc2VPblNlbGVjdChjbG9zZU9uU2VsZWN0OiBib29sZWFuIHwgdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5vcHRpb25zLmNsb3NlT25TZWxlY3QgPSBjbG9zZU9uU2VsZWN0O1xuICAgIGlmICh0aGlzLmRyb3Bkb3duKSB7XG4gICAgICB0aGlzLmRyb3Bkb3duLnNldHRpbmdzLmNsb3NlT25TZWxlY3QgPSBjbG9zZU9uU2VsZWN0O1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXQgY2xvc2VPblNlbGVjdCgpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLmNsb3NlT25TZWxlY3Q7XG4gIH1cblxuICAvKipcbiAgICogQXBwZW5kIGEgY3NzIGNsYXNzIHRvIHRoZSBkcm9wZG93bi1saXN0XG4gICAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgc2V0IGNzc0NsYXNzKGNzc0NsYXNzOiBzdHJpbmcgfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLm9wdGlvbnMuY3NzQ2xhc3MgPSBjc3NDbGFzcztcbiAgfVxuXG4gIHB1YmxpYyBnZXQgY3NzQ2xhc3MoKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLmNzc0NsYXNzO1xuICB9XG5cbiAgLyoqXG4gICAqIFR5cGluZyBkZWJvdW5jZSBmb3Igc2VhcmNoXG4gICAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgc2V0IGRlbGF5KGRlbGF5OiBudW1iZXIgfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLm9wdGlvbnMuZGVsYXkgPSBkZWxheTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgZGVsYXkoKTogbnVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLmRlbGF5O1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGljb24gdXNlZCBhcyB0aGUgRHJvcGRvd24gSW5kaWNhdG9yXG4gICAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgc2V0IGRyb3Bkb3duSWNvbihpY29uOiBzdHJpbmcgfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLm9wdGlvbnMuZHJvcGRvd25JY29uID0gaWNvbjtcbiAgICBpZiAodGhpcy5kcm9wZG93bikge1xuICAgICAgdGhpcy5kcm9wZG93bi5zZXR0aW5ncy5kcm9wZG93bkljb24gPSBpY29uO1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXQgZHJvcGRvd25JY29uKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5kcm9wZG93bkljb247XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSB0aGUgZW1wdHkgdmFsdWVcbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgZW1wdHkoZW1wdHk6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLm9wdGlvbnMuZW1wdHkgPSBlbXB0eTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgZW1wdHkoKTogYm9vbGVhbiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5lbXB0eTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWx1ZSBvZiB0aGUgbWF4aW11bSBudW1iZXIgb2Ygc2VsZWN0ZWQgZWxlbWVudHMgKG11c3QgaGF2ZSBtdWx0aXBsZSBzZXQgdG8gdHJ1ZSlcbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgbWF4U2VsZWN0ZWQobWF4U2VsZWN0ZWQ6IG51bWJlciB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMub3B0aW9ucy5tYXhTZWxlY3RlZCA9IG1heFNlbGVjdGVkO1xuICB9XG5cbiAgcHVibGljIGdldCBtYXhTZWxlY3RlZCgpOiBudW1iZXIgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnMubWF4U2VsZWN0ZWQ7XG4gIH1cblxuICAvKipcbiAgICogRmxhZyB0byBtb3ZlIHRoZSBzZWxlY3RlZCB2YWx1ZXMgdG8gdGhlIHRvcCBvZiB0aGUgZHJvcGRvd25cbiAgICpcbiAgICogQGRlcHJlY2F0ZWQgdXNlIG1vdmVTZWxlY3RlZFxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIHNldCBtb3ZlU2VsZWN0ZWRUb1RvcChtb3ZlU2VsZWN0ZWRUb1RvcDogYm9vbGVhbiB8IHVuZGVmaW5lZCkge1xuICAgIGNvbnNvbGUud2FybihgJ21vdmVTZWxlY3RlZFRvVG9wJyBoYXMgYmVlbiBkZXByZWNhdGVkLCBwbGVhc2UgdXNlICdtb3ZlU2VsZWN0ZWQnLmApO1xuICAgIHRoaXMub3B0aW9ucy5tb3ZlU2VsZWN0ZWRUb1RvcCA9IG1vdmVTZWxlY3RlZFRvVG9wOyAgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICB9XG5cbiAgcHVibGljIGdldCBtb3ZlU2VsZWN0ZWRUb1RvcCgpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLm1vdmVTZWxlY3RlZFRvVG9wO1xuICB9XG5cbiAgQElucHV0KClcbiAgcHVibGljIHNldCBtb3ZlU2VsZWN0ZWQobW92ZVNlbGVjdGVkOiBTb2hvRHJvcERvd25Nb3ZlU2VsZWN0ZWRPcHRpb25zIHwgdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5vcHRpb25zLm1vdmVTZWxlY3RlZCA9IG1vdmVTZWxlY3RlZDtcbiAgICBpZiAodGhpcy5kcm9wZG93bikge1xuICAgICAgdGhpcy5kcm9wZG93bi5zZXR0aW5ncy5tb3ZlU2VsZWN0ZWQgPSBtb3ZlU2VsZWN0ZWQ7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldCBtb3ZlU2VsZWN0ZWQoKTogU29ob0Ryb3BEb3duTW92ZVNlbGVjdGVkT3B0aW9ucyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5tb3ZlU2VsZWN0ZWQ7XG4gIH1cblxuICBASW5wdXQoKVxuICBwdWJsaWMgc2V0IHNob3dFbXB0eUdyb3VwSGVhZGVycyhzaG93RW1wdHlHcm91cEhlYWRlcnM6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLm9wdGlvbnMuc2hvd0VtcHR5R3JvdXBIZWFkZXJzID0gc2hvd0VtcHR5R3JvdXBIZWFkZXJzO1xuICAgIGlmICh0aGlzLmRyb3Bkb3duKSB7XG4gICAgICB0aGlzLmRyb3Bkb3duLnNldHRpbmdzLnNob3dFbXB0eUdyb3VwSGVhZGVycyA9IHNob3dFbXB0eUdyb3VwSGVhZGVycztcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0IHNob3dFbXB0eUdyb3VwSGVhZGVycygpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLnNob3dFbXB0eUdyb3VwSGVhZGVycztcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgc291cmNlQXJndW1lbnRzKHNvdXJjZUFyZ3VtZW50czogYW55KSB7XG4gICAgdGhpcy5vcHRpb25zLnNvdXJjZUFyZ3VtZW50cyA9IHNvdXJjZUFyZ3VtZW50cztcbiAgICBpZiAodGhpcy5kcm9wZG93bikge1xuICAgICAgdGhpcy5kcm9wZG93bi5zZXR0aW5ncy5zb3VyY2VBcmd1bWVudHMgPSBzb3VyY2VBcmd1bWVudHM7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldCBzb3VyY2VBcmd1bWVudHMoKTogYW55IHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLnNvdXJjZUFyZ3VtZW50cztcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmVzIHRoZSBmcmVxdWVuY3kgb2YgcmVsb2FkaW5nIGRhdGEgZnJvbSBhbiBleHRlcm5hbCBzb3VyY2VcbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgcmVsb2FkKHJlbG9hZDogU29ob0Ryb3BEb3duUmVsb2FkU3R5bGVzKSB7XG4gICAgdGhpcy5vcHRpb25zLnJlbG9hZCA9IHJlbG9hZDtcbiAgICBpZiAodGhpcy5kcm9wZG93bikge1xuICAgICAgdGhpcy5kcm9wZG93bi5zZXR0aW5ncy5yZWxvYWQgPSByZWxvYWQ7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldCByZWxvYWQoKTogU29ob0Ryb3BEb3duUmVsb2FkU3R5bGVzIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLnJlbG9hZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBJZiBzZXQgdGhlIHdpZHRoIG9mIHRoZSBkcm9wZG93biBpcyBsaW1pdGVkIHRvIHRoaXMgcGl4ZWwgd2lkdGguXG4gICAqIFVzZSAzMDAgZm9yIHRoZSAzMDAgcHggc2l6ZSBmaWVsZHMuIERlZmF1bHQgaXMgc2l6ZSBvZiB0aGUgbGFyZ2VzdCBkYXRhLlxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIHNldCBtYXhXaWR0aChtYXhXaWR0aDogbnVtYmVyIHwgdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5vcHRpb25zLm1heFdpZHRoID0gbWF4V2lkdGg7XG4gICAgaWYgKHRoaXMuZHJvcGRvd24pIHtcbiAgICAgIC8vIEB0b2RvIHRoaXMgcHJvcGVydHkgY2FuIG5vdCBiZSB1cGRhdGVkIG9uY2UgdGhlIGNvbnRyb2xcbiAgICAgIC8vIGhhcyBiZWVuIGluaXRpYWxpc2VkLlxuICAgICAgdGhpcy5kcm9wZG93bi5zZXR0aW5ncy5tYXhXaWR0aCA9IG1heFdpZHRoO1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXQgbWF4V2lkdGgoKTogbnVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLm1heFdpZHRoO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGV4YWN0IHdpZHRoIG9mIHRoZSBvcGVuIGxpc3QsIGJ5IGRlZmF1bHQgaXRzIHRoZSBzaXplIG9mIHRoZSBmaWVsZFxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIHNldCB3aWR0aCh3aWR0aDogbnVtYmVyIHwgdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5vcHRpb25zLndpZHRoID0gd2lkdGg7XG4gICAgaWYgKHRoaXMuZHJvcGRvd24pIHtcbiAgICAgIHRoaXMuZHJvcGRvd24uc2V0dGluZ3Mud2lkdGggPSB3aWR0aDtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0IHdpZHRoKCk6IG51bWJlciB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy53aWR0aDtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgZmlsdGVyTW9kZShmaWx0ZXJNb2RlOiBTb2hvRHJvcERvd25GaWx0ZXJNb2RlT3B0aW9ucyB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMub3B0aW9ucy5maWx0ZXJNb2RlID0gZmlsdGVyTW9kZTtcbiAgICBpZiAodGhpcy5kcm9wZG93bikge1xuICAgICAgdGhpcy5kcm9wZG93bi5zZXR0aW5ncy5maWx0ZXJNb2RlID0gZmlsdGVyTW9kZTtcbiAgICAgIHRoaXMubWFya0ZvclJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0IGZpbHRlck1vZGUoKTogU29ob0Ryb3BEb3duRmlsdGVyTW9kZU9wdGlvbnMgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnMuZmlsdGVyTW9kZTtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgdmlydHVhbFNjcm9sbCh2aXJ0dWFsU2Nyb2xsOiBib29sZWFuIHwgdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5vcHRpb25zLnZpcnR1YWxTY3JvbGwgPSB2aXJ0dWFsU2Nyb2xsO1xuICAgIGlmICh0aGlzLmRyb3Bkb3duKSB7XG4gICAgICB0aGlzLmRyb3Bkb3duLnNldHRpbmdzLnZpcnR1YWxTY3JvbGwgPSB2aXJ0dWFsU2Nyb2xsO1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXQgdmlydHVhbFNjcm9sbCgpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLnZpcnR1YWxTY3JvbGw7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgc2VsZWN0IGVsZW1lbnQgYXMgYSBtdWx0aS1zZWxlY3RcbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgbXVsdGlwbGUobXVsdGlwbGU6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLm9wdGlvbnMubXVsdGlwbGUgPSBtdWx0aXBsZTtcbiAgICBpZiAodGhpcy5kcm9wZG93bikge1xuICAgICAgdGhpcy5kcm9wZG93bi5zZXR0aW5ncy5tdWx0aXBsZSA9IG11bHRpcGxlO1xuICAgICAgdGhpcy5tYXJrRm9yUmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXQgbXVsdGlwbGUoKTogYm9vbGVhbiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5tdWx0aXBsZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBOYW1lIGZvciB0aGUgZHJvcGRvd24gY29udHJvbC4gTmVjZXNzYXJ5IGZvciBuZ01vZGVsIHRvIGZ1bmN0aW9uLlxuICAgKi9cbiAgQElucHV0KCkgbmFtZSA9IGBzb2hvLWRyb3Bkb3duLSR7U29ob0Ryb3BEb3duQ29tcG9uZW50LmNvdW50ZXIrK31gO1xuXG4gIC8qKlxuICAgKiBGbGFnIHRvIGFkZC9yZW1vdmUgc2VhcmNoIGZ1bmN0aW9uYWxpdHkgZnJvbSB0aGUgZHJvcGRvd25cbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgbm9TZWFyY2gobm9TZWFyY2g6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcbiAgICAvLyBBc3N1bWUgYW55IHZhbHVlIGlzIHRydWUgdG8gYWxsb3cgdGhlIG5vU2VhcmNoIGF0dHJpYnV0ZSB0byBiZSBhZGRlZFxuICAgIC8vIHdpdGhvdXQgYSBib29sZWFuIHZhbHVlLlxuICAgIGNvbnN0IHZhbHVlID0gbm9TZWFyY2ggIT09IG51bGwgJiYgbm9TZWFyY2ggYXMgYW55ICE9PSAnZmFsc2UnO1xuICAgIHRoaXMub3B0aW9ucy5ub1NlYXJjaCA9IHZhbHVlO1xuICAgIGlmICh0aGlzLmRyb3Bkb3duKSB7XG4gICAgICB0aGlzLmRyb3Bkb3duLnNldHRpbmdzLm5vU2VhcmNoID0gdmFsdWU7XG4gICAgICB0aGlzLm1hcmtGb3JSZWZyZXNoKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldCBub1NlYXJjaCgpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLm5vU2VhcmNoO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4aXN0ZW50IGFzIGEgaGVscGVyLi4uIHNob3VsZCB1c2UgZnJhbWV3b3JrJ3MgQVBJIHRvIGdldCBkYXRhIGFuZFxuICAgKiB0aGVuIGNyZWF0ZSBhbmQgcGFzcyB0byB0aGUgY29udHJvbCB0byB1c2VcbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgc291cmNlKHNvdXJjZTogU29ob0Ryb3BEb3duU291cmNlRnVuY3Rpb24gfCBPYmplY3QgfCBzdHJpbmcgfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLm9wdGlvbnMuc291cmNlID0gc291cmNlO1xuICB9XG5cbiAgcHVibGljIGdldCBzb3VyY2UoKTogU29ob0Ryb3BEb3duU291cmNlRnVuY3Rpb24gfCBPYmplY3QgfCBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbnMuc291cmNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgdGhlIHNob3dTZWxlY3RBbGwgdmFsdWUgZm9yIG11bHRpLXNlbGVjdCBkcm9wIGRvd25zXG4gICAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgc2V0IHNob3dTZWxlY3RBbGwoc2VsZWN0QWxsOiBib29sZWFuIHwgdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5vcHRpb25zLnNob3dTZWxlY3RBbGwgPSBzZWxlY3RBbGw7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHNob3dTZWxlY3RBbGwoKTogYm9vbGVhbiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5zaG93U2VsZWN0QWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgdGhlIHNob3dUYWdzIHZhbHVlIGZvciBtdWx0aS1zZWxlY3QgZHJvcCBkb3duc1xuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIHNldCBzaG93VGFncyhzaG93VGFnczogYm9vbGVhbiB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMub3B0aW9ucy5zaG93VGFncyA9IHNob3dUYWdzO1xuICB9XG5cbiAgcHVibGljIGdldCBzaG93VGFncygpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLnNob3dUYWdzO1xuICB9XG5cbiAgLyoqXG4gICAqIElmIHRydWUsIG1vdmVzIHRoZSBTZWFyY2hmaWVsZCBpbiB0aGUgRHJvcGRvd24gbGlzdCBmcm9tIGRpcmVjdGx5IG9uIHRvcCBvZiB0aGUgcHNldWRvLWxlbWVudFxuICAgKiB0byB1bmRlcm5lYXRoL2Fib3ZlLCBwcm92aWRpbmcgdmlzaWJpbGl0eSBpbnRvIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgcmVzdWx0cy5cbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgc2hvd1NlYXJjaFVuZGVyU2VsZWN0ZWQoc2hvd1NlYXJjaFVuZGVyU2VsZWN0ZWQ6IGJvb2xlYW4gfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLm9wdGlvbnMuc2hvd1NlYXJjaFVuZGVyU2VsZWN0ZWQgPSBzaG93U2VhcmNoVW5kZXJTZWxlY3RlZDtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgc2hvd1NlYXJjaFVuZGVyU2VsZWN0ZWQoKTogYm9vbGVhbiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5zaG93U2VhcmNoVW5kZXJTZWxlY3RlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBJZiBkZWZpbmVkLCBwYXNzZXMgYWxvbmcgJ2NsaWNrSGFuZGxlcicgYW5kICdkaXNtaXNzSGFuZGxlcicgZnVuY3Rpb25zIHRvIGFueSBUYWdzXG4gICAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgc2V0IHRhZ1NldHRpbmdzKHRhZ1NldHRpbmdzOiBhbnkpIHtcbiAgICB0aGlzLm9wdGlvbnMudGFnU2V0dGluZ3MgPSB0YWdTZXR0aW5ncztcbiAgfVxuXG4gIHB1YmxpYyBnZXQgdGFnU2V0dGluZ3MoKTogYW55IHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLnRhZ1NldHRpbmdzO1xuICB9XG5cbiAgLyoqXG4gICAqIElmIGRlZmluZWQsIHBhc3NlcyBhbG9uZyAnY2xpY2tIYW5kbGVyJyBhbmQgJ2Rpc21pc3NIYW5kbGVyJyBmdW5jdGlvbnMgdG8gYW55IFRhZ3NcbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgYWxsVGV4dFN0cmluZyhhbGxUZXh0U3RyaW5nOiBzdHJpbmcgfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLm9wdGlvbnMuYWxsVGV4dFN0cmluZyA9IGFsbFRleHRTdHJpbmc7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGFsbFRleHRTdHJpbmcoKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLmFsbFRleHRTdHJpbmc7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIGFwcGVuZFRvIGFkZGl0aW9uYWwgY2xhc3Nlc1xuICAgKi9cbiAgQElucHV0KCkgc2V0IGFwcGVuZFRvKGFwcGVuZFRvOiBzdHJpbmcpIHtcbiAgICB0aGlzLm9wdGlvbnMuYXBwZW5kVG8gPSBhcHBlbmRUbztcbiAgfVxuXG4gIC8qKkN1c3RvbSB0ZXh0IHN0cmluZyBmb3IgYFNlbGVjdGVkYCB0ZXh0IGhlYWRlciB1c2UgaW4gTXVsdGlTZWxlY3QgKi9cbiAgQElucHV0KClcbiAgcHVibGljIHNldCBzZWxlY3RlZFRleHRTdHJpbmcoc2VsZWN0ZWRUZXh0U3RyaW5nOiBzdHJpbmcpIHtcbiAgICB0aGlzLm9wdGlvbnMuc2VsZWN0ZWRUZXh0U3RyaW5nID0gc2VsZWN0ZWRUZXh0U3RyaW5nO1xuICB9XG5cbiAgcHVibGljIGdldCBzZWxlY3RlZFRleHRTdHJpbmcoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLnRhZ1NldHRpbmdzO1xuICB9XG5cbiAgQElucHV0KClcbiAgcHVibGljIHNldCBhdHRyaWJ1dGVzKGF0dHJpYnV0ZXM6IEFycmF5PE9iamVjdD4gfCBPYmplY3QgfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXM7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGF0dHJpYnV0ZXMoKTogQXJyYXk8T2JqZWN0PiB8IE9iamVjdCB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVzO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGxlZCB3aGVuIHRoZSBkcm9wZG93biB2YWx1ZSBjaGFuZ2VzXG4gICAqXG4gICAqIEB0b2RvIHJlcGxhY2Ugb3ZlcnJpZGUgb2YgbmF0aXZlIGF0dHJpYnV0ZVxuICAgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtcmVuYW1lLCBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LW5hdGl2ZVxuICBAT3V0cHV0KCdjaGFuZ2UnKSBjaGFuZ2UkID0gbmV3IEV2ZW50RW1pdHRlcjxKUXVlcnkuVHJpZ2dlcmVkRXZlbnQ+KCk7XG5cbiAgLyoqXG4gICAqIENhbGxlZCB3aGVuIHRoZSBkcm9wZG93biB1cGRhdGVzIGluIHNvbWUgd2F5LlxuICAgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtcmVuYW1lXG4gIEBPdXRwdXQoJ3VwZGF0ZWQnKVxuICB1cGRhdGVkJCA9IG5ldyBFdmVudEVtaXR0ZXI8SlF1ZXJ5LlRyaWdnZXJlZEV2ZW50PigpO1xuXG4gIC8qKlxuICAgKiBGaXJlZCB3aGVuIHRoZSBkcm9wZG93biBsaXN0IGlzIGNsb3NlZC5cbiAgICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LXJlbmFtZVxuICBAT3V0cHV0KCdsaXN0Y2xvc2VkJylcbiAgbGlzdENsb3NlZCQgPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9Ecm9wRG93bkV2ZW50PigpO1xuXG4gIC8qKlxuICAgKiBGaXJlZCB3aGVuIHRoZSBkcm9wZG93biBsaXN0IGlzIG9wZW5lZC5cbiAgICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LXJlbmFtZVxuICBAT3V0cHV0KCdsaXN0b3BlbmVkJylcbiAgbGlzdE9wZW5lZCQgPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9Ecm9wRG93bkV2ZW50PigpO1xuXG4gIC8qKlxuICAgKiBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gYSBrZXkgaXMgcHJlc3NlZFxuICAgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtcmVuYW1lLCBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LW5hdGl2ZVxuICBAT3V0cHV0KCdrZXlkb3duJykga2V5ZG93biQgPSBuZXcgRXZlbnRFbWl0dGVyPEV2ZW50PigpO1xuXG4gIC8qKlxuICAgKiBCaW5kIGF0dHJpYnV0ZXMgdG8gdGhlIGhvc3Qgc2VsZWN0IGVsZW1lbnRcbiAgICovXG5cbiAgLyoqXG4gICAqIEFzc2lnbiB0aGUgaWQgZm9yIHRoZSBjb250cm9sXG4gICAqIChtYXBzIHRvIHRoZSBuYW1lIHRvIHVzZSBvbiBhIGxhYmVsJ3MgJ2ZvcicgYXR0cmlidXRlKVxuICAgKi9cbiAgQEhvc3RCaW5kaW5nKCdpZCcpIGdldCBpZCgpIHtcbiAgICByZXR1cm4gdGhpcy5uYW1lO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLm11bHRpcGxlJykgZ2V0IGlzTXVsdGlwbGUoKSB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5tdWx0aXBsZTtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnY2xhc3MuZHJvcGRvd24nKSBnZXQgaXNEcm9wZG93bigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gIXRoaXMub3B0aW9ucy5tdWx0aXBsZTtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnY2xhc3MubXVsdGlzZWxlY3QnKSBnZXQgaXNNdWx0aVNlbGVjdCgpIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLm11bHRpcGxlO1xuICB9XG5cbiAgQElucHV0KClcbiAgcHVibGljIHNldCByZWFkb25seShyZWFkb25seTogYm9vbGVhbiB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMuaXNSZWFkT25seSA9IHJlYWRvbmx5O1xuICAgIGlmICh0aGlzLmRyb3Bkb3duKSB7XG4gICAgICBpZiAocmVhZG9ubHkpIHtcbiAgICAgICAgdGhpcy5kcm9wZG93bi5yZWFkb25seSgpO1xuICAgICAgfSBlbHNlIGlmIChyZWFkb25seSA9PT0gZmFsc2UpIHtcbiAgICAgICAgdGhpcy5kcm9wZG93bi5lbmFibGUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBnZXQgcmVhZG9ubHkoKTogYm9vbGVhbiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuaXNSZWFkT25seTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIFNvaG9Ecm9wRG93bkNvbXBvbmVudC5cbiAgICpcbiAgICogQHBhcmFtIGVsZW1lbnQgdGhlIGVsZW1lbnQgdGhpcyBjb21wb25lbnQgZW5jYXBzdWxhdGVzLlxuICAgKiBAcGFyYW0gbmdab25lIHRoZSBhbmd1bGFyIHpvbmUgZm9yIHRoaXMgY29tcG9uZW50XG4gICAqIEBwYXJhbSBuZ0NvbnRyb2wgYW55IGFzc29jaWF0ZWQgZm9ybSBjb250cm9sIChvcHRpb25hbClcbiAgICogQHBhcmFtIHJlZiB0aGUgY2hhbmdlIGRldGVjdG9yIHJlZmVyZW5jZSwgbXVzdCBub3QgYmUgbnVsbC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZWxlbWVudDogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxuICAgIEBTZWxmKCkgQE9wdGlvbmFsKCkgcHVibGljIG5nQ29udHJvbDogTmdDb250cm9sLFxuICAgIHB1YmxpYyByZWY6IENoYW5nZURldGVjdG9yUmVmKSB7XG5cbiAgICAvLyBJcyB0aGUgY29udHJvbCB1c2luZyBhIGZvcm0gY29udHJvbCBhbmQvb3IgbmdNb2RlbD9cbiAgICBpZiAodGhpcy5uZ0NvbnRyb2wpIHtcbiAgICAgIC8vIFdyYXAgdGhlIGFjY2Vzc29yIHRvIGFsbG93IHVwZGF0ZXMgdG8gYmUgcHVzaGVkLFxuICAgICAgLy8gYnV0IGFsc28gdXNlIHRoZSBzdGFuZGFyZCBhY2Nlc3NvcnMgcHJvdmlkZWQgYnkgYW5ndWxhci5cbiAgICAgIHRoaXMudmFsdWVBY2Nlc3NvciA9XG4gICAgICAgIG5ldyBTb2hvRHJvcERvd25Db250cm9sVmFsdWVBY2Nlc3NvckRlbGVnYXRvcigodGhpcy5uZ0NvbnRyb2wudmFsdWVBY2Nlc3NvciBhcyBhbnkpLCB0aGlzKTtcblxuICAgICAgLy8gLi4uIGNoYW5nZSB0aGUgYWNjZXNzb3Igb24gdGhlIGNvbnRyb2wgdG8gdXNlIG91cnMuXG4gICAgICB0aGlzLm5nQ29udHJvbC52YWx1ZUFjY2Vzc29yID0gdGhpcy52YWx1ZUFjY2Vzc29yO1xuICAgIH1cbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAvLyBjYWxsIG91dHNpZGUgdGhlIGFuZ3VsYXIgem9uZSBzbyBjaGFuZ2UgZGV0ZWN0aW9uXG4gICAgLy8gaXNuJ3QgdHJpZ2dlcmVkIGJ5IHRoZSBzb2hvIGNvbXBvbmVudC5cbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAvLyBhc3NpZ24gZWxlbWVudCB0byBsb2NhbCB2YXJpYWJsZVxuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50ID0galF1ZXJ5KHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50KTtcblxuICAgICAgdGhpcy5vcHRpb25zLm9uS2V5RG93biA9IChlOiBFdmVudCkgPT4gdGhpcy5uZ1pvbmUucnVuKCgpID0+IHRoaXMua2V5ZG93biQubmV4dChlKSk7XG5cbiAgICAgIC8vIGluaXRpYWxpc2UgdGhlIGRyb3Bkb3duIGNvbnRyb2xcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5kcm9wZG93bih0aGlzLm9wdGlvbnMpO1xuXG4gICAgICAvLyBleHRyYWN0IHRoZSBhcGlcbiAgICAgIHRoaXMuZHJvcGRvd24gPSB0aGlzLmpRdWVyeUVsZW1lbnQuZGF0YSgnZHJvcGRvd24nKTtcblxuICAgICAgLy8gQHRvZG8gLSBhZGQgZXZlbnQgYmluZGluZyBjb250cm9sIHNvIHdlIGRvbid0IGJpbmQgaWYgbm90IHJlcXVpcmVkLlxuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50XG4gICAgICAgIC5vbignY2hhbmdlJywgKGV2ZW50OiBKUXVlcnkuVHJpZ2dlcmVkRXZlbnQpID0+IHRoaXMub25DaGFuZ2VkKGV2ZW50KSlcbiAgICAgICAgLm9uKCd1cGRhdGVkJywgKGV2ZW50OiBKUXVlcnkuVHJpZ2dlcmVkRXZlbnQpID0+IHRoaXMub25VcGRhdGVkKGV2ZW50KSlcbiAgICAgICAgLm9uKCdyZXF1ZXN0ZW5kJywgKGV2ZW50OiBKUXVlcnkuVHJpZ2dlcmVkRXZlbnQsIHNlYXJjaFRlcm06IHN0cmluZywgZGF0YTogYW55W10pID0+IHRoaXMub25SZXF1ZXN0RW5kKGV2ZW50LCBzZWFyY2hUZXJtLCBkYXRhKSlcbiAgICAgICAgLm9uKCdsaXN0Y2xvc2VkJywgKGV2ZW50OiBKUXVlcnkuVHJpZ2dlcmVkRXZlbnQsIGFjdGlvbjogU29ob0Ryb3BEb3duRXZlbnRBY3Rpb25zKSA9PiB0aGlzLm9uTGlzdENsb3NlZChldmVudCwgYWN0aW9uKSlcbiAgICAgICAgLm9uKCdsaXN0b3BlbmVkJywgKGV2ZW50OiBKUXVlcnkuVHJpZ2dlcmVkRXZlbnQpID0+IHRoaXMub25MaXN0T3BlbmVkKGV2ZW50KSk7XG5cbiAgICAgIHRoaXMucnVuVXBkYXRlZE9uQ2hlY2sgPSB0cnVlO1xuICAgIH0pO1xuICB9XG5cbiAgbmdBZnRlclZpZXdDaGVja2VkKCkge1xuICAgIGlmICh0aGlzLnJ1blVwZGF0ZWRPbkNoZWNrKSB7XG4gICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gdXBkYXRlIHRoZSBjb250cm9sIEFGVEVSIHRoZSBtb2RlbFxuICAgICAgICAvLyBoYXMgYmVlbiB1cGRhdGVkIChhc3N1bWluZyB0aGVyZSBpcyBvbmUpLCBzb1xuICAgICAgICAvLyBleGVjdXRlIHVwZGF0ZWQgYWZ0ZXIgYW5ndWxhciBoYXMgZ2VuZXJhdGVkXG4gICAgICAgIC8vIHRoZSBtb2RlbCBhbmQgdGhlIHZpZXcgbWFya3VwLlxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMudXBkYXRlZCgpKTtcblxuICAgICAgICBpZiAodGhpcy5yZWFkb25seSkge1xuICAgICAgICAgIHRoaXMuZHJvcGRvd24/LnJlYWRvbmx5KCk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5yZWFkb25seSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICB0aGlzLmRyb3Bkb3duPy5lbmFibGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucnVuVXBkYXRlZE9uQ2hlY2sgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIGlmICh0aGlzLmpRdWVyeUVsZW1lbnQpIHtcbiAgICAgICAgLy8gcmVtb3ZlIHRoZSBldmVudCBsaXN0ZW5lcnMgb24gdGhpcyBlbGVtZW50LlxuICAgICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub2ZmKCk7XG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgICAgLy8gRGVzdHJveSBhbnkgd2lkZ2V0IHJlc291cmNlcy5cbiAgICAgIHRoaXMuZHJvcGRvd24/LmRlc3Ryb3koKTtcbiAgICAgIHRoaXMuZHJvcGRvd24gPSBudWxsO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEV2ZW50IGhhbmRsZXIgZm9yIHRoZSAncmVxdWVzdGVuZCcgZXZlbnQgb24gdGhlIGRyb3Bkb3duICdjb21wb25lbnQnLlxuICAgKlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnQgdGhlIHN0YW5kYXJkIGpRdWVyeSBldmVudC5cbiAgICogQHBhcmFtIGRhdGEgYW55IGRhdGEgcGFzc2VkIGJ5IHRoZSBkcm9wZG93biAodG9kbyB0aGUgdHlwZSlcbiAgICpcbiAgICovXG4gIHByaXZhdGUgb25SZXF1ZXN0RW5kKF9ldmVudDogSlF1ZXJ5LlRyaWdnZXJlZEV2ZW50LCBfc2VhcmNoVGVybTogc3RyaW5nLCBfZGF0YTogYW55W10pIHtcbiAgICAvLyBXaGVuIHRoZSByZXF1ZXN0IGZvciBkYXRhIGhhcyBjb21wbGV0ZWQsIG1ha2Ugc3VyZSB3ZVxuICAgIC8vIHVwZGF0ZSB0aGUgJ2Ryb3Bkb3duJyBjb250cm9sLlxuICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICB0aGlzLnJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgICB9KTtcblxuICB9XG5cbiAgcHJpdmF0ZSBvblVwZGF0ZWQoZXZlbnQ6IEpRdWVyeS5UcmlnZ2VyZWRFdmVudCkge1xuICAgIC8vIEZpcmUgdGhlIGV2ZW50LCBpbiB0aGUgYW5ndWxhciB6b25lLlxuICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLnVwZGF0ZWQkLm5leHQoZXZlbnQpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFdmVudCBoYW5kbGVyIGZvciB0aGUgJ2NoYW5nZWQnIGV2ZW50IG9uIHRoZSAnZHJvcGRvd24nIGNvbXBvbmVudC5cbiAgICpcbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IHRoZSBzdGFuZGFyZCBqUXVlcnkgZXZlbnQuXG4gICAqXG4gICAqL1xuICBwcml2YXRlIG9uQ2hhbmdlZChldmVudDogYW55KSB7XG4gICAgLy8gUmV0cmlldmUgdGhlIHZhbHVlIGZyb20gdGhlICdkcm9wZG93bicgY29tcG9uZW50LlxuICAgIGNvbnN0IHZhbCA9IHRoaXMualF1ZXJ5RWxlbWVudD8udmFsKCk7XG5cbiAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgLy8gVGhpcyB2YWx1ZSBuZWVkcyB0byBiZSBjb252ZXJ0ZWQgaW50byBhbiBvcHRpb25zIHZhbHVlLCB3aGljaCBpc1xuICAgICAgLy8gZ2VuZXJhdGVkIGJ5IHRoZSB7U2VsZWN0Q29udHJvbFZhbHVlQWNjZXNzb3J9LlxuICAgICAgaWYgKHRoaXMudmFsdWVBY2Nlc3Nvcikge1xuICAgICAgICBjb25zdCBvcHRpb25WYWx1ZSA9IHRoaXMudmFsdWVBY2Nlc3Nvci5jb252ZXJ0VG9PcHRpb25WYWx1ZSh2YWwpO1xuXG4gICAgICAgIC8vIE1ha2Ugc3VyZSBjYWxscyB0byBhbmd1bGFyIGFyZSBtYWRlIGluIHRoZSByaWdodCB6b25lLlxuICAgICAgICAvLyAuLi4gdXBkYXRlIHRoZSBtb2RlbCAod2hpY2ggd2lsbCBmaXJlIGNoYW5nZVxuICAgICAgICAvLyBkZXRlY3Rpb24gaWYgcmVxdWlyZWQpLlxuICAgICAgICBpZiAodGhpcy52YWx1ZUFjY2Vzc29yICYmIHRoaXMudmFsdWVBY2Nlc3Nvci5vbkNoYW5nZUZuKSB7XG4gICAgICAgICAgdGhpcy52YWx1ZUFjY2Vzc29yLm9uQ2hhbmdlRm4ob3B0aW9uVmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEB0b2RvIC0gdGhpcyB3YW50cyB0byBiZSB0aGUgcmVhbCB2YWx1ZSwgc28gd2UgbWF5IG5lZWQgdG8gbG9va1xuICAgICAgLy8gdGhhdCB1cC5cbiAgICAgIGV2ZW50LmRhdGEgPSB2YWw7XG4gICAgICB0aGlzLmNoYW5nZSQuZW1pdChldmVudCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlcyB0aGUgJ2xpc3RvcGVuZWQnIGV2ZW50IHRyaWdnZXJlZCBieSB0aGUgdW5kZXJseWluZyBqUXVlcnkgY29udHJvbC5cbiAgICpcbiAgICogQHBhcmFtIGV2ZW50IHRoZSBmaXJlZCBldmVudC5cbiAgICovXG4gIHByaXZhdGUgb25MaXN0T3BlbmVkKGV2ZW50OiBTb2hvRHJvcERvd25FdmVudCk6IHZvaWQge1xuICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICB0aGlzLmxpc3RPcGVuZWQkLmVtaXQoZXZlbnQpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgdGhlICdsaXN0Y2xvc2VkJyBldmVudCB0cmlnZ2VyZWQgYnkgdGhlIHVuZGVybHlpbmcgalF1ZXJ5IGNvbnRyb2wuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudCB0aGUgZmlyZWQgZXZlbnQuXG4gICAqL1xuICBwcml2YXRlIG9uTGlzdENsb3NlZChldmVudDogU29ob0Ryb3BEb3duRXZlbnQsIGFjdGlvbjogU29ob0Ryb3BEb3duRXZlbnRBY3Rpb25zKTogdm9pZCB7XG4gICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgZXZlbnQgaXMgZml4ZWQgdXAgZm9yIGRpc3BhdGNoXG4gICAgICBldmVudC5hY3Rpb24gPSBhY3Rpb247XG4gICAgICB0aGlzLmxpc3RDbG9zZWQkLmVtaXQoZXZlbnQpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEluIGNhc2Ugb3B0aW9ucyBhcmUgYmVpbmcgYm91bmQgYXN5bmNocm9ub3VzbHksIHlvdSB3aWxsIG5lZWQgdG8gdHJpZ2dlciB1cGRhdGVkIG9uXG4gICAqIHNvaG8gZHJvcGRvd24gY29udHJvbCBzbyBpdCB1cGRhdGVzIGl0cyB2YWx1ZSBsYWJlbHMuXG4gICAqL1xuICBwdWJsaWMgdXBkYXRlZCgpOiBTb2hvRHJvcERvd25Db21wb25lbnQge1xuICAgIGlmICh0aGlzLmRyb3Bkb3duKSB7XG4gICAgICAvLyBDYWxsaW5nIHVwZGF0ZWQgd2hlbiBhbiBpdGVtIGlzIHNlbGVjdGVkLCBsb3NlcyB0aGUgc2VsZWN0aW9uIVxuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4gdGhpcy5kcm9wZG93bj8udXBkYXRlZCgpKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIENvbXBvbmVudCBJbnB1dFxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgQElucHV0KCkgc2V0IGRpc2FibGVkKHZhbHVlOiBib29sZWFuKSB7XG4gICAgaWYgKHRoaXMuZHJvcGRvd24pIHtcbiAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLmRyb3Bkb3duPy5kaXNhYmxlKCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4gdGhpcy5kcm9wZG93bj8uZW5hYmxlKCkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogU29oby1kcm9wZG93biBpcyBub3QgYSBuYXRpdmUgZWxlbWVudCAtIG5lZWQgdGhpcyB0byBzZXQgZm9jdXMgcHJvZ3JhbW1hdGljYWxseS5cbiAgICogJ25hbWUnIGF0dHJpYnV0ZSBtdXN0IGJlIHNldCBvbiB0aGUgY29udHJvbCBmb3IgdGhpcyB0byB3b3JrIGNvcnJlY3RseS5cbiAgICovXG4gIHB1YmxpYyBzZXRGb2N1cygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5qUXVlcnlFbGVtZW50KSB7XG4gICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudD8udHJpZ2dlcignYWN0aXZhdGVkJyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIFNldHMgdGhlIHZhbHVlIG9mIHRoZSBkcm9wZG93bi5cbiAgICpcbiAgICogQHRvZG8gdGhpcyBtYXkgbmVlZCB0byBpbnZvbHZlIG1hcHBpbmcgZnJvbSBhY3R1YWwgdmFsdWVcbiAgICogaWYgbmdNb2RlbCBpcyB1c2VkLlxuICAgKlxuICAgKiBUaGlzIGlzIHRoZSBtb2RlbCB2YWx1ZSB0aGF0IGlzIHRvIGJlIHNldC5cbiAgICogQHBhcmFtIHZhbHVlIC0gdGhlIGludGVybmFsIHZhbHVlIHRvIHNlbGVjdFxuICAgKi9cbiAgcHVibGljIHNlbGVjdFZhbHVlKHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kcm9wZG93bikge1xuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICB0aGlzLmRyb3Bkb3duPy5zZWxlY3RWYWx1ZSh2YWx1ZSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTWFya3MgdGhlIGNvbXBvbmVudHMgYXMgcmVxdWlyaW5nIGEgcmVidWlsZCBhZnRlciB0aGUgbmV4dCB1cGRhdGUuXG4gICAqL1xuICBtYXJrRm9yUmVmcmVzaCgpIHtcbiAgICAvLyBSdW4gdXBkYXRlZCBvbiB0aGUgbmV4dCB1cGRhdGVkIGNoZWNrLlxuICAgIHRoaXMucnVuVXBkYXRlZE9uQ2hlY2sgPSB0cnVlO1xuXG4gICAgLy8gLi4uIG1ha2Ugc3VyZSB0aGUgY2hhbmdlIGRldGVjdG9yIGtpY2tzIGluLCBvdGhlcndpc2UgaWYgdGhlIGlucHV0c1xuICAgIC8vIHdlcmUgY2hhbmdlIHByb2dyYW1tYXRpYWxseSB0aGUgY29tcG9uZW50IG1heSBub3QgYmUgZWxpZ2libGUgZm9yXG4gICAgLy8gdXBkYXRpbmcuXG4gICAgdGhpcy5yZWYubWFya0ZvckNoZWNrKCk7XG4gIH1cbn1cblxuLyoqXG4gKiBQcm92aWRlcyBhICd3cmFwcGVyJyBhcm91bmQgdGhlIHtDb250cm9sVmFsdWVBY2Nlc3Nvcn0gYWRkZWQgYnlcbiAqIGFuZ3VsYXIgd2hlbiBoYW5kbGluZyBgc2VsZWN0YCBlbGVtZW50cy5cbiAqXG4gKiBUaGlzIGNsYXNzIGFsbG93cyB0aGUge1NvaG9Ecm9wRG93bkNvbXBvbmVudH0gdG8gaW50ZXJvcGVyYXRlIHdpdGhcbiAqIHRoZSB7Q29udHJvbFZhbHVlQWNjZXNzb3J9LiAgU3BlY2lmaWNhbGx5LCBwcm92aWRpbmcgYWNjZXNzIHRvIHRoZVxuICogb25DaGFuZ2UgZnVuY3Rpb24sIHdoaWNoIHdlIG11c3QgY2FsbCB3aGVuIHRoZSB2YWx1ZSBvZiB0aGUgZHJvcGRvd25cbiAqIGlzIG1vZGlmaWVkLlxuICpcbiAqIEl0IGFsc28gZXhwb3NlcyB0aGUgZW5jb2RpbmcgdXNlZCBzdG9yaW5nIGNvbXBsZXggb2JqZWN0cyBhc1xuICogdmFsdWVzIGluIHRoZSAnb3B0aW9uJyBlbGVtZW50cy5cbiAqXG4gKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXIvYW5ndWxhci9ibG9iL21hc3Rlci9wYWNrYWdlcy9mb3Jtcy9zcmMvZGlyZWN0aXZlcy9zZWxlY3RfbXVsdGlwbGVfY29udHJvbF92YWx1ZV9hY2Nlc3Nvci50cy5cbiAqXG4gKlxuICpcbiAqL1xuY2xhc3MgU29ob0Ryb3BEb3duQ29udHJvbFZhbHVlQWNjZXNzb3JEZWxlZ2F0b3IgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciB7XG4gIC8qKlxuICAgKiBUaGUgRnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZSB2YWx1ZSBvZiB0aGUgY29udHJvbCBjaGFuZ2VzLlxuICAgKi9cbiAgcHVibGljIG9uQ2hhbmdlRm4/OiBGdW5jdGlvbjtcblxuICAvKipcbiAgICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBTb2hvRHJvcERvd25Db250cm9sVmFsdWVBY2Nlc3NvckRlbGVnYXRlLlxuICAgKlxuICAgKiBAcGFyYW0gZGVsZWdhdGUgdGhlIHZhbHVlIGFjY2Vzc29yXG4gICAqIEBwYXJhbSBkcm9wZG93biB0aGUgZHJvcGRvd24gbGlua2VkIHRvIHRoZSBhY2Nlc3NvclxuICAgKlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBkZWxlZ2F0ZTogQ29udHJvbFZhbHVlQWNjZXNzb3IsXG4gICAgcHJpdmF0ZSBkcm9wZG93bjogU29ob0Ryb3BEb3duQ29tcG9uZW50KSB7IH1cblxuICB3cml0ZVZhbHVlKHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICAvLyBKdXN0IHBhc3MgaXQgb24uXG4gICAgdGhpcy5kZWxlZ2F0ZS53cml0ZVZhbHVlKHZhbHVlKTtcblxuICAgIC8vIEB0b2RvIHJlZHVjZSB0aGUgbnVtYmVyIG9mIGNhbGxzIHRvIHRoaXMhXG4gICAgdGhpcy5kcm9wZG93bi5tYXJrRm9yUmVmcmVzaCgpO1xuICB9XG5cbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KTogdm9pZCB7XG4gICAgLy8gS2VlcCBhIHJlZmVyZW5jZSB0byB0aGUgY2hhbmdlIGZ1bmN0aW9uLCB0aGVuIHdlIGFuIGNhbGwgaXQuXG4gICAgdGhpcy5vbkNoYW5nZUZuID0gZm47XG5cbiAgICAvLyBHaXZlIHRoZSBkZWxlZ2F0ZSBhIGNoYW5jZSB0byBzdG9yZSB0aGlzIHRvby5cbiAgICB0aGlzLmRlbGVnYXRlLnJlZ2lzdGVyT25DaGFuZ2UoZm4pO1xuICB9XG5cbiAgcmVnaXN0ZXJPblRvdWNoZWQoZm46IGFueSk6IHZvaWQge1xuICAgIHRoaXMuZGVsZWdhdGUucmVnaXN0ZXJPblRvdWNoZWQoZm4pO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgalF1ZXJ5IHdpZGdldCB3aXRoIHRoZSByZXF1ZXN0IGRpc2FibGVkIHN0YXRlLlxuICAgKlxuICAgKiBAcGFyYW0gaXNEaXNhYmxlZCB0cnVlIGlmIHRoZSBjb250cm9sIHNob3VsZCBiZSBkaXNhYmxlZDsgb3RoZXJ3aXNlIGZhbHNlLlxuICAgKlxuICAgKi9cbiAgc2V0RGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy5kcm9wZG93bi5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XG5cbiAgICBpZiAodGhpcy5kZWxlZ2F0ZS5zZXREaXNhYmxlZFN0YXRlKSB7XG4gICAgICB0aGlzLmRlbGVnYXRlLnNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnQgdGhlICdyZWFsJyB2YWx1ZSBpbnRvIHRoZSBjb3JyZXNwb25kaW5nXG4gICAqIG9wdGlvbiB2YWx1ZS5cbiAgICpcbiAgICpcbiAgICogQHBhcmFtIHZhbHVlIHRoZSB2YWx1ZSBvZiB0aGUgb3B0aW9uOyBtdXN0IG5vdCBiZSBudWxsLlxuICAgKiBAcmV0dXJucyB0aGUgc3RyaW5nIG9wdGlwblZhbHVlIG9mIHRoZSBvdGlvbiBlbGVtZW4uXG4gICAqXG4gICAqL1xuICBjb252ZXJ0VG9PcHRpb25WYWx1ZSh2YWx1ZTogYW55KTogc3RyaW5nIHtcbiAgICBjb25zdCBkZWxlZ2F0ZSA9ICh0aGlzLmRlbGVnYXRlIGFzIGFueSk7XG4gICAgY29uc3QgaWQgPSBkZWxlZ2F0ZS5fZ2V0T3B0aW9uSWQodmFsdWUpO1xuICAgIHJldHVybiB0aGlzLmJ1aWxkVmFsdWVTdHJpbmcoaWQsIHZhbHVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb3B5IG9mIHRoZSBcInZhbHVlc3RyaW5nXCIgYnVpbGRlciB1c2VkIGJ5IHRoZSBBbmd1bGFyXG4gICAqIFNlbGVjdCBhbmQgTXVsdGlTZWxlY3RcbiAgICpcbiAgICogQHBhcmFtIGlkIG9wdGlvbiBpZCAob3JkaW5hbClcbiAgICogQHBhcmFtIHZhbHVlIHRoZSBhY3R1YWwgdmFsdWVcbiAgICovXG4gIHByaXZhdGUgYnVpbGRWYWx1ZVN0cmluZyhpZDogYW55LCB2YWx1ZTogYW55KSB7XG4gICAgaWYgKGlkID09IG51bGwpIHtcbiAgICAgIHJldHVybiAnJyArIHZhbHVlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgdmFsdWUgPSAnXFwnJyArIHZhbHVlICsgJ1xcJyc7XG4gICAgfVxuXG4gICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHZhbHVlID0gJ09iamVjdCc7XG4gICAgfVxuICAgIHJldHVybiAoaWQgKyAnOiAnICsgdmFsdWUpLnNsaWNlKDAsIDUwKTtcbiAgfVxufVxuIl19