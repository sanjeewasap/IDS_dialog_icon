import { ChangeDetectionStrategy, Component, EventEmitter, HostBinding, Input, Output, } from '@angular/core';
import * as i0 from "@angular/core";
export class SohoBarComponent {
    get isBar() {
        return true;
    }
    /** Defines the data to use, must be specified for this component. */
    set dataset(dataset) {
        this.options.dataset = dataset;
        if (this.bar) {
            this.bar.settings.dataset = dataset;
            this.updateRequired = true;
        }
    }
    /** Chart Type */
    set type(value) {
        this.options.type = value;
        if (this.bar) {
            this.bar.settings.type = value;
            this.updateRequired = true;
        }
    }
    /** Default is a single or stacked chart. */
    set isStacked(value) {
        this.options.isStacked = value;
        if (this.bar) {
            this.bar.settings.isStacked = value;
            this.updateRequired = true;
        }
    }
    /** If true its a 100% bar chart. */
    set isNormalized(value) {
        this.options.isNormalized = value;
        if (this.bar) {
            this.bar.settings.isNormalized = value;
            this.updateRequired = true;
        }
    }
    /** If true its a grouped bar chart. */
    set isGrouped(value) {
        this.options.isGrouped = value;
        if (this.bar) {
            this.bar.settings.isGrouped = value;
            this.updateRequired = true;
        }
    }
    /** If false the legend will not be shown. */
    set showLegend(value) {
        this.options.showLegend = value;
        if (this.bar) {
            this.bar.settings.showLegend = value;
            this.updateRequired = true;
        }
    }
    /** true|false - will do or not do the animation, 'initial' will do only first time the animation. */
    set animate(value) {
        this.options.animate = value;
        if (this.bar) {
            this.bar.settings.animate = value;
            this.updateRequired = true;
        }
    }
    /** If true, the component will not resize when resizing the page. */
    set redrawOnResize(value) {
        this.options.redrawOnResize = value;
        if (this.bar) {
            this.bar.settings.redrawOnResize = value;
            this.updateRequired = true;
        }
    }
    /** Use d3 format some examples can be found on http://bit.ly/1IKVhHh */
    set formatterString(value) {
        this.options.formatterString = value;
        if (this.bar) {
            this.bar.settings.formatterString = value;
            this.updateRequired = true;
        }
    }
    /** The d3 axis format. */
    set format(value) {
        this.options.format = value;
        if (this.bar) {
            this.bar.settings.format = value;
            this.updateRequired = true;
        }
    }
    /** A tooltip for the whole chart. */
    set tooltip(value) {
        this.options.tooltip = value;
        if (this.bar) {
            this.bar.settings.tooltip = value;
            this.updateRequired = true;
        }
    }
    /** If true log scale is enabled. */
    set useLogScale(value) {
        this.options.useLogScale = value;
        if (this.bar) {
            this.bar.settings.useLogScale = value;
            this.updateRequired = true;
        }
    }
    /** Settings for the chart ticks. Can set ticks: {format: d3Format, number: n} */
    set ticks(value) {
        this.options.ticks = value;
        if (this.bar) {
            this.bar.settings.ticks = value;
            this.updateRequired = true;
        }
    }
    /** Show the in the axis lines or not. */
    set showLines(value) {
        this.options.showLines = value;
        if (this.bar) {
            this.bar.settings.showLines = value;
            this.updateRequired = true;
        }
    }
    /** How far out than the outer circle should the labels be placed, this
     * may be useful to adjust for some labels. */
    set labelFactor(value) {
        this.options.labelFactor = value;
        if (this.bar) {
            this.bar.settings.labelFactor = value;
            this.updateRequired = true;
        }
    }
    /** The number of pixels after which a label needs to be given a new line.
     * You may want to change this based on label data. */
    set wrapWidth(value) {
        this.options.wrapWidth = value;
        if (this.bar) {
            this.bar.settings.wrapWidth = value;
            this.updateRequired = true;
        }
    }
    /** If true chart height will fit in parent available height. */
    set fitHeight(value) {
        this.options.fitHeight = value;
        if (this.bar) {
            this.bar.settings.fitHeight = value;
            this.updateRequired = true;
        }
    }
    /** An empty message will be displayed when there is no chart data. */
    set emptyMessage(value) {
        this.options.emptyMessage = value;
        if (this.bar) {
            this.bar.settings.emptyMessage = value;
            this.updateRequired = true;
        }
    }
    /**
     * Add extra attributes like id's to the component
     *
     * @param attributes - the array or object of attributes to add
     */
    set attributes(attributes) {
        this.options.attributes = attributes;
        if (this.bar) {
            this.bar.settings.attributes = attributes;
            this.updateRequired = true;
        }
    }
    constructor(element, ngZone) {
        this.element = element;
        this.ngZone = ngZone;
        /** Options. */
        this.options = {};
        /** Events */
        this.selected = new EventEmitter();
        this.unselected = new EventEmitter();
        this.rendered = new EventEmitter();
        // eslint-disable-next-line @angular-eslint/no-output-native, @angular-eslint/no-output-rename
        this.dblclick = new EventEmitter();
        /**
         * @todo replace override of native attribute
         */
        // eslint-disable-next-line @angular-eslint/no-output-native
        this.contextmenu = new EventEmitter();
        this.updateRequired = false;
    }
    /** Setup */
    ngAfterViewInit() {
        this.ngZone.runOutsideAngular(() => {
            this.jQueryElement = jQuery(this.element.nativeElement);
            this.jQueryElement.chart(this.options);
            this.bar = this.jQueryElement.data('bar');
            // Setup the events
            this.jQueryElement.on('selected', (_e, args) => this.ngZone.run(() => this.selected.emit(args)));
            this.jQueryElement.on('unselected', (_e, args) => this.ngZone.run(() => this.unselected.emit(args)));
            this.jQueryElement.on('rendered', (...args) => this.ngZone.run(() => this.rendered.emit(args)));
            this.jQueryElement.on('contextmenu', (...args) => this.ngZone.run(() => this.contextmenu?.emit(args)));
            this.jQueryElement.on('dblclick', (_e, args) => this.ngZone.run(() => this.dblclick.emit(args)));
        });
    }
    ngAfterViewChecked() {
        if (this.bar && this.updateRequired) {
            this.ngZone.runOutsideAngular(() => this.bar?.updated(this.bar.settings));
            this.updateRequired = false;
        }
    }
    updated() {
        this.ngZone.runOutsideAngular(() => {
            this.options.type = 'bar';
            this.jQueryElement?.chart(this.options);
            this.bar = this.jQueryElement?.data('bar');
        });
    }
    /** Tear Down */
    ngOnDestroy() {
        // call outside the angular zone so change detection isn't triggered by the soho component.
        this.ngZone.runOutsideAngular(() => {
            if (this.jQueryElement) {
                this.jQueryElement.off();
                this.jQueryElement = undefined;
            }
            if (this.bar) {
                this.bar.destroy();
                this.bar = null;
            }
        });
    }
    setSelected(selected) {
        this.ngZone.runOutsideAngular(() => this.bar?.setSelected(selected));
    }
    toggleSelected(selected) {
        this.ngZone.runOutsideAngular(() => this.bar?.toggleSelected(selected));
    }
    getSelected() {
        return this.ngZone.runOutsideAngular(() => this.bar.getSelected());
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoBarComponent, deps: [{ token: i0.ElementRef }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.4", type: SohoBarComponent, selector: "[soho-bar]", inputs: { dataset: "dataset", type: "type", isStacked: "isStacked", isNormalized: "isNormalized", isGrouped: "isGrouped", showLegend: "showLegend", animate: "animate", redrawOnResize: "redrawOnResize", formatterString: "formatterString", format: "format", tooltip: "tooltip", useLogScale: "useLogScale", ticks: "ticks", showLines: "showLines", labelFactor: "labelFactor", wrapWidth: "wrapWidth", fitHeight: "fitHeight", emptyMessage: "emptyMessage", attributes: "attributes" }, outputs: { selected: "selected", unselected: "unselected", rendered: "rendered", dblclick: "dblclick", contextmenu: "contextmenu" }, host: { properties: { "class.chart-container.bar-chart": "this.isBar" } }, ngImport: i0, template: '<ng-content></ng-content>', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.4", ngImport: i0, type: SohoBarComponent, decorators: [{
            type: Component,
            args: [{
                    selector: '[soho-bar]',
                    template: '<ng-content></ng-content>',
                    changeDetection: ChangeDetectionStrategy.OnPush
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.NgZone }]; }, propDecorators: { isBar: [{
                type: HostBinding,
                args: ['class.chart-container.bar-chart']
            }], dataset: [{
                type: Input
            }], type: [{
                type: Input
            }], isStacked: [{
                type: Input
            }], isNormalized: [{
                type: Input
            }], isGrouped: [{
                type: Input
            }], showLegend: [{
                type: Input
            }], animate: [{
                type: Input
            }], redrawOnResize: [{
                type: Input
            }], formatterString: [{
                type: Input
            }], format: [{
                type: Input
            }], tooltip: [{
                type: Input
            }], useLogScale: [{
                type: Input
            }], ticks: [{
                type: Input
            }], showLines: [{
                type: Input
            }], labelFactor: [{
                type: Input
            }], wrapWidth: [{
                type: Input
            }], fitHeight: [{
                type: Input
            }], emptyMessage: [{
                type: Input
            }], attributes: [{
                type: Input
            }], selected: [{
                type: Output
            }], unselected: [{
                type: Output
            }], rendered: [{
                type: Output
            }], dblclick: [{
                type: Output
            }], contextmenu: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29oby1iYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvaWRzLWVudGVycHJpc2Utbmcvc3JjL2xpYi9iYXIvc29oby1iYXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFHTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUVULFlBQVksRUFDWixXQUFXLEVBQ1gsS0FBSyxFQUdMLE1BQU0sR0FDUCxNQUFNLGVBQWUsQ0FBQzs7QUFRdkIsTUFBTSxPQUFPLGdCQUFnQjtJQUkzQixJQUFvRCxLQUFLO1FBQ3ZELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELHFFQUFxRTtJQUNyRSxJQUFhLE9BQU8sQ0FBQyxPQUFtQjtRQUN0QyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFFL0IsSUFBSSxJQUFJLENBQUMsR0FBRyxFQUFFO1lBQ1osSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztZQUNwQyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztTQUM1QjtJQUNILENBQUM7SUFFRCxpQkFBaUI7SUFDakIsSUFBYSxJQUFJLENBQUMsS0FBa0I7UUFDbEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDO1FBRTFCLElBQUksSUFBSSxDQUFDLEdBQUcsRUFBRTtZQUNaLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUM7WUFDL0IsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7U0FDNUI7SUFDSCxDQUFDO0lBRUQsNENBQTRDO0lBQzVDLElBQWEsU0FBUyxDQUFDLEtBQWM7UUFDbkMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1FBRS9CLElBQUksSUFBSSxDQUFDLEdBQUcsRUFBRTtZ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QWpCLE1BQU07Z0JBRUcsUUFBUTtzQkFBakIsTUFBTTtnQkFLRyxXQUFXO3NCQUFwQixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3Q2hlY2tlZCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZyxcbiAgSW5wdXQsXG4gIE5nWm9uZSxcbiAgT25EZXN0cm95LFxuICBPdXRwdXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdbc29oby1iYXJdJywgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICB0ZW1wbGF0ZTogJzxuZy1jb250ZW50PjwvbmctY29udGVudD4nLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcblxuZXhwb3J0IGNsYXNzIFNvaG9CYXJDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBBZnRlclZpZXdDaGVja2VkLCBPbkRlc3Ryb3kge1xuICAvKiogT3B0aW9ucy4gKi9cbiAgcHJpdmF0ZSBvcHRpb25zOiBTb2hvQmFyT3B0aW9ucyA9IHt9O1xuXG4gIEBIb3N0QmluZGluZygnY2xhc3MuY2hhcnQtY29udGFpbmVyLmJhci1jaGFydCcpIGdldCBpc0JhcigpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKiBEZWZpbmVzIHRoZSBkYXRhIHRvIHVzZSwgbXVzdCBiZSBzcGVjaWZpZWQgZm9yIHRoaXMgY29tcG9uZW50LiAqL1xuICBASW5wdXQoKSBzZXQgZGF0YXNldChkYXRhc2V0OiBBcnJheTxhbnk+KSB7XG4gICAgdGhpcy5vcHRpb25zLmRhdGFzZXQgPSBkYXRhc2V0O1xuXG4gICAgaWYgKHRoaXMuYmFyKSB7XG4gICAgICB0aGlzLmJhci5zZXR0aW5ncy5kYXRhc2V0ID0gZGF0YXNldDtcbiAgICAgIHRoaXMudXBkYXRlUmVxdWlyZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBDaGFydCBUeXBlICovXG4gIEBJbnB1dCgpIHNldCB0eXBlKHZhbHVlOiBTb2hvQmFyVHlwZSkge1xuICAgIHRoaXMub3B0aW9ucy50eXBlID0gdmFsdWU7XG5cbiAgICBpZiAodGhpcy5iYXIpIHtcbiAgICAgIHRoaXMuYmFyLnNldHRpbmdzLnR5cGUgPSB2YWx1ZTtcbiAgICAgIHRoaXMudXBkYXRlUmVxdWlyZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBEZWZhdWx0IGlzIGEgc2luZ2xlIG9yIHN0YWNrZWQgY2hhcnQuICovXG4gIEBJbnB1dCgpIHNldCBpc1N0YWNrZWQodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLm9wdGlvbnMuaXNTdGFja2VkID0gdmFsdWU7XG5cbiAgICBpZiAodGhpcy5iYXIpIHtcbiAgICAgIHRoaXMuYmFyLnNldHRpbmdzLmlzU3RhY2tlZCA9IHZhbHVlO1xuICAgICAgdGhpcy51cGRhdGVSZXF1aXJlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgLyoqIElmIHRydWUgaXRzIGEgMTAwJSBiYXIgY2hhcnQuICovXG4gIEBJbnB1dCgpIHNldCBpc05vcm1hbGl6ZWQodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLm9wdGlvbnMuaXNOb3JtYWxpemVkID0gdmFsdWU7XG5cbiAgICBpZiAodGhpcy5iYXIpIHtcbiAgICAgIHRoaXMuYmFyLnNldHRpbmdzLmlzTm9ybWFsaXplZCA9IHZhbHVlO1xuICAgICAgdGhpcy51cGRhdGVSZXF1aXJlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgLyoqIElmIHRydWUgaXRzIGEgZ3JvdXBlZCBiYXIgY2hhcnQuICovXG4gIEBJbnB1dCgpIHNldCBpc0dyb3VwZWQodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLm9wdGlvbnMuaXNHcm91cGVkID0gdmFsdWU7XG5cbiAgICBpZiAodGhpcy5iYXIpIHtcbiAgICAgIHRoaXMuYmFyLnNldHRpbmdzLmlzR3JvdXBlZCA9IHZhbHVlO1xuICAgICAgdGhpcy51cGRhdGVSZXF1aXJlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgLyoqIElmIGZhbHNlIHRoZSBsZWdlbmQgd2lsbCBub3QgYmUgc2hvd24uICovXG4gIEBJbnB1dCgpIHNldCBzaG93TGVnZW5kKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5vcHRpb25zLnNob3dMZWdlbmQgPSB2YWx1ZTtcblxuICAgIGlmICh0aGlzLmJhcikge1xuICAgICAgdGhpcy5iYXIuc2V0dGluZ3Muc2hvd0xlZ2VuZCA9IHZhbHVlO1xuICAgICAgdGhpcy51cGRhdGVSZXF1aXJlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgLyoqIHRydWV8ZmFsc2UgLSB3aWxsIGRvIG9yIG5vdCBkbyB0aGUgYW5pbWF0aW9uLCAnaW5pdGlhbCcgd2lsbCBkbyBvbmx5IGZpcnN0IHRpbWUgdGhlIGFuaW1hdGlvbi4gKi9cbiAgQElucHV0KCkgc2V0IGFuaW1hdGUodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLm9wdGlvbnMuYW5pbWF0ZSA9IHZhbHVlO1xuXG4gICAgaWYgKHRoaXMuYmFyKSB7XG4gICAgICB0aGlzLmJhci5zZXR0aW5ncy5hbmltYXRlID0gdmFsdWU7XG4gICAgICB0aGlzLnVwZGF0ZVJlcXVpcmVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvKiogSWYgdHJ1ZSwgdGhlIGNvbXBvbmVudCB3aWxsIG5vdCByZXNpemUgd2hlbiByZXNpemluZyB0aGUgcGFnZS4gKi9cbiAgQElucHV0KCkgc2V0IHJlZHJhd09uUmVzaXplKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5vcHRpb25zLnJlZHJhd09uUmVzaXplID0gdmFsdWU7XG5cbiAgICBpZiAodGhpcy5iYXIpIHtcbiAgICAgIHRoaXMuYmFyLnNldHRpbmdzLnJlZHJhd09uUmVzaXplID0gdmFsdWU7XG4gICAgICB0aGlzLnVwZGF0ZVJlcXVpcmVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvKiogVXNlIGQzIGZvcm1hdCBzb21lIGV4YW1wbGVzIGNhbiBiZSBmb3VuZCBvbiBodHRwOi8vYml0Lmx5LzFJS1ZoSGggKi9cbiAgQElucHV0KCkgc2V0IGZvcm1hdHRlclN0cmluZyh2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5vcHRpb25zLmZvcm1hdHRlclN0cmluZyA9IHZhbHVlO1xuXG4gICAgaWYgKHRoaXMuYmFyKSB7XG4gICAgICB0aGlzLmJhci5zZXR0aW5ncy5mb3JtYXR0ZXJTdHJpbmcgPSB2YWx1ZTtcbiAgICAgIHRoaXMudXBkYXRlUmVxdWlyZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBUaGUgZDMgYXhpcyBmb3JtYXQuICovXG4gIEBJbnB1dCgpIHNldCBmb3JtYXQodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMub3B0aW9ucy5mb3JtYXQgPSB2YWx1ZTtcblxuICAgIGlmICh0aGlzLmJhcikge1xuICAgICAgdGhpcy5iYXIuc2V0dGluZ3MuZm9ybWF0ID0gdmFsdWU7XG4gICAgICB0aGlzLnVwZGF0ZVJlcXVpcmVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvKiogQSB0b29sdGlwIGZvciB0aGUgd2hvbGUgY2hhcnQuICovXG4gIEBJbnB1dCgpIHNldCB0b29sdGlwKHZhbHVlOiBzdHJpbmcpIHtcbiAgICB0aGlzLm9wdGlvbnMudG9vbHRpcCA9IHZhbHVlO1xuXG4gICAgaWYgKHRoaXMuYmFyKSB7XG4gICAgICB0aGlzLmJhci5zZXR0aW5ncy50b29sdGlwID0gdmFsdWU7XG4gICAgICB0aGlzLnVwZGF0ZVJlcXVpcmVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvKiogSWYgdHJ1ZSBsb2cgc2NhbGUgaXMgZW5hYmxlZC4gKi9cbiAgQElucHV0KCkgc2V0IHVzZUxvZ1NjYWxlKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5vcHRpb25zLnVzZUxvZ1NjYWxlID0gdmFsdWU7XG5cbiAgICBpZiAodGhpcy5iYXIpIHtcbiAgICAgIHRoaXMuYmFyLnNldHRpbmdzLnVzZUxvZ1NjYWxlID0gdmFsdWU7XG4gICAgICB0aGlzLnVwZGF0ZVJlcXVpcmVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvKiogU2V0dGluZ3MgZm9yIHRoZSBjaGFydCB0aWNrcy4gQ2FuIHNldCB0aWNrczoge2Zvcm1hdDogZDNGb3JtYXQsIG51bWJlcjogbn0gKi9cbiAgQElucHV0KCkgc2V0IHRpY2tzKHZhbHVlOiBvYmplY3QpIHtcbiAgICB0aGlzLm9wdGlvbnMudGlja3MgPSB2YWx1ZTtcblxuICAgIGlmICh0aGlzLmJhcikge1xuICAgICAgdGhpcy5iYXIuc2V0dGluZ3MudGlja3MgPSB2YWx1ZTtcbiAgICAgIHRoaXMudXBkYXRlUmVxdWlyZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBTaG93IHRoZSBpbiB0aGUgYXhpcyBsaW5lcyBvciBub3QuICovXG4gIEBJbnB1dCgpIHNldCBzaG93TGluZXModmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLm9wdGlvbnMuc2hvd0xpbmVzID0gdmFsdWU7XG5cbiAgICBpZiAodGhpcy5iYXIpIHtcbiAgICAgIHRoaXMuYmFyLnNldHRpbmdzLnNob3dMaW5lcyA9IHZhbHVlO1xuICAgICAgdGhpcy51cGRhdGVSZXF1aXJlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgLyoqIEhvdyBmYXIgb3V0IHRoYW4gdGhlIG91dGVyIGNpcmNsZSBzaG91bGQgdGhlIGxhYmVscyBiZSBwbGFjZWQsIHRoaXNcbiAgICogbWF5IGJlIHVzZWZ1bCB0byBhZGp1c3QgZm9yIHNvbWUgbGFiZWxzLiAqL1xuICBASW5wdXQoKSBzZXQgbGFiZWxGYWN0b3IodmFsdWU6IG51bWJlcikge1xuICAgIHRoaXMub3B0aW9ucy5sYWJlbEZhY3RvciA9IHZhbHVlO1xuXG4gICAgaWYgKHRoaXMuYmFyKSB7XG4gICAgICB0aGlzLmJhci5zZXR0aW5ncy5sYWJlbEZhY3RvciA9IHZhbHVlO1xuICAgICAgdGhpcy51cGRhdGVSZXF1aXJlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgLyoqIFRoZSBudW1iZXIgb2YgcGl4ZWxzIGFmdGVyIHdoaWNoIGEgbGFiZWwgbmVlZHMgdG8gYmUgZ2l2ZW4gYSBuZXcgbGluZS5cbiAgICogWW91IG1heSB3YW50IHRvIGNoYW5nZSB0aGlzIGJhc2VkIG9uIGxhYmVsIGRhdGEuICovXG4gIEBJbnB1dCgpIHNldCB3cmFwV2lkdGgodmFsdWU6IG51bWJlcikge1xuICAgIHRoaXMub3B0aW9ucy53cmFwV2lkdGggPSB2YWx1ZTtcblxuICAgIGlmICh0aGlzLmJhcikge1xuICAgICAgdGhpcy5iYXIuc2V0dGluZ3Mud3JhcFdpZHRoID0gdmFsdWU7XG4gICAgICB0aGlzLnVwZGF0ZVJlcXVpcmVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvKiogSWYgdHJ1ZSBjaGFydCBoZWlnaHQgd2lsbCBmaXQgaW4gcGFyZW50IGF2YWlsYWJsZSBoZWlnaHQuICovXG4gIEBJbnB1dCgpIHNldCBmaXRIZWlnaHQodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLm9wdGlvbnMuZml0SGVpZ2h0ID0gdmFsdWU7XG5cbiAgICBpZiAodGhpcy5iYXIpIHtcbiAgICAgIHRoaXMuYmFyLnNldHRpbmdzLmZpdEhlaWdodCA9IHZhbHVlO1xuICAgICAgdGhpcy51cGRhdGVSZXF1aXJlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgLyoqIEFuIGVtcHR5IG1lc3NhZ2Ugd2lsbCBiZSBkaXNwbGF5ZWQgd2hlbiB0aGVyZSBpcyBubyBjaGFydCBkYXRhLiAqL1xuICBASW5wdXQoKSBzZXQgZW1wdHlNZXNzYWdlKHZhbHVlOiBTb2hvRW1wdHlNZXNzYWdlT3B0aW9ucykge1xuICAgIHRoaXMub3B0aW9ucy5lbXB0eU1lc3NhZ2UgPSB2YWx1ZTtcblxuICAgIGlmICh0aGlzLmJhcikge1xuICAgICAgdGhpcy5iYXIuc2V0dGluZ3MuZW1wdHlNZXNzYWdlID0gdmFsdWU7XG4gICAgICB0aGlzLnVwZGF0ZVJlcXVpcmVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQWRkIGV4dHJhIGF0dHJpYnV0ZXMgbGlrZSBpZCdzIHRvIHRoZSBjb21wb25lbnRcbiAgICpcbiAgICogQHBhcmFtIGF0dHJpYnV0ZXMgLSB0aGUgYXJyYXkgb3Igb2JqZWN0IG9mIGF0dHJpYnV0ZXMgdG8gYWRkXG4gICAqL1xuICBASW5wdXQoKSBzZXQgYXR0cmlidXRlcyhhdHRyaWJ1dGVzOiBBcnJheTxPYmplY3Q+IHwgT2JqZWN0KSB7XG4gICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzO1xuXG4gICAgaWYgKHRoaXMuYmFyKSB7XG4gICAgICB0aGlzLmJhci5zZXR0aW5ncy5hdHRyaWJ1dGVzID0gYXR0cmlidXRlcztcbiAgICAgIHRoaXMudXBkYXRlUmVxdWlyZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBFdmVudHMgKi9cbiAgQE91dHB1dCgpIHNlbGVjdGVkOiBFdmVudEVtaXR0ZXI8U29ob0JhclNlbGVjdEV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8U29ob0JhclNlbGVjdEV2ZW50PigpO1xuICBAT3V0cHV0KCkgdW5zZWxlY3RlZDogRXZlbnRFbWl0dGVyPFNvaG9CYXJTZWxlY3RFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPFNvaG9CYXJTZWxlY3RFdmVudD4oKTtcbiAgQE91dHB1dCgpIHJlbmRlcmVkOiBFdmVudEVtaXR0ZXI8T2JqZWN0PiA9IG5ldyBFdmVudEVtaXR0ZXI8T2JqZWN0PigpO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L25vLW91dHB1dC1uYXRpdmUsIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtcmVuYW1lXG4gIEBPdXRwdXQoKSBkYmxjbGljazogRXZlbnRFbWl0dGVyPE9iamVjdD4gPSBuZXcgRXZlbnRFbWl0dGVyPE9iamVjdD4oKTtcbiAgLyoqXG4gICAqIEB0b2RvIHJlcGxhY2Ugb3ZlcnJpZGUgb2YgbmF0aXZlIGF0dHJpYnV0ZVxuICAgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtbmF0aXZlXG4gIEBPdXRwdXQoKSBjb250ZXh0bWVudTogRXZlbnRFbWl0dGVyPE9iamVjdFtdPiA9IG5ldyBFdmVudEVtaXR0ZXI8T2JqZWN0W10+KCk7XG5cbiAgcHJpdmF0ZSBqUXVlcnlFbGVtZW50PzogSlF1ZXJ5O1xuICBwcml2YXRlIGJhcj86IFNvaG9CYXIgfCBudWxsO1xuICBwcml2YXRlIHVwZGF0ZVJlcXVpcmVkID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBlbGVtZW50OiBFbGVtZW50UmVmLFxuICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsXG4gICkgeyB9XG5cbiAgLyoqIFNldHVwICovXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQgPSBqUXVlcnkodGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQpO1xuXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQuY2hhcnQodGhpcy5vcHRpb25zKTtcbiAgICAgIHRoaXMuYmFyID0gdGhpcy5qUXVlcnlFbGVtZW50LmRhdGEoJ2JhcicpO1xuXG4gICAgICAvLyBTZXR1cCB0aGUgZXZlbnRzXG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub24oJ3NlbGVjdGVkJywgKF9lOiBhbnksIGFyZ3M6IFNvaG9CYXJTZWxlY3RFdmVudCkgPT5cbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHRoaXMuc2VsZWN0ZWQuZW1pdChhcmdzKSkpO1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50Lm9uKCd1bnNlbGVjdGVkJywgKF9lOiBhbnksIGFyZ3M6IFNvaG9CYXJTZWxlY3RFdmVudCkgPT5cbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHRoaXMudW5zZWxlY3RlZC5lbWl0KGFyZ3MpKSk7XG4gICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub24oJ3JlbmRlcmVkJywgKC4uLmFyZ3MpID0+XG4gICAgICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLnJlbmRlcmVkLmVtaXQoYXJncykpKTtcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vbignY29udGV4dG1lbnUnLCAoLi4uYXJncykgPT5cbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHRoaXMuY29udGV4dG1lbnU/LmVtaXQoYXJncykpKTtcbiAgICAgIHRoaXMualF1ZXJ5RWxlbWVudC5vbignZGJsY2xpY2snLCAoX2U6IGFueSwgYXJnczogT2JqZWN0KSA9PlxuICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gdGhpcy5kYmxjbGljay5lbWl0KGFyZ3MpKSk7XG4gICAgfSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0NoZWNrZWQoKSB7XG4gICAgaWYgKHRoaXMuYmFyICYmIHRoaXMudXBkYXRlUmVxdWlyZWQpIHtcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuYmFyPy51cGRhdGVkKHRoaXMuYmFyLnNldHRpbmdzKSk7XG4gICAgICB0aGlzLnVwZGF0ZVJlcXVpcmVkID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgdXBkYXRlZCgpIHtcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICB0aGlzLm9wdGlvbnMudHlwZSA9ICdiYXInO1xuICAgICAgdGhpcy5qUXVlcnlFbGVtZW50Py5jaGFydCh0aGlzLm9wdGlvbnMpO1xuICAgICAgdGhpcy5iYXIgPSB0aGlzLmpRdWVyeUVsZW1lbnQ/LmRhdGEoJ2JhcicpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqIFRlYXIgRG93biAqL1xuICBuZ09uRGVzdHJveSgpIHtcbiAgICAvLyBjYWxsIG91dHNpZGUgdGhlIGFuZ3VsYXIgem9uZSBzbyBjaGFuZ2UgZGV0ZWN0aW9uIGlzbid0IHRyaWdnZXJlZCBieSB0aGUgc29obyBjb21wb25lbnQuXG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgaWYgKHRoaXMualF1ZXJ5RWxlbWVudCkge1xuICAgICAgICB0aGlzLmpRdWVyeUVsZW1lbnQub2ZmKCk7XG4gICAgICAgIHRoaXMualF1ZXJ5RWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmJhcikge1xuICAgICAgICB0aGlzLmJhci5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMuYmFyID0gbnVsbDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRTZWxlY3RlZChzZWxlY3RlZDogU29ob0JhclNlbGVjdGVkKSB7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4gdGhpcy5iYXI/LnNldFNlbGVjdGVkKHNlbGVjdGVkKSk7XG4gIH1cblxuICBwdWJsaWMgdG9nZ2xlU2VsZWN0ZWQoc2VsZWN0ZWQ6IFNvaG9CYXJTZWxlY3RlZCkge1xuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuYmFyPy50b2dnbGVTZWxlY3RlZChzZWxlY3RlZCkpO1xuICB9XG5cbiAgcHVibGljIGdldFNlbGVjdGVkKCk6IFNvaG9CYXJTZWxlY3RlZCB7XG4gICAgcmV0dXJuIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+ICh0aGlzLmJhciBhcyBhbnkpLmdldFNlbGVjdGVkKCkpO1xuICB9XG59XG4iXX0=