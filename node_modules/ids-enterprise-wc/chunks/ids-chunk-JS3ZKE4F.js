import{a as r}from"./ids-chunk-OIS6KGMU.js";import{e as a}from"./ids-chunk-QPDOZZIG.js";import{a as s}from"./ids-chunk-EQJWBFQ2.js";var h=n=>class extends n{datasource=new r;constructor(...t){super(...t)}static get attributes(){return[...n.attributes,s.AUTOCOMPLETE,s.SEARCH_FIELD]}connectedCallback(){if(super.connectedCallback(),!this.autocomplete){this.destroyAutocomplete();return}this.#i(),this.#s(),this.#n(),this.#o()}set autocomplete(t){let e=a(t);this.container&&(e?(this.setAttribute(s.AUTOCOMPLETE,""),this.container?.classList.add("autocomplete")):(this.removeAttribute(s.AUTOCOMPLETE),this.container?.classList.remove("autocomplete")))}get autocomplete(){return this.hasAttribute(s.AUTOCOMPLETE)}set data(t){this.datasource&&(this.datasource.data=t||[],this.#e())}get data(){return this?.datasource?.data||[]}set searchField(t){t?this.setAttribute(s.SEARCH_FIELD,t):this.removeAttribute(s.SEARCH_FIELD)}get searchField(){let t=this.data&&Object?.keys(this.data[0]);return this.getAttribute(s.SEARCH_FIELD)||t[0]}get popup(){return this.shadowRoot?.querySelector("ids-popup")}get listBox(){return this.shadowRoot?.querySelector("ids-list-box")}get options(){return this.shadowRoot?.querySelectorAll("ids-list-box-option")}get isSelected(){return this.shadowRoot?.querySelector("ids-list-box-option.is-selected")}findMatches(t,e){return e.filter(i=>{let o=new RegExp(t,"gi");return i[this.searchField].toString()?.match(o)})}displayMatches(){if(this.readonly||this.disabled)return;let t=this,i=this.findMatches(t.value,this.data)?.map(o=>{let l=new RegExp(t.value,"gi"),p=o[this.searchField].toString()?.replace(l,`<span class="highlight">${t.value?.toLowerCase()}</span>`);return this.#t(o[this.searchField],p)}).join("");t.value?(this.openPopup(),this.listBox.innerHTML=i||`<ids-list-box-option>${this.localeAPI.translate("NoResults")}</ids-list-box-option>`,this.popup.place()):(this.clearOptions(),this.closePopup())}#e(){this.listBox&&(this.listBox.innerHTML=this.data.map(t=>{let e=t[this.searchField];return this.#t(e,e)}))}#t(t,e){return`<ids-list-box-option value="${t}">${e}</ids-list-box-option>`}#s(){let t={role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":this.listBox?.getAttribute("id")||`ids-list-box-${this.id}`};return this.listBox&&(this.listBox.setAttribute("id",`ids-list-box-${this.id}`),this.listBox.setAttribute("aria-label","Listbox")),Object.keys(t).forEach(e=>this.setAttribute(e,t[e])),this}closePopup(){this.popup.open=!1,this.popup.visible=!1}openPopup(){this.popup.open=!0,this.popup.visible=!0}selectOption(t){t.target.nodeName==="IDS-LIST-BOX-OPTION"&&this.setSelectedOption(t.target),this.isSelected&&(this.value=this.isSelected.getAttribute("value"),this.triggerEvent("selected",this,{bubbles:!0,detail:{elem:this,value:this.value}})),this.closePopup()}clearOptions(){this.triggerEvent("cleared",this,{bubbles:!0,detail:{elem:this,value:this.value}})}setSelectedOption(t){t.classList.add("is-selected"),t.setAttribute("tabindex","0")}removeSelectedOption(t){t.classList.remove("is-selected"),t.setAttribute("tabindex","-1")}#i(){this.popup.type="dropdown",this.popup.align="bottom, left",this.popup.alignTarget=this.fieldContainer,this.popup.y=-1}#o(){this.onEvent("keydownend",this,this.displayMatches),this.onEvent("mousedown",this.listBox,this.selectOption.bind(this)),this.onEvent("blur",this,this.closePopup)}#n(){this.listen(["ArrowDown"],this,t=>{t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault();let e=this.isSelected,i=this.options[0],o=this.options[this.options.length-1];e||this.setSelectedOption(i),e?.nextElementSibling&&(this.removeSelectedOption(e),this.setSelectedOption(e.nextElementSibling),e.nextElementSibling.focus()),e===o&&(this.removeSelectedOption(e),this.setSelectedOption(i))}),this.listen(["ArrowUp"],this,t=>{t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault();let e=this.isSelected,i=this.options[0],o=this.options[this.options.length-1];if(t.altKey){this.value=e.getAttribute("value"),this.closePopup();return}e?.previousElementSibling&&(this.removeSelectedOption(e),this.setSelectedOption(e.previousElementSibling),e.previousElementSibling.focus()),e===i&&(this.removeSelectedOption(e),this.setSelectedOption(o))}),this.listen([" ","Enter"],this.listBox,this.selectOption.bind(this)),this.listen(["Escape"],this.listBox,this.closePopup.bind(this))}#a(){this.offEvent("keyup",this,this.displayMatches),this.offEvent("change",this,this.displayMatches),this.offEvent("blur",this,this.closePopup)}destroyAutocomplete(){this.#a()}},g=h;export{g as a};
