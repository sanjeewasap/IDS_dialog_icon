import{a as C}from"./ids-chunk-XE4WFW5M.js";import{a as G}from"./ids-chunk-GFV2Z7F5.js";import{a as y,b as l,c as n,d as c}from"./ids-chunk-U7OOVFXE.js";var m,E,f,w,p,b,v,V,d=class extends G{constructor(){super({noShadowRoot:!0});n(this,m);n(this,f);n(this,p);n(this,v);l(this,"rootNode");l(this,"isInValid",!1);l(this,"originalValue");l(this,"previousInvalidState","");l(this,"editor");l(this,"isEditing")}connectedCallback(){super.connectedCallback()}get dataGrid(){return this.rootNode||(this.rootNode=this.getRootNode()),this.rootNode.host}get column(){return this.dataGrid?.columns[Number(this.getAttribute("aria-colindex"))-1]}get row(){return Number(this.parentElement?.getAttribute("data-index"))}renderCell(){let i=this.column,t=Number(this.parentElement?.getAttribute("row-index")),s=this.dataGrid?.data[t],e=d.template(s,i,t,this.dataGrid);this.innerHTML=e}activate(i){return this.dataGrid.activeCell?.node?.removeAttribute("tabindex"),this.dataGrid.activeCell.node=this,this.setAttribute("tabindex","0"),i||this.focus(),this.dataGrid.triggerEvent("activecellchanged",this.dataGrid,{detail:{elem:this,activeCell:this.dataGrid.activeCell}}),this.dataGrid.activeCell}startCellEdit(i){this.dataGrid.activeCellEditor instanceof d&&this.dataGrid.activeCellEditor!==this&&this.dataGrid.activeCellEditor.endCellEdit();let t=this.column;if(!t.editor)return;let s=this.dataGrid.editors.find(o=>o.type===t?.editor?.type);if(!s||!s.editor||this.isEditing)return;let e=!(this.classList.contains("is-readonly")||this.classList.contains("is-disabled"));if(!e)return;let a=o=>{e=!!o};if(this.dataGrid.triggerEvent("beforecelledit",this.dataGrid,{detail:{elem:this,editor:this.editor,column:t,data:this.dataGrid.data[this.dataGrid.activeCell.row],response:a}}),!e)return;this.originalValue=this.textContent,this.editor=s.editor,this.editor.clickEvent=i;let r=this.editor.type;if(r==="dropdown")this.originalValue=this.querySelector("[data-value]")?.getAttribute("data-value");else if(r==="timepicker"||r==="datepicker"){let h=this.dataGrid.data[this.dataGrid.activeCell.row][this.column.field];this.originalValue=h}this.classList.add("is-editing"),this.editor.init(this),this.classList.contains("is-invalid")&&(this.classList.remove("is-invalid"),this.isInValid=!0),t.editor.inline&&this.classList.add("is-inline"),this.isEditing=!0,this.editor.input?.onEvent("focusout",this.editor.input,()=>{this.endCellEdit()}),this.dataGrid?.triggerEvent("celledit",this.dataGrid,{detail:{elem:this,editor:this.editor,column:t,data:this.dataGrid.data[this.row]}}),this.dataGrid.activeCellEditor=this}endCellEdit(){let i=this.column,t=this.editor?.input,s=this.editor?.type;t?.offEvent("focusout",t),s==="input"&&(t?.setDirtyTracker(t?.value),t?.checkValidation()),(s==="dropdown"||s==="timepicker"||s==="datepicker")&&t?.input?.checkValidation();let e=i.editor?.editorSettings?.dirtyTracker&&(t?.isDirty||t?.input.isDirty),a=i.editor?.editorSettings?.validate?t?.isValid:!0,r=this.editor?.save(this);c(this,m,E).call(this,r?.value),e&&c(this,f,w).call(this,r?.dirtyCheckValue??r?.value),a||c(this,p,b).call(this,t?.validationMessages),this.isInValid&&a&&c(this,v,V).call(this),this.editor?.destroy(this),this.renderCell(),this.isEditing=!1,this.classList.remove("is-editing"),this.dataGrid?.triggerEvent("endcelledit",this.dataGrid,{detail:{elem:this,editor:this.editor,column:i,data:this.dataGrid.data[this.row]}}),this.dataGrid.activeCellEditor=void 0}cancelCellEdit(){let i=this.column,t=this.editor?.input;t?.offEvent("focusout",t),t?.setDirtyTracker(t?.value),this.dataGrid?.updateDataset(this.row,{[String(i?.field)]:this.originalValue}),this.editor?.destroy(this),this.renderCell(),this.isEditing=!1,this.classList.remove("is-editing"),this.dataGrid?.triggerEvent("cancelcelledit",this.dataGrid,{detail:{elem:this,editor:this.editor,column:i,data:this.dataGrid.data[this.row],oldValue:this.originalValue}}),this.dataGrid.activeCellEditor=void 0}static template(i,t,s,e){let a=e.cacheHash,r=i.rowSelected?"select":"deselect",o=`${a}:${t.id}:${s}:${r}`;if(!d.cellCache[o]){let h=e.formatters,u="";if(!h[t?.formatter?.name||"text"]&&t?.formatter?u=t?.formatter(i,t,s,e):u=h[t?.formatter?.name||"text"](i,t,s,e),i.invalidCells){let g=i.invalidCells.find(I=>I.cell===e.columnIdxById(t.id));g&&(u+=`<ids-alert icon="error" tooltip="${g?.validationMessages[0]?.message}"></ids-alert>`)}d.cellCache[o]=u}return d.cellCache[o]}clearCache(){let i=this.dataGrid.cacheHash,t=Number(this.parentElement?.getAttribute("row-index")),e=this.dataGrid.data[t].rowSelected?"select":"deselect",a=`${i}:${this.column.id}:${t}:${e}`;delete d.cellCache[a]}refreshCell(){this.clearCache(),this.renderCell()}};m=new WeakSet,E=function(i){let t=this.column;this.dataGrid.resetCache(this.dataGrid?.activeCell.row),t.editor?.editorSettings?.mask==="date"&&(i=this.dataGrid.localeAPI.parseDate(i,t.formatOptions)),this.dataGrid?.updateDataset(this.row,{[String(t?.field)]:i})},f=new WeakSet,w=function(i){let t=this.dataGrid.data[this.row].dirtyCells;t===void 0&&(t=[]);let s=Number(this.getAttribute("aria-colindex"))-1,e=t.filter(a=>a.cell===s);if(e[0]&&i===e[0].originalValue){let a=t.findIndex(r=>r.cell===s);t.splice(a,1),this?.classList.remove("is-dirty"),this.dataGrid?.updateDataset(this.row,{dirtyCells:t});return}this?.classList.add("is-dirty"),e.length===0&&(t.push({cell:Number(this?.getAttribute("aria-colindex"))-1,columnId:this.column.id,originalValue:this?.editor?.input?.dirty.original}),this.dataGrid?.updateDataset(this.row,{dirtyCells:t}))},p=new WeakSet,b=function(i){let t=this.dataGrid.data[this.row].invalidCells;t||(t=[]);let s=Number(this.getAttribute("aria-colindex"))-1,e=t.filter(a=>a.cell===s);this?.classList.add("is-invalid"),e.length===0&&(this.previousInvalidState=i.id,t.push({cell:Number(this?.getAttribute("aria-colindex"))-1,columnId:this.column.id,validationMessages:i}),this.dataGrid?.updateDataset(this.row,{invalidCells:t}))},v=new WeakSet,V=function(){this?.classList.remove("is-invalid"),this.dataGrid?.updateDataset(this.row,{invalidCells:void 0}),this.isInValid=!1},l(d,"cellCache",{}),d=y([C("ids-data-grid-cell")],d);export{d as a};
