import{c as d,d as c}from"./ids-chunk-CK6SA7FU.js";import{a}from"./ids-chunk-27RPCUPT.js";import{e as E,i as m}from"./ids-chunk-QPDOZZIG.js";var p=u=>class extends u{handledEvents=new Map;longPressOn=!1;swipeOn=!1;keyboardFocusOn=!1;keyDownEndOn=!1;hoverEndOn=!1;isClick=!1;timer;slopedMouseLeaveTimer;startX=NaN;startY=NaN;trackedX=NaN;trackedY=NaN;vetoableEventTypes=[];constructor(...e){super(...e),this.detachAllEvents=this.detachAllEvents.bind(this),this.detachEventsByName=this.detachEventsByName.bind(this),this.offEvent=this.offEvent.bind(this),this.onEvent=this.onEvent.bind(this)}static get attributes(){return[...u.attributes]}disconnectedCallback(){super.disconnectedCallback?.(),this.detachAllEvents()}onEvent(e,t,n,s){!t||!n||(e.indexOf("longpress")===0&&this.#a(e,t,s),e.indexOf("keyboardfocus")===0&&this.#d(e,t),e.indexOf("hoverend")===0&&this.#l(e,t,s),e.indexOf("sloped-mouseleave")===0&&this.#v(e,t,s),e.indexOf("keydownend")===0&&this.#c(t,s),e.indexOf("swipe")===0&&this.#h(e,t,s),t.addEventListener(a(e),n,s),this.handledEvents.set(e,{target:t,callback:n,options:s}))}offEvent(e,t,n){let s=this.handledEvents.get(e);if(this.handledEvents.delete(e),e.indexOf("longpress")===0&&s?.callback){this.#t();return}if(e.indexOf("keyboardfocus")===0&&s?.callback){this.#n();return}if(e.indexOf("hoverend")===0&&s?.callback){this.#r();return}if(e.indexOf("sloped-mouseleave")===0&&s?.callback){this.#i();return}if(e.indexOf("keydownend")===0&&s?.callback){this.#o();return}if(e.indexOf("swipe")===0&&s?.callback){this.#s();return}let i=t||s?.target;s?.callback&&i?.removeEventListener&&i.removeEventListener(a(e),s.callback,n||s.options)}triggerEvent(e,t,n){let s=new CustomEvent(a(e),n);t.dispatchEvent(s)}triggerVetoableEvent(e,t){if(!this.vetoableEventTypes?.includes(e))return!1;let n=!0,s=i=>{n=E(i)};return this.triggerEvent(e,this,{bubbles:!0,detail:{data:t,elem:this,response:s}}),n}detachAllEvents(){this.handledEvents.forEach((e,t)=>{this.offEvent(t,e.target,e.options)}),this.#t(),this.#n(),this.#r(),this.#i(),this.#o(),this.#s()}detachEventsByName=e=>{let t=typeof e=="string"&&!!e.length,n=this.handledEvents.has(e);if(t&&n){let s=this.handledEvents.get(e);this.offEvent(e,s.target,s.options)}};#a(e,t,n){this.longPressOn||(this.onEvent("touchstart.longpress",t,s=>{s.preventDefault(),this.clearTimer(),this.timer=d(()=>{let i=new CustomEvent("longpress",s);t.dispatchEvent(i),this.clearTimer()},n?.delay?n.delay:500)},{passive:!0}),this.onEvent("touchend.longpress",t,s=>{s.preventDefault(),this.clearTimer()},{passive:!0}),this.longPressOn=!0)}#t(){this.longPressOn&&(this.longPressOn=!1,this.clearTimer(),this.detachEventsByName("touchstart.longpress"),this.detachEventsByName("touchend.longpress"))}#h(e,t,n){if(this.swipeOn)return;let s=0,i=0;if(n&&(n.passive=!0),this.onEvent("touchstart.swipe",t,r=>{s=r.changedTouches[0].screenX},n),this.onEvent("touchend.swipe",t,r=>{i=r.changedTouches[0].screenX;let o="";if(i<s&&(o="left"),i>s&&(o="right"),!o)return;let h=new CustomEvent("swipe",{detail:{direction:o,trigger:"touch"}});t.dispatchEvent(h)},n),n?.scrollContainer){let r=0;this.onEvent("scroll",n.scrollContainer,o=>{let h=o.target,l=100*(h.scrollLeft/(h.scrollWidth-h.clientWidth));if(Math.abs(r-l)<1)return;r=l;let v="";if(l===0&&(v="right"),l>98&&(v="left"),!v)return;let f=new CustomEvent("swipe",{detail:{direction:v,trigger:"scroll"}});t.dispatchEvent(f)},{passive:!0})}this.swipeOn=!0}#s(){this.swipeOn&&(this.swipeOn=!1,this.detachEventsByName("touchstart.swipe"),this.detachEventsByName("touchend.swipe"))}#d(e,t){this.keyboardFocusOn||(this.isClick=!1,this.onEvent("click.keyboardfocus",t,()=>{this.isClick=!0}),this.onEvent("keypress.keyboardfocus",t,()=>{this.isClick=!1}),this.onEvent("focus.keyboardfocus",t,n=>{let s=new CustomEvent("keyboardfocus",n);t.dispatchEvent(s)}),this.keyboardFocusOn=!0)}#n(){this.keyboardFocusOn&&(this.keyboardFocusOn=!1,this.detachEventsByName("click.keyboardfocus"),this.detachEventsByName("keypress.keyboardfocus"))}#l(e,t,n){this.onEvent("mouseenter.eventsmixin",t,s=>{this.clearTimer(),this.timer=d(()=>{let i=new MouseEvent(a(e),s);t.dispatchEvent(i),this.clearTimer()},n?.delay)}),this.onEvent("mouseleave.eventsmixin",t,()=>{this.clearTimer()}),this.onEvent("click.eventsmixin",t,()=>{this.clearTimer()}),this.hoverEndOn=!0}#v(e,t,n){let s=(i,r)=>{let o=new CustomEvent(a(e),{detail:{originalEvent:r,mouseLeaveNode:i}});t.dispatchEvent(o),this.#e()};this.onEvent("mouseleave.eventsmixin",t,i=>{this.slopedMouseLeaveTimer||(this.startX=i.pageX,this.startY=i.pageY,this.slopedMouseLeaveTimer=d(()=>{let r=this.trackedX-this.startX>3.5,o=this.trackedY-this.startY>3.5;(r||o)&&s(document.elementFromPoint(this.trackedX,this.trackedY),i)},n?.delay),this.onEvent("mousemove.eventsmixin",document,r=>{this.trackedX=r.pageX,this.trackedY=r.pageY}),this.onEvent("mouseenter.eventsmixin",t,()=>{this.#e()}))})}#e(){this.slopedMouseLeaveTimer&&c(this.slopedMouseLeaveTimer),this.slopedMouseLeaveTimer=void 0,this.detachEventsByName("mousemove.eventsmixin"),this.detachEventsByName("mouseenter.eventsmixin"),this.startX=NaN,this.startY=NaN,this.trackedX=NaN,this.trackedY=NaN}#i(){this.slopedMouseLeaveTimer&&(this.detachEventsByName("mouseleave.eventsmixin"),this.#e())}#c(e,t){let n="",s=t?.delay||500;this.onEvent("keydown.eventsmixin",e,i=>{typeof i.key>"u"&&i.detail?.nativeEvent&&(i=i.detail.nativeEvent),m(i)&&(n+=i.key,this.clearTimer(),this.timer=d(()=>{let r=new CustomEvent("keydownend",{detail:{keys:n}});n="",e.dispatchEvent(r),this.clearTimer()},s))}),this.keyDownEndOn=!0}clearTimer(){this.timer&&c(this.timer),this.timer=void 0}#r(){this.hoverEndOn&&(this.hoverEndOn=!1,this.detachEventsByName("click.eventsmixin"),this.detachEventsByName("mousemove.eventsmixin"),this.detachEventsByName("mouseleave.eventsmixin"),this.detachEventsByName("mouseenter.eventsmixin"),this.clearTimer())}#o(){this.keyDownEndOn&&(this.keyDownEndOn=!1,this.clearTimer(),this.detachEventsByName("keydown.eventsmixin"))}},O=p;export{O as a};
