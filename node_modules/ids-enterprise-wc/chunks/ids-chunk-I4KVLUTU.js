import{b as A}from"./ids-chunk-M7IB5XSG.js";import{j as v}from"./ids-chunk-4W3JMIJK.js";import{a as o}from"./ids-chunk-EQJWBFQ2.js";var p=f=>class extends f{isTypeNotValid;constructor(...t){super(...t)}connectedCallback(){super.connectedCallback?.(),this.handleValidation()}static get attributes(){return[...f.attributes,o.VALIDATE,o.VALIDATION_EVENTS,o.VALIDATION_ICON,o.VALIDATION_ID,o.VALIDATION_MESSAGE,o.VALIDATION_TYPE]}useRules=new Map;validationEventsList=[];VALIDATION_DEFAULT_ICON="user-profile";VALIDATION_ICONS={alert:"alert",error:"error",info:"info",success:"success"};handleValidation(){let t=this,e=t.input?.classList.contains("ids-radio-group"),i=!e||!!(e&&this.querySelector("ids-radio"));if(t.labelEl&&typeof this.validate=="string"&&i){let a=this.validationEvents&&typeof this.validationEvents=="string"?this.validationEvents:"change.validationmixin blur.validationmixin";this.validationEventsList=[...new Set(a.split(" "))];let r=n=>({id:n,rule:this.rules[n]}),s=!1;this.validate.split(" ").forEach(n=>{if(!r(n).rule)return;n==="required"&&(t.labelEl?.classList.add("required"),t.input?.setAttribute("aria-required",!0),e&&[].slice.call(this.querySelectorAll("ids-radio")).forEach(c=>c.input.setAttribute("required","required")),this.validationElems?.editor?.setAttribute("aria-required",!0)),(u=>{let c=this.useRules.get(u);if(c){if(!c.some(g=>g.id===n)){let g=[...c,r(n)];this.useRules.set(u,g),s=!0}}else this.useRules.set(u,[r(n)]),s=!0})(t.input)}),s&&this.handleValidationEvents();let l=this.validate?.split(" "),d=this.useRules.get(t.input);if(t.input&&d?.length>l?.length){let n=[];l.forEach(h=>{d=d.filter(u=>u.id===h?!0:(n.push(u.id),!1))}),n.forEach(h=>this.removeValidationMessage({id:h})),this.useRules.set(t.input,d)}}else this.destroyValidation()}checkValidation(){let t=e=>{this.isTypeNotValid={};let i=!0;this.useRules.get(e)?.forEach(r=>{r.rule!==void 0&&!r.rule?.check(e)&&this.isTypeNotValid?(this.addMessage(r.rule),i=!1,this.isTypeNotValid[r.rule.type]=!0):r.rule!==void 0&&this.removeMessage(r.rule)}),this.isTypeNotValid=null,this.triggerEvent("validate",this,{detail:{elem:this,value:this.value,isValid:i}})};this.input&&(t(this.input),this.#t())}addValidationRule(t){let e=s=>typeof s=="string"&&s!=="",i=[],a=!1,r=s=>{let{id:l,type:d,message:n}=s;e(l)&&e(d)&&e(n)&&typeof s.check=="function"&&(this.rules[l]||(a=!0,this.rules[l]=s,(!this.validate||!new RegExp(l).test(this.validate))&&i.push(l)))};if(t?.constructor===Array?t.forEach(s=>r(s)):r(t),a){if(i.length){let s=this.validate?`${this.validate} `:"";this.validate=`${s}${[...new Set(i)].join(" ")}`}this.handleValidation()}}removeValidationRule(t){let e=s=>typeof s=="string"&&s!=="",i=this.validate,a=!1,r=s=>{e(s)&&this.rules[s]&&new RegExp(s).test(i)&&(a=!0,delete this.rules[s],i=i?.replace(s,"")||null)};t?.constructor===Array?t.forEach(s=>r(s)):r(t),a&&(this.validate=i?.replace(/\s\s+/g," ").trim()||null)}addValidationMessage(t){let e=i=>{A(i)&&this.addMessage(i)};t?.constructor===Array?t.forEach(i=>e(i)):e(t),this.#t()}removeValidationMessage(t){let e=i=>{A(i)&&this.removeMessage(i)};t?.constructor===Array?t.forEach(i=>e(i)):e(t),this.#t()}addMessage(t){let{id:e,type:i,message:a,icon:r}=t,s=this;if(!e)return;let l=this.shadowRoot?.querySelector(`[validation-id="${e}"]`);if(l)return;let d=new RegExp(`^\\b(${Object.keys(this.VALIDATION_ICONS).join("|")})\\b$`,"g"),n=i&&d.test(i),h=n?i.replace(/^./,i[0].toUpperCase()):null;h=h?`<ids-text audible="true">${h} </ids-text>`:"";let u="validation-message",c=i?this.VALIDATION_ICONS[i]:"",I=`${s.input?.getAttribute("id")}-${t.type}`;!c&&i==="icon"&&(c=r||this.VALIDATION_DEFAULT_ICON,u+=c?" has-custom-icon":""),u+=n?` ${i}`:"",u+=this.disabled?" disabled":"";let g=c?`<ids-icon icon="${c}" class="ids-icon"></ids-icon>`:"";l=document.createElement("div"),l.setAttribute("id",I),l.setAttribute("validation-id",e),l.setAttribute("type",i),l.className=u,l.innerHTML=`${g}<ids-text error="true" class="message-text">${h}${a}</ids-text>`,this.validationElems?.main?.classList.add(i),s.fieldContainer?.classList.add(i??""),s.input?.setAttribute("aria-describedby",I),s.input?.setAttribute("aria-invalid","true"),(this.shadowRoot?.querySelector(".ids-input, .ids-textarea, .ids-checkbox")||this.shadowRoot)?.appendChild(l),s.input?.classList.contains("ids-radio-group")&&[].slice.call(this.querySelectorAll("ids-radio")).forEach(m=>m.setAttribute("validation-has-error","true"))}removeMessage(t){let e=this,i=t.id,a=t.type,r=d=>{if(d){let n=i===null||typeof i>"u"?d.getAttribute("id"):i;a||(a=d.getAttribute("type")),this.isTypeNotValid||(this.isTypeNotValid={}),d.remove?.(),this.validationId===n&&(this.validationId=null,this.validationType=null,this.validationMessage=null,this.validationIcon=null)}},s=this.shadowRoot?.querySelector(`[validation-id="${i}"]`);s?r(s):a&&(i===null||typeof i>"u")&&(this.shadowRoot?.querySelectorAll(`.validation-message[type="${a}"]`)).forEach(n=>r(n)),a&&this.isTypeNotValid&&!this.isTypeNotValid[a]&&(e.fieldContainer?.classList.remove(a),e.input?.removeAttribute("aria-describedby"),e.input?.removeAttribute("aria-invalid")),e.input?.classList.contains("ids-radio-group")&&[].slice.call(this.querySelectorAll("ids-radio")).forEach(n=>n.removeAttribute("validation-has-error")),a&&this.validationElems?.main?.classList.remove(a)}removeAllValidationMessages(){[].slice.call(this.shadowRoot?.querySelectorAll(".validation-message")).forEach(e=>{let i={id:e.getAttribute("validation-id")},a=e.getAttribute("type");a&&(i.type=a),this.removeMessage(i)}),this.#t()}setMessageManually(){let t=s=>typeof s=="string"&&s.trim()!==""?s.trim():"",e=t(this.validationId),i=t(this.validationType),a=t(this.validationMessage),r=t(this.validationIcon);if(e&&i&&a){let s={id:e,type:i,message:a,icon:r};this.removeMessage(s),this.addMessage(s),this.#t()}}#t(){let t=this.validationMessagesCount,e="validation-message-count";t>0?this.setAttribute(e,String(t)):this.removeAttribute(e)}handleValidationEvents(t=""){let e=i=>{this.validationEventsList.forEach(a=>{if(t==="remove"){let r=this.handledEvents.get(a);r&&r.target===i&&this.offEvent(a,i)}else this.onEvent(a,i,()=>{this.checkValidation()})})};this.input&&e(this.input)}destroyValidation(){let t=e=>{this.useRules.get(e)&&(this.handleValidationEvents("remove"),this.useRules.delete(e)),/\brequired\b/gi.test(this.validate)||(this.labelEl?.classList.remove("required"),e.removeAttribute("aria-required"),this.validationElems?.editor?.removeAttribute("aria-required")),this.removeAllValidationMessages()};this.input&&t(this.input)}rules={required:{check:t=>{if(t.getAttribute("type")==="checkbox")return t.checked;if(t.classList.contains("ids-radio-group"))return t.getRootNode()?.host?.checked;let e=t.value;return!(e===null||typeof e=="string"&&e===""||typeof e=="number"&&Number.isNaN(e))},message:"Required",type:"error",id:"required"},email:{check:t=>{let e=t.value,i=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,16}(?:\.[a-z]{2})?)$/i;return e.length?i.test(e):!0},message:"Email address not valid",type:"error",id:"email"},date:{check(t){let e=t.getRootNode().host,i=t.value;if(t instanceof Date)return t&&t.getTime&&!Number.isNaN(t.getTime());let a=e.format,r={};return a&&(r.dateFormat=a),this.message=e.localeAPI.translate("InvalidDate",{showBrackets:!1}),!(e.localeAPI.parseDate(i,r)===void 0&&i!=="")},message:"Invalid Date",type:"error",id:"date"},time:{check(t){let e=t.getRootNode().host,i=t.value;if(!i)return!0;let a=e.localeAPI.calendar(e.localeAPI.locale.name).timeFormat,s=e.format||a;this.message=e.localeAPI.translate("InvalidTime",{showBrackets:!1});let l=e.localeAPI.parseDate(i,{dateFormat:s,strictTime:!0});return v(l)},message:"Invalid Time",type:"error",id:"time"}};set validate(t){t?this.setAttribute(o.VALIDATE,t):this.removeAttribute(o.VALIDATE),this.handleValidation()}get validate(){return this.getAttribute(o.VALIDATE)}set validationEvents(t){t?this.setAttribute(o.VALIDATION_EVENTS,t):this.removeAttribute(o.VALIDATION_EVENTS),this.handleValidation()}get validationEvents(){return this.getAttribute(o.VALIDATION_EVENTS)}set validationIcon(t){t?this.setAttribute(o.VALIDATION_ICON,t):this.removeAttribute(o.VALIDATION_ICON),this.setMessageManually()}get validationIcon(){return this.getAttribute(o.VALIDATION_ICON)}set validationId(t){t?this.setAttribute(o.VALIDATION_ID,t):this.removeAttribute(o.VALIDATION_ID),this.setMessageManually()}get validationId(){return this.getAttribute(o.VALIDATION_ID)}set validationMessage(t){t?this.setAttribute(o.VALIDATION_MESSAGE,t):this.removeAttribute(o.VALIDATION_MESSAGE),this.setMessageManually()}get validationMessage(){return this.getAttribute(o.VALIDATION_MESSAGE)}set validationType(t){t?this.setAttribute(o.VALIDATION_TYPE,t):this.removeAttribute(o.VALIDATION_TYPE),this.setMessageManually()}get validationType(){return this.getAttribute(o.VALIDATION_TYPE)}get isValid(){return this.shadowRoot?.querySelectorAll(".validation-message").length===0}get validationMessages(){let t=[];return this.shadowRoot?.querySelectorAll(".validation-message").forEach(e=>{t.push({message:e.querySelector("ids-text")?.childNodes[1].textContent||"",type:e.getAttribute("type")||"",id:e.getAttribute("validation-id")||""})}),t}get validationMessagesCount(){return this.shadowRoot?.querySelectorAll(".validation-message")?.length||0}},L=p;export{L as a};
