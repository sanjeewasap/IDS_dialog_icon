import{a}from"./ids-chunk-QWU6YXGX.js";var o={LOCAL_FILE_HEADER:"PK",CENTRAL_FILE_HEADER:"PK",CENTRAL_DIRECTORY_END:"PK",DIR_FILE_ATTR:"\0\xFDA",NON_DIR_FILE_ATTR:"\0\0\xB4\x81"},c=class{root="";entries={};bytesWritten=0;dataArray=[];file(e,t){e=this.root+e,this.addEntry(e,t,!1)}zip(e){return this.createZipFile(Object.values(this.entries),e)}addFolderEntry(e){return this.entries[e]||this.addEntry(e,null,!0),this.entries[e]}addEntry(e,t,r){let n=this.isNested(e);n&&this.addFolderEntry(n),(r||!t||t.length===0)&&(t=new Uint8Array);let i=new a(e,t,r);this.entries[e]=i}isNested(e){e.slice(-1)==="/"&&(e=e.substring(0,e.length-1));let t=e.lastIndexOf("/");return t>0?e.substring(0,t):""}createZipFile(e,t){let r=[];e.forEach(i=>{let s=this.processEntry(i,this.bytesWritten);this.writeData(s.localFileHeader),this.writeData(s.content),r.push(s.centralDirectoryFileHeader)}),this.closeZipFile(r);let n=this.concat(this.dataArray);return new Blob([n.buffer],{type:t})}processEntry(e,t){let r=e.processData(),n=this.generateHeaderPartial(e),i=this.generateLocalFileHeader(n,e),s=this.generateCentralDirectoryFileHeader(e,n,t);return{localFileHeader:i,centralDirectoryFileHeader:s,content:r}}closeZipFile(e){let t=this.bytesWritten;for(let i=0;i<e.length;i++)this.writeData(e[i]);let r=this.bytesWritten-t,n=this.generateEndOfCentralDirectory(e.length,r,t);this.writeData(n)}writeData(e){e&&e.length&&(this.dataArray.push(this.transform(e)),this.bytesWritten+=e.length)}transform(e){if(typeof e!="string")return e;let t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t[r]=e.charCodeAt(r)&255;return t}concat(e){let t=e.reduce((i,s)=>i+s.length,0),r=new Uint8Array(t),n=0;for(let i=0;i<e.length;i++)r.set(e[i],n),n+=e[i].length;return r}generateHeaderPartial(e){let t=e.compression,r=e.date,n,i;return n=r.getUTCHours(),n<<=6,n|=r.getUTCMinutes(),n<<=5,n|=r.getUTCSeconds()/2,i=r.getUTCFullYear()-1980,i<<=4,i|=r.getUTCMonth()+1,i<<=5,i|=r.getUTCDate(),[`
\0`,"\0\0",t,this.decToHex(n,2),this.decToHex(i,2),this.decToHex(e.crc32,4),this.decToHex(e.compressedSize,4),this.decToHex(e.uncompressedSize,4),this.decToHex(e.name.length,2),"\0\0"].join("")}generateLocalFileHeader(e,t){return o.LOCAL_FILE_HEADER+e+t.name}generateCentralDirectoryFileHeader(e,t,r){let i=e.dir?o.DIR_FILE_ATTR:o.NON_DIR_FILE_ATTR;return[o.CENTRAL_FILE_HEADER,this.decToHex(798,2),t,"\0\0","\0\0","\0\0",i,this.decToHex(r,4),e.name,"",""].join("")}generateEndOfCentralDirectory(e,t,r){return[o.CENTRAL_DIRECTORY_END,"\0\0","\0\0",this.decToHex(e,2),this.decToHex(e,2),this.decToHex(t,4),this.decToHex(r,4),"\0\0",""].join("")}decToHex(e,t){let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e&255),e>>>=8;return r}};export{c as a};
