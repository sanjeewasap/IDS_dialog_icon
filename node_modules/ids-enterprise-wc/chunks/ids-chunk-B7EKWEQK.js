import{b as h}from"./ids-chunk-UR2NLGN4.js";import{e as g}from"./ids-chunk-QPDOZZIG.js";import{a as r}from"./ids-chunk-EQJWBFQ2.js";var v=o=>class extends o{constructor(...t){super(...t)}static get attributes(){return[...o.attributes,r.SAVE_ACTIVE_PAGE,r.SAVE_COLUMNS,r.SAVE_FILTER,r.SAVE_PAGE_SIZE,r.SAVE_ROW_HEIGHT,r.SAVE_SORT_ORDER,r.SAVE_USER_SETTINGS]}connectedCallback(){super.connectedCallback?.()}settings={activePage:"active-page",columns:"columns",filter:"filter",pageSize:"page-size",rowHeight:"row-height",sortOrder:"sort-order"};#s=Object.values(this.settings);#i=!0;#r=[];set saveActivePage(t){this.#t(r.SAVE_ACTIVE_PAGE,t)}get saveActivePage(){return this.hasAttribute(r.SAVE_ACTIVE_PAGE)}set saveColumns(t){this.#t(r.SAVE_COLUMNS,t)}get saveColumns(){return this.hasAttribute(r.SAVE_COLUMNS)}set saveFilter(t){this.#t(r.SAVE_FILTER,t)}get saveFilter(){return this.hasAttribute(r.SAVE_FILTER)}set savePageSize(t){this.#t(r.SAVE_PAGE_SIZE,t)}get savePageSize(){return this.hasAttribute(r.SAVE_PAGE_SIZE)}set saveRowHeight(t){this.#t(r.SAVE_ROW_HEIGHT,t)}get saveRowHeight(){return this.hasAttribute(r.SAVE_ROW_HEIGHT)}set saveSortOrder(t){this.#t(r.SAVE_SORT_ORDER,t)}get saveSortOrder(){return this.hasAttribute(r.SAVE_SORT_ORDER)}set saveUserSettings(t){this.#t(r.SAVE_USER_SETTINGS,t)}get saveUserSettings(){return this.hasAttribute(r.SAVE_USER_SETTINGS)}#t(t,e){if(g(e)){this.setAttribute(t,"");return}this.removeAttribute(t)}#a(){try{if(typeof localStorage?.getItem=="function")return!0}catch{return!1}return!1}#n(t,e="",s="",i=this.uniqueId??this.getAttribute("id")??""){return`ids-data-grid-usersettings-${e}-${i}-${t}-${s}`.replace(/-+/g,"-").replace(/-$/g,"")}#o(t){let e=this,s=()=>{let n=[];return e.filters?.filterConditions?.()?.forEach(d=>{let{columnId:S,operator:c,value:l}=d;n.push({columnId:S,operator:c,value:l})}),n},i=this.settings,a=null;return t===i.activePage&&(a=e.datasource.pageNumber),t===i.columns&&(a=h(e.columns)),t===i.filter&&(a=s()),t===i.pageSize&&(a=e.datasource.pageSize),t===i.rowHeight&&(a=e.rowHeight),t===i.sortOrder&&(a=e.sortColumn),{key:this.#n(t),value:a}}#g(t,e){this.#i&&this.#a()&&typeof e<"u"&&e!==null&&localStorage.setItem(t,JSON.stringify(e))}saveSetting(t){if(this.#s.includes(t)){this.#r.includes(t)||this.#r.push(t);let{key:e,value:s}=this.#o(t);this.#g(e,s)}}saveAllSettings(){this.#s.forEach(t=>this.saveSetting(t))}savedSetting(t){let e=null;if(this.#s.includes(t)&&this.#a()){let s=this.#n(t),i=localStorage.getItem(s);typeof i=="string"&&i!==""&&(e=JSON.parse(i))}return e}allSavedSettings(){return Object.fromEntries(Object.entries(this.settings).map(([t,e])=>[t,this.savedSetting(e)]))}clearSetting(t,e){this.#s.includes(t)&&this.#a()&&(e=e??this.#n(t),Object.keys(localStorage).some(i=>i===e)&&localStorage.removeItem(e))}clearAllSettings(t={}){Object.entries(this.settings).forEach(([e,s])=>this.clearSetting(s,t[e]))}restoreSetting(t,e){if(this.#s.includes(t)){let s=this.settings;t===s.activePage&&this.#h(e),t===s.columns&&this.#d(e),t===s.filter&&this.#S(e),t===s.pageSize&&this.#c(e),t===s.rowHeight&&this.#l(e),t===s.sortOrder&&this.#v(e)}}restoreAllSettings(t={}){Object.entries(this.settings).forEach(([e,s])=>this.restoreSetting(s,t[e]))}#e(t,e,s){!this.#r.includes(t)&&typeof e<"u"&&e!==null&&(this.#i=!1,s(),this.#i=!0,this.#r.push(t))}#h(t=this.savedSetting(this.settings.activePage)){this.#e(this.settings.activePage,t,()=>{this.pageNumber=t})}#d(t=this.savedSetting(this.settings.columns)){let e=["cellSelectedCssPart","click","cssPart","disabled","filterType","formatter","isChecked","tooltipCssPart"],s=i=>{let a=this.columnDataById(i.id);e.forEach(n=>{!i[n]&&a[n]&&(i[n]=a[n])})};t?.forEach(i=>s(i)),this.#e(this.settings.columns,t,()=>{this.columns=t})}#S(t=this.savedSetting(this.settings.filter)){this.#e(this.settings.filter,t,()=>{this.applyFilter(t)})}#c(t=this.savedSetting(this.settings.pageSize)){this.#e(this.settings.pageSize,t,()=>{this.pageSize=t})}#l(t=this.savedSetting(this.settings.rowHeight)){this.#e(this.settings.rowHeight,t,()=>{this.rowHeight=t})}#v(t=this.savedSetting(this.settings.sortOrder)){let{id:e,ascending:s}=t||{};this.#e(this.settings.sortOrder,t,()=>{this.setSortColumn(e,s)})}saveSettings(){let t=this;if(!this.#i||!t.initialized||!t.data?.length)return;let e=Object.fromEntries(Object.entries(this.settings).map(([s,i])=>[s,this.#o(i).value]));if(this.triggerEvent("settingschanged",this,{bubbles:!0,detail:{elem:this,settings:e}}),this.saveUserSettings){this.saveAllSettings();return}this.saveActivePage&&this.saveSetting(this.settings.activePage),this.saveColumns&&this.saveSetting(this.settings.columns),this.saveFilter&&this.saveSetting(this.settings.filter),this.savePageSize&&this.saveSetting(this.settings.pageSize),this.saveRowHeight&&this.saveSetting(this.settings.rowHeight),this.saveSortOrder&&this.saveSetting(this.settings.sortOrder)}attachSaveSettingsEventHandlers(){let t=this;this.offEvent("pagenumberchange.data-grid-save-settings"),this.onEvent("pagenumberchange.data-grid-save-settings",t.pager,()=>{this.saveSettings()}),this.offEvent("pagesizechange.data-grid-save-settings"),this.onEvent("pagesizechange.data-grid-save-settings",t.pager,()=>{this.saveSettings()})}},m=v;export{m as a};
