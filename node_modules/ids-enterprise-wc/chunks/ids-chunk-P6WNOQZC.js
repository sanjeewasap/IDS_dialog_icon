import{b as g}from"./ids-chunk-UR2NLGN4.js";import{b as S}from"./ids-chunk-LCUXCSNZ.js";import{e as u,f}from"./ids-chunk-QPDOZZIG.js";import{a as s}from"./ids-chunk-EQJWBFQ2.js";var b=E=>class extends E{constructor(...e){super(...e)}static get attributes(){return[...E.attributes,s.SEARCH_FIELD_ID,s.SEARCH_FILTER_MODE,s.SEARCH_TERM_CASE_SENSITIVE,s.SEARCH_TERM_MIN_SIZE,s.SEARCHABLE,s.SUPPRESS_HIGHLIGHT]}connectedCallback(){super.connectedCallback()}searchFilterModes={CONTAINS:"contains",KEYWORD:"keyword",PHRASE_STARTS_WITH:"phrase-starts-with",WORD_STARTS_WITH:"word-starts-with"};searchFilterCallback=null;searchableTextCallback=null;#e="";get searchContainer(){return this.shadowRoot?.querySelector(".ids-list-view-search")}get searchField(){let e=this.querySelector('ids-search-field[slot="search"]');return!e&&this.searchFieldId&&(e=this.closest("ids-container")?.querySelector(`#${this.searchFieldId}`)),e}set searchFieldId(e){e?this.setAttribute(s.SEARCH_FIELD_ID,String(e)):this.removeAttribute(s.SEARCH_FIELD_ID),this.redraw?.()}get searchFieldId(){return this.getAttribute(s.SEARCH_FIELD_ID)}set searchFilterMode(e){Object.values(this.searchFilterModes).includes(e||"")?this.setAttribute(s.SEARCH_FILTER_MODE,String(e)):this.removeAttribute(s.SEARCH_FILTER_MODE)}get searchFilterMode(){let e=this.searchFilterModes.CONTAINS;return this.getAttribute(s.SEARCH_FILTER_MODE)||e}set searchTermCaseSensitive(e){u(e)?this.setAttribute(s.SEARCH_TERM_CASE_SENSITIVE,""):this.removeAttribute(s.SEARCH_TERM_CASE_SENSITIVE)}get searchTermCaseSensitive(){return this.hasAttribute(s.SEARCH_TERM_CASE_SENSITIVE)}set searchTermMinSize(e){let t=f(e);!Number.isNaN(t)&&t>0?this.setAttribute(s.SEARCH_TERM_MIN_SIZE,t.toString()):this.removeAttribute(s.SEARCH_TERM_MIN_SIZE)}get searchTermMinSize(){let t=f(this.getAttribute(s.SEARCH_TERM_MIN_SIZE));return!Number.isNaN(t)&&t>0?t:1}set searchable(e){u(e)?this.setAttribute(s.SEARCHABLE,""):this.removeAttribute(s.SEARCHABLE),this.setSearchable()}get searchable(){return this.hasAttribute(s.SEARCHABLE)}set suppressHighlight(e){u(e)?this.setAttribute(s.SUPPRESS_HIGHLIGHT,""):this.removeAttribute(s.SUPPRESS_HIGHLIGHT)}get suppressHighlight(){return this.hasAttribute(s.SUPPRESS_HIGHLIGHT)}searchTemplate(){return this.searchFieldId?"":'<div class="ids-list-view-search" part="search"><slot name="search"></slot></div>'}searchFieldTemplate(){return'<ids-search-field slot="search" label="List view search" label-state="collapsed" size="full" exportparts="container: searchfield-container, field-container: searchfield-field-container, input: searchfield-input, popup: searchfield-popup" ids-lv-default-searchfield clearable no-margins></ids-search-field>'}resetSearch(){this.#e="";let e=this;e.datasource?.filtered&&(e.datasource?.filter(null),e.redraw?.(),e.triggerEvent("filtered",e,{bubbles:!0,detail:{elem:e,type:"clear",term:""}}))}setSearchable(){let e=()=>this.shadowRoot?.querySelector('slot[name="search"]')?.assignedElements()[0],t=e();!t&&this.searchable?(this.insertAdjacentHTML("afterbegin",this.searchFieldTemplate()),t=e()):!this.searchable&&t?.hasAttribute("ids-lv-default-searchfield")&&t.remove();let i=!!e();this.container?.classList[i?"add":"remove"]("has-searchfield"),this.searchContainer?.classList[i?"add":"remove"]("has-searchfield"),this.#s()}#s(){let e=this.searchField;e&&(e.onSearch=t=>this.#a(t),this.offEvent("cleared.listviewsearch"),this.onEvent("cleared.listviewsearch",e,()=>this.resetSearch()))}#i(e){let t=["isFilteredOut"],i="";return Object.keys(e).forEach(a=>{if(t.indexOf(a)>0)return;let c=i.length?" ":"";i+=`${c}${e[a]}`}),i}#t(e){let t=!0;if(typeof this.searchableTextCallback=="function")return this.searchableTextCallback(e)??"";let i;return typeof e=="string"?i=e:e instanceof HTMLElement?(t=!1,i=e.innerText):i=this.#i(e),t&&(i=S(i)),i??""}#r(e,t){let i=e.split(" ");for(let a=0;a<i.length;a++)if(i[a].indexOf(t)===0)return!0;return e.indexOf(t)===0||t.indexOf(" ")>0&&e.indexOf(t)>0}#a(e){let t=this;if(!t.datasource)return;let i=typeof e=="string";if(!i||i&&e==="")return this.resetSearch();if(e.length<this.searchTermMinSize){this.resetSearch();return}if(this.#e===e)return;this.#e=e,this.searchTermCaseSensitive||(e=e.toLowerCase());let c=d=>{let h=this.#t(d);this.searchTermCaseSensitive||(h=h.toLowerCase().trim());let r=this.searchFilterModes,n=!1;if(this.searchFilterMode===r.WORD_STARTS_WITH&&(n=this.#r(h,e)),this.searchFilterMode===r.PHRASE_STARTS_WITH&&h.indexOf(e)===0&&(n=!0),this.searchFilterMode===r.CONTAINS&&h.indexOf(e)>=0&&(n=!0),this.searchFilterMode===r.KEYWORD){let o=e.split(" ");for(let l=0;l<o.length;l++)if(h.indexOf(o[l])>=0){n=!0;break}}return!n};typeof this.searchFilterCallback=="function"&&(c=this.searchFilterCallback(e)),t.datasource.filter(c),t.redraw?.(),t.triggerEvent("filtered",t,{bubbles:!0,detail:{elem:t,type:"apply",term:e}})}searchHighlight(e){if(this.suppressHighlight||!e||this.#e==="")return e;let t=null,i=this.searchFilterModes,a=this.searchTermCaseSensitive?"g":"gi",c='<strong class="highlight">$1</strong>',d=o=>o.replace(t,c);if(this.searchFilterMode===i.WORD_STARTS_WITH?(t=new RegExp(`(^|\\s)(${this.#e})`,a),d=o=>o.replace(t,l=>l.replace(new RegExp(`(${this.#e})`,a),c))):this.searchFilterMode===i.PHRASE_STARTS_WITH?t=new RegExp(`^(${this.#e})`,a):(this.searchFilterMode===i.CONTAINS||this.searchFilterMode===i.KEYWORD)&&(t=new RegExp(`(${this.#e})`,a)),!t)return e;let h=this.#e,r=g(e),n=this.#t(r);if(this.searchTermCaseSensitive||(h=h.toLowerCase(),n=n.toLowerCase()),n.indexOf(h)>=0)if(typeof r=="string"&&n===r)r=d(r);else if(r instanceof HTMLElement){let o=r.innerText,l=S(r.innerText);n===l&&(r.innerText=d(o))}else for(let[o,l]of Object.entries(r)){let T=this.searchTermCaseSensitive?l:l?.toString().toLowerCase();n===T&&(r[o]=d(l))}return r}},H=b;export{H as a};
